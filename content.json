{"meta":{"title":"æ²ƒå¾·å‘","subtitle":"ç›¸äº’å¹æ§ï¼Œå…±åŒè¿›æ­¥ğŸ˜ğŸ˜ğŸ˜","description":null,"author":"Yang","url":"http://example.com","root":"/"},"pages":[{"title":"about","date":"2023-12-07T14:14:04.000Z","updated":"2023-12-07T14:19:57.552Z","comments":true,"path":"about/index.html","permalink":"http://example.com/about/index.html","excerpt":"","text":""},{"title":"link","date":"2023-12-07T13:41:21.000Z","updated":"2023-12-07T13:41:48.936Z","comments":true,"path":"link/index.html","permalink":"http://example.com/link/index.html","excerpt":"","text":""},{"title":"categories","date":"2023-11-23T11:58:42.000Z","updated":"2023-11-23T11:59:22.023Z","comments":true,"path":"categories/index.html","permalink":"http://example.com/categories/index.html","excerpt":"","text":""},{"title":"tags","date":"2023-11-23T12:01:15.000Z","updated":"2023-11-23T12:04:24.284Z","comments":true,"path":"tags/index.html","permalink":"http://example.com/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"æ•°æ®é€šä¿¡åŸºç¡€","slug":"æ•°æ®é€šä¿¡åŸºç¡€","date":"2024-07-08T10:53:28.000Z","updated":"2024-07-08T11:41:56.010Z","comments":true,"path":"2024/07/08/æ•°æ®é€šä¿¡åŸºç¡€/","permalink":"http://example.com/2024/07/08/%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A1%E5%9F%BA%E7%A1%80/","excerpt":"","text":"é€šä¿¡åŸºç¡€å†²çªåŸŸ è½¯ä»¶ï¼šCSMA&#x2F;CD è½½æ³¢ä¾¦å¬å¤šè·¯è®¿é—®&#x2F;å†²çªæ£€æµ‹ å·¥ä½œæœºåˆ¶ï¼šâ‘ å…ˆå¬åå‘ï¼›â‘¡è¾¹å‘è¾¹å¬ï¼›â‘¢éšæœºå»¶è¿Ÿ ç¡¬ä»¶ï¼šäº¤æ¢æœº å¹¿æ’­åŸŸ è½¯ä»¶ï¼švlan ç¡¬ä»¶ï¼šè·¯ç”±å™¨ OSIæ¨¡å‹ 7. åº”ç”¨å±‚ å¯¹åº”ç”¨ç¨‹åºæä¾›æ¥å£ã€‚ 6. è¡¨ç¤ºå±‚ è¿›è¡Œæ•°æ®æ ¼å¼çš„è½¬æ¢ï¼Œä»¥ç¡®ä¿ä¸€ä¸ªç³»ç»Ÿç”Ÿæˆçš„åº”ç”¨å±‚æ•°æ®èƒ½å¤Ÿè¢«å¦å¤–ä¸€ä¸ªç³»ç»Ÿçš„åº”ç”¨å±‚æ‰€è¯†åˆ«å’Œç†è§£ã€‚ 5. ä¼šè¯å±‚ åœ¨é€šä¿¡åŒæ–¹ä¹‹é—´å»ºç«‹ã€ç®¡ç†å’Œç»ˆæ­¢ä¼šè¯ã€‚ 4. ä¼ è¾“å±‚ å»ºç«‹ã€ç»´æŠ¤å’Œå–æ¶ˆä¸€æ¬¡ç«¯åˆ°ç«¯çš„æ•°æ®ä¼ è¾“è¿‡ç¨‹ã€‚æ§åˆ¶ä¼ è¾“èŠ‚å¥çš„å¿«æ…¢ï¼Œè°ƒæ•´æ•°æ®çš„æ’åºç­‰ç­‰ã€‚ 3. ç½‘ç»œå±‚ å®šä¹‰é€»è¾‘åœ°å€ï¼›å®ç°æ•°æ®ä»æºåˆ°ç›®çš„åœ°çš„è½¬å‘ã€‚ 2. æ•°æ®é“¾è·¯å±‚ å°†åˆ†ç»„æ•°æ®å°è£…æˆå¸§ï¼›åœ¨æ•°æ®é“¾è·¯ä¸Šå®ç°æ•°æ®çš„ç‚¹åˆ°ç‚¹ã€æˆ–ç‚¹åˆ°å¤šç‚¹æ–¹å¼çš„ç›´æ¥é€šä¿¡ï¼›å·®é”™æ£€æµ‹ã€‚ 1. ç‰©ç†å±‚ åœ¨åª’ä»‹ä¸Šä¼ è¾“æ¯”ç‰¹æµï¼›æä¾›æœºæ¢°çš„å’Œç”µæ°”çš„è§„çº¦ã€‚ TCPæŠ¥æ–‡å¤´éƒ¨ï¼šSource Portï¼šæºç«¯å£ï¼Œæ ‡è¯†å“ªä¸ªåº”ç”¨ç¨‹åºå‘é€ã€‚é•¿åº¦ä¸º16æ¯”ç‰¹ã€‚Destination Portç›®ï¼šçš„ç«¯å£ï¼Œæ ‡è¯†å“ªä¸ªåº”ç”¨ç¨‹åºæ¥æ”¶ã€‚é•¿åº¦ä¸º16æ¯”ç‰¹ã€‚Sequence Numberï¼šåºå·å­—æ®µã€‚TCPé“¾æ¥ä¸­ä¼ è¾“çš„æ•°æ®æµæ¯ä¸ªå­—èŠ‚éƒ½ç¼–ä¸Šä¸€ä¸ªåºå·ã€‚åºå·å­—æ®µçš„å€¼æŒ‡çš„æ˜¯æœ¬æŠ¥æ–‡æ®µæ‰€å‘é€æ•°æ®çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åºå·ã€‚é•¿åº¦ä¸º32æ¯”ç‰¹ã€‚Acknowledgment Numberï¼šç¡®è®¤åºåˆ—å·ï¼Œæ˜¯æœŸæœ›æ”¶åˆ°å¯¹æ–¹ä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µæ•°æ®çš„ç¬¬1ä¸ªå­—èŠ‚çš„åºå·ï¼Œå³ä¸Šæ¬¡å·²æˆåŠŸæ¥æ”¶åˆ°çš„æ•°æ®æ®µçš„æœ€åä¸€ä¸ªå­—èŠ‚æ•°æ®çš„åºå·åŠ 1ã€‚åªæœ‰Ackæ ‡è¯†ä¸º1ï¼Œæ­¤å­—æ®µæœ‰æ•ˆã€‚é•¿åº¦ä¸º32æ¯”ç‰¹ã€‚Header Lengthï¼šå¤´éƒ¨é•¿åº¦ï¼ŒæŒ‡å‡ºTCPæŠ¥æ–‡å¤´éƒ¨é•¿åº¦ï¼Œä»¥32æ¯”ç‰¹ï¼ˆ4å­—èŠ‚ï¼‰ä¸ºè®¡ç®—å•ä½ã€‚è‹¥æ— é€‰é¡¹å†…å®¹ï¼Œåˆ™è¯¥å­—æ®µä¸º5ï¼Œå³å¤´éƒ¨ä¸º20å­—èŠ‚ã€‚Reservedï¼šä¿ç•™ï¼Œå¿…é¡»å¡«0ã€‚é•¿åº¦ä¸º6æ¯”ç‰¹ã€‚Control bitsï¼šæ§åˆ¶ä½ï¼ŒåŒ…å«FINã€ACKã€SYNç­‰æ ‡å¿—ä½ï¼Œä»£è¡¨ä¸åŒçŠ¶æ€ä¸‹çš„TCPæ•°æ®æ®µã€‚Windowï¼šçª—å£TCPçš„æµé‡æ§åˆ¶ï¼Œè¿™ä¸ªå€¼è¡¨æ˜å½“å‰æ¥æ”¶ç«¯å¯æ¥å—çš„æœ€å¤§çš„æ•°æ®æ€»æ•°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚çª—å£æœ€å¤§ä¸º65535å­—èŠ‚ã€‚é•¿åº¦ä¸º16æ¯”ç‰¹ã€‚Checksumï¼šæ ¡éªŒå­—æ®µï¼Œæ˜¯ä¸€ä¸ªå¼ºåˆ¶æ€§çš„å­—æ®µï¼Œç”±å‘ç«¯è®¡ç®—å’Œå­˜å‚¨ï¼Œå¹¶ç”±æ”¶ç«¯è¿›è¡ŒéªŒè¯ã€‚åœ¨è®¡ç®—æ£€éªŒå’Œæ—¶ï¼Œè¦åŒ…æ‹¬TCPå¤´éƒ¨å’ŒTCPæ•°æ®ï¼ŒåŒæ—¶åœ¨TCPæŠ¥æ–‡æ®µçš„å‰é¢åŠ ä¸Š12å­—èŠ‚çš„ä¼ªå¤´éƒ¨ã€‚é•¿åº¦ä¸º16æ¯”ç‰¹ã€‚ å¦‚æ‹“æœ´å›¾ R1ï¼ŒR2å»ºç«‹ç®€å•çš„telnetï¼Œæ¨¡å¼æ˜¯passwordï¼Œè·¯ç”±é…ç½®å®Œæˆï¼Œ R1ç™»å½•R2ï¼ˆloopbackå£ï¼‰ï¼ŒæŠ“åŒ… å¯ä»¥çœ‹åˆ°ARPåŒ…å’ŒTCPå»ºç«‹çš„ä¸‰æ¬¡æ¡æ‰‹ ARPå±€åŸŸç½‘åŒç½‘æ®µä¸‹çš„ARPæµç¨‹å¦‚æœä¸»æœºAè¦æƒ³é€šè¿‡Bçš„IPåœ°å€ç¡®å®šå…¶MACåœ°å€å¹¶å’ŒBè¿›è¡Œæ•°æ®äº¤äº’ï¼Œéœ€è¦æŒ‰ç…§ARPåè®®çš„â€å¹¿æ’­è¯·æ±‚å’Œå•æ’­åº”ç­”â€æ¥ç¡®å®šä¸»æœºBçš„MACåœ°å€ï¼Œæµç¨‹å¦‚ä¸‹ï¼š1ï¼‰ Aå…ˆæŸ¥çœ‹è‡ªå·±çš„ARPé«˜é€Ÿç¼“å­˜è¡¨ä¸­æ˜¯å¦æœ‰Bä¸»æœºçš„MACåœ°å€è®°å½•ã€‚ 2ï¼‰ å¦‚æœAçš„ARPé«˜é€Ÿç¼“å­˜è¡¨ä¸­æœ‰Bçš„MACåœ°å€è®°å½•ï¼Œåˆ™ç›´æ¥é€šè¿‡è¿™ä¸ªMACåœ°å€è¿›è¡Œæ•°æ®çš„ä¼ è¾“ã€‚ 3ï¼‰ å¦‚æœAä¸»æœºçš„ARPé«˜é€Ÿç¼“å­˜ä¸­æ²¡æœ‰Bä¸»æœºçš„è®°å½•ï¼Œåˆ™ä¼šå‘å±€åŸŸç½‘çš„æ‰€æœ‰ä¸»æœºå¹¿æ’­ä¸€ä¸ªARPè¯·æ±‚ï¼Œå¯»æ‰¾Bä¸»æœºçš„MACåœ°å€ã€‚ 4ï¼‰ å½“Bä¸»æœºæ”¶åˆ°Aä¸»æœºå¹¿æ’­çš„ARPè¯·æ±‚åï¼Œå°±ä¼šç›´æ¥ç»™Aä¸»æœºå›å¤ä¸€ä¸ªARPæ•°æ®åŒ…ã€‚ 5ï¼‰ å½“Aä¸»æœºæ”¶åˆ°Bä¸»æœºå‘é€è¿‡æ¥çš„è¯·æ±‚åï¼Œå°†Bçš„MACåœ°å€å†™å…¥é«˜é€Ÿç¼“å­˜ä¸­ï¼Œç„¶åé€šè¿‡è¯¥MACåœ°å€ï¼ŒAä¸»æœºå‘Bä¸»æœºè¿›è¡Œæ•°æ®çš„ä¼ è¾“ã€‚ å±€åŸŸç½‘ä¸åŒç½‘æ®µä¸‹çš„ARPæµç¨‹å¯¹äºè·¨ç½‘æ®µçš„ARPå·¥ä½œæˆ‘ä»¬é¦–å…ˆéœ€è¦çŸ¥é“çš„æ˜¯ï¼š ARPè¯·æ±‚ä»¥å¹¿æ’­å‘é€ã€ä»¥å•æ’­å›åº”ï¼› è·¯ç”±å™¨éš”ç¦»å¹¿æ’­ã€‚æ¯ä¸€ä¸ªç½‘æ®µéƒ½æ˜¯ç‹¬ç«‹çš„å¹¿æ’­åŸŸï¼› è·¨è¶Šç½‘æ®µé€šä¿¡éœ€è¦ä½¿ç”¨ç½‘å…³çš„macåœ°å€ã€‚ 1ã€ä¸»æœºAæœ‰æ•°æ®å‘å¾€ä¸»æœºBï¼Œæ•°æ®å°è£…IPä¹‹åå‘ç°æ²¡æœ‰ä¸»æœºBçš„macåœ°å€ï¼›ç„¶åæŸ¥è¯¢ARPï¼ŒARPå›åº”ï¼šâ€œæˆ‘åœ¨192.168.3.0&#x2F;24ç½‘æ®µï¼Œç›®æ ‡åœ°å€åœ¨192.168.4.0&#x2F;24,ä¸å±äºåŒä¸€ç½‘æ®µï¼Œéœ€è¦ä½¿ç”¨é»˜è®¤ç½‘å…³â€ï¼›ARPå‘ç°é»˜è®¤ç½‘å…³æ˜¯192.168.3.2ï¼Œä½†æ˜¯æ²¡æœ‰ç½‘å…³macåœ°å€ï¼Œéœ€è¦å…ˆè¿›è¡ŒæŸ¥è¯¢ï¼› 2ã€ä¸»æœºå°†æ•°æ®åŒ…å…ˆæ”¾åˆ°ç¼“å­˜ä¸­ï¼Œç„¶åå‘é€ARPæŸ¥è¯¢æŠ¥æ–‡ï¼šå°è£…è‡ªå·±çš„macåœ°å€ä¸ºæºmacï¼Œç›®æ ‡macåœ°å€å†™å…¨Fçš„å¹¿æ’­åœ°å€ï¼Œè¯·æ±‚ç½‘å…³192.168.3.2çš„macåœ°å€ã€‚ç„¶åä»¥å¹¿æ’­æ–¹å¼å‘é€å‡ºå»ï¼› 3ã€è·¯ç”±å™¨æ”¶åˆ°å¹¿æ’­æ•°æ®åŒ…ï¼Œé¦–å…ˆå°†åŸ192.168.3.1æ·»åŠ åˆ°è‡ªå·±çš„macåœ°å€è¡¨ä¸­ï¼Œå¯¹åº”macåœ°å€ä¸º0800.0222.2222ã€‚è·¯ç”±å‘ç°æ˜¯è¯·æ±‚è‡ªå·±çš„macåœ°å€ï¼Œç„¶åè·¯ç”±å›å¤ä¸€ä¸ªARPåº”ç­”ï¼šå°è£…è‡ªå·±çš„IPåœ°å€ä¸ºæºIPè‡ªå·±çš„macåœ°å€ä¸ºæºmacï¼Œä¸»æœºAçš„IPä¸ºç›®çš„IPä¸»æœºAçš„macä¸ºç›®çš„macï¼Œå‘é€ä¸€ä¸ªå•æ’­åº”ç­”â€œæˆ‘æ˜¯192.168.3.2.æˆ‘çš„macåœ°å€ä¸º0800.0333.2222â€ï¼› 4ã€ä¸»æœºæ”¶åˆ°åº”ç­”åï¼Œå°†ç½‘å…³macåœ°å€å¯¹åº”192.168.4.2ï¼ˆè·¨ç½‘å…³é€šä¿¡ï¼Œå…¶ä»–ç½‘æ®µIPåœ°å€çš„macåœ°å€å‡ä¸ºç½‘å…³macï¼‰ï¼Œç„¶åå°†ç¼“å­˜ä¸­çš„æ•°æ®åŒ…ï¼Œå°è£…ç½‘å…³macåœ°å€è¿›è¡Œå‘é€ï¼› 5ã€è·¯ç”±æ”¶åˆ°æ•°æ®åŒ…ï¼Œæ£€æŸ¥ç›®çš„IPåœ°å€ï¼Œå‘ç°ä¸æ˜¯ç»™è‡ªå·±çš„ï¼Œå†³å®šè¦è¿›è¡Œè·¯ç”±ï¼Œç„¶åæŸ¥è¯¢è·¯ç”±è¡¨ï¼Œéœ€è¦å‘å¾€192.168.4.0ç½‘æ®µä¸­çš„192.168.4.2åœ°å€ã€‚è·¯ç”±å‡†å¤‡ä»ç›¸åº”æ¥å£ä¸Šå‘å‡ºå»ï¼Œç„¶åæŸ¥è¯¢macåœ°å€è¡¨ï¼Œå‘ç°æ²¡æœ‰ä¸»æœºBçš„æ˜ å°„ã€‚è·¯ç”±å™¨å‘é€arpè¯·æ±‚æŸ¥è¯¢ä¸»æœºBçš„macåœ°å€ï¼ˆåŸç†åŒ2ã€3æ­¥ï¼Œä¸»æœºBæ”¶åˆ°è¯·æ±‚åé¦–å…ˆä¼šæ·»åŠ ç½‘å…³çš„macåœ°å€ï¼Œç„¶åå•æ’­å›å¤arpè¯·æ±‚ï¼‰ï¼› 6ã€è·¯ç”±å™¨æ”¶åˆ°ä¸»æœºBçš„macåœ°å€åï¼Œå°†å…¶æ·»åŠ åˆ°è·¯ç”±macåœ°å€è¡¨ä¸­ï¼Œç„¶åå°†ç¼“å­˜ä¸­çš„æ•°æ®2å±‚å¸§å¤´å»æ‰ï¼Œå°è£…è‡ªå·±çš„macåœ°å€ä¸ºæºmacï¼Œä¸»æœºBçš„macåœ°å€ä¸ºç›®çš„macï¼ˆæºå’Œç›®çš„IPåœ°å€ä¸å˜ï¼‰ï¼ŒåŠ ä¸ŠäºŒå±‚å¸§å¤´åŠæ ¡éªŒï¼Œå‘é€ç»™ä¸»æœºBï¼› 7ã€ä¸»æœºBæ”¶åˆ°æ•°æ®ä¹‹åï¼Œè¿›è¡Œå¤„ç†ï¼Œå‘é€è¿‡ç¨‹ç»“æŸï¼› 8ã€å¦‚æœä¸»æœºBæ”¶åˆ°æ•°æ®åè¿›è¡Œå›å¤ï¼Œä¸»æœºBä¼šè¿›è¡Œåœ°å€åˆ¤æ–­ï¼Œä¸åœ¨åŒä¸€ç½‘æ®µï¼Œç„¶åå†³å®šå°†æ•°æ®å‘é€ç»™ç½‘å…³ï¼Œä¸»æœºBæŸ¥è¯¢macåœ°å€è¡¨è·å¾—ç½‘å…³macåœ°å€ï¼Œå°†æ•°æ®å°è£…åå‘é€ï¼ˆarpåœ°å€è§£æçš„è¿‡ç¨‹ä¸å†éœ€è¦äº†ï¼Œmacåœ°å€è¡¨æ¡ç›®æœ‰ä¸€å®šçš„æœ‰æ•ˆæ—¶é—´ï¼‰ï¼Œç½‘å…³æ”¶åˆ°æ•°æ®åç›´æ¥æŸ¥è¯¢macè¡¨ï¼Œå°†äºŒå±‚å¸§macåœ°å€æ›´æ”¹ä¸ºAçš„macå‘é€å‡ºå»ã€‚å¦‚æ­¤ï¼Œä¸»æœºAæ”¶åˆ°ä¸»æœºBçš„å›å¤ï¼› VRPç³»ç»Ÿè®¾å¤‡ç³»ç»Ÿæ”¯æŒçš„ç”¨æˆ·ç•Œé¢æœ‰Consoleç”¨æˆ·ç•Œé¢å’Œè™šæ‹Ÿç±»å‹ç»ˆç«¯VTYï¼ˆVirtual Type Terminalï¼‰ç”¨æˆ·ç•Œé¢ã€‚ flashç›®å½•ä¸‹æœ‰dhcpæ–‡ä»¶å¤¹ è¿›å…¥dhcpæ–‡ä»¶å¤¹ dir å‘ç°æœ‰ dhcp-duid.txtæ–‡ä»¶ åœ¨flashç›®å½•ä¸‹åˆ›å»ºyzyæ–‡ä»¶å¤¹ï¼Œ æŠŠdhcp-duid.txt å¤åˆ¶åˆ°yzyç›®å½• copy dhcp-duid.txt yzy dirå¯ä»¥çœ‹åˆ° æ”¹ä¸ªåå­— å·²ç»æ”¹æˆ666 å­ç½‘åˆ’åˆ†å­ç½‘åˆ’åˆ† | æ²ƒå¾·å‘ (yangzhiyu.top)","categories":[{"name":"åŸºç¡€çŸ¥è¯†","slug":"åŸºç¡€çŸ¥è¯†","permalink":"http://example.com/categories/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"}],"tags":[{"name":"æ•°é€šåŸºç¡€","slug":"æ•°é€šåŸºç¡€","permalink":"http://example.com/tags/%E6%95%B0%E9%80%9A%E5%9F%BA%E7%A1%80/"},{"name":"VRPç³»ç»Ÿ","slug":"VRPç³»ç»Ÿ","permalink":"http://example.com/tags/VRP%E7%B3%BB%E7%BB%9F/"},{"name":"ARP","slug":"ARP","permalink":"http://example.com/tags/ARP/"}]},{"title":"MPLSVPNå®éªŒ","slug":"MPLSVPNå®éªŒ","date":"2024-07-01T08:19:01.000Z","updated":"2024-07-01T11:33:08.839Z","comments":true,"path":"2024/07/01/MPLSVPNå®éªŒ/","permalink":"http://example.com/2024/07/01/MPLSVPN%E5%AE%9E%E9%AA%8C/","excerpt":"","text":"æ‹“æ‰‘ï¼š é…ç½®æ¥å£ipåœ°å€ä»¥åŠloopback 0åœ°å€ï¼šç•¥ ç›®çš„ï¼šCE1å’ŒCE2ä¹‹é—´ä¸èƒ½äº’è®¿ï¼ŒCE1å’ŒCE2å¯ä»¥è®¿é—®CE3 åˆ›å»ºVPNå®ä¾‹ ip vpn-instance CE1 ipv4-family route-distinguisher 100:1 vpn-target 100:1 export-extcommunity vpn-target 100:1 import-extcommunity [PE1-GigabitEthernet0&#x2F;0&#x2F;0]ip binding vpn-instance CE1 ï¼ˆæ¥å£ç»‘å®šï¼‰ æ³¨æ„ï¼šç»‘å®šVPNå®ä¾‹åï¼Œæ¥å£é…ç½®ä¼šæ¶ˆå¤±ï¼Œæ³¨æ„é‡æ–°é…ç½®ip ip vpn-instance CE2 ipv4-family route-distinguisher 200:1 vpn-target 200:1 export-extcommunity vpn-target 100:1 import-extcommunity [PE1-GigabitEthernet0&#x2F;0&#x2F;1]ip binding vpn-instance CE2 PE2ä¸Šåˆ›å»ºVPNå®ä¾‹CE3 ip vpn-instance CE3 ipv4-family route-distinguisher 100:1 vpn-target 100:1 export-extcommunity vpn-target 100:1 200:1 import-extcommunity [PE2-GigabitEthernet0&#x2F;0&#x2F;1]ip binding vpn-instance CE3 PE2å’ŒCE3ä¹‹é—´OSPFé…ç½® PE2ï¼š ospf 1 vpn-instance CE3 ï¼ˆæ³¨æ„åœ¨vpnå®ä¾‹ä¸­ï¼‰ area 0.0.0.0 network 10.0.56.0 0.0.0.255 CE3ï¼š ospf 1 area 0.0.0.0 network 10.0.56.0 0.0.0.255 é…ç½®CE1å’ŒPE1ä¹‹é—´çš„EBGPï¼š CE1ï¼š bgp 100 router-id 1.1.1.1 peer 10.0.12.2 as-number 200 PE1ï¼š bgp 200 router-id 3.3.3.3[PE1-bgp]ipv4-family vpn-instance CE1 ï¼ˆæ³¨æ„åœ¨vpnå®ä¾‹ä¸­å»ºç«‹ï¼‰[PE1-bgp-CE1]peer 10.0.12.1 as-number 100 æŸ¥çœ‹bgpé‚»å±…å…³ç³»ï¼š [PE1]display bgp vpnv4 vpn-instance CE1 peer è¿è¥å•†ç½‘ç»œä¹‹é—´çš„OSPFé…ç½® PE1ï¼š ospf 1 area 0.0.0.0 network 10.0.24.0 0.0.0.255 network 3.3.3.3 0.0.0.0 Pï¼š ospf 1 area 0.0.0.0 network 10.0.24.0 0.0.0.255 network 10.0.45.0 0.0.0.255 network 4.4.4.4 0.0.0.0 PE2ï¼š ospf 2 ï¼ˆæ³¨æ„æ˜¯è¿›ç¨‹2ï¼Œå› ä¸ºè¿›ç¨‹1åœ¨VPNå®ä¾‹CE3ä¸­ä½¿ç”¨è¿‡äº†ï¼Œospfæœ¬åœ°è¿›ç¨‹å”¯ä¸€ï¼‰ area 0.0.0.0 network 10.0.45.0 0.0.0.255 network 5.5.5.5 0.0.0.0 è¿è¥å•†ç½‘ç»œçš„MPLSé…ç½® PE1ï¼š mpls lsr-id 3.3.3.3mplsmpls ldp interface GigabitEthernet0&#x2F;0&#x2F;2 mpls mpls ldp å‰©ä½™é‡å¤æ“ä½œç•¥ PE1å’ŒPE2ä¹‹é—´bgpå»ºç«‹ PE2ï¼š bgp 200 peer 3.3.3.3 as-number 200 peer 3.3.3.3 connect-interface LoopBack0 ipv4-family vpnv4 peer 3.3.3.3 enable PE1åŒç†æ“ä½œ è·¯ç”± åœ¨CE1ä¸Šåˆ›å»ºloopback 1æ¥å£ï¼š10.10.10.10 åœ¨CE1ä¸Šnetworkå®£å‘Šè¿›å…¥bgpè¿›ç¨‹ dis bgp vpnv4 all routing-table æŸ¥çœ‹å·²ç»å­¦ä¹ åˆ°äº†10.10.10.10ç½‘æ®µçš„è·¯ç”± æ­¤æ—¶è¿™æ¡è·¯ç”±å¯ä»¥åˆ°è¾¾PE2 æ— æ³•åˆ°è¾¾CE3 [PE2-ospf-1]import-route bgp åœ¨PE2ä¸Šospf 1è¿›ç¨‹å¼•å…¥bgpï¼Œæ­¤æ—¶CE3å¯ä»¥å­¦ä¹ åˆ° ï¼ˆæ³¨æ„æ˜¯è¿›ç¨‹1ï¼Œè¿›ç¨‹2æ˜¯è¿è¥å•†ç½‘ç»œçš„ospfï¼Œè¿›ç¨‹1æ˜¯VPNå®ä¾‹CE3çš„ospfï¼‰ CE3ä¸Šä¹Ÿæ·»åŠ ä¸€æ¡loopback 1 [CE3-LoopBack1]ip address 30.30.30.30 32 [CE3-ospf-1]import-route direct ï¼ˆå¼•å…¥ï¼‰ å°†å³è¾¹ospfå¼•å…¥bgp [PE2]bgp 200 [PE2-bgp]ipv4-family vpn-instance CE3 ï¼ˆæ³¨æ„åœ¨å®ä¾‹ä¸­å¼•å…¥ï¼‰ [PE2-bgp-CE3]import-route ospf 1 ï¼ˆæ³¨æ„æŒ‡æ˜è¿›ç¨‹ï¼Œé»˜è®¤æ˜¯1ï¼‰ æ­¤æ—¶bgpè¿›ç¨‹ä¸­å­¦ä¹ åˆ°äº†30.30.30.30ç½‘æ®µ åœ¨CE1ä¸ŠpingCE3çš„30.30.30.30ï¼ˆæ³¨æ„pingçš„æ—¶å€™åŠ æºåœ°å€-aï¼‰ å¯ä»¥é€šäº† CE2çš„è·¯ç”± [PE1]ip route-static vpn-instance CE2 2.2.2.2 32 10.0.23.1 æ·»åŠ ä¸€æ¡å…³äºVPNå®ä¾‹CE2çš„é™æ€è·¯ç”±ï¼Œ PE1ä¸ŠæŸ¥çœ‹CE2å®ä¾‹è·¯ç”±è¡¨ å¯ä»¥å­¦ä¹ åˆ°äº† PE1åœ¨BGPä¸­å¼•å…¥é™æ€è·¯ç”± [PE1]bgp 200 [PE1-bgp]ipv4-family vpn-instance CE2 ï¼ˆæ³¨æ„åœ¨å®ä¾‹ä¸­ï¼‰ [PE1-bgp-CE2]import-route static CE2ä¸Šæ·»åŠ é»˜è®¤è·¯ç”± [CE2]ip route-static 0.0.0.0 0 10.0.23.2 æ­¤æ—¶CE2å¯ä»¥pingé€šCE3çš„30.30.30.30 å®éªŒç‘•ç–µï¼š [PE1]dis bgp vpnv4 all routing-table å¯ä»¥çœ‹åˆ°ï¼Œ10.10.10.10ç½‘æ®µå¯èƒ½ä¼ é€’ç»™CE2çš„VPNå®ä¾‹ ä½†æ˜¯CE1å’ŒCE2ä¹‹é—´ä»ç„¶ä¸èƒ½äº’è®¿ï¼Œè¿™æ˜¯å› ä¸ºCE2çš„2.2.2.2ä¸ä¼šä¼ é€’ç»™CE1çš„VPNå®ä¾‹ åŸå› ï¼šCE1å’ŒCE2çš„RTå€¼è®¾ç½®åŸå› ï¼ŒCE1çš„export æ˜¯100ï¼š1ï¼ŒCE2çš„importæ˜¯100:1ï¼Œå°±å¯¼è‡´CE2ä¹Ÿä¼šæ¥å—CE1ä¼ é€’çš„VPNå®ä¾‹ï¼Œä½†æ˜¯CE2ä¼ é€’çš„ï¼ŒCE1ä¸ä¼šæ¥å—ï¼Œæ‰€ä»¥ç†è®ºä¸Šä¹Ÿå®ç°äº†å®éªŒè¦æ±‚ï¼Œä½†æ˜¯ä¸å¤Ÿå®Œç¾ã€‚","categories":[{"name":"ieå®éªŒ","slug":"ieå®éªŒ","permalink":"http://example.com/categories/ie%E5%AE%9E%E9%AA%8C/"}],"tags":[]},{"title":"ipç»¼åˆå®éªŒ","slug":"ipç»¼åˆå®éªŒ","date":"2024-06-29T13:27:12.000Z","updated":"2024-06-30T15:32:59.174Z","comments":true,"path":"2024/06/29/ipç»¼åˆå®éªŒ/","permalink":"http://example.com/2024/06/29/ip%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/","excerpt":"","text":"ç»†èŠ‚æ­¥éª¤æ²¡æœ‰å®Œå…¨è®°å½•ï¼Œåªè®°å½•äº†å¤§æ¦‚ 1.é…ç½®vlanï¼Œæ¥å£æ”¾è¡Œvlan ï¼ˆäº¤æ¢æœºæ”¾è¡Œvlan10ï¼Œ20ï¼Œ30ï¼Œ66ï¼Œ88ï¼Œ100ï¼‰ æ±‡èš1æ±‡èš2ä¹‹é—´åšé“¾è·¯èšåˆï¼Œeth 1æ”¾é€švlan æ³¨æ„ï¼šæ±‡èš1çš„g0&#x2F;0&#x2F;7åªèµ°WLANçš„æ•°æ®ï¼Œvlan10 20 30ä¸ä¼šèµ°ï¼Œåªéœ€æ”¾é€švlan 66 88 100å³å¯ 2.é…ç½®MSTP wlançš„ä¸»æ ¹æ¡¥æ˜¯æ±‡èš1ï¼ˆ66 88 100ï¼‰ æœ‰çº¿çš„ä¸»æ ¹æ¡¥æ˜¯æ±‡èš2ï¼ˆ10 20 30ï¼‰ stp mode mstp stp region-configuration region-name aa instance 1 vlan 66 88 100 instance 2 vlan 10 20 30 active region-configuration æ±‡èš1ï¼š stp instance 1 root primarystp instance 2 root secondary æ±‡èš2ï¼š stp instance 1 root secondarystp instance 2 root primary 3.AC-AP ç®¡ç†vlan100ï¼Œä¸šåŠ¡vlan88å’Œ66 ACï¼š vlan 100 int g 0&#x2F;0&#x2F;1 p l t p t a v 100 66 88 int vlanif 100 ip ad 192.168.100.254 24 capwap source interface vlanif 100 wlané…ç½®ï¼š wlan ap-group name apï¼ˆåˆ›å»ºapç»„ï¼‰ regulatory-domain-profile default security-profile name yuangongï¼ˆä¸¤ä¸ªå®‰å…¨æ¨¡æ¿ï¼‰ security wpa-wpa2 psk pass-phrase yuangong666 aes security-profile name fangke security wpa-wpa2 psk pass-phrase fangke888 aes ssid-profile name yuangongï¼ˆä¸¤ä¸ªssidæ¨¡æ¿ï¼‰ ssid yuangong ssid-profile name fangke ssid fangke vap-profile name yuangongï¼ˆä¸¤ä¸ªvapæ¨¡æ¿åˆ†åˆ«ç»‘å®šyuangongå’Œfangkeï¼‰ security-profile yuangong ssid-profile yuangong service-vlan vlan-id 66 vap-profile name fangke security-profile fangke ssid-profile fangke service-vlan vlan-id 88 ap-id 0 ap-mac 00e0-fca6-10f0ï¼ˆä¸‰ä¸ªapä¸Šçº¿ï¼‰ ap-name ap1 ap-group ap ap-id 1 ap-mac 00e0-fc64-6810 ap-name ap2 ap-group ap ap-id 2 ap-mac 00e0-fcbb-3530 ap-name ap3 ap-group ap ap-group name apï¼ˆä¸‹å‘ä¿¡å·ï¼‰ vap-profile yuangong wlan 1 radio all vap-profile fangke wlan 2 radio all dhcp enableï¼ˆé…ç½®dhcpï¼‰ int vlanif100 dhcp se int 4.é…ç½®VRRP æ±‡èš1ï¼š interface Vlanif10 ip address 192.168.10.1 255.255.255.0 vrrp vrid 1 virtual-ip 192.168.10.254 æ±‡èš2ï¼š interface Vlanif10 ip address 192.168.10.2 255.255.255.0 vrrp vrid 1 virtual-ip 192.168.10.254 vrrp vrid 1 priority 120ï¼ˆå› ä¸ºæ±‡èš2æ˜¯vlan10 20 30çš„ä¸»æ ¹æ¡¥ï¼Œæ‰€ä»¥ä¼˜å…ˆçº§æ”¹å¤§ï¼‰ åªä¸¾ä¾‹vrrp 1çš„ åè¾¹vlan 20 vlan 30åŒç†åˆ›å»º valn 66 88 çš„æ±‡èš1ä¼˜å…ˆçº§æ”¹å¤§ 5.é…ç½®DHCP å› ä¸ºé…ç½®äº†VRRPï¼Œæ‰€ä»¥æ±‡èš1å’Œæ±‡èš2éƒ½è¦é…ç½®dhcp ip pool 10 gateway-list 192.168.10.254 network 192.168.10.0 mask 255.255.255.0 excluded-ip-address 192.168.10.1 192.168.10.2 ip pool 20 gateway-list 192.168.20.254 network 192.168.20.0 mask 255.255.255.0 excluded-ip-address 192.168.20.1 192.168.20.2ip pool 30 gateway-list 192.168.30.254 network 192.168.30.0 mask 255.255.255.0 excluded-ip-address 192.168.30.1 192.168.30.2ip pool 66 gateway-list 192.168.66.254 network 192.168.66.0 mask 255.255.255.0 excluded-ip-address 192.168.66.1 192.168.66.2ip pool 88 gateway-list 192.168.88.254 network 192.168.88.0 mask 255.255.255.0 excluded-ip-address 192.168.88.1 192.168.88.2 int vlanif 10dhcp se gint vlanif 20dhcp se gint vlanif 30dhcp se gint vlanif 66dhcp se gint vlanif 88dhcp se g 6.é…ç½®OSPF é¦–å…ˆé…ç½®ipåœ°å€ï¼Œæ±‡èšäº¤æ¢æœºvlanifæ¥å£é…ç½®ï¼šè¿‡ç¨‹ç•¥ æ±‡èš1ï¼š ospf 1 area 0.0.0.0 network 192.168.10.0 0.0.0.255network 192.168.20.0 0.0.0.255network 192.168.30.0 0.0.0.255network 192.168.66.0 0.0.0.255network 192.168.88.0 0.0.0.255network 10.0.1.0 0.0.0.3network 10.0.3.0 0.0.0.3 æ±‡èš2ï¼š ospf 1 area 0.0.0.0 network 192.168.10.0 0.0.0.255network 192.168.20.0 0.0.0.255network 192.168.30.0 0.0.0.255network 192.168.66.0 0.0.0.255network 192.168.88.0 0.0.0.255network 10.0.2.0 0.0.0.3network 10.0.3.0 0.0.0.3 å‡ºå£è·¯ç”±å™¨ï¼š IPåœ°å€ï¼šç•¥ ospf 1 area 0.0.0.0 network 10.0.1.0 0.0.0.3 network 10.0.2.0 0.0.0.3 network 192.168.60.0 0.0.0.255 7.é…ç½®IS-IS æ±‡èš2å’Œå‘˜å·¥å®¿èˆè·¯ç”±å™¨ä¹‹é—´ç”¨vlanif 43ç›¸è¿ï¼š192.168.43.0&#x2F;30ç½‘æ®µ æ±‡èš2ï¼š isis 1 is-level level-2 network-entity 49.0001.0000.0000.0001.00 int vlan 43 isis enable å‘˜å·¥å®¿èˆè·¯ç”±å™¨ï¼š isis 1 is-level level-2 network-entity 49.0001.0000.0000.0002.00 int g0&#x2F;0&#x2F;0 isis enable 8.å‘˜å·¥å®¿èˆåŒºå•è‡‚è·¯ç”± äºŒå±‚äº¤æ¢æœºï¼š vlan b 40 50 int e 0&#x2F;0&#x2F;3 p l a p de v 50 int e 0&#x2F;0&#x2F;1 p l a p de v 40 int g 0&#x2F;0&#x2F;1 p l t p t a v 40 50 è·¯ç”±å™¨ï¼š interface GigabitEthernet0&#x2F;0&#x2F;1.10 dot1q termination vid 50 ip address 192.168.50.254 255.255.255.0 arp broadcast enable interface GigabitEthernet0&#x2F;0&#x2F;1.20 dot1q termination vid 40 ip address 192.168.40.254 255.255.255.0 arp broadcast enable 9.æ±‡èš2é…ç½®DHCPä¸ºå‘˜å·¥å®¿èˆåŒºpcåˆ†é…ipåœ°å€ ä¸åœ¨åŒä¸€ç½‘æ®µï¼Œç”¨dhcp ä¸­ç»§ æ±‡èš2ï¼š ip pool 40 gateway-list 192.168.40.254 network 192.168.40.0 mask 255.255.255.0 ip pool 50 gateway-list 192.168.50.254 network 192.168.50.0 mask 255.255.255.0 interface Vlanif43 dhcp select global å‘˜å·¥å®¿èˆåŒºè·¯ç”±å™¨ï¼š å¼€å¯relay interface GigabitEthernet0&#x2F;0&#x2F;1.10 dhcp select relay dhcp relay server-ip 192.168.43.1 interface GigabitEthernet0&#x2F;0&#x2F;1.20 dhcp select relay dhcp relay server-ip 192.168.43.1 å­æ¥å£å®£å‘Šè¿›isis 1 interface GigabitEthernet0&#x2F;0&#x2F;1.10 isis enable 1 interface GigabitEthernet0&#x2F;0&#x2F;1.20 isis enable 1 æ­¤æ—¶å®¿èˆåŒºå¯ä»¥è·å–ip 10.æ±‡èš2 ospfå’Œisisäº’ç›¸å¼•å…¥ ä½¿å¾—å®¿èˆåŒºä¸èƒ½è®¿é—®ä¸šåŠ¡å¤§æ¥¼ï¼ˆ20ï¼‰å’Œè´¢æ”¿å¤§æ¥¼ï¼ˆ30ï¼‰ ospf 1 import-route isis 1 isis 1 import-route ospf 1 æ­¤æ—¶å†…ç½‘å…¨éƒ¨äº’é€š è¿‡æ»¤ æ±‡èš2ï¼š ip ip-prefix aa index 10 permit 192.168.20.0 24 less-equal 32 ip ip-prefix aa index 20 permit 192.168.30.0 24 less-equal 32 route-policy aa deny node 10 if-match ip-prefix aa route-policy aa permit node 20 isis 1 import-route ospf 1 route-policy aa 11.NAPT nat address-group 1 200.10.10.5 200.10.10.10 acl 2000 rule 5 permit anyï¼ˆéƒ½å¯ä»¥è®¿é—®å¤–ç½‘ï¼‰ interface GigabitEthernet4&#x2F;0&#x2F;0 ip address 200.10.10.3 255.255.255.0 nat outbound 2000 address-group 1 12.NAT Server è¦æ±‚å†…ç½‘æ­£å¸¸è®¿é—®ftpå’ŒhttpæœåŠ¡å™¨ å¤–ç½‘åªèƒ½è®¿é—®httpæœåŠ¡å™¨ nat server protocol tcp global 200.10.10.1 any inside 192.168.60.1 nat server protocol tcp global 200.10.10.2 any inside 192.168.60.2 13.ä¸‹å‘ç¼ºçœè·¯ç”± å‡ºå£è·¯ç”±å™¨ï¼š ospf 1 default-route-advertise always æ±‡èš2ï¼š isis 1 default-route-advertise always æ­¤æ—¶å‘ç°pc4ping30ç½‘æ®µå¯ä»¥é€šï¼Œä½†æ˜¯åšäº†è¿‡æ»¤ï¼ˆåŸå› ï¼šä¸‹å‘äº†ç¼ºçœè·¯ç”±ï¼‰ PC&gt;ping 192.168.30.253 Ping 192.168.30.253: 32 data bytes, Press Ctrl_C to breakFrom 192.168.30.253: bytes&#x3D;32 seq&#x3D;1 ttl&#x3D;126 time&#x3D;79 msFrom 192.168.30.253: bytes&#x3D;32 seq&#x3D;2 ttl&#x3D;126 time&#x3D;93 ms è§£å†³ï¼šç­–ç•¥è·¯ç”±åšè¿‡æ»¤ å‘˜å·¥å®¿èˆè·¯ç”±å™¨ï¼š acl 3000 rule deny ip source 192.168.40.0 0.0.0.255 destination 192.168.30.0 0.0.0.255 rule deny ip source 192.168.40.0 0.0.0.255 destination 192.168.20.0 0.0.0.255 rule deny ip source 192.168.50.0 0.0.0.255 destination 192.168.30.0 0.0.0.255 rule deny ip source 192.168.50.0 0.0.0.255 destination 192.168.20.0 0.0.0.255 interface GigabitEthernet0&#x2F;0&#x2F;0 traffic-filter outbound acl 3000 æ­¤æ—¶è¿‡æ»¤æˆåŠŸ 14.ISPåŒºåŸŸé…ç½®isis é…ç½®ipåœ°å€ï¼Œé…ç½®isisï¼šåŸºæ“ï¼Œç•¥ 15.ISPåŒºåŸŸé…ç½®IBGP R5ï¼š bgp 100 peer 1.1.1.1 as-number 100 peer 1.1.1.1 connect-interface LoopBack0 peer 1.1.1.1 reflect-clientï¼ˆè·¯ç”±åå°„å™¨é…ç½®å®¢æˆ·ç«¯ï¼‰ bgp 100 peer 2.2.2.2 as-number 100 peer 2.2.2.2 connect-interface LoopBack0peer 2.2.2.2 reflect-client bgp 100 peer 3.3.3.3 as-number 100 peer 3.3.3.3 connect-interface LoopBack0peer 3.3.3.3 reflect-client bgp 100 peer 4.4.4.4 as-number 100 peer 4.4.4.4 connect-interface LoopBack0peer 4.4.4.4 reflect-client R1R2R3R4ï¼š bgp 100 peer 5.5.5.5 as-number 100 peer 5.5.5.5 connect-interface LoopBack0 å»ºç«‹EBGPï¼šç•¥ 16.å…¬å¸BåšNAT AR9ï¼š acl 2000 rule permit source any int g 0&#x2F;0&#x2F;2 nat outbound 2000 nat server global 200.10.20.3 inside 192.168.10.3ï¼ˆnat serverï¼‰ 17.BGPé€šå‘Šè·¯ç”± å…¬å¸Bè®¿é—®Aå›­åŒºçš„æœåŠ¡å™¨ï¼Œæ²¡æœ‰è·¯ç”± éœ€è¦å°†200.10.10.0ç½‘æ®µè·¯ç”±é€šå‘Šè¿›BGP AR1ï¼š bgp 100 network 200.10.10.0 24 æ­¤æ—¶å‘ç°è·¯ç”±åœ¨R3ä¸æ˜¯æœ€ä¼˜çš„ åŸå› ï¼šæ²¡æœ‰æ”¹ä¸‹ä¸€è·³ R5ï¼š bgp 100 peer 1.1.1.1 next-hop -local peer 3.3.3.3 next-hop -local ä»ç„¶ä¸æ˜¯æœ€ä¼˜ åŸå› ï¼šR3åœ¨level-1åŒºåŸŸï¼Œä¸èƒ½å­¦ä¹ åˆ°level-2åŒºåŸŸçš„è·¯ç”± è§£å†³ï¼šisisè·¯ç”±æ¸—é€ R5ï¼š isis 1 import-route isis level-2 into level-1 æ­¤æ—¶æ˜¯æœ€ä¼˜ R3ä¹Ÿè¦é€šå‘Š200.10.20.0ç½‘æ®µçš„è·¯ç”±åˆ°bgp R3ï¼š network 200.10.20.0 24 å‘ç°R1ä¸Šå¯ä»¥å­¦ä¹ åˆ°ï¼Œå¹¶ä¸”æ˜¯æœ€ä¼˜çš„ AR9ï¼š ï¼ˆç¼ºçœè·¯ç”±ï¼‰ ip route-static 0.0.0.0 0 200.10.20.1 Aå›­åŒºå‡ºå£è·¯ç”±å™¨æ·»åŠ ç¼ºçœè·¯ç”±ï¼š ip route-static 0.0.0.0 0 200.10.10.4 æ­¤æ—¶å…¬å¸Båº”è¯¥å¯ä»¥è®¿é—®Aå›­åŒºçš„æœåŠ¡å™¨ ä½†æ˜¯æµ‹è¯•pingä¸é€šï¼ŒFTPæœåŠ¡å™¨å¯ä»¥é€š åŸå› ï¼šåšnat serveræ—¶å€™æ²¡æœ‰æ”¾é€šicmpåè®®ï¼Œåªæ”¾é€šäº†tcpåè®®","categories":[{"name":"ç»¼åˆå®éªŒ","slug":"ç»¼åˆå®éªŒ","permalink":"http://example.com/categories/%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/"}],"tags":[]},{"title":"VRF","slug":"VRF","date":"2024-06-23T09:34:15.000Z","updated":"2024-06-23T10:31:04.401Z","comments":true,"path":"2024/06/23/VRF/","permalink":"http://example.com/2024/06/23/VRF/","excerpt":"","text":"å‡è®¾PC1ä¸R2è¿™ä¸€ä¾§çš„ç½‘ç»œå±äºä¸€ä¸ªç‹¬ç«‹çš„ä¸šåŠ¡ï¼›PC2ä¸R3è¿™ä¸€ä¾§çš„ç½‘ç»œå±äºå¦ä¸€ä¸ªç‹¬ç«‹çš„ä¸šåŠ¡ï¼Œç”±äºè®¾å¤‡èµ„æºæœ‰é™æˆ–è€…å…¶ä»–æ–¹é¢çš„åŸå› ï¼Œè¿™ä¸¤ä¸ªç‹¬ç«‹çš„ä¸šåŠ¡çš„ç›¸å…³èŠ‚ç‚¹è¿æ¥åœ¨R1ä¸Šï¼Œä¹Ÿå°±æ˜¯åŒä¸€å°è®¾å¤‡ä¸Šã€‚é‚£ä¹ˆåœ¨å®Œæˆç›¸å…³é…ç½®åï¼ŒR1çš„è·¯ç”±è¡¨å¦‚ä¸Šå›¾æ‰€ç¤ºã€‚ç°åœ¨å¦‚æœPC1è¦å‘ä¸€ä¸ªæ•°æ®åŒ…åˆ°2.2.2.2ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°æ®åŒ…åœ¨åˆ°è¾¾R1åï¼ŒR1å°±ä¼šå»æŸ¥çœ‹è‡ªå·±çš„è·¯ç”±è¡¨ï¼Œå‘ç°æœ‰ä¸€æ¡2.2.2.0&#x2F;24çš„è·¯ç”±åŒ¹é…ï¼Œå› æ­¤å°†è¿™ä¸ªIPåŒ…ä»GE0&#x2F;0&#x2F;2å£è½¬å‘ç»™192.168.100.2ã€‚è¿™æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œç„¶è€Œå¦‚æœPC1è¦è®¿é—®3.3.3.0&#x2F;24ç½‘ç»œå‘¢ï¼Ÿä¹Ÿæ˜¯æ— å‹åŠ›çš„ï¼Œå› ä¸ºæ•°æ®åŒ…åˆ°è¾¾R1åï¼Œå¥¹ç…§æ ·æŸ¥æ‰¾è·¯ç”±è¡¨ç»“æœå‘ç°æœ‰åŒ¹é…çš„è·¯ç”±ï¼Œå› æ­¤å°†æ•°æ®åŒ…è½¬ç»™R3ã€‚ä½†æ˜¯å®é™…ä¸Šï¼Œä»ä¸šåŠ¡çš„è§’åº¦è€ƒè™‘ï¼Œæˆ‘ä»¬ç¦æ­¢PC1è®¿é—®3.3.3.0&#x2F;24ç½‘ç»œã€‚é‚£ä¹ˆæ€ä¹ˆåŠï¼Ÿ ç°åœ¨ï¼Œæˆ‘ä»¬åœ¨R1ä¸Šåˆ›å»ºä¸¤ä¸ªVRFï¼šVRF1åŠVRF2ï¼Œåˆ›å»ºå®Œæˆåï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºï¼Œæ‹¥æœ‰äº†ä¸¤å°è™šæ‹Ÿè·¯ç”±å™¨ã€‚å½“ç„¶ï¼Œç°åœ¨è¿™ä¸¤å°è™šæ‹Ÿè·¯ç”±å™¨ä¸Šå•¥ä¹Ÿæ²¡æœ‰ã€‚æ¥ä¸‹å»æˆ‘ä»¬å°†GE0&#x2F;0&#x2F;1å£åŠGE0&#x2F;0&#x2F;2å£ç»‘å®šåˆ°VRF1ï¼›å°†GE0&#x2F;0&#x2F;3åŠGE0&#x2F;0&#x2F;4å£ç»‘å®šåˆ°VRF2ã€‚å¦‚æ­¤ä¸€æ¥è¿™ä¸¤å°è™šæ‹Ÿè·¯ç”±å™¨å°±å„è‡ªæ‹¥æœ‰äº†ä¸¤ä¸ªç‰©ç†æ¥å£ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸¤å°è™šæ‹Ÿè·¯ç”±å™¨æ˜¯è™½ç„¶éƒ½åœ¨åŒä¸€å°ç‰©ç†è®¾å¤‡ä¸Šï¼Œä½†æ˜¯å´æ˜¯éš”ç¦»çš„ï¼Œä»–ä»¬å°†æœ‰è‡ªå·±çš„æ¥å£ï¼Œè‡ªå·±çš„è·¯ç”±è¡¨ï¼Œè‡ªå·±çš„ARPè¡¨ç­‰ç­‰ç›¸å…³çš„å†…å®¹ã€‚æˆ‘ä»¬çš„ç¯å¢ƒå°±å˜æˆæœ‰ç‚¹åƒè¿™æ ·ï¼š æˆ‘ä»¬çœ‹åˆ°ï¼ŒVRF1åŠVRF2æœ‰äº†è‡ªå·±çš„æ¥å£ï¼Œä¹Ÿæœ‰äº†è‡ªå·±çš„è·¯ç”±è¡¨ã€‚å¹¶ä¸”ç›¸äº’ä¹‹é—´æ˜¯éš”ç¦»çš„ã€‚ç°åœ¨PC1è¦å‘é€ä¸€ä¸ªæ•°æ®åŒ…åˆ°2.2.2.2ï¼ŒR1ä»æ¥å£GE0&#x2F;0&#x2F;1æ”¶åˆ°äº†è¿™ä¸ªæ•°æ®åŒ…ï¼Œç”±äºæ­¤æ—¶GE0&#x2F;0&#x2F;1å·²ç»ç»‘å®šåˆ°äº†VRF1ï¼Œå› æ­¤åœ¨æ‰§è¡Œç›®çš„IPçš„è·¯ç”±æŸ¥æ‰¾çš„æ—¶å€™ï¼ŒæŸ¥çš„æ˜¯VRF1çš„è·¯ç”±è¡¨ï¼ŒæŸ¥æ‰¾åˆ°åŒ¹é…çš„è·¯ç”±æ¡ç›®åï¼Œé—´ä¸ªæ•°æ®åŒ…ä»å…¶æŒ‡ç¤ºçš„GE0&#x2F;0&#x2F;1å£è½¬å‘ç»™ä¸‹ä¸€è·³192.168.100.2ã€‚ é‚£ä¹ˆå¦‚æœPC1è¦è®¿é—®3.3.3.3å‘¢ï¼Ÿæ•°æ®åŒ…å‘åˆ°äº†R1ï¼ŒR1ä»æ¥å£GE0&#x2F;0&#x2F;1æ”¶åˆ°äº†è¿™ä¸ªæ•°æ®åŒ…ï¼Œäºæ˜¯å®ƒåœ¨åšè·¯ç”±æŸ¥æ‰¾çš„æ—¶å€™ï¼ŒæŸ¥çš„ä»ç„¶æ˜¯VRF1çš„è·¯ç”±è¡¨ã€‚ç»è¿‡æŸ¥è¡¨åï¼Œå®ƒå‘ç°å¹¶æ— åŒ¹é…çš„æ¡ç›®ï¼Œå› æ­¤å°†æ•°æ®åŒ…ä¸¢å¼ƒã€‚ å®éªŒ å¦‚å›¾ï¼ŒR2å±äºVPNå®ä¾‹aaï¼ŒR3å±äºVPNå®ä¾‹bbï¼Œè¦æ±‚pc1å¯ä»¥è®¿é—®R2ï¼Œä¸èƒ½è®¿é—®R3ã€‚PC2å¯ä»¥è®¿é—®R3ï¼Œä¸èƒ½è®¿é—®R2. R1ä¸‹åšå•è‡‚è·¯ç”±ï¼Œåˆ›å»ºVPNå®ä¾‹aaå’Œbbï¼Œå­æ¥å£åˆ†åˆ«ç»‘å®šç›¸åº”çš„VPNå®ä¾‹ã€‚g0&#x2F;0&#x2F;0ç»‘å®švpnå®ä¾‹aaï¼Œg0&#x2F;0&#x2F;1ç»‘å®švpnå®ä¾‹bbã€‚ S1åˆ›å»ºvlanï¼Œåˆ’åˆ†æ¥å£ï¼šç•¥ æ³¨æ„ï¼šæ¥å£ç»‘å®šVPNå®ä¾‹åï¼Œipåœ°å€çš„é…ç½®ä¼šè¢«ç§»é™¤ï¼Œéœ€è¦é‡æ–°é…ç½® åˆ›å»ºvpnå®ä¾‹ï¼š ip vpn-instance aa ipv4-family #ä½¿èƒ½ipv4åœ°å€ç°‡ æ¥å£ç»‘å®šï¼šip binding vpn-instance aa æŸ¥çœ‹vpnè·¯ç”±è¡¨ï¼šdis ip routing-table vpn-instance aa é™æ€è·¯ç”±ï¼šip route-static vpn-instance aa 2.2.2.2 32 192.168.10.1 pingå‘½ä»¤ï¼šping -vpn-instance aa 192.168.10.1 R2ä¸Šæ·»åŠ å›ç¨‹è·¯ç”±ï¼šç•¥ è‡³æ­¤ï¼ŒPC1å¯ä»¥pingé€šR2 R1ä¸Šåˆ›å»ºospfï¼šospf 1 router-id 1.1.1.1 vpn-instance bb å®£å‘Šç½‘æ®µï¼šç•¥ R3ä¸Šospfå®£å‘Š3.3.3.3 pc2pingé€š3.3.3.3","categories":[{"name":"ipå®éªŒ","slug":"ipå®éªŒ","permalink":"http://example.com/categories/ip%E5%AE%9E%E9%AA%8C/"}],"tags":[{"name":"VRF","slug":"VRF","permalink":"http://example.com/tags/VRF/"}]},{"title":"IAç»¼åˆå®éªŒ","slug":"IAç»¼åˆå®éªŒ","date":"2024-06-21T13:03:16.000Z","updated":"2024-06-22T07:55:53.098Z","comments":true,"path":"2024/06/21/IAç»¼åˆå®éªŒ/","permalink":"http://example.com/2024/06/21/IA%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/","excerpt":"","text":"å¦‚å›¾æ‰€ç¤ºä¸ºæŸå›­åŒºç½‘ç»œç®€æ˜“æ‹“æ‰‘ï¼ŒLSW1,LSW2ä½œä¸ºæ±‡èšå±‚äº¤æ¢æœºï¼ŒAR1ä½œä¸ºæ ¸å¿ƒè·¯ç”±å™¨ï¼ŒLSW3-4ä½œä¸ºå„è‡ªæ¥¼å±‚çš„æ¥å…¥äº¤æ¢æœºï¼Œç°æŒ‰ç…§è¦æ±‚å®ç°å¦‚ä¸‹é…ç½®ï¼š ä¸€.IPåœ°å€è§„åˆ’ 1.åŠå…¬æ¥¼1æ‰€æœ‰PCçš„ç½‘æ®µä¸ºï¼š192.168.10.0&#x2F;24 ç½‘å…³åœ°å€ä¸ºï¼š192.168.10.254 2.åŠå…¬æ¥¼2æ‰€æœ‰PCçš„ç½‘æ®µä¸ºï¼š192.168.20.0&#x2F;24 ç½‘å…³åœ°å€ä¸ºï¼š192.168.20.254 3.æœåŠ¡å™¨åŒºæ‰€æœ‰PCçš„ç½‘æ®µä¸ºï¼š192.168.30.0&#x2F;24 ç½‘å…³åœ°å€ä¸ºï¼š192.168.30.254 4.LSW1ä½œä¸ºæ±‡èšå±‚äº¤æ¢æœºä½¿ç”¨INT VLANIF 100æ¥å£ä¸R1äº’è¿ï¼ŒIPåœ°å€ä¸º100.1.1.1&#x2F;24ï¼› R1ä¸LSW1äº’è¿æ¥å£çš„IPåœ°å€ä¸º100.1.1.2&#x2F;24 5.R1ä¸R2æ¥å£,R1æ¥å£IPåœ°å€ä¸ºï¼š200.1.1.1&#x2F;24,R2æ¥å£IPåœ°å€ä¸ºï¼š200.1.1.2&#x2F;24, 6.é…ç½®è®¾å¤‡çš„åç§° äºŒ.é…ç½®LSW1ä¸LSW2æ±‡èšäº¤æ¢æœºä¹‹é—´çš„é“¾è·¯èšåˆï¼Œé‡‡ç”¨LACPçš„æ–¹å¼ï¼Œæ´»åŠ¨é“¾è·¯2æ¡ è¦æ±‚G0&#x2F;0&#x2F;3ç«¯å£downæ‰ä¹‹åï¼Œæ•°æ®èµ°G0&#x2F;0&#x2F;2è½¬å‘ã€‚ ä¸‰.é…ç½®äº¤æ¢æœºä¹‹é—´çš„ç”Ÿæˆæ ‘ 1.è¦æ±‚æ‰€æœ‰è¿è¡ŒRSTP 2.LSW1ä½œä¸ºä¸»æ ¹æ¡¥ï¼ŒLSW2ä½œä¸ºå¤‡ä»½æ ¹æ¡¥ 3.é…ç½®è¾¹ç¼˜ç«¯å£ï¼Œè®©æ‰€æœ‰çš„ç»ˆç«¯æ¥å…¥åˆ°ç½‘ç»œä¸­ï¼Œèƒ½ç«‹å³è½¬å‘æ•°æ®å››.é…ç½®äº¤æ¢æœºçš„é“¾è·¯ç±»å‹ä»¥åŠVLAN 1.åœ¨äº¤æ¢æœºä¸Šåˆ›å»ºæ‹“æ‰‘å›¾ä¸­æ‰€å­˜åœ¨çš„VLAN 2.é…ç½®äº¤æ¢æœºä¸PCä¸è·¯ç”±å™¨çš„é“¾è·¯ç±»å‹ä¸ºaccessé“¾è·¯ï¼Œç„¶åå°†æ¥å£åˆ’åˆ†è¿›ç›¸åº”çš„VLANï¼› åŠå…¬æ¥¼1ä¸ºVLAN 10 åŠå…¬æ¥¼2ä¸ºVLAN 20 æœåŠ¡å™¨åŒºä¸ºVLAN 30 LSW1ä¸è¿æ¥R1çš„æ¥å£VLAN 100 3.é…ç½®äº¤æ¢æœºä¸äº¤æ¢æœºäº’è¿çš„é“¾è·¯çš„trunkï¼Œå¹¶ä¸”å…è®¸ç›¸åº”çš„VLANé€šè¿‡ äº”.åœ¨æ±‡èšäº¤æ¢æœºLSW1é…ç½®ç›¸åº”çš„VLANIFæ¥å£ï¼Œä½¿ä¸åŒæ¥¼å±‚çš„PCèƒ½å®ç°é€šè®¯ å…­.DHCPé…ç½®: åœ¨LSW1ä¸Šé…ç½®å…¨å±€åœ°å€æ± 1ï¼š åœ°å€æ± pool10åˆ†é…åœ°å€æ®µä¸º192.168.10.0&#x2F;24,ç½‘å…³ä¸º192.168.10.254,DNSä¸º114.114.114.114ï¼Œ ä¸ºVLAN10çš„ä¸»æœºåˆ†é…IPåœ°å€ï¼› åœ¨LSW2ä¸Šé…ç½®å…¨å±€åœ°å€æ± 2ï¼š åœ°å€æ± pool20åˆ†é…åœ°å€æ®µä¸º192.168.20.0&#x2F;24,ç½‘å…³ä¸º192.168.20.254,DNSä¸º8.8.8.8 ä¸ºVLAN20çš„ä¸»æœºåˆ†é…IPåœ°å€ã€‚ä¸ƒ.è·¯ç”±åè®®1.åœ¨æ ¸å¿ƒè·¯ç”±å™¨AR1å’Œæ±‡èšäº¤æ¢æœºLSW1ä¸Šé…ç½®åŠ¨æ€è·¯ç”±åè®®ospfï¼Œä½¿R1èƒ½å­¦åˆ°æ•™å­¦æ¥¼å’ŒæœåŠ¡å™¨åŒºç½‘æ®µçš„è·¯ç”± é…ç½®å®Œæˆä¹‹åï¼Œæµ‹è¯•R1æ˜¯å¦è®¿é—®åˆ°æ¯å°PCä¸Š2.åœ¨æ ¸å¿ƒè·¯ç”±å™¨AR1é…ç½®ä¸€è·³é™æ€é»˜è®¤è·¯ç”±æŒ‡å‘ISPçš„è·¯ç”±å™¨AR2 å…«.NATæŠ€æœ¯ 1ã€åœ¨AR1ä¸Šä½¿ç”¨NATæŠ€æœ¯ï¼Œä½¿å†…ç½‘VLAN10ï¼ŒVLAN20çš„ç½‘æ®µè®¿é—®å¤–ç½‘æ—¶ï¼Œè½¬åŒ–çš„åœ°å€ä¸ºAR1 g0&#x2F;0&#x2F;1æ¥å£çš„IPåœ°å€ã€‚ ï¼ˆé€šè¿‡easy ipæŠ€æœ¯å®ç°ï¼‰ LSW3-1 sys [Huawei]sysn lsw3-1 [lsw3-1]v b 10 20 Info: This operation may take a few seconds. Please wait for a momentâ€¦done. [lsw3-1]int e0&#x2F;0&#x2F;3 [lsw3-1-Ethernet0&#x2F;0&#x2F;3]p l a [lsw3-1-Ethernet0&#x2F;0&#x2F;3]p d v 10 [lsw3-1-Ethernet0&#x2F;0&#x2F;3]int e0&#x2F;0&#x2F;4 [lsw3-1-Ethernet0&#x2F;0&#x2F;4]p l a[lsw3-1-Ethernet0&#x2F;0&#x2F;4]p d v 10 [lsw3-1-Ethernet0&#x2F;0&#x2F;4]int e0&#x2F;0&#x2F;1 [lsw3-1-Ethernet0&#x2F;0&#x2F;1]p l t [lsw3-1-Ethernet0&#x2F;0&#x2F;1]p t a v 10 20 [lsw3-1-Ethernet0&#x2F;0&#x2F;1]int e0&#x2F;0&#x2F;2 [lsw3-1-Ethernet0&#x2F;0&#x2F;2]p l t [lsw3-1-Ethernet0&#x2F;0&#x2F;2]p t a v 10 20 [lsw3-1]stp mode r [lsw3-1]int e0&#x2F;0&#x2F;3 [lsw3-1-Ethernet0&#x2F;0&#x2F;3]stp edged-port enable &#x2F;&#x2F;è®¾ç½®è¾¹ç¼˜ç«¯å£ä¾¿äºå¿«é€Ÿæ”¶ æ•› [lsw3-1-Ethernet0&#x2F;0&#x2F;3]int e0&#x2F;0&#x2F;4 [lsw3-1-Ethernet0&#x2F;0&#x2F;4]stp edged-port enable LSW4 sys Enter system view, return user view with Ctrl+Z. [Huawei]sysn LSW4-1 [LSW4-1]v b 20 [LSW4-1]int e0&#x2F;0&#x2F;4 [LSW4-1-Ethernet0&#x2F;0&#x2F;4]p l a [LSW4-1-Ethernet0&#x2F;0&#x2F;4]p d v 20 [LSW4-1-Ethernet0&#x2F;0&#x2F;4]int e0&#x2F;0&#x2F;5 [LSW4-1-Ethernet0&#x2F;0&#x2F;5]p l a [LSW4-1-Ethernet0&#x2F;0&#x2F;5]p d v 20 [LSW4-1-Ethernet0&#x2F;0&#x2F;5]int e0&#x2F;0&#x2F;1 [LSW4-1-Ethernet0&#x2F;0&#x2F;1]p l t [LSW4-1-Ethernet0&#x2F;0&#x2F;1]p t a v 10 20 [LSW4-1-Ethernet0&#x2F;0&#x2F;1]int e0&#x2F;0&#x2F;2 [LSW4-1-Ethernet0&#x2F;0&#x2F;2]p l t [LSW4-1-Ethernet0&#x2F;0&#x2F;2]p t a v 10 20 [LSW4-1]stp mode r [LSW4-1]int e0&#x2F;0&#x2F;4 [LSW4-1-Ethernet0&#x2F;0&#x2F;4]stp edged-port enable [LSW4-1-Ethernet0&#x2F;0&#x2F;4]int e0&#x2F;0&#x2F;5[LSW4-1-Ethernet0&#x2F;0&#x2F;5]stp ed e [LSW4-1]int e0&#x2F;0&#x2F;1 [LSW4-1-Ethernet0&#x2F;0&#x2F;1]stp cost 300000 &#x2F;&#x2F;ä¿®æ”¹ç«¯å£costæ¥ä½¿åˆ°è¾¾ç½‘å…³æœ€ä¼˜ LSW1 [LSW1]v b 10 20 12 100 30 [LSW1]int g0&#x2F;0&#x2F;4 [LSW1-GigabitEthernet0&#x2F;0&#x2F;4]p l t [LSW1-GigabitEthernet0&#x2F;0&#x2F;4]p t a v 10 20 [LSW1-GigabitEthernet0&#x2F;0&#x2F;4]int g0&#x2F;0&#x2F;5 [LSW1-GigabitEthernet0&#x2F;0&#x2F;5]p l t [LSW1-GigabitEthernet0&#x2F;0&#x2F;5]p t a v 10 20 [LSW1-GigabitEthernet0&#x2F;0&#x2F;5]q [LSW1]int Eth-Trunk 1 [LSW1-Eth-Trunk1]mode lacp-static [LSW1-Eth-Trunk1]max active-linknumber 2 &#x2F;&#x2F;è®¾ç½®èšåˆæœ€å¤§æ•°é‡ä¸º2 [LSW1-Eth-Trunk1]trunkport g 0&#x2F;0&#x2F;1 0&#x2F;0&#x2F;2 0&#x2F;0&#x2F;3 [LSW1-Eth-Trunk1]p l t [LSW1-Eth-Trunk1]p t a v 10 20 30 12 [LSW1-Eth-Trunk1]shutdown [LSW1-Eth-Trunk1]undo shutdown [LSW1-Eth-Trunk1]q [LSW1]int g0&#x2F;0&#x2F;6 [LSW1-GigabitEthernet0&#x2F;0&#x2F;6]p l a [LSW1-GigabitEthernet0&#x2F;0&#x2F;6]p d v 100 [LSW1-GigabitEthernet0&#x2F;0&#x2F;6]int g0&#x2F;0&#x2F;7 [LSW1-GigabitEthernet0&#x2F;0&#x2F;7]p l a [LSW1-GigabitEthernet0&#x2F;0&#x2F;7]p d v 30 [LSW1-GigabitEthernet0&#x2F;0&#x2F;7]int g0&#x2F;0&#x2F;8 [LSW1-GigabitEthernet0&#x2F;0&#x2F;8]p l a [LSW1-GigabitEthernet0&#x2F;0&#x2F;8]p d v 30 [LSW1-GigabitEthernet0&#x2F;0&#x2F;8]q [LSW1]stp mode rstp [LSW1]stp root primary [LSW1]int g0&#x2F;0&#x2F;7[LSW1-GigabitEthernet0&#x2F;0&#x2F;7]stp ed e [LSW1-GigabitEthernet0&#x2F;0&#x2F;7]int g0&#x2F;0&#x2F;8 [LSW1-GigabitEthernet0&#x2F;0&#x2F;8]stp ed e [LSW1-GigabitEthernet0&#x2F;0&#x2F;8]q [LSW1]int v 10 [LSW1-Vlanif10]ip add 192.168.10.254 24 [LSW1-Vlanif10]int v 12 [LSW1-Vlanif12]ip add 10.0.12.1 24 [LSW1-Vlanif12]int v 100 [LSW1-Vlanif100]ip add 100.1.1.1 24 [LSW1-Vlanif100]int v 30 [LSW1-Vlanif30]ip add 192.168.30.254 24 [LSW1-Vlanif30]q [LSW1]ip pool vlan10 [LSW1-ip-pool-vlan10]network 192.168.10.0 mask 24 [LSW1-ip-pool-vlan10]gateway-list 192.168.10.254 [LSW1-ip-pool-vlan10]dns-list 8.8.8.8 [LSW1-ip-pool-vlan10]q [LSW1]ip pool vlan30 [LSW1-ip-pool-vlan30]network 192.168.30.0 m 24 [LSW1-ip-pool-vlan30]g 192.168.30.254 [LSW1-ip-pool-vlan30]dns 114.114.114.114 [LSW1-ip-pool-vlan30]q [LSW1]dhcp enable [LSW1]int v 10 [LSW1-Vlanif10]dhcp se g [LSW1-Vlanif10]int v 30 [LSW1-Vlanif30]dhcp s g [LSW1]ospf [LSW1-ospf-1]area 0 [LSW1-ospf-1-area-0.0.0.0]network 10.0.12.0 0.0.0.255 [LSW1-ospf-1-area-0.0.0.0]network 100.1.1.1 0.0.0.255 [LSW1-ospf-1-area-0.0.0.0]network 192.168.10.0 0.0.0.255 [LSW1-ospf-1-area-0.0.0.0]network 192.168.30.0 0.0.0.255 [LSW1-ospf-1-area-0.0.0.0]network 192.168.20.0 0.0.0.255LSW2 sys Enter system view, return user view with Ctrl+Z. [Huawei]v b 12 10 20 40 [Huawei]sysn LSW2 [LSW2]int g0&#x2F;0&#x2F;4 [LSW2-GigabitEthernet0&#x2F;0&#x2F;4]p l t [LSW2-GigabitEthernet0&#x2F;0&#x2F;4]p t a v 10 20 [LSW2-GigabitEthernet0&#x2F;0&#x2F;4]int g0&#x2F;0&#x2F;5 [LSW2-GigabitEthernet0&#x2F;0&#x2F;5]p l t [LSW2-GigabitEthernet0&#x2F;0&#x2F;5]p t a v 10 20 [LSW2]int Eth-Trunk 1 [LSW2-Eth-Trunk1]mode lacp-static [LSW2-Eth-Trunk1]max active-linknumber 2 [LSW2-Eth-Trunk1]trunkport g 0&#x2F;0&#x2F;1 0&#x2F;0&#x2F;2 0&#x2F;0&#x2F;3 [LSW2-Eth-Trunk1]q [LSW2]int g0&#x2F;0&#x2F;2 [LSW2-GigabitEthernet0&#x2F;0&#x2F;2]lacp priority 32769 &#x2F;&#x2F;è®¾ç½®è¯¥ç«¯å£åœ¨èšåˆæ—¶ ä¸ºå¤‡ä»½ [LSW2-GigabitEthernet0&#x2F;0&#x2F;2]int e 1 [LSW2-Eth-Trunk1]shutdown [LSW2-Eth-Trunk1]undo shutdown &#x2F;&#x2F;éæŠ¢å  æ‰€ä»¥éœ€è¦é‡å¯ [LSW2-Eth-Trunk1]p l t [LSW2-Eth-Trunk1]p t a v 12 10 20 [LSW2-Eth-Trunk1]q [LSW2]stp mode rs [LSW2]stp root secondary [LSW2]ip pool vlan20 [LSW2-ip-pool-vlan20]network 192.168.20.0 m 24 [LSW2-ip-pool-vlan20]g 192.168.20.254 [LSW2-ip-pool-vlan20]q [LSW2]dhcp enable [LSW2]int v 20 [LSW2-Vlanif20]ip add 192.168.20.254 24 [LSW2-Vlanif20]q[LSW2-Vlanif20]dhcp se g [LSW2-Vlanif20]int v 12 [LSW2-Vlanif12]ip add 10.0.12.2 24 [LSW2-Vlanif12]q -â€“ æ¥ä¸‹æ¥ä¸ºacè¿™éƒ¨åˆ†é…ç½® [LSW2]int g0&#x2F;0&#x2F;7 [LSW2-GigabitEthernet0&#x2F;0&#x2F;7]p l t [LSW2-GigabitEthernet0&#x2F;0&#x2F;7]p t a v 40 50 [LSW2-GigabitEthernet0&#x2F;0&#x2F;7]int g0&#x2F;0&#x2F;6 [LSW2-GigabitEthernet0&#x2F;0&#x2F;6]p l t [LSW2-GigabitEthernet0&#x2F;0&#x2F;6]p t a v 40 50 10 20 12 [LSW2-GigabitEthernet0&#x2F;0&#x2F;6]p t p v 40 [LSW2]ospf [LSW2-ospf-1]area 0 [LSW2-ospf-1-area-0.0.0.0]network 192.168.20.0 0.0.0.255 [LSW2-ospf-1-area-0.0.0.0]network 10.0.12.0 0.0.0.255 AC sys Enter system view, return user view with Ctrl+Z. [AC6005]sysn AC [AC]int g0&#x2F;0&#x2F;1 [AC-GigabitEthernet0&#x2F;0&#x2F;1]q [AC]v b 40 50 [AC]int g0&#x2F;0&#x2F;1 [AC-GigabitEthernet0&#x2F;0&#x2F;1]p l t [AC-GigabitEthernet0&#x2F;0&#x2F;1]p t a v 40 50 [AC-GigabitEthernet0&#x2F;0&#x2F;1]q [AC]int v 40 [AC-Vlanif40]ip add 192.168.40.254 24 [AC-ip-pool-vlan40]int v 50 [AC-Vlanif50]ip add 192.168.50.254 24 [AC-Vlanif50]int v 1 [AC-Vlanif1]ip add 10.0.11.2 24 &#x2F;&#x2F; ä¸ar1 é€šä¿¡[AC-Vlanif1]q [AC]ip pool vlan40 [AC-ip-pool-vlan40]network 192.168.40.0 m 24 [AC-ip-pool-vlan40]g 192.168.40.254 [AC-ip-pool-vlan40]q [AC]ip pool vlan50 [AC-ip-pool-vlan50]network 192.168.50.0 m 24 [AC-ip-pool-vlan50]g 192.168.50.254 [AC-ip-pool-vlan50]q [AC-wlan-view]int v 40 [AC-Vlanif40]dhcp select g [AC-Vlanif40]int v 50 [AC-Vlanif50]dhcp select global [AC]capwap source interface Vlanif 40 [AC]wlan [AC-wlan-view]ssid-profile name HCIA-WLAN [AC-wlan-ssid-prof-HCIA-WLAN]ssid HCIA-WLAN [AC-wlan-ssid-prof-HCIA-WLAN]q [AC-wlan-view]security-profile name HCIA-WLAN [AC-wlan-sec-prof-HCIA-WLAN]security wpa-wpa2 psk pass-phrase HCIA Datacom aes [AC-wlan-sec-prof-HCIA-WLAN]q [AC-wlan-view]vap-profile name HCIA-WLAN [AC-wlan-vap-prof-HCIA-WLAN]ssid-profile HCIA-WLAN [AC-wlan-vap-prof-HCIA-WLAN]security-profile HCIA-WLAN [AC-wlan-vap-prof-HCIA-WLAN]service-vlan vlan-id 50 [AC-wlan-vap-prof-HCIA-WLAN]forward-mode direct-forward [AC-wlan-view]ap-group name ap-group1 [AC-wlan-ap-group-ap-group1]vap-profile HCIA-WLAN wlan 1 radio all [AC-wlan-ap-group-ap-group1]q [AC-wlan-view]ap-id 1 ap-mac 00E0-FC27-2F80 [AC-wlan-ap-1]ap-group ap-group1 [AC]ospf [AC-ospf-1]area 0 [AC-ospf-1-area-0.0.0.0]network 10.0.11.0 0.0.0.255 [AC-ospf-1-area-0.0.0.0]network 192.168.50.0 0.0.0.255AR1 [ar1]int g0&#x2F;0&#x2F;0 [ar1-GigabitEthernet0&#x2F;0&#x2F;0]ip add 100.1.1.2 24 [ar1-GigabitEthernet0&#x2F;0&#x2F;0]int g0&#x2F;0&#x2F;1 [ar1-GigabitEthernet0&#x2F;0&#x2F;1]ip add 200.1.1.1 24 [ar1-GigabitEthernet0&#x2F;0&#x2F;1]int g0&#x2F;0&#x2F;2 [ar1-GigabitEthernet0&#x2F;0&#x2F;2]ip add 10.0.11.1 24 [ar1-GigabitEthernet0&#x2F;0&#x2F;2]q [ar1]ip route-static 0.0.0.0 0 200.1.1.2 [ar1-GigabitEthernet0&#x2F;0&#x2F;2]ospf [ar1-ospf-1]area 0 [ar1-ospf-1-area-0.0.0.0]network 100.1.1.0 0.0.0.255 [ar1-ospf-1-area-0.0.0.0]network 10.0.11.1 0.0.0.255 [ar1-ospf-1]default-route-advertise always [ar1]acl 2000 [ar1-acl-basic-2000]rule permit source 192.168.10.0 0.0.0.255 [ar1-acl-basic-2000]rule permit source 192.168.20.0 0.0.0.255 [ar1-acl-basic-2000]rule permit source 192.168.50.0 0.0.0.255 ar1]int g0&#x2F;0&#x2F;1 [ar1-GigabitEthernet0&#x2F;0&#x2F;1]nat outbound 2000 æ­¤æ—¶ä¾ç„¶å¯ä»¥å…¨éƒ¨è¿›è¡Œé€šä¿¡è¿™æ˜¯å› ä¸ºèµ°é»˜è®¤è·¯å¾„å¯ä»¥ç›´æ¥å‡ºå» è€Œä¸”å¯¹ç«¯ä¼šå›åŒ… [ar1]acl 2001 [ar1-acl-basic-2001]rule permit source 192.168.10.0 0.0.0.255 [ar1-acl-basic-2001]rule permit source 192.168.20.0 0.0.0.255 rule deny source 0.0.0.0 255.255.255.255 [ar1-acl-basic-2001]q [ar1]int g0&#x2F;0&#x2F;0 [ar1-GigabitEthernet0&#x2F;0&#x2F;1]traffic-filter inbound acl 2001 AR2 æ·»åŠ é»˜è®¤å›ç¨‹è·¯ç”± [AR2]ip route-static 0.0.0.0 0 200.1.1.1 æµ‹è¯•ç¯å›å£[AR2]int LoopBack 0 [AR2-LoopBack0]ip add 2.2.2.2 24","categories":[{"name":"ç»¼åˆå®éªŒ","slug":"ç»¼åˆå®éªŒ","permalink":"http://example.com/categories/%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/"}],"tags":[]},{"title":"STP/RSTP/MSTPæ€»ç»“","slug":"STP-RSTP-MSTPæ€»ç»“","date":"2024-05-29T05:40:56.000Z","updated":"2024-05-29T07:40:59.545Z","comments":true,"path":"2024/05/29/STP-RSTP-MSTPæ€»ç»“/","permalink":"http://example.com/2024/05/29/STP-RSTP-MSTP%E6%80%BB%E7%BB%93/","excerpt":"","text":"STPä»¥å¤ªç½‘äº¤æ¢ç½‘ç»œä¸­ä¸ºäº†è¿›è¡Œé“¾è·¯å¤‡ä»½ï¼Œæé«˜ç½‘ç»œå¯é æ€§ï¼Œé€šå¸¸ä¼šä½¿ç”¨å†—ä½™é“¾è·¯ã€‚ä½†æ˜¯ä½¿ç”¨å†—ä½™é“¾è·¯ä¼šåœ¨äº¤æ¢ç½‘ç»œä¸Šäº§ç”Ÿç¯è·¯ï¼Œå¼•å‘å¹¿æ’­é£æš´ä»¥åŠMACåœ°å€è¡¨ä¸ç¨³å®šç­‰æ•…éšœç°è±¡ï¼Œä»è€Œå¯¼è‡´ç”¨æˆ·é€šä¿¡è´¨é‡è¾ƒå·®ï¼Œç”šè‡³é€šä¿¡ä¸­æ–­ã€‚ä¸ºè§£å†³äº¤æ¢ç½‘ç»œä¸­çš„ç¯è·¯é—®é¢˜ï¼Œæå‡ºäº†ç”Ÿæˆæ ‘åè®®STPï¼ˆSpanning Tree Protocolï¼‰ã€‚ ä¸ä¼—å¤šåè®®çš„å‘å±•è¿‡ç¨‹ä¸€æ ·ï¼Œç”Ÿæˆæ ‘åè®®ä¹Ÿæ˜¯éšç€ç½‘ç»œçš„å‘å±•è€Œä¸æ–­æ›´æ–°çš„ï¼Œä»æœ€åˆçš„IEEE 802.1Dä¸­å®šä¹‰çš„STPåˆ°IEEE 802.1Wä¸­å®šä¹‰çš„å¿«é€Ÿç”Ÿæˆæ ‘åè®®RSTPï¼ˆRapid Spanning Tree Protocolï¼‰ï¼Œå†åˆ°æœ€æ–°çš„IEEE 802.1Sä¸­å®šä¹‰çš„å¤šç”Ÿæˆæ ‘åè®®MSTPï¼ˆMultiple Spanning Tree Protocolï¼‰ã€‚ ç”Ÿæˆæ ‘åè®®ä¸­ï¼ŒMSTPå…¼å®¹RSTPã€STPï¼ŒRSTPå…¼å®¹STPã€‚ ç”Ÿæˆæ ‘åè®® ç‰¹ç‚¹ åº”ç”¨åœºæ™¯ STP å½¢æˆä¸€æ£µæ— ç¯è·¯çš„æ ‘ï¼Œè§£å†³å¹¿æ’­é£æš´å¹¶å®ç°å†—ä½™å¤‡ä»½ã€‚æ”¶æ•›é€Ÿåº¦è¾ƒæ…¢ã€‚ æ— éœ€åŒºåˆ†ç”¨æˆ·æˆ–ä¸šåŠ¡æµé‡ï¼Œæ‰€æœ‰VLANå…±äº«ä¸€æ£µç”Ÿæˆæ ‘ã€‚ RSTP å½¢æˆä¸€æ£µæ— ç¯è·¯çš„æ ‘ï¼Œè§£å†³å¹¿æ’­é£æš´å¹¶å®ç°å†—ä½™å¤‡ä»½ã€‚æ”¶æ•›é€Ÿåº¦å¿«ã€‚ MSTP å½¢æˆå¤šæ£µæ— ç¯è·¯çš„æ ‘ï¼Œè§£å†³å¹¿æ’­é£æš´å¹¶å®ç°å†—ä½™å¤‡ä»½ã€‚æ”¶æ•›é€Ÿåº¦å¿«ã€‚å¤šæ£µç”Ÿæˆæ ‘åœ¨VLANé—´å®ç°è´Ÿè½½å‡è¡¡ï¼Œä¸åŒVLANçš„æµé‡æŒ‰ç…§ä¸åŒçš„è·¯å¾„è½¬å‘ã€‚ éœ€è¦åŒºåˆ†ç”¨æˆ·æˆ–ä¸šåŠ¡æµé‡ï¼Œå¹¶å®ç°è´Ÿè½½åˆ†æ‹…ã€‚ä¸åŒçš„VLANé€šè¿‡ä¸åŒçš„ç”Ÿæˆæ ‘è½¬å‘æµé‡ï¼Œæ¯æ£µç”Ÿæˆæ ‘ä¹‹é—´ç›¸äº’ç‹¬ç«‹ã€‚ äº§ç”ŸèƒŒæ™¯1.å¹¿æ’­é£æš´ æ ¹æ®äº¤æ¢æœºçš„è½¬å‘åŸåˆ™ï¼Œå¦‚æœäº¤æ¢æœºä»ä¸€ä¸ªç«¯å£ä¸Šæ¥æ”¶åˆ°çš„æ˜¯ä¸€ä¸ªå¹¿æ’­å¸§ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªç›®çš„MACåœ°å€æœªçŸ¥çš„å•æ’­å¸§ï¼Œåˆ™ä¼šå°†è¿™ä¸ªå¸§å‘é™¤æºç«¯å£ä¹‹å¤–çš„æ‰€æœ‰å…¶ä»–ç«¯å£è½¬å‘ï¼ˆæ³›æ´ªï¼‰ã€‚å¦‚æœäº¤æ¢ç½‘ç»œä¸­æœ‰ç¯è·¯ï¼Œåˆ™è¿™ä¸ªå¸§ä¼šè¢«æ— é™è½¬å‘ï¼Œæ­¤æ—¶ä¾¿ä¼šå½¢æˆå¹¿æ’­é£æš´ï¼Œç½‘ç»œä¸­ä¹Ÿä¼šå……æ–¥ç€é‡å¤çš„æ•°æ®å¸§ã€‚ SWBï¼ŒSWAå’ŒSWCä¹Ÿä¼šå°†æ­¤å¸§è½¬å‘åˆ°é™¤äº†æ¥æ”¶æ­¤å¸§çš„å…¶ä»–æ‰€æœ‰ç«¯å£ï¼Œç»“æœæ­¤å¸§åˆä¼šè¢«å†æ¬¡è½¬å‘ç»™SWBï¼Œè¿™ç§å¾ªç¯ä¼šä¸€ç›´æŒç»­ï¼Œäºæ˜¯ä¾¿äº§ç”Ÿäº†å¹¿æ’­é£æš´ã€‚äº¤æ¢æœºæ€§èƒ½ä¼šå› æ­¤æ€¥é€Ÿä¸‹é™ï¼Œå¹¶ä¼šå¯¼è‡´ä¸šåŠ¡ä¸­æ–­ã€‚ 2.MACåœ°å€è¡¨éœ‡è¡ äº¤æ¢æœºæ˜¯æ ¹æ®æ‰€æ¥æ”¶åˆ°çš„æ•°æ®å¸§çš„æºåœ°å€å’Œæ¥æ”¶ç«¯å£ç”ŸæˆMACåœ°å€è¡¨é¡¹çš„ã€‚ ï¼ˆ1ï¼‰ä¸»æœºAå‘å¤–å‘é€ä¸€ä¸ªå•æ’­å¸§ï¼Œå‡è®¾æ­¤å•æ’­å¸§çš„ç›®çš„MACåœ°å€åœ¨ç½‘ç»œä¸­æ‰€æœ‰äº¤æ¢æœºçš„MACåœ°å€è¡¨ä¸­éƒ½æš‚æ—¶ä¸å­˜åœ¨ã€‚SWBæ”¶åˆ°æ­¤æ•°æ®å¸§ä¹‹åï¼Œåœ¨MACåœ°å€è¡¨ä¸­ç”Ÿæˆä¸€ä¸ªMACåœ°å€è¡¨é¡¹ï¼š SWBçš„MACåœ°å€è¡¨ MACåœ°å€ ç«¯å£ 00-05-06-07-08-AA GE0&#x2F;0&#x2F;3 â€‹ å°†å…¶ä»G0&#x2F;0&#x2F;1å’ŒG0&#x2F;0&#x2F;2ç«¯å£è½¬å‘ã€‚æ­¤ä¾‹ä»…ä»¥SWBä»G0&#x2F;0&#x2F;1ç«¯å£è½¬å‘æ­¤å¸§ä¸ºä¾‹è¿›è¡Œè¯´æ˜ã€‚ ï¼ˆ2ï¼‰SWAæ¥æ”¶åˆ°æ­¤å¸§åï¼Œç”±äºMACåœ°å€è¡¨ä¸­æ²¡æœ‰å¯¹åº”æ­¤å¸§ç›®çš„MACåœ°å€çš„è¡¨é¡¹ï¼Œæ‰€ä»¥SWAä¼šå°†æ­¤å¸§ä»G0&#x2F;0&#x2F;2è½¬å‘å‡ºå»ã€‚ ï¼ˆ3ï¼‰SWCæ¥æ”¶åˆ°æ­¤å¸§åï¼Œç”±äºMACåœ°å€è¡¨ä¸­ä¹Ÿæ²¡æœ‰å¯¹åº”æ­¤å¸§ç›®çš„MACåœ°å€çš„è¡¨é¡¹ï¼Œæ‰€ä»¥SWCä¼šå°†æ­¤å¸§ä»G0&#x2F;0&#x2F;2ç«¯å£å‘é€å›SWBï¼Œä¹Ÿä¼šå‘ç»™ä¸»æœºBã€‚ ï¼ˆ4ï¼‰SWBä»G0&#x2F;0&#x2F;2æ¥å£æ¥æ”¶åˆ°æ­¤æ•°æ®å¸§ä¹‹åï¼Œä¼šåœ¨MACåœ°å€è¡¨ä¸­åˆ é™¤åŸæœ‰çš„ç›¸å…³è¡¨é¡¹ï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„è¡¨é¡¹ï¼š SWBçš„MACåœ°å€è¡¨ MACåœ°å€ ç«¯å£ 00-05-06-07-08-AA GE0&#x2F;0&#x2F;3 00-05-06-07-08-AA GE0&#x2F;0&#x2F;2 æ­¤è¿‡ç¨‹ä¼šä¸æ–­é‡å¤ï¼Œä»è€Œå¯¼è‡´MACåœ°å€è¡¨éœ‡è¡ã€‚ STPåŸºæœ¬æ¦‚å¿µæ ¹æ¡¥ æ ‘å½¢çš„ç½‘ç»œç»“æ„å¿…é¡»æœ‰æ ‘æ ¹ï¼Œäºæ˜¯STPå¼•å…¥äº†æ ¹æ¡¥ï¼ˆRoot Bridgeï¼‰æ¦‚å¿µã€‚ å¯¹äºä¸€ä¸ªSTPç½‘ç»œï¼Œæ ¹æ¡¥åœ¨å…¨ç½‘ä¸­åªæœ‰ä¸€ä¸ªï¼Œå®ƒæ˜¯æ•´ä¸ªç½‘ç»œçš„é€»è¾‘ä¸­å¿ƒï¼Œä½†ä¸ä¸€å®šæ˜¯ç‰©ç†ä¸­å¿ƒã€‚æ ¹æ¡¥ä¼šæ ¹æ®ç½‘ç»œæ‹“æ‰‘çš„å˜åŒ–è€ŒåŠ¨æ€å˜åŒ–ã€‚ ç½‘ç»œæ”¶æ•›åï¼Œæ ¹æ¡¥ä¼šæŒ‰ç…§ä¸€å®šçš„æ—¶é—´é—´éš”äº§ç”Ÿå¹¶å‘å¤–å‘é€é…ç½®BPDUï¼Œå…¶ä»–è®¾å¤‡æ”¶åˆ°è¯¥é…ç½®BPDUåï¼Œå¦‚æœä¼˜å…ˆçº§æ¯”è‡ªå·±çš„é…ç½®BPDUé«˜ï¼Œåˆ™éæ ¹æ¡¥è®¾å¤‡ä¼šæ ¹æ®æ”¶åˆ°çš„é…ç½®BPDUä¸­æºå¸¦çš„ä¿¡æ¯æ›´æ–°è‡ªå·±STPç«¯å£å­˜å‚¨çš„é…ç½®BPDUä¿¡æ¯ï¼Œå¦åˆ™ä¼šä¸¢å¼ƒè¯¥é…ç½®BPDUã€‚ BIDï¼šæ¡¥ID IEEE 802.1Dæ ‡å‡†ä¸­è§„å®šBIDæ˜¯ç”±16ä½çš„æ¡¥ä¼˜å…ˆçº§ï¼ˆBridge Priorityï¼‰ä¸æ¡¥MACåœ°å€æ„æˆã€‚BIDæ¡¥ä¼˜å…ˆçº§å æ®é«˜16ä½ï¼Œå…¶ä½™çš„ä½48ä½æ˜¯MACåœ°å€ã€‚ åœ¨STPç½‘ç»œä¸­ï¼Œæ¡¥IDæœ€å°çš„è®¾å¤‡ä¼šè¢«é€‰ä¸¾ä¸ºæ ¹æ¡¥ã€‚ PIDï¼šç«¯å£ID PIDç”±ä¸¤éƒ¨åˆ†æ„æˆçš„ï¼Œé«˜4ä½æ˜¯ç«¯å£ä¼˜å…ˆçº§ï¼Œä½12ä½æ˜¯ç«¯å£å·ã€‚ PIDåªåœ¨æŸäº›æƒ…å†µä¸‹å¯¹é€‰æ‹©æŒ‡å®šç«¯å£æœ‰ä½œç”¨ã€‚ æ¡¥ä¼˜å…ˆçº§ï¼š0-65535ï¼Œé»˜è®¤32768ï¼Œå¿…é¡»æ˜¯4095å€æ•° ç«¯å£ä¼˜å…ˆçº§ï¼š0-240ï¼Œé»˜è®¤128ï¼Œæ­¥é•¿16ï¼Œå¿…é¡»æ˜¯16çš„å€æ•° é€‰ä¸¾è¿‡ç¨‹1.é€‰ä¸¾æ ¹æ¡¥ï¼ˆBID&#x3D;ä¼˜å…ˆçº§+MACï¼Œä¼˜å…ˆçº§è¶Šå°è¶Šä¼˜ï¼Œå¦‚æœä¼˜å…ˆçº§ç›¸ç­‰ï¼ŒMACå°çš„æˆä¸ºæ ¹æ¡¥ï¼‰ åœ¨ä¸€ä¸ªäº¤æ¢ç½‘ç»œä¸­é€‰ä¸¾ä¸€ä¸ªæ ¹æ¡¥ 2.é€‰ä¸¾æ ¹ç«¯å£ï¼ˆRPCå°çš„ä¼˜+ä¸Šè¡Œäº¤æ¢æœºçš„BID+ä¸Šè¡Œäº¤æ¢æœºçš„PID+æœ¬åœ°PIDï¼‰ åœ¨æ¯ä¸ªéæ ¹äº¤æ¢æœºé€‰ä¸¾ä¸€ä¸ªæ ¹ç«¯å£ 3.é€‰ä¸¾æŒ‡å®šç«¯å£ï¼ˆRPCå°çš„ä¼˜+æœ¬ç«¯å£çš„BID+æœ¬ç«¯å£çš„PIDï¼‰ æ¯ä¸ªç½‘æ®µé€‰ä¸¾ä¸€ä¸ªæŒ‡å®šç«¯å£ 4.é˜»å¡éæŒ‡å®šç«¯å£ é˜»å¡äº¤æ¢æœºä¸Šçš„æ‰€æœ‰éæ ¹ï¼ŒéæŒ‡å®šç«¯å£ ç«¯å£çŠ¶æ€ ç›®çš„ è¯´æ˜ Forwarding ç«¯å£æ—¢è½¬å‘ç”¨æˆ·æµé‡ä¹Ÿå¤„ç†BPDUæŠ¥æ–‡ã€‚ åªæœ‰æ ¹ç«¯å£æˆ–æŒ‡å®šç«¯å£æ‰èƒ½è¿›å…¥ForwardingçŠ¶æ€ã€‚ Learning è®¾å¤‡ä¼šæ ¹æ®æ”¶åˆ°çš„ç”¨æˆ·æµé‡æ„å»ºMACåœ°å€è¡¨ï¼Œä½†ä¸è½¬å‘ç”¨æˆ·æµé‡ã€‚ è¿‡æ¸¡çŠ¶æ€ï¼Œå¢åŠ LearningçŠ¶æ€é˜²æ­¢ä¸´æ—¶ç¯è·¯ã€‚ Listening ç¡®å®šç«¯å£è§’è‰²ï¼Œå°†é€‰ä¸¾å‡ºæ ¹æ¡¥ã€æ ¹ç«¯å£å’ŒæŒ‡å®šç«¯å£ã€‚ è¿‡æ¸¡çŠ¶æ€ã€‚ Blocking ç«¯å£ä»…ä»…æ¥æ”¶å¹¶å¤„ç†BPDUï¼Œä¸è½¬å‘ç”¨æˆ·æµé‡ã€‚ é˜»å¡ç«¯å£çš„æœ€ç»ˆçŠ¶æ€ã€‚ Disabled ç«¯å£ä¸ä»…ä¸å¤„ç†BPDUæŠ¥æ–‡ï¼Œä¹Ÿä¸è½¬å‘ç”¨æˆ·æµé‡ã€‚ ç«¯å£çŠ¶æ€ä¸ºDownã€‚ å¯¹äºSTPï¼Œå½±å“ç«¯å£çŠ¶æ€å’Œç«¯å£æ”¶æ•›æœ‰ä»¥ä¸‹3ä¸ªå‚æ•°ã€‚ Hello Timeï¼ˆ2sï¼‰ è¿è¡ŒSTPåè®®çš„è®¾å¤‡å‘é€é…ç½®æ¶ˆæ¯BPDUçš„æ—¶é—´é—´éš”ï¼Œç”¨äºè®¾å¤‡æ£€æµ‹é“¾è·¯æ˜¯å¦å­˜åœ¨æ•…éšœã€‚è®¾å¤‡æ¯éš”Hello Timeæ—¶é—´ä¼šå‘å‘¨å›´çš„è®¾å¤‡å‘é€helloæŠ¥æ–‡ï¼Œä»¥ç¡®è®¤é“¾è·¯æ˜¯å¦å­˜åœ¨æ•…éšœã€‚ å½“ç½‘ç»œæ‹“æ‰‘ç¨³å®šä¹‹åï¼Œè¯¥è®¡æ—¶å™¨çš„ä¿®æ”¹åªæœ‰åœ¨æ ¹æ¡¥ä¿®æ”¹åæ‰æœ‰æ•ˆã€‚æ–°çš„æ ¹æ¡¥ä¼šåœ¨å‘å‡ºçš„BPDUæŠ¥æ–‡ä¸­å¡«å……é€‚å½“çš„å­—æ®µä»¥å‘å…¶ä»–éæ ¹æ¡¥ä¼ é€’è¯¥è®¡æ—¶å™¨ä¿®æ”¹çš„ä¿¡æ¯ã€‚ä½†å½“æ‹“æ‰‘å˜åŒ–ä¹‹åï¼ŒTCN BPDUçš„å‘é€ä¸å—è¿™ä¸ªè®¡æ—¶å™¨çš„ç®¡ç†ã€‚ Forward Delayï¼ˆ15sï¼‰ è®¾å¤‡çŠ¶æ€è¿ç§»çš„å»¶è¿Ÿæ—¶é—´ã€‚é“¾è·¯æ•…éšœä¼šå¼•å‘ç½‘ç»œé‡æ–°è¿›è¡Œç”Ÿæˆæ ‘çš„è®¡ç®—ï¼Œç”Ÿæˆæ ‘çš„ç»“æ„å°†å‘ç”Ÿç›¸åº”çš„å˜åŒ–ã€‚ä¸è¿‡é‡æ–°è®¡ç®—å¾—åˆ°çš„æ–°é…ç½®æ¶ˆæ¯æ— æ³•ç«‹åˆ»ä¼ éæ•´ä¸ªç½‘ç»œï¼Œå¦‚æœæ–°é€‰å‡ºçš„æ ¹ç«¯å£å’ŒæŒ‡å®šç«¯å£ç«‹åˆ»å°±å¼€å§‹æ•°æ®è½¬å‘çš„è¯ï¼Œå¯èƒ½ä¼šé€ æˆä¸´æ—¶ç¯è·¯ã€‚ä¸ºæ­¤ï¼ŒSTPé‡‡ç”¨äº†ä¸€ç§çŠ¶æ€è¿ç§»æœºåˆ¶ï¼Œæ–°é€‰å‡ºçš„æ ¹ç«¯å£å’ŒæŒ‡å®šç«¯å£è¦ç»è¿‡2å€çš„Forward Delayå»¶æ—¶åæ‰èƒ½è¿›å…¥è½¬å‘çŠ¶æ€ï¼Œè¿™ä¸ªå»¶æ—¶ä¿è¯äº†æ–°çš„é…ç½®æ¶ˆæ¯ä¼ éæ•´ä¸ªç½‘ç»œï¼Œä»è€Œé˜²æ­¢äº†ä¸´æ—¶ç¯è·¯çš„äº§ç”Ÿã€‚30s Forward Delay TimeræŒ‡ä¸€ä¸ªç«¯å£å¤„äºListeningå’ŒLearningçŠ¶æ€çš„å„è‡ªæŒç»­æ—¶é—´ï¼Œé»˜è®¤æ˜¯15ç§’ã€‚å³ListeningçŠ¶æ€æŒç»­15ç§’ï¼ŒéšåLearningçŠ¶æ€å†æŒç»­15ç§’ã€‚è¿™ä¸¤ä¸ªçŠ¶æ€ä¸‹çš„ç«¯å£ä¸è½¬å‘ç”¨æˆ·æµé‡ï¼Œè¿™æ­£æ˜¯STPç”¨äºé¿å…ä¸´æ—¶ç¯è·¯çš„å…³é”®ã€‚ Max Ageï¼ˆ20sï¼‰ ç«¯å£çš„BPDUæŠ¥æ–‡è€åŒ–æ—¶é—´ï¼Œå¯åœ¨æ ¹æ¡¥ä¸Šé€šè¿‡å‘½ä»¤äººä¸ºæ”¹åŠ¨è€åŒ–æ—¶é—´ã€‚ Max Ageé€šè¿‡é…ç½®BPDUæŠ¥æ–‡çš„ä¼ è¾“ï¼Œå¯ä¿è¯Max Ageåœ¨æ•´ç½‘ä¸­ä¸€è‡´ã€‚è¿è¡ŒSTPåè®®çš„ç½‘ç»œä¸­éæ ¹æ¡¥è®¾å¤‡æ”¶åˆ°é…ç½®BPDUæŠ¥æ–‡åï¼ŒæŠ¥æ–‡ä¸­çš„Message Ageå’ŒMax Ageä¼šè¿›è¡Œæ¯”è¾ƒï¼š å¦‚æœMessage Ageå°äºç­‰äºMax Ageï¼Œåˆ™è¯¥éæ ¹æ¡¥è®¾å¤‡ç»§ç»­è½¬å‘é…ç½®BPDUæŠ¥æ–‡ã€‚ å¦‚æœMessage Ageå¤§äºMax Ageï¼Œåˆ™è¯¥é…ç½®BPDUæŠ¥æ–‡å°†è¢«è€åŒ–ã€‚è¯¥éæ ¹æ¡¥è®¾å¤‡ç›´æ¥ä¸¢å¼ƒè¯¥é…ç½®BPDUï¼Œå¯è®¤ä¸ºç½‘ç»œç›´å¾„è¿‡å¤§ï¼Œå¯¼è‡´æ ¹æ¡¥è¿æ¥å¤±è´¥ã€‚ å¦‚æœé…ç½®BPDUæ˜¯æ ¹æ¡¥å‘å‡ºçš„ï¼Œåˆ™Message Ageä¸º0ã€‚å¦åˆ™ï¼ŒMessage Ageæ˜¯ä»æ ¹æ¡¥å‘é€åˆ°å½“å‰æ¡¥æ¥æ”¶åˆ°BPDUçš„æ€»æ—¶é—´ï¼ŒåŒ…æ‹¬ä¼ è¾“å»¶æ—¶ç­‰ã€‚å®é™…å®ç°ä¸­ï¼Œé…ç½®BPDUæŠ¥æ–‡ç»è¿‡ä¸€ä¸ªæ¡¥ï¼ŒMessage Ageå¢åŠ 1ã€‚ STPæŠ¥æ–‡æ ¼å¼ é…ç½®BPDUæ˜¯ä¸€ç§å¿ƒè·³æŠ¥æ–‡ï¼Œåªè¦ç«¯å£ä½¿èƒ½STPï¼Œåˆ™é…ç½®BPDUå°±ä¼šæŒ‰ç…§Hello Timeå®šæ—¶å™¨è§„å®šçš„æ—¶é—´é—´éš”ä»æŒ‡å®šç«¯å£å‘å‡ºã€‚ TCN BPDUæ˜¯åœ¨è®¾å¤‡æ£€æµ‹åˆ°ç½‘ç»œæ‹“æ‰‘å‘ç”Ÿå˜åŒ–æ—¶æ‰å‘å‡ºã€‚ é€šå¸¸æ‰€è¯´çš„BPDUæŠ¥æ–‡å¤šæ•°æŒ‡é…ç½®BPDUã€‚ åœ¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªæ¡¥éƒ½ä¸»åŠ¨å‘é€é…ç½®BPDUã€‚åœ¨ç½‘ç»œæ‹“æ‰‘ç¨³å®šä»¥åï¼Œæ¯å°è®¾å¤‡çš„æŒ‡å®šç«¯å£éƒ½ä¼šå‘¨æœŸæ€§çš„å‘é€é…ç½®BPDUã€‚é…ç½®BPDUçš„é•¿åº¦è‡³å°‘è¦35ä¸ªå­—èŠ‚ï¼ŒåŒ…å«äº†æ¡¥IDã€è·¯å¾„å¼€é”€å’Œç«¯å£IDç­‰å‚æ•°ã€‚åªæœ‰å½“å‘é€è€…çš„BIDæˆ–ç«¯å£çš„PIDä¸¤ä¸ªå­—æ®µä¸­è‡³å°‘æœ‰ä¸€ä¸ªå’Œæœ¬æ¡¥æ¥æ”¶ç«¯å£ä¸åŒï¼ŒBPDUæŠ¥æ–‡æ‰ä¼šè¢«å¤„ç†ï¼Œå¦åˆ™ä¸¢å¼ƒã€‚è¿™æ ·é¿å…äº†å¤„ç†å’Œæœ¬ç«¯å£ä¿¡æ¯ä¸€è‡´çš„BPDUæŠ¥æ–‡ã€‚ é…ç½®BPDUåœ¨ä»¥ä¸‹3ç§æƒ…å†µä¸‹ä¼šäº§ç”Ÿï¼š åªè¦ç«¯å£ä½¿èƒ½STPï¼Œåˆ™é…ç½®BPDUå°±ä¼šæŒ‰ç…§Hello Timeå®šæ—¶å™¨è§„å®šçš„æ—¶é—´é—´éš”ä»æŒ‡å®šç«¯å£å‘å‡ºã€‚ å½“æ ¹ç«¯å£æ”¶åˆ°é…ç½®BPDUæ—¶ï¼Œå¦‚æœä¼˜å…ˆçº§æ¯”è‡ªå·±çš„é…ç½®BPDUé«˜ï¼Œåˆ™ä¼šæ ¹æ®æ”¶åˆ°çš„é…ç½®BPDUä¸­æºå¸¦çš„ä¿¡æ¯æ›´æ–°è‡ªå·±STPç«¯å£å­˜å‚¨çš„é…ç½®BPDUä¿¡æ¯å¹¶ä»æŒ‡å®šæ¥å£å‘ä¸‹æ¸¸å‘é€ï¼Œå¦åˆ™ä¼šä¸¢å¼ƒè¯¥é…ç½®BPDUã€‚ å½“æŒ‡å®šç«¯å£æ”¶åˆ°æ¯”è‡ªå·±å·®çš„é…ç½®BPDUæ—¶ï¼Œä¼šç«‹åˆ»å‘ä¸‹æ¸¸è®¾å¤‡å‘é€è‡ªå·±çš„BPDUã€‚ STPæ‹“æ‰‘å˜æ›´ åœ¨ç½‘ç»œæ‹“æ‰‘å‘ç”Ÿå˜åŒ–åï¼Œä¸‹æ¸¸è®¾å¤‡ä¼šä¸é—´æ–­åœ°å‘ä¸Šæ¸¸è®¾å¤‡å‘é€TCN BPDUæŠ¥æ–‡ã€‚ ä¸Šæ¸¸è®¾å¤‡æ”¶åˆ°ä¸‹æ¸¸è®¾å¤‡å‘æ¥çš„TCN BPDUæŠ¥æ–‡åï¼Œåªæœ‰æŒ‡å®šç«¯å£å¤„ç†TCN BPDUæŠ¥æ–‡ã€‚å…¶å®ƒç«¯å£ä¹Ÿæœ‰å¯èƒ½æ”¶åˆ°TCN BPDUæŠ¥æ–‡ï¼Œä½†ä¸ä¼šå¤„ç†ã€‚ ä¸Šæ¸¸è®¾å¤‡ä¼šæŠŠé…ç½®BPDUæŠ¥æ–‡ä¸­çš„Flagsçš„TCAä½è®¾ç½®1ï¼Œç„¶åå‘é€ç»™ä¸‹æ¸¸è®¾å¤‡ï¼Œå‘ŠçŸ¥ä¸‹æ¸¸è®¾å¤‡åœæ­¢å‘é€TCN BPDUæŠ¥æ–‡ã€‚ ä¸Šæ¸¸è®¾å¤‡å¤åˆ¶ä¸€ä»½TCN BPDUæŠ¥æ–‡ï¼Œå‘æ ¹æ¡¥æ–¹å‘å‘é€ã€‚ é‡å¤æ­¥éª¤1ã€2ã€3ã€4ï¼Œç›´åˆ°æ ¹æ¡¥æ”¶åˆ°TCN BPDUæŠ¥æ–‡ã€‚ æ ¹æ¡¥æŠŠé…ç½®BPDUæŠ¥æ–‡ä¸­çš„Flagsçš„TCä½ç½®1åå‘é€ï¼Œé€šçŸ¥ä¸‹æ¸¸è®¾å¤‡ç›´æ¥åˆ é™¤æ¡¥MACåœ°å€è¡¨é¡¹ã€‚ è¯¦æƒ…è¯·çœ‹STPæ‹“æ‰‘å˜æ›´æœºåˆ¶ | æ²ƒå¾·å‘ (yangzhiyu.top) STPæ•…éšœæ”¶æ•›æ—¶é—´ sw1çš„fa0&#x2F;1çš„æ¥å£downäº†ï¼Œä½†æ˜¯å®ƒè¿˜æ˜¯å¯ä»¥ä»blockç«¯å£ä¸­æ¥æ”¶åˆ°sw0çš„bpduï¼Œé‚£ä¹ˆå®ƒä¸rootçš„è”ç³»å°±æ²¡æœ‰æ–­å¼€ï¼Œå®ƒæ­¤æ—¶åšçš„æ“ä½œæ˜¯æ ¹æ®æ ¹æ¡¥å‘é€çš„bpdué‡æ–°è®¡ç®—æ ¹ç«¯å£ï¼Œç„¶åç»å†30sçš„æ”¶æ•›ï¼Œå°†fa0&#x2F;2å˜ä¸ºæ ¹ç«¯å£ã€‚ sw2çš„fa0&#x2F;2æ–­å¼€downäº†ï¼Œæˆ‘ä»¬çŸ¥é“blockç«¯å£æ—¶ä¸ä¼šå¯¹bpduè¿›è¡Œå‘é€çš„ï¼Œäºæ˜¯fa0&#x2F;1å°±ç›¸å½“äºä¸rootæ–­å¼€äº†ï¼Œä¸€æ®µæ—¶é—´åï¼Œä»–å°±ä¼šä»fa0&#x2F;1å‘é€è‡ªå·±æ˜¯æ ¹æ¡¥çš„bpduï¼Œä½†æ˜¯sw1æ˜¯ä¸ä¼šç†ç¬çš„ï¼Œå› ä¸ºå®ƒçŸ¥é“sw0çš„bpduæ‰æ˜¯æœ€å¥½çš„ï¼Œå› ä¸ºsw0çš„bpduä¸­çš„æ ¹æ¡¥IDçš„ä¼˜å…ˆçº§æ˜¯æœ€é«˜çš„ï¼Œ ç»è¿‡20såï¼Œsw1çš„fa0&#x2F;2å› ä¸ºæ²¡æœ‰ä»swfa0&#x2F;1ä¸Šæ¥æ”¶åˆ°bpduï¼Œæ‰€ä»¥å®ƒä¼šå°†ç«¯å£è½¬æ¢ä¸ºæŒ‡å®šç«¯å£å°†bpduä¿¡æ¯è¿›è¡Œè½¬å‘ï¼Œè¿™ä¸ªè¿‡ç¨‹å¤§æ¦‚50sã€‚ RSTPIEEEäº2001å¹´å‘å¸ƒçš„802.1wæ ‡å‡†å®šä¹‰äº†å¿«é€Ÿç”Ÿæˆæ ‘åè®®RSTPï¼ˆRapid Spanning Tree Protocolï¼‰ï¼Œè¯¥åè®®åŸºäºSTPåè®®ï¼Œå¯¹åŸæœ‰çš„STPåè®®è¿›è¡Œäº†æ›´åŠ ç»†è‡´çš„ä¿®æ”¹å’Œè¡¥å……ã€‚ STPåè®®è™½ç„¶èƒ½å¤Ÿè§£å†³ç¯è·¯é—®é¢˜ï¼Œä½†æ˜¯ç”±äºç½‘ç»œæ‹“æ‰‘æ”¶æ•›æ…¢ï¼Œå½±å“äº†ç”¨æˆ·é€šä¿¡è´¨é‡ã€‚å¦‚æœç½‘ç»œä¸­çš„æ‹“æ‰‘ç»“æ„é¢‘ç¹å˜åŒ–ï¼Œç½‘ç»œä¹Ÿä¼šéšä¹‹é¢‘ç¹å¤±å»è¿é€šæ€§ï¼Œä»è€Œå¯¼è‡´ç”¨æˆ·é€šä¿¡é¢‘ç¹ä¸­æ–­ï¼Œè¿™æ˜¯ç”¨æˆ·æ— æ³•å¿å—çš„ã€‚ STPçš„ä¸è¶³ä¹‹å¤„å¦‚ä¸‹ï¼š STPæ²¡æœ‰ç»†è‡´åŒºåˆ†ç«¯å£çŠ¶æ€å’Œç«¯å£è§’è‰²ï¼Œä¸åˆ©äºåˆå­¦è€…å­¦ä¹ åŠéƒ¨ç½²ã€‚ ç½‘ç»œåè®®çš„ä¼˜åŠ£å¾€å¾€å–å†³äºåè®®æ˜¯å¦å¯¹å„ç§æƒ…å†µåŠ ä»¥ç»†è‡´åŒºåˆ†ã€‚ ä»ç”¨æˆ·è§’åº¦æ¥è®²ï¼ŒListeningã€Learningå’ŒBlockingçŠ¶æ€å¹¶æ²¡æœ‰åŒºåˆ«ï¼Œéƒ½åŒæ ·ä¸è½¬å‘ç”¨æˆ·æµé‡ã€‚ ä»ä½¿ç”¨å’Œé…ç½®è§’åº¦æ¥è®²ï¼Œç«¯å£ä¹‹é—´æœ€æœ¬è´¨çš„åŒºåˆ«å¹¶ä¸åœ¨äºç«¯å£çŠ¶æ€ï¼Œè€Œæ˜¯åœ¨äºç«¯å£æ‰®æ¼”çš„è§’è‰²ã€‚ æ ¹ç«¯å£å’ŒæŒ‡å®šç«¯å£å¯ä»¥éƒ½å¤„äºListeningçŠ¶æ€ï¼Œä¹Ÿå¯èƒ½éƒ½å¤„äºForwardingçŠ¶æ€ã€‚ STPç®—æ³•æ˜¯è¢«åŠ¨çš„ç®—æ³•ï¼Œä¾èµ–å®šæ—¶å™¨ç­‰å¾…çš„æ–¹å¼åˆ¤æ–­æ‹“æ‰‘å˜åŒ–ï¼Œæ”¶æ•›é€Ÿåº¦æ…¢ã€‚ STPç®—æ³•è¦æ±‚åœ¨ç¨³å®šçš„æ‹“æ‰‘ä¸­ï¼Œæ ¹æ¡¥ä¸»åŠ¨å‘å‡ºé…ç½®BPDUæŠ¥æ–‡ï¼Œè€Œå…¶ä»–è®¾å¤‡è¿›è¡Œå¤„ç†ï¼Œä¼ éæ•´ä¸ªSTPç½‘ç»œã€‚ è¿™ä¹Ÿæ˜¯å¯¼è‡´æ‹“æ‰‘æ”¶æ•›æ…¢çš„ä¸»è¦åŸå› ä¹‹ä¸€ã€‚ ç«¯å£æ”¹è¿›æ ¹æ®STPçš„ä¸è¶³ï¼ŒRSTPåˆ é™¤äº†3ç§ç«¯å£çŠ¶æ€ï¼Œæ–°å¢åŠ äº†2ç§ç«¯å£è§’è‰² RSTPçš„ç«¯å£è§’è‰²å…±æœ‰5ç§ï¼šæ ¹ç«¯å£ã€æŒ‡å®šç«¯å£ã€Alternateç«¯å£ã€Backupç«¯å£å’ŒDisableç«¯å£ã€‚ ä»é…ç½®BPDUæŠ¥æ–‡å‘é€è§’åº¦æ¥çœ‹ï¼š Alternateç«¯å£å°±æ˜¯ç”±äºå­¦ä¹ åˆ°å…¶å®ƒç½‘æ¡¥å‘é€çš„é…ç½®BPDUæŠ¥æ–‡è€Œé˜»å¡çš„ç«¯å£ã€‚ Backupç«¯å£å°±æ˜¯ç”±äºå­¦ä¹ åˆ°è‡ªå·±å‘é€çš„é…ç½®BPDUæŠ¥æ–‡è€Œé˜»å¡çš„ç«¯å£ã€‚ ä»ç”¨æˆ·æµé‡è§’åº¦æ¥çœ‹ï¼š Alternateç«¯å£æä¾›äº†ä»æŒ‡å®šæ¡¥åˆ°æ ¹çš„å¦ä¸€æ¡å¯åˆ‡æ¢è·¯å¾„ï¼Œä½œä¸ºæ ¹ç«¯å£çš„å¤‡ä»½ç«¯å£ã€‚ Backupç«¯å£ä½œä¸ºæŒ‡å®šç«¯å£çš„å¤‡ä»½ï¼Œæä¾›äº†å¦ä¸€æ¡ä»æ ¹æ¡¥åˆ°ç›¸åº”ç½‘æ®µçš„å¤‡ä»½é€šè·¯ã€‚ ç»™ä¸€ä¸ªRSTPåŸŸå†…æ‰€æœ‰ç«¯å£åˆ†é…è§’è‰²çš„è¿‡ç¨‹å°±æ˜¯æ•´ä¸ªæ‹“æ‰‘æ”¶æ•›çš„è¿‡ç¨‹ã€‚ RSTPçš„çŠ¶æ€è§„èŒƒæŠŠåŸæ¥çš„5ç§çŠ¶æ€ç¼©å‡ä¸º3ç§ã€‚æ ¹æ®ç«¯å£æ˜¯å¦è½¬å‘ç”¨æˆ·æµé‡å’Œå­¦ä¹ MACåœ°å€æ¥åˆ’åˆ†: å¦‚æœä¸è½¬å‘ç”¨æˆ·æµé‡ä¹Ÿä¸å­¦ä¹ MACåœ°å€ï¼Œé‚£ä¹ˆç«¯å£çŠ¶æ€å°±æ˜¯DiscardingçŠ¶æ€ã€‚ å¦‚æœä¸è½¬å‘ç”¨æˆ·æµé‡ä½†æ˜¯å­¦ä¹ MACåœ°å€ï¼Œé‚£ä¹ˆç«¯å£çŠ¶æ€å°±æ˜¯LearningçŠ¶æ€ã€‚ å¦‚æœæ—¢è½¬å‘ç”¨æˆ·æµé‡åˆå­¦ä¹ MACåœ°å€ï¼Œé‚£ä¹ˆç«¯å£çŠ¶æ€å°±æ˜¯ForwardingçŠ¶æ€ã€‚ STPç«¯å£çŠ¶æ€ RSTPç«¯å£çŠ¶æ€ ç«¯å£åœ¨æ‹“æ‰‘ä¸­çš„è§’è‰² Forwarding Forwarding åŒ…æ‹¬æ ¹ç«¯å£ã€æŒ‡å®šç«¯å£ Learning Learning åŒ…æ‹¬æ ¹ç«¯å£ã€æŒ‡å®šç«¯å£ Listening Discarding åŒ…æ‹¬æ ¹ç«¯å£ã€æŒ‡å®šç«¯å£ Blocking Discarding åŒ…æ‹¬Alternateç«¯å£ã€Backupç«¯å£ Disabled Discarding åŒ…æ‹¬Disableç«¯å£ é…ç½®BPDUçš„å¤„ç†å‘ç”Ÿå˜åŒ– æ‹“æ‰‘ç¨³å®šåï¼Œé…ç½®BPDUæŠ¥æ–‡çš„å‘é€æ–¹å¼ æ‹“æ‰‘ç¨³å®šåï¼Œæ ¹æ¡¥æŒ‰ç…§Hello Timerè§„å®šçš„æ—¶é—´é—´éš”å‘é€é…ç½®BPDUã€‚å…¶ä»–éæ ¹æ¡¥è®¾å¤‡åœ¨æ”¶åˆ°ä¸Šæ¸¸è®¾å¤‡å‘é€è¿‡æ¥çš„é…ç½®BPDUåï¼Œæ‰ä¼šè§¦å‘å‘å‡ºé…ç½®BPDUï¼Œæ­¤æ–¹å¼ä½¿å¾—STPåè®®è®¡ç®—å¤æ‚ä¸”ç¼“æ…¢ã€‚RSTPå¯¹æ­¤è¿›è¡Œäº†æ”¹è¿›ï¼Œå³åœ¨æ‹“æ‰‘ç¨³å®šåï¼Œæ— è®ºéæ ¹æ¡¥è®¾å¤‡æ˜¯å¦æ¥æ”¶åˆ°æ ¹æ¡¥ä¼ æ¥çš„é…ç½®BPDUæŠ¥æ–‡ï¼Œéæ ¹æ¡¥è®¾å¤‡ä»ç„¶æŒ‰ç…§Hello Timerè§„å®šçš„æ—¶é—´é—´éš”å‘é€é…ç½®BPDUï¼Œè¯¥è¡Œä¸ºå®Œå…¨ç”±æ¯å°è®¾å¤‡è‡ªä¸»è¿›è¡Œã€‚ æ›´çŸ­çš„BPDUè¶…æ—¶è®¡æ—¶ å¦‚æœä¸€ä¸ªç«¯å£åœ¨è¶…æ—¶æ—¶é—´ï¼ˆè¶…æ—¶æ—¶é—´ï¼Hello Time Ã— 3 Ã— Timer Factorï¼‰å†…æ²¡æœ‰æ”¶åˆ°ä¸Šæ¸¸è®¾å¤‡å‘é€è¿‡æ¥çš„é…ç½®BPDUï¼Œé‚£ä¹ˆè¯¥è®¾å¤‡è®¤ä¸ºä¸æ­¤é‚»å±…ä¹‹é—´çš„åå•†å¤±è´¥ã€‚è€Œä¸åƒSTPé‚£æ ·éœ€è¦å…ˆç­‰å¾…ä¸€ä¸ªMax Ageã€‚ï¼ˆ6sï¼‰ å¤„ç†æ¬¡ç­‰BPDU å½“ä¸€ä¸ªç«¯å£æ”¶åˆ°ä¸Šæ¸¸çš„æŒ‡å®šæ¡¥å‘æ¥çš„RST BPDUæŠ¥æ–‡æ—¶ï¼Œè¯¥ç«¯å£ä¼šå°†è‡ªèº«å­˜å‚¨çš„RST BPDUä¸æ”¶åˆ°çš„RST BPDUè¿›è¡Œæ¯”è¾ƒã€‚ å¦‚æœè¯¥ç«¯å£å­˜å‚¨çš„RST BPDUçš„ä¼˜å…ˆçº§é«˜äºæ”¶åˆ°çš„RST BPDUï¼Œé‚£ä¹ˆè¯¥ç«¯å£ä¼šç›´æ¥ä¸¢å¼ƒæ”¶åˆ°çš„RST BPDUï¼Œç«‹å³å›åº”è‡ªèº«å­˜å‚¨çš„RST BPDUã€‚å½“ä¸Šæ¸¸è®¾å¤‡æ”¶åˆ°ä¸‹æ¸¸è®¾å¤‡å›åº”çš„RST BPDUåï¼Œä¸Šæ¸¸è®¾å¤‡ä¼šæ ¹æ®æ”¶åˆ°çš„RST BPDUæŠ¥æ–‡ä¸­ç›¸åº”çš„å­—æ®µç«‹å³æ›´æ–°è‡ªå·±å­˜å‚¨çš„RST BPDUã€‚ ç”±æ­¤ï¼ŒRSTPå¤„ç†æ¬¡ç­‰BPDUæŠ¥æ–‡ä¸å†ä¾èµ–äºä»»ä½•å®šæ—¶å™¨é€šè¿‡è¶…æ—¶è§£å†³æ‹“æ‰‘æ”¶æ•›ï¼Œä»è€ŒåŠ å¿«äº†æ‹“æ‰‘æ”¶æ•›ã€‚ å¿«é€Ÿæ”¶æ•›ï¼ˆP&#x2F;Aæœºåˆ¶ï¼‰å½“ä¸€ä¸ªç«¯å£è¢«é€‰ä¸¾æˆä¸ºæŒ‡å®šç«¯å£ä¹‹åï¼Œåœ¨STPä¸­ï¼Œè¯¥ç«¯å£è‡³å°‘è¦ç­‰å¾…ä¸€ä¸ªForward Delayï¼ˆLearningï¼‰æ—¶é—´æ‰ä¼šè¿ç§»åˆ°ForwardingçŠ¶æ€ã€‚è€Œåœ¨RSTPä¸­ï¼Œæ­¤ç«¯å£ä¼šå…ˆè¿›å…¥DiscardingçŠ¶æ€ï¼Œå†é€šè¿‡Proposal&#x2F;Agreementæœºåˆ¶å¿«é€Ÿè¿›å…¥ForwardçŠ¶æ€ã€‚è¿™ç§æœºåˆ¶å¿…é¡»åœ¨ç‚¹åˆ°ç‚¹å…¨åŒå·¥é“¾è·¯ä¸Šä½¿ç”¨ã€‚Proposal&#x2F;Agreementæœºåˆ¶ç®€ç§°P&#x2F;Aæœºåˆ¶ Proposal&#x2F;Agreementæœºåˆ¶ï¼Œå…¶ç›®çš„æ˜¯ä½¿ä¸€ä¸ªæŒ‡å®šç«¯å£å°½å¿«è¿›å…¥ForwardingçŠ¶æ€ã€‚å¦‚å›¾1æ‰€ç¤ºï¼Œæ ¹æ¡¥S1å’ŒS2ä¹‹é—´æ–°æ·»åŠ äº†ä¸€æ¡é“¾è·¯ã€‚åœ¨å½“å‰çŠ¶æ€ä¸‹ï¼ŒS2çš„å¦å¤–å‡ ä¸ªç«¯å£p2æ˜¯Alternateç«¯å£ï¼Œp3æ˜¯æŒ‡å®šç«¯å£ä¸”å¤„äºForwardingçŠ¶æ€ï¼Œp4æ˜¯è¾¹ç¼˜ç«¯å£ã€‚ æ–°é“¾è·¯è¿æ¥æˆåŠŸåï¼ŒP&#x2F;Aæœºåˆ¶åå•†è¿‡ç¨‹å¦‚ä¸‹ï¼š p0å’Œp1ä¸¤ä¸ªç«¯å£é©¬ä¸Šéƒ½å…ˆæˆä¸ºæŒ‡å®šç«¯å£ï¼Œå‘é€RST BPDUã€‚ S2çš„p1å£æ”¶åˆ°æ›´ä¼˜çš„RST BPDUï¼Œé©¬ä¸Šæ„è¯†åˆ°è‡ªå·±å°†æˆä¸ºæ ¹ç«¯å£ï¼Œè€Œä¸æ˜¯æŒ‡å®šç«¯å£ï¼Œåœæ­¢å‘é€RST BPDUã€‚ S1çš„p0è¿›å…¥DiscardingçŠ¶æ€ï¼Œäºæ˜¯å‘é€çš„RST BPDUä¸­æŠŠproposalç½®1ã€‚ S2æ”¶åˆ°æ ¹æ¡¥å‘é€æ¥çš„æºå¸¦proposalçš„RST BPDUï¼Œå¼€å§‹å°†è‡ªå·±çš„æ‰€æœ‰ç«¯å£è¿›å…¥syncå˜é‡ç½®ä½ã€‚ p2å·²ç»é˜»å¡ï¼ŒçŠ¶æ€ä¸å˜ï¼›p4æ˜¯è¾¹ç¼˜ç«¯å£ï¼Œä¸å‚ä¸è¿ç®—ï¼›æ‰€ä»¥åªéœ€è¦é˜»å¡éè¾¹ç¼˜æŒ‡å®šç«¯å£p3ã€‚ å„ç«¯å£çš„syncedå˜é‡ç½®ä½åï¼Œp2ã€p3è¿›å…¥DiscardingçŠ¶æ€ï¼Œp1è¿›å…¥ForwardingçŠ¶æ€å¹¶å‘S1è¿”å›Agreementä½ç½®ä½çš„å›åº”RST BPDUã€‚ å½“S1åˆ¤æ–­å‡ºè¿™æ˜¯å¯¹åˆšåˆšå‘å‡ºçš„Proposalçš„å›åº”ï¼Œäºæ˜¯ç«¯å£p0é©¬ä¸Šè¿›å…¥ForwardingçŠ¶æ€ã€‚ ä¸‹æ¸¸è®¾å¤‡ç»§ç»­æ‰§è¡ŒP&#x2F;Aåå•†è¿‡ç¨‹ã€‚ äº‹å®ä¸Šå¯¹äºSTPï¼ŒæŒ‡å®šç«¯å£çš„é€‰æ‹©å¯ä»¥å¾ˆå¿«å®Œæˆï¼Œä¸»è¦çš„é€Ÿåº¦ç“¶é¢ˆåœ¨äºï¼šä¸ºäº†é¿å…ç¯è·¯ï¼Œå¿…é¡»ç­‰å¾…è¶³å¤Ÿé•¿çš„æ—¶é—´ï¼Œä½¿å…¨ç½‘çš„ç«¯å£çŠ¶æ€å…¨éƒ¨ç¡®å®šï¼Œä¹Ÿå°±æ˜¯è¯´å¿…é¡»è¦ç­‰å¾…è‡³å°‘ä¸€ä¸ªForward Delayæ‰€æœ‰ç«¯å£æ‰èƒ½è¿›è¡Œè½¬å‘ã€‚è€ŒRSTPçš„ä¸»è¦ç›®çš„å°±æ˜¯æ¶ˆé™¤è¿™ä¸ªç“¶é¢ˆï¼Œé€šè¿‡é˜»å¡è‡ªå·±çš„éæ ¹ç«¯å£æ¥ä¿è¯ä¸ä¼šå‡ºç°ç¯è·¯ã€‚è€Œä½¿ç”¨P&#x2F;Aæœºåˆ¶åŠ å¿«äº†ä¸Šæ¸¸ç«¯å£è½¬åˆ°ForwardingçŠ¶æ€çš„é€Ÿåº¦ã€‚ ä¿æŠ¤åŠŸèƒ½ ä¿æŠ¤åŠŸèƒ½ åœºæ™¯ åŸç† BPDUä¿æŠ¤ åœ¨äº¤æ¢è®¾å¤‡ä¸Šï¼Œé€šå¸¸å°†ç›´æ¥ä¸ç”¨æˆ·ç»ˆç«¯ï¼ˆå¦‚PCæœºï¼‰æˆ–æ–‡ä»¶æœåŠ¡å™¨ç­‰éäº¤æ¢è®¾å¤‡ç›¸è¿çš„ç«¯å£é…ç½®ä¸ºè¾¹ç¼˜ç«¯å£ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œè¾¹ç¼˜ç«¯å£ä¸ä¼šæ”¶åˆ°RST BPDUã€‚å¦‚æœæœ‰äººä¼ªé€ RST BPDUæ¶æ„æ”»å‡»äº¤æ¢è®¾å¤‡ï¼Œå½“è¾¹ç¼˜ç«¯å£æ¥æ”¶åˆ°RST BPDUæ—¶ï¼Œäº¤æ¢è®¾å¤‡ä¼šè‡ªåŠ¨å°†è¾¹ç¼˜ç«¯å£è®¾ç½®ä¸ºéè¾¹ç¼˜ç«¯å£ï¼Œå¹¶é‡æ–°è¿›è¡Œç”Ÿæˆæ ‘è®¡ç®—ï¼Œä»è€Œå¼•èµ·ç½‘ç»œéœ‡è¡ã€‚ äº¤æ¢è®¾å¤‡ä¸Šå¯åŠ¨äº†BPDUä¿æŠ¤åŠŸèƒ½åï¼Œå¦‚æœè¾¹ç¼˜ç«¯å£æ”¶åˆ°RST BPDUï¼Œè¾¹ç¼˜ç«¯å£å°†è¢«error-downï¼Œä½†æ˜¯è¾¹ç¼˜ç«¯å£å±æ€§ä¸å˜ï¼ŒåŒæ—¶é€šçŸ¥ç½‘ç®¡ç³»ç»Ÿã€‚ æ ¹ä¿æŠ¤ ç”±äºç»´æŠ¤äººå‘˜çš„é”™è¯¯é…ç½®æˆ–ç½‘ç»œä¸­çš„æ¶æ„æ”»å‡»ï¼Œç½‘ç»œä¸­åˆæ³•æ ¹æ¡¥æœ‰å¯èƒ½ä¼šæ”¶åˆ°ä¼˜å…ˆçº§æ›´é«˜çš„RST BPDUï¼Œä½¿å¾—åˆæ³•æ ¹æ¡¥å¤±å»æ ¹åœ°ä½ï¼Œä»è€Œå¼•èµ·ç½‘ç»œæ‹“æ‰‘ç»“æ„çš„é”™è¯¯å˜åŠ¨ã€‚è¿™ç§ä¸åˆæ³•çš„æ‹“æ‰‘å˜åŒ–ï¼Œä¼šå¯¼è‡´åŸæ¥åº”è¯¥é€šè¿‡é«˜é€Ÿé“¾è·¯çš„æµé‡è¢«ç‰µå¼•åˆ°ä½é€Ÿé“¾è·¯ä¸Šï¼Œé€ æˆç½‘ç»œæ‹¥å¡ã€‚ å¯¹äºå¯ç”¨Rootä¿æŠ¤åŠŸèƒ½çš„æŒ‡å®šç«¯å£ï¼Œå…¶ç«¯å£è§’è‰²åªèƒ½ä¿æŒä¸ºæŒ‡å®šç«¯å£ã€‚ä¸€æ—¦å¯ç”¨Rootä¿æŠ¤åŠŸèƒ½çš„æŒ‡å®šç«¯å£æ”¶åˆ°ä¼˜å…ˆçº§æ›´é«˜çš„RST BPDUæ—¶ï¼Œç«¯å£çŠ¶æ€å°†è¿›å…¥DiscardingçŠ¶æ€ï¼Œä¸å†è½¬å‘æŠ¥æ–‡ã€‚åœ¨ç»è¿‡ä¸€æ®µæ—¶é—´ï¼ˆé€šå¸¸ä¸ºä¸¤å€çš„Forward Delayï¼‰ï¼Œå¦‚æœç«¯å£ä¸€ç›´æ²¡æœ‰å†æ”¶åˆ°ä¼˜å…ˆçº§è¾ƒé«˜çš„RST BPDUï¼Œç«¯å£ä¼šè‡ªåŠ¨æ¢å¤åˆ°æ­£å¸¸çš„ForwardingçŠ¶æ€ã€‚è¯´æ˜ï¼šRootä¿æŠ¤åŠŸèƒ½åªèƒ½åœ¨æŒ‡å®šç«¯å£ä¸Šé…ç½®ç”Ÿæ•ˆã€‚ ç¯è·¯ä¿æŠ¤ åœ¨è¿è¡ŒRSTPåè®®çš„ç½‘ç»œä¸­ï¼Œæ ¹ç«¯å£å’Œå…¶ä»–é˜»å¡ç«¯å£çŠ¶æ€æ˜¯ä¾é ä¸æ–­æ¥æ”¶æ¥è‡ªä¸Šæ¸¸äº¤æ¢è®¾å¤‡çš„RST BPDUç»´æŒã€‚å½“ç”±äºé“¾è·¯æ‹¥å¡æˆ–è€…å•å‘é“¾è·¯æ•…éšœå¯¼è‡´è¿™äº›ç«¯å£æ”¶ä¸åˆ°æ¥è‡ªä¸Šæ¸¸äº¤æ¢è®¾å¤‡çš„RST BPDUæ—¶ï¼Œæ­¤æ—¶äº¤æ¢è®¾å¤‡ä¼šé‡æ–°é€‰æ‹©æ ¹ç«¯å£ã€‚åŸå…ˆçš„æ ¹ç«¯å£ä¼šè½¬å˜ä¸ºæŒ‡å®šç«¯å£ï¼Œè€ŒåŸå…ˆçš„é˜»å¡ç«¯å£ä¼šè¿ç§»åˆ°è½¬å‘çŠ¶æ€ï¼Œä»è€Œé€ æˆäº¤æ¢ç½‘ç»œä¸­å¯èƒ½äº§ç”Ÿç¯è·¯ã€‚ åœ¨å¯åŠ¨äº†ç¯è·¯ä¿æŠ¤åŠŸèƒ½åï¼Œå¦‚æœæ ¹ç«¯å£æˆ–Alternateç«¯å£é•¿æ—¶é—´æ”¶ä¸åˆ°æ¥è‡ªä¸Šæ¸¸çš„RST BPDUæ—¶ï¼Œåˆ™å‘ç½‘ç®¡å‘å‡ºé€šçŸ¥ä¿¡æ¯ï¼ˆå¦‚æœæ˜¯æ ¹ç«¯å£åˆ™è¿›å…¥DiscardingçŠ¶æ€ï¼‰ã€‚è€Œé˜»å¡ç«¯å£åˆ™ä¼šä¸€ç›´ä¿æŒåœ¨é˜»å¡çŠ¶æ€ï¼Œä¸è½¬å‘æŠ¥æ–‡ï¼Œä»è€Œä¸ä¼šåœ¨ç½‘ç»œä¸­å½¢æˆç¯è·¯ã€‚ç›´åˆ°æ ¹ç«¯å£æˆ–Alternateç«¯å£æ”¶åˆ°RST BPDUï¼Œç«¯å£çŠ¶æ€æ‰æ¢å¤æ­£å¸¸åˆ°ForwardingçŠ¶æ€ã€‚è¯´æ˜ï¼šç¯è·¯ä¿æŠ¤åŠŸèƒ½åªèƒ½åœ¨æ ¹ç«¯å£æˆ–Alternateç«¯å£ä¸Šé…ç½®ç”Ÿæ•ˆã€‚ é˜²TC-BPDUæ”»å‡» äº¤æ¢è®¾å¤‡åœ¨æ¥æ”¶åˆ°TC BPDUæŠ¥æ–‡åï¼Œä¼šæ‰§è¡ŒMACåœ°å€è¡¨é¡¹å’ŒARPè¡¨é¡¹çš„åˆ é™¤æ“ä½œã€‚å¦‚æœæœ‰äººä¼ªé€ TC BPDUæŠ¥æ–‡æ¶æ„æ”»å‡»äº¤æ¢è®¾å¤‡æ—¶ï¼Œäº¤æ¢è®¾å¤‡çŸ­æ—¶é—´å†…ä¼šæ”¶åˆ°å¾ˆå¤šTC BPDUæŠ¥æ–‡ï¼Œé¢‘ç¹çš„åˆ é™¤æ“ä½œä¼šç»™è®¾å¤‡é€ æˆå¾ˆå¤§çš„è´Ÿæ‹…ï¼Œç»™ç½‘ç»œçš„ç¨³å®šå¸¦æ¥å¾ˆå¤§éšæ‚£ã€‚ å¯ç”¨é˜²TC-BPDUæŠ¥æ–‡æ”»å‡»åŠŸèƒ½åï¼Œåœ¨å•ä½æ—¶é—´å†…ï¼Œäº¤æ¢è®¾å¤‡å¤„ç†TC BPDUæŠ¥æ–‡çš„æ¬¡æ•°å¯é…ç½®ã€‚å¦‚æœåœ¨å•ä½æ—¶é—´å†…ï¼Œäº¤æ¢è®¾å¤‡åœ¨æ”¶åˆ°TC BPDUæŠ¥æ–‡æ•°é‡å¤§äºé…ç½®çš„é˜ˆå€¼ï¼Œé‚£ä¹ˆè®¾å¤‡åªä¼šå¤„ç†é˜ˆå€¼æŒ‡å®šçš„æ¬¡æ•°ã€‚å¯¹äºå…¶ä»–è¶…å‡ºé˜ˆå€¼çš„TC BPDUæŠ¥æ–‡ï¼Œå®šæ—¶å™¨åˆ°æœŸåè®¾å¤‡åªå¯¹å…¶ç»Ÿä¸€å¤„ç†ä¸€æ¬¡ã€‚è¿™æ ·å¯ä»¥é¿å…é¢‘ç¹çš„åˆ é™¤MACåœ°å€è¡¨é¡¹å’ŒARPè¡¨é¡¹ï¼Œä»è€Œè¾¾åˆ°ä¿æŠ¤è®¾å¤‡çš„ç›®çš„ã€‚ RSTPæ‹“æ‰‘å˜æ›´åˆ¤æ–­æ‹“æ‰‘å˜åŒ–å”¯ä¸€æ ‡å‡†ï¼šä¸€ä¸ªéè¾¹ç¼˜ç«¯å£è¿ç§»åˆ°ForwardingçŠ¶æ€ä¸ºæœ¬äº¤æ¢è®¾å¤‡çš„æ‰€æœ‰éè¾¹ç¼˜æŒ‡å®šç«¯å£å¯åŠ¨ä¸€ä¸ªTC While Timerï¼Œè¯¥è®¡æ—¶å™¨å€¼æ˜¯Hello Timeçš„ä¸¤å€ã€‚åœ¨è¿™ä¸ªæ—¶é—´å†…ï¼Œæ¸…ç©ºçŠ¶æ€å‘ç”Ÿå˜åŒ–çš„ç«¯å£ä¸Šå­¦ä¹ åˆ°çš„MACåœ°å€ã€‚åŒæ—¶ï¼Œç”±è¿™äº›ç«¯å£å‘å¤–å‘é€RST BPDUï¼Œå…¶ä¸­TCç½®ä½ã€‚ä¸€æ—¦TC While Timerè¶…æ—¶ï¼Œåˆ™åœæ­¢å‘é€RST BPDUã€‚å…¶ä»–äº¤æ¢è®¾å¤‡æ¥æ”¶åˆ°RST BPDUåï¼Œæ¸…ç©ºæ‰€æœ‰ç«¯å£å­¦ä¹ åˆ°MACåœ°å€ï¼Œé™¤äº†æ”¶åˆ°RST BPDUçš„ç«¯å£ã€‚ç„¶åä¹Ÿä¸ºè‡ªå·±æ‰€æœ‰çš„éè¾¹ç¼˜æŒ‡å®šç«¯å£å’Œæ ¹ç«¯å£å¯åŠ¨TC While Timerï¼Œé‡å¤ä¸Šè¿°è¿‡ç¨‹ã€‚ å¦‚æ­¤ï¼Œç½‘ç»œä¸­å°±ä¼šäº§ç”ŸRST BPDUçš„æ³›æ´ªã€‚","categories":[{"name":"åŸºç¡€çŸ¥è¯†","slug":"åŸºç¡€çŸ¥è¯†","permalink":"http://example.com/categories/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"}],"tags":[{"name":"STP","slug":"STP","permalink":"http://example.com/tags/STP/"},{"name":"RSTP","slug":"RSTP","permalink":"http://example.com/tags/RSTP/"},{"name":"MSTP","slug":"MSTP","permalink":"http://example.com/tags/MSTP/"}]},{"title":"å¤§å‹WLANæŠ€æœ¯(1)","slug":"å¤§å‹WLANæŠ€æœ¯(1)","date":"2024-05-26T07:10:59.000Z","updated":"2024-05-28T09:49:25.024Z","comments":true,"path":"2024/05/26/å¤§å‹WLANæŠ€æœ¯(1)/","permalink":"http://example.com/2024/05/26/%E5%A4%A7%E5%9E%8BWLAN%E6%8A%80%E6%9C%AF(1)/","excerpt":"","text":"VLAN Poolé€šè¿‡vlan poolæŠŠæ¥å…¥çš„ç”¨æˆ·åˆ†é…åˆ°ä¸åŒçš„vlanï¼Œå‡å°‘å¹¿æ’­åŸŸï¼Œå‡å°‘ç½‘ç»œä¸­çš„å¹¿æ’­æŠ¥æ–‡ï¼Œæå‡ç½‘ç»œæ€§èƒ½ã€‚ ç”±äºæ— çº¿ç»ˆç«¯çš„ç§»åŠ¨æ€§ï¼Œåœ¨æ— çº¿ç½‘ç»œä¸­ç»å¸¸æœ‰å¤§é‡ç”¨æˆ·ä»æŸä¸ªåŒºåŸŸæ¥å…¥åï¼Œéšç€ç”¨çš„ç§»åŠ¨ï¼Œå†æ¼«æ¸¸åˆ°å…¶ä»–åŒºåŸŸï¼Œå¯¼è‡´è¯¥åŒºåŸŸçš„ç”¨æˆ·æ¥å…¥å¤šï¼Œå¯¹IPåœ°å€æ•°ç›®è¦æ±‚å¤§ã€‚æ¯”å¦‚ï¼šåœºé¦†å…¥å£ã€é…’åº—çš„å¤§å ‚ç­‰ã€‚ç›®å‰ä¸€ä¸ªSSIDåªèƒ½å¯¹åº”ä¸€ä¸ªVLANï¼Œä¸€ä¸ªVLANå¯¹åº”ä¸€ä¸ªå­ç½‘ï¼Œå¦‚æœå¤§é‡ç”¨æˆ· ä»æŸä¸€åŒºåŸŸæ¥å…¥ï¼Œåªèƒ½æ‰©å¤§VLANçš„å­ç½‘ï¼Œä¿è¯ç”¨æˆ·èƒ½å¤Ÿè·å–åˆ°IPåœ°å€ã€‚è¿™æ ·å¸¦æ¥çš„é—®é¢˜å°±æ˜¯å¹¿æ’­åŸŸæ‰©å¤§ï¼Œå¯¼è‡´å¤§é‡çš„å¹¿æ’­æŠ¥æ–‡ï¼ˆå¦‚ARPã€DHCPç­‰ï¼‰å¸¦æ¥ä¸¥é‡çš„ç½‘ç»œæ‹¥å¡ã€‚åŸºäºæ­¤é—®é¢˜è€ƒè™‘ï¼Œä¸€ä¸ªSSIDéœ€è¦èƒ½å¤Ÿå¯¹åº”å¤šä¸ªVLANï¼ŒæŠŠå¤§é‡ç”¨æˆ·åˆ†æ•£åˆ°ä¸åŒçš„VLANå‡å°‘å¹¿æ’­åŸŸã€‚VLAN Poolæä¾›å¤šä¸ªVLANçš„ç®¡ç†å’Œåˆ†é…ç®—æ³•ï¼Œå®ç°SSIDå¯¹åº”å¤šä¸ªVLANçš„æ–¹æ¡ˆã€‚ åˆ†é…ç®—æ³•â€¢ é¡ºåºåˆ†é…ç®—æ³•ï¼šæŠŠç”¨æˆ·æŒ‰ä¸Šçº¿é¡ºåºä¾æ¬¡åˆ’åˆ†åˆ°ä¸åŒçš„VLANä¸­ï¼Œç”¨æˆ·ä¸Šä¸‹çº¿ç”¨æˆ·VLANå®¹æ˜“ å˜åŒ–ï¼ŒIPåœ°å€å˜æ›´ã€‚ â€¢ HASHåˆ†é…ç®—æ³•ï¼šæ ¹æ®ç”¨æˆ·MACåœ°å€HASHå€¼åˆ†é…VLANï¼Œç”¨æˆ·åˆ†é…çš„VLANå›ºå®šï¼Œå¯èƒ½å¯¼è‡´ VLANé—´ç”¨æˆ·åˆ’åˆ†ä¸å‡åŒ€ï¼Œæœ‰çš„VLANç”¨æˆ·è¾ƒå¤šï¼Œæœ‰çš„è¾ƒå°‘ã€‚ é…ç½® å¦‚å›¾ï¼Œç®¡ç†vlan10ï¼Œä¸šåŠ¡vlan 20 30 40ï¼Œç½‘ç»œå¯è¾¾ï¼Œdhcpé…ç½®ï¼Œcapwapéš§é“ï¼ŒwlanåŸºç¡€é…ç½®ï¼ˆvapæ¨¡æ¿é‡Œä¸šåŠ¡vlané€‰æ‹©ç»‘å®švlan poolï¼‰ åˆ›å»ºvlan poolï¼ŒæŠŠä¸šåŠ¡vlan 20 30 40 åŠ å…¥è¿›æ¥ï¼Œåˆ†é…ç®—æ³•è¿™é‡Œé€‰æ‹©é¡ºåºåˆ†é… ç»ˆç«¯è¿æ¥åï¼ŒæŸ¥çœ‹ipï¼Œå‘ç°åˆ†åˆ«æ¥å…¥vlan20 30 40 ACçš„DHCPæŠ€æœ¯éšç€ç½‘ç»œè§„æ¨¡çš„ä¸æ–­æ‰©å¤§ï¼Œç½‘ç»œè®¾å¤‡ä¸æ–­å¢å¤šï¼Œä¼ä¸šå†…ä¸åŒçš„ç”¨æˆ·å¯èƒ½åˆ†å¸ƒåœ¨ä¸åŒçš„ç½‘æ®µï¼Œä¸€å°DHCPæœåŠ¡å™¨åœ¨æ­£å¸¸æƒ…å†µä¸‹æ— æ³•æ»¡è¶³å¤šä¸ªç½‘æ®µçš„åœ°å€åˆ†é…éœ€æ±‚ã€‚ä¼ä¸šå†…ç½‘å„ä¸ªç½‘æ®µé€šå¸¸éƒ½æ²¡æœ‰ä¸DHCP Serveråœ¨åŒä¸€ä¸ªäºŒå±‚å¹¿æ’­åŸŸå†…ï¼Œå¦‚æœè¿˜éœ€è¦é€šè¿‡DHCPæœåŠ¡å™¨åˆ†é…IPåœ°å€ï¼Œåˆ™éœ€è¦è·¨ç½‘æ®µå‘é€DHCPåè®®æŠ¥æ–‡ã€‚ æ¡ˆä¾‹1 ACå’ŒAPåœ¨äºŒå±‚ï¼ŒDHCPæœåŠ¡å™¨å’ŒACä¸åœ¨åŒä¸€ç½‘æ®µï¼ŒDHCPæœåŠ¡å™¨ç»™STAå’ŒAPåˆ†é…ipåœ°å€ï¼Œç”±äºè·¨ç½‘æ®µï¼Œæ‰€ä»¥åœ¨ACä¸Šé…ç½®ä¸­ç»§ é…ç½®ç«¯å£ï¼šç•¥ AR1ï¼š int g 0&#x2F;0&#x2F;1 ip ad 172.168.12.1 dhcp enable [Huawei-GigabitEthernet0&#x2F;0&#x2F;1]dhcp select global é…ç½®åœ°å€ç»„ ip pool 10 gateway-list 10.0.10.254 network 10.0.10.0 mask 255.255.255.0 ip pool 11 gateway-list 10.0.11.254 network 10.0.11.0 mask 255.255.255.0 é…ç½®é™æ€è·¯ç”± [Huawei]ip route-static 10.0.10.0 24 172.168.12.2[Huawei]ip route-static 10.0.11.0 24 172.168.12.2 ACï¼š vlan b 10 11 int vlanif 10 ip ad 10.0.10.254 24 int vlanif 11 ip ad 10.0.11.254 24 int vlanif 1 ip ad 172.168.12.2 24 (ä¸è·¯ç”±å™¨ç›¸è¿æ¥å£ip) é…ç½®ä¸­ç»§ï¼š interface Vlanif10 ip address 10.0.10.254 255.255.255.0 dhcp select relay dhcp relay server-ip 172.168.12.1 interface Vlanif11 ip address 10.0.11.254 255.255.255.0 dhcp select relay dhcp relay server-ip 172.168.12.1 capwap source interface vlanif 10ï¼ˆéš§é“ï¼‰ æ­¤æ—¶apå¯ä»¥è·å–ipåœ°å€ WLANé…ç½®ï¼šç•¥ staæŸ¥çœ‹ip å¯ä»¥è·å–ipåœ°å€ æ¡ˆä¾‹2 â€¢ åœ¨ACå’ŒAPé—´æ˜¯äºŒå±‚ç»„ç½‘çš„æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥é…ç½®Option43ï¼ŒAPä¼šæ ¹æ®Option43çš„å†…å®¹å…ˆå‘ æŒ‡å®šIPåœ°å€çš„ACå‘é€å•æ’­è¯·æ±‚æŠ¥æ–‡ï¼Œå¦‚æœå‘é€åæ¬¡æŠ¥æ–‡ï¼ŒAPéƒ½æ²¡æœ‰æ”¶åˆ°å›åº”ï¼Œåˆ™APä¼šç»§ç»­ ä»¥å¹¿æ’­çš„æ–¹å¼æ¥å‘ç°åŒä¸€ç½‘æ®µçš„ACã€‚æ‰€ä»¥åœ¨äºŒå±‚ç»„ç½‘çš„æƒ…å†µä¸‹Option 43ä¸æ˜¯å¿…é…çš„å‚æ•°ï¼Œ ä½†åœ¨ä¸‰å±‚ç»„ç½‘çš„æƒ…å†µä¸‹åˆ™æ˜¯å¿…é…çš„ã€‚ â€¢ Option 43å³ä¸ºTypeå€¼ä¸º43ï¼ˆ0x2Bï¼‰çš„Optionå­—æ®µï¼Œåˆç§°ä¸ºå‚å•†ç‰¹å®šä¿¡æ¯é€‰é¡¹ï¼ŒDHCPæœåŠ¡ å™¨å’ŒDHCPå®¢æˆ·ç«¯é€šè¿‡Option43äº¤æ¢å‚å•†ç‰¹å®šçš„ä¿¡æ¯ã€‚å½“DHCPæœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚Option43 ä¿¡æ¯çš„DHCPè¯·æ±‚æŠ¥æ–‡åï¼Œå°†åœ¨å›å¤æŠ¥æ–‡ä¸­æºå¸¦Option43ï¼Œä¸ºDHCPå®¢æˆ·ç«¯åˆ†é…å‚å•†æŒ‡å®šçš„ ä¿¡æ¯ï¼ˆæœ¬æ–‡ä¸­ç‰¹æŒ‡ACçš„IPåœ°å€ï¼‰ã€‚ æ‹“æ‰‘ å¦‚å›¾ ACå’ŒAPä¸åœ¨åŒä¸€ç½‘æ®µï¼ŒS3ä½œä¸ºrelayç»™STAåˆ†é…ipï¼ŒAC2ä½œä¸ºDHCPæœåŠ¡å™¨ç»™APåˆ†é…ipåœ°å€ é…ç½®ï¼š é…ç½®ç«¯å£ï¼šç•¥ S3ï¼š vlan b 20 21 100 int g 0&#x2F;0&#x2F;2 p l t p t a v 100 int vlanif 100 ip add 192.168.100.3 (S3å’ŒACä¹‹é—´é€šè¿‡vlanif100è¿æ¥) dhcpé…ç½®ï¼š dhcp enable interface Vlanif20 ip address 10.0.20.254 255.255.255.0 dhcp select relay dhcp relay server-ip 192.168.100.2 interface Vlanif21 ip address 10.0.21.254 255.255.255.0 dhcp select interface ï¼ˆç»™staåˆ†é…é€‰æ‹©æ¥å£åœ°å€æ± ï¼‰ ACï¼š vlan 100 é…ç½®dhcpï¼š dhcp enable ip pool 20 gateway-list 10.0.20.254 network 192.168.100.0 mask 255.255.255.0 option 43 sub-option 3 ascii 192.168.100.2 ï¼ˆè®¾ç½®option43å­—æ®µï¼Œacçš„åœ°å€ï¼‰ interface Vlanif100 ip address 192.168.100.2 255.255.255.0 dhcp select global int g 0&#x2F;0&#x2F;1 p l t p t a v 100 é…ç½®é™æ€è·¯ç”±ï¼š ip route-static 10.0.20.0 24 192.168.100.3 capwapéš§é“ï¼š capwap source interface vlanif 100 æ­¤æ—¶apå¯ä»¥è·å–ip wlané…ç½®ï¼šç•¥ æ­¤æ—¶staå¯ä»¥è·å–åœ°å€ æ¼«æ¸¸ â€¢ äºŒå±‚æ¼«æ¸¸ï¼š1ä¸ªæ— çº¿å®¢æˆ·ç«¯åœ¨2ä¸ªAPï¼ˆæˆ–å¤šä¸ªAPï¼‰ä¹‹é—´æ¥å›åˆ‡æ¢è¿æ¥æ— çº¿ï¼Œå‰ææ˜¯è¿™äº›APéƒ½ ç»‘å®šçš„æ˜¯åŒ1ä¸ªSSIDå¹¶ä¸”ä¸šåŠ¡VLANéƒ½åœ¨åŒ1ä¸ªVLANå†…ï¼ˆåœ¨åŒä¸€ä¸ªIPåœ°å€æ®µï¼‰ï¼Œæ¼«æ¸¸åˆ‡æ¢çš„ è¿‡ç¨‹ä¸­ï¼Œæ— çº¿å®¢æˆ·ç«¯çš„æ¥å…¥å±æ€§ï¼ˆæ¯”å¦‚æ— çº¿å®¢æˆ·ç«¯æ‰€å±çš„ä¸šåŠ¡VLANã€è·å–çš„IPåœ°å€ç­‰å±æ€§ï¼‰ ä¸ä¼šæœ‰ä»»ä½•å˜åŒ–ï¼Œç›´æ¥å¹³æ»‘è¿‡æ¸¡ï¼Œåœ¨æ¼«æ¸¸çš„è¿‡ç¨‹ä¸­ä¸ä¼šæœ‰ä¸¢åŒ…å’Œæ–­çº¿é‡è¿çš„ç°è±¡ã€‚ â€¢ ä¸‰å±‚æ¼«æ¸¸ï¼šæ¼«æ¸¸å‰åSSIDçš„ä¸šåŠ¡VLANä¸åŒï¼ŒAPæ‰€æä¾›çš„ä¸šåŠ¡ç½‘ç»œä¸ºä¸åŒçš„ä¸‰å±‚ç½‘ç»œï¼Œå¯¹ åº”ä¸åŒçš„ç½‘å…³ã€‚æ­¤æ—¶ï¼Œä¸ºä¿æŒæ¼«æ¸¸ç”¨æˆ·IPåœ°å€ä¸å˜çš„ç‰¹æ€§ï¼Œéœ€è¦å°†ç”¨æˆ·æµé‡è¿‚å›åˆ°åˆå§‹æ¥å…¥ ç½‘æ®µçš„APï¼Œå®ç°è·¨VLANæ¼«æ¸¸ã€‚ â€¢ ç½‘ç»œä¸­æœ‰æ—¶å€™ä¼šå‡ºç°ä»¥ä¸‹æƒ…å†µï¼šä¸¤ä¸ªä¸šåŠ¡VLANçš„VLAN IDç›¸åŒï¼Œä½†æ˜¯è¿™ä¸¤ä¸ªå­ç½‘åˆå±äºä¸ åŒçš„å­ç½‘ã€‚æ­¤æ—¶ä¸ºäº†é¿å…ç³»ç»Ÿä»…ä»…ä¾æ®VLAN IDå°†ç”¨æˆ·åœ¨ä¸¤ä¸ªå­ç½‘é—´çš„æ¼«æ¸¸è¯¯åˆ¤ä¸ºäºŒå±‚æ¼« æ¸¸ï¼Œéœ€è¦é€šè¿‡æ¼«æ¸¸åŸŸæ¥ç¡®å®šè®¾å¤‡æ˜¯å¦åœ¨åŒä¸€ä¸ªå­ç½‘å†…ï¼Œåªæœ‰å½“VLANç›¸åŒä¸”æ¼«æ¸¸åŸŸä¹Ÿç›¸åŒçš„ æ—¶å€™æ‰æ˜¯äºŒå±‚æ¼«æ¸¸ï¼Œå¦åˆ™æ˜¯ä¸‰å±‚æ¼«æ¸¸ã€‚ â€¢ é…ç½®æ¼«æ¸¸ç»„ã€‚ â–« å¦‚æœæŒ‡å®šäº†æ¼«æ¸¸ç»„æœåŠ¡å™¨ï¼Œåˆ™éœ€è¦åœ¨æ¼«æ¸¸ç»„æœåŠ¡å™¨ä¸Šé…ç½®æ¼«æ¸¸ç»„ã€‚ â–« å¦‚æœæ²¡æœ‰æŒ‡å®šæ¼«æ¸¸ç»„æœåŠ¡å™¨ï¼Œåˆ™å„æˆå‘˜ACå‡éœ€é…ç½®æ¼«æ¸¸ç»„ã€‚ å®éªŒ è®¾å¤‡è¿æ¥æ–¹å¼å¦‚å›¾æ‰€ç¤ºï¼ŒAP1è¢«AC1çº³ç®¡ï¼ŒAP2è¢«AC2çº³ç®¡ï¼Œæ‰€æœ‰APéƒ½é‡‡ç”¨ç›´æ¥è½¬å‘æ¨¡å¼ã€‚ S4äº¤æ¢æœºäºŒå±‚é€ä¼ AP2çš„ç®¡ç†ã€ä¸šåŠ¡æŠ¥æ–‡ï¼ŒS3ä½œä¸ºAPç®¡ç†æµé‡ã€ä¸šåŠ¡æµé‡çš„ç½‘å…³ã€‚ S3å¼€å¯DHCPæœåŠ¡ä¸ºAP1ã€AP2åˆ†é…ç®¡ç†åœ°å€ã€ä¸ºæ— çº¿ç»ˆç«¯åˆ†é…ä¸šåŠ¡åœ°å€ï¼ŒAPé€šè¿‡DHCPæŠ¥æ–‡ä¸­çš„Option 43è·å–ACåœ°å€ã€‚ 1.1.1.1 æ•°æ®è§„åˆ’ é…ç½®é¡¹ é…ç½®å‚æ•° APç®¡ç†VLAN VLAN10ã€20 STAä¸šåŠ¡VLAN VLAN11ã€21 DHCPæœåŠ¡å™¨ S3ä½œä¸ºDHCPæœåŠ¡å™¨ä¸ºAPåˆ†é…IPåœ°å€ S3ä½œä¸ºDHCPæœåŠ¡å™¨ä¸ºSTAåˆ†é…IPåœ°å€ APçš„IPåœ°å€æ±  10.0.10.0&#x2F;24ã€10.0.20.0&#x2F;24 STAçš„IPåœ°å€æ±  10.0.11.0&#x2F;24ã€10.0.21.0&#x2F;24 ACçš„æºæ¥å£IPåœ°å€ VLANIF100ï¼ˆ10.0.100.254ï¼‰ã€VLANIF200ï¼ˆ10.0.200.254ï¼‰ APç»„ åç§°ï¼šap-group1ã€ap-group2 å¼•ç”¨æ¨¡æ¿ï¼šVAPæ¨¡æ¿departX åŸŸç®¡ç†æ¨¡æ¿ åç§°ï¼šdefault å›½å®¶ç ï¼šä¸­å›½ï¼ˆCNï¼‰ SSIDæ¨¡æ¿ åç§°ï¼šdepartX SSIDåç§°ï¼šroam å®‰å…¨æ¨¡æ¿ åç§°ï¼šdepartX å®‰å…¨ç­–ç•¥ï¼šWPA-WPA2+PSK+AES å¯†ç ï¼šhuawei123 VAPæ¨¡æ¿ åç§°ï¼šdepartX è½¬å‘æ¨¡å¼ï¼šç›´æ¥è½¬å‘ ä¸šåŠ¡VLANï¼šVLAN11ã€21 å¼•ç”¨æ¨¡æ¿ï¼šSSIDæ¨¡æ¿departXã€å®‰å…¨æ¨¡æ¿departX DepartXä¸­çš„Xä»£è¡¨ACç¼–å·ï¼Œå³AC1ä¸Šä¸ºdepart1ã€AC2ä¸Šä¸ºdepart2ã€‚ S3è®¾å¤‡é…ç½® # sysname S3 # vlan batch 10 to 11 20 to 21 100 200 # dhcp enable # ip pool ap1 gateway-list 10.0.10.1 network 10.0.10.0 mask 255.255.255.0 option 43 sub-option 3 ascii 10.0.100.254 # ip pool ap2 gateway-list 10.0.20.1 network 10.0.20.0 mask 255.255.255.0 option 43 sub-option 3 ascii 10.0.200.254 # ip pool service_a gateway-list 10.0.11.1 network 10.0.11.0 mask 255.255.255.0 dns-list 10.0.11.1 # ip pool service_b gateway-list 10.0.21.1 network 10.0.21.0 mask 255.255.255.0 dns-list 10.0.21.1 # interface Vlanif10 description ap1_mgnt ip address 10.0.10.1 255.255.255.0 dhcp select global # interface Vlanif11 description ap1_service ip address 10.0.11.1 255.255.255.0 dhcp select global # interface Vlanif20 description ap2_mgnt ip address 10.0.20.1 255.255.255.0 dhcp select global # interface Vlanif21 description ap2_service ip address 10.0.21.1 255.255.255.0 dhcp select global # interface Vlanif100 description to_AC1 ip address 10.0.100.1 255.255.255.0 # interface Vlanif200 description to_AC2 ip address 10.0.200.1 255.255.255.0 # interface GigabitEthernet0&#x2F;0&#x2F;1 port link-type trunk port trunk allow-pass vlan 100 # interface GigabitEthernet0&#x2F;0&#x2F;2 port link-type trunk port trunk allow-pass vlan 200 # interface GigabitEthernet0&#x2F;0&#x2F;3 port link-type trunk port trunk allow-pass vlan 20 to 21 # interface GigabitEthernet0&#x2F;0&#x2F;4 port link-type trunk port trunk pvid vlan 10 port trunk allow-pass vlan 10 to 11 # return S4è®¾å¤‡é…ç½® # sysname S4 # vlan batch 20 to 21 # interface GigabitEthernet0&#x2F;0&#x2F;3 port link-type trunk port trunk allow-pass vlan 20 to 21 # interface GigabitEthernet0&#x2F;0&#x2F;4 port link-type trunk port trunk pvid vlan 20 port trunk allow-pass vlan 20 to 21 # return AC1è®¾å¤‡é…ç½® # sysname AC1 # vlan batch 100 # interface Vlanif100 description to_S3_CAPWAP ip address 10.0.100.254 255.255.255.0 # interface GigabitEthernet0&#x2F;0&#x2F;12 port link-type trunk port trunk allow-pass vlan 100 # ip route-static 10.0.10.0 255.255.255.0 10.0.100.1 ip route-static 10.0.200.0 255.255.255.0 10.0.100.1 # capwap source interface vlanif100 # wlan security-profile name depart1 security wpa2 psk pass-phrase huawei123 aes aes ssid-profile name depart1 ssid roam vap-profile name depart1 service-vlan vlan-id 11 ssid-profile depart1 security-profile depart1 regulatory-domain-profile name default mobility-group name mobilityï¼ˆæ¼«æ¸¸ç»„åç§°å¿…é¡»ä¸€è‡´ï¼‰ member ip-address 10.0.100.254 member ip-address 10.0.200.254 ap-group name depart1 radio 0 vap-profile depart1 wlan 1 radio 1 vap-profile depart1 wlan 1 radio 2 vap-profile depart1 wlan 1 ap-id 0 type-id 56 ap-mac 00e0-fc6e-2890 ap-sn 210235448310F30CF56D ap-name ap1 ap-group depart1 provision-ap # return AC2è®¾å¤‡é…ç½® # sysname AC2 # vlan batch 200 # interface Vlanif200 description to_S3_CAPWAP ip address 10.0.200.254 255.255.255.0 # interface GigabitEthernet0&#x2F;0&#x2F;13 port link-type trunk port trunk allow-pass vlan 200 # ip route-static 10.0.20.0 255.255.255.0 10.0.200.1 ip route-static 10.0.100.0 255.255.255.0 10.0.200.1 # capwap source interface vlanif200 # wlan security-profile name depart2 security wpa-wpa2 psk pass-phrase huawei123 aes ssid-profile name default ssid-profile name depart2 ssid roam vap-profile name depart2 service-vlan vlan-id 21 ssid-profile depart2 security-profile depart2 regulatory-domain-profile name default mobility-group name mobility member ip-address 10.0.100.254 member ip-address 10.0.200.254 ap-group name depart2 radio 0 vap-profile depart2 wlan 1 radio 1 vap-profile depart2 wlan 1 radio 2 vap-profile depart2 wlan 1 ap-id 0 type-id 56 ap-mac 00e0-fcde-1990 ap-sn 210235448310FA145341 ap-name ap2 ap-group depart2 provision-ap # Return æ¼«æ¸¸æ³¨æ„äº‹é¡¹ å®ç°WLANæ¼«æ¸¸çš„ä¸¤ä¸ªAPå¿…é¡»ä½¿ç”¨ç›¸åŒçš„SSIDå’Œå®‰å…¨æ¨¡æ¿ï¼ˆå®‰å…¨æ¨¡æ¿åç§°å¯ä»¥ä¸åŒï¼Œä½†æ˜¯å®‰å…¨æ¨¡æ¿ä¸‹çš„é…ç½®å¿…é¡»ç›¸åŒï¼‰ï¼Œè®¤è¯æ¨¡æ¿çš„è®¤è¯æ–¹å¼å’Œè®¤è¯å‚æ•°ä¹Ÿè¦é…ç½®ç›¸åŒã€‚ æ¼«æ¸¸ç»„å†…æœ€å¤šå¯ä»¥æ·»åŠ 16ä¸ªACæˆå‘˜ï¼ŒACä¸€æ¬¡åªèƒ½åŠ å…¥åˆ°ä¸€ä¸ªæ¼«æ¸¸ç»„ä¸­ï¼Œä¸å¯ä»¥åŒæ—¶åŠ å…¥å¤šä¸ªæ¼«æ¸¸ç»„ã€‚åœ¨é«˜å¯†ç­‰å¯èƒ½é¢‘ç¹å‘ç”ŸACé—´æ¼«æ¸¸çš„åœºæ™¯ä¸­ï¼Œå¦‚æœæ¼«æ¸¸ç»„æˆå‘˜æ•°è¿‡å¤šï¼Œå¯èƒ½å¯¼è‡´é¢‘ç¹å‡ºç°æ¼«æ¸¸å¤±è´¥ã€‚å¯¹äºæ­¤ç±»åœºæ™¯ï¼Œå»ºè®®è°ƒæ•´ç»„ç½‘è§„åˆ’ï¼Œä½¿æ¼«æ¸¸ç»„ä¸­å­˜åœ¨4ä¸ªä»¥å†…æˆå‘˜ACã€‚ åŒä¸€æ¼«æ¸¸ç»„å†…çš„ACå¿…é¡»ä½¿ç”¨ç›¸åŒçš„è½¯ä»¶Cç‰ˆæœ¬ï¼Œå¦åˆ™å¯èƒ½ä¼šå¯¼è‡´ACé—´æ¼«æ¸¸å¤±è´¥ã€‚ ACé—´æ¼«æ¸¸å»ºè®®é‡‡ç”¨è§„æ ¼ç›¸è¿‘çš„ACã€‚ä¸åŒå‹å·ACçš„ç”¨æˆ·æ¥å…¥èƒ½åŠ›ç›¸å·®è¾ƒå¤§ï¼Œå½“å¤§è§„æ ¼ACçš„æ¥å…¥ç”¨æˆ·å¤§é‡å‘å°è§„æ ¼ACæ¼«æ¸¸æ—¶ï¼Œè¶…å‡ºå°è§„æ ¼ACæ¥å…¥èƒ½åŠ›çš„éƒ¨åˆ†ç”¨æˆ·ä¼šæ¼«æ¸¸å¤±è´¥ã€‚ é…ç½®æ¼«æ¸¸ç»„æ—¶ï¼Œéœ€ç¡®ä¿ACå·²é…ç½®CAPWAPæºåœ°å€ï¼Œå¦åˆ™æ¼«æ¸¸ç»„ä¸ç”Ÿæ•ˆã€‚ ACé—´æ¼«æ¸¸ä¸åŒé“¾è·¯çƒ­å¤‡åŠŸèƒ½äº’æ–¥ã€‚ AGVæ¼«æ¸¸åŠŸèƒ½ä¸ç©ºå£æ‰«æåŠŸèƒ½äº’æ–¥ã€‚å¼€å¯AGVåŠŸèƒ½åï¼ŒAPä¸Šçš„å¯¹åº”å°„é¢‘å°†ä¸æ”¯æŒç©ºå£æ‰«æåŠŸèƒ½ï¼Œä¾èµ–äºæ‰«æçš„ä¸šåŠ¡å¦‚æ™ºèƒ½æ¼«æ¸¸ã€é¢‘è°±å¯¼èˆªã€è´Ÿè½½å‡è¡¡ç­‰å‡ä¸å¯ç”¨ã€‚ ACé—´æ¼«æ¸¸ç»„åç§°å¿…é¡»ä¸€è‡´ã€‚ WLAN ACå’Œäº¤æ¢æœºä¹‹é—´ä¸æ”¯æŒACé—´æ¼«æ¸¸ã€‚ 802.11råŠŸèƒ½æ”¯æŒçš„å®‰å…¨ç­–ç•¥åŒ…æ‹¬å¼€æ”¾å¼ç³»ç»Ÿè®¤è¯ã€WPA2+PSK+AESã€WPA2+PPSK+AESå’ŒWPA2+802.1X+AESã€‚ 802.11råŠŸèƒ½ä¸PMFåŠŸèƒ½äº’æ–¥ï¼Œå³å¦‚æœå·²é…ç½®äº†802.11råŠŸèƒ½ï¼Œä¸èƒ½å†é…ç½®PMFåŠŸèƒ½ã€‚ 802.11rä½¿ç”¨802.1Xè®¤è¯æ—¶ï¼Œå¦‚æœå¼€å¯äº†802.1Xé‡è®¤è¯åŠŸèƒ½ï¼Œéƒ¨åˆ†ç»ˆç«¯å¯èƒ½å› å…¼å®¹æ€§é—®é¢˜ï¼Œåœ¨é‡è®¤è¯é˜¶æ®µæ‰çº¿åé‡æ–°ä¸Šçº¿ã€‚ éƒ¨åˆ†ç»ˆç«¯å¯èƒ½ä¸802.11ræ¼«æ¸¸åŠŸèƒ½å­˜åœ¨å…¼å®¹æ€§é—®é¢˜ï¼Œå¯¼è‡´æ¼«æ¸¸å¤±è´¥ã€‚ä¸å»ºè®®å¼€å¯802.11ræ¼«æ¸¸åŠŸèƒ½ã€‚ å¦‚æœä¸¤ä¸ªACä¸Šçš„PPSKé…ç½®ä¿æŒä¸€è‡´ï¼Œåˆ™PPSKç”¨æˆ·æ”¯æŒACé—´802.11rå¿«é€Ÿæ¼«æ¸¸ï¼›å¦‚æœä¸¤ä¸ªACä¸Šçš„PPSKé…ç½®ä¸ä¸€è‡´ï¼Œåˆ™PPSKç”¨æˆ·ä¸æ”¯æŒACé—´802.11rå¿«é€Ÿæ¼«æ¸¸ã€‚ ç›¸åŒæˆ–ä¸åŒæ¼«æ¸¸ç»„æˆå‘˜ï¼ˆå«æ¼«æ¸¸ç»„æœåŠ¡å™¨ï¼‰çš„IPç‰ˆæœ¬å¿…é¡»ä¿æŒä¸€è‡´ã€‚å¦‚æœé…ç½®äº†Navi ACï¼Œåˆ™æ¼«æ¸¸ç»„æˆå‘˜ä¸Navi ACæˆå‘˜ï¼ˆNavi ACå’ŒLocal ACï¼‰çš„IPç‰ˆæœ¬ä¹Ÿå¿…é¡»ä¿æŒä¸€è‡´ã€‚ ç›¸åŒçš„SSIDã€‚ ç›¸åŒçš„VAPæ¨¡æ¿ï¼Œä¸”VAP IDå¿…é¡»ç›¸åŒã€‚ ç›¸åŒçš„å®‰å…¨ç­–ç•¥ã€‚ é«˜å¯é æ€§æŠ€æœ¯â€¢ çƒ­å¤‡ä»½æ˜¯æŒ‡ï¼Œå½“ä¸¤å°è®¾å¤‡åœ¨ç¡®å®šä¸»ç”¨ï¼ˆMasterï¼‰è®¾å¤‡å’Œå¤‡ç”¨ï¼ˆBackupï¼‰è®¾å¤‡åï¼Œç”±ä¸»ç”¨è®¾ å¤‡è¿›è¡Œä¸šåŠ¡çš„è½¬å‘ï¼Œè€Œå¤‡ç”¨è®¾å¤‡å¤„äºç›‘æ§çŠ¶æ€ï¼ŒåŒæ—¶ä¸»ç”¨è®¾å¤‡å®æ—¶å‘å¤‡ç”¨è®¾å¤‡å‘é€çŠ¶æ€ä¿¡ æ¯å’Œéœ€è¦å¤‡ä»½çš„ä¿¡æ¯ï¼Œå½“ä¸»ç”¨è®¾å¤‡å‡ºç°æ•…éšœåï¼Œå¤‡ç”¨è®¾å¤‡åŠæ—¶æ¥æ›¿ä¸»ç”¨è®¾å¤‡çš„ä¸šåŠ¡è¿è¡Œã€‚ â€¢ VRRPåŒæœºçƒ­å¤‡ä»½ â–« ä¸»å¤‡ACä¸¤ä¸ªç‹¬ç«‹çš„IPåœ°å€ï¼Œé€šè¿‡VRRPå¯¹å¤–è™šæ‹Ÿä¸ºåŒä¸€ä¸ªIPåœ°å€ï¼Œå•ä¸ªAPå’Œè™šæ‹ŸIPå»º ç«‹ä¸€æ¡CAPWAPé“¾è·¯ã€‚ â–« ä¸»ACå¤‡ä»½APä¿¡æ¯ã€STAä¿¡æ¯å’ŒCAPWAPé“¾è·¯ä¿¡æ¯ï¼Œå¹¶é€šè¿‡HSBä¸»å¤‡æœåŠ¡å°†ä¿¡æ¯åŒæ­¥ç»™ å¤‡ACã€‚ä¸»ACæ•…éšœåï¼Œå¤‡ACç›´æ¥æ¥æ›¿å·¥ä½œã€‚ â€¢ åŒé“¾è·¯çƒ­å¤‡ä»½ â–« å•ä¸ªAPåˆ†åˆ«å’Œä¸»å¤‡ACå»ºç«‹CAPWAPé“¾è·¯ï¼Œä¸€æ¡ä¸»é“¾è·¯ï¼Œä¸€æ¡å¤‡é“¾è·¯ã€‚ â–« ä¸»ACä»…å¤‡ä»½STAä¿¡æ¯ï¼Œå¹¶é€šè¿‡HSBä¸»å¤‡æœåŠ¡å°†ä¿¡æ¯åŒæ­¥ç»™å¤‡ACã€‚ä¸»ACæ•…éšœåï¼ŒAPåˆ‡ æ¢åˆ°å¤‡é“¾è·¯ä¸Šï¼Œå¤‡ACæ¥æ›¿å·¥ä½œã€‚ â€¢ åŒé“¾è·¯å†·å¤‡ä»½ â–« å•ä¸ªAPåˆ†åˆ«å’Œä¸»å¤‡ACå»ºç«‹CAPWAPé“¾è·¯ï¼Œä¸€æ¡ä¸»é“¾è·¯ï¼Œä¸€æ¡å¤‡é“¾è·¯ã€‚ â–« ACä¸å¤‡ä»½åŒæ­¥ä¿¡æ¯ã€‚ä¸»ACæ•…éšœåï¼ŒAPåˆ‡æ¢åˆ°å¤‡é“¾è·¯ä¸Šï¼Œå¤‡ACæ¥æ›¿å·¥ä½œã€‚ â€¢ N+1å¤‡ä»½ â–« å•ä¸ªAPåªå’Œä¸€ä¸ªACå»ºç«‹CAPWAPé“¾è·¯ã€‚ â–« ACä¸å¤‡ä»½åŒæ­¥ä¿¡æ¯ã€‚ä¸»ACæ•…éšœåï¼ŒAPé‡æ–°ä¸å¤‡ACå»ºé“¾CAPWAPé“¾è·¯ï¼Œå¤‡ACæ¥æ›¿å·¥ ä½œã€‚ VRRPåŒæœºçƒ­å¤‡ ACç›®å‰æ”¯æŒVRRPå•å®ä¾‹æ•´æœºçƒ­å¤‡ï¼Œä¸æ”¯æŒè´Ÿè½½å‡è¡¡ã€‚ åŸºäºVRRP çš„åŒæœºçƒ­å¤‡ï¼Œçƒ­å¤‡ç›¸å…³çš„ä¸šåŠ¡éƒ½æ³¨å†Œåˆ°åŒä¸€ä¸ªHSBå¤‡ä»½ç»„ï¼ŒHSBå¤‡ä»½ç»„å†…éƒ¨ç»‘å®š HSBæœåŠ¡ï¼ŒåŒæ—¶HSBå¤‡ä»½ç»„ä¸ä¸€ä¸ªVRRPå®ä¾‹ç»‘å®šï¼Œä»è€Œä¸šåŠ¡é€šè¿‡HSBå¤‡ä»½ç»„è·çŸ¥å½“å‰ç”¨æˆ· çš„ä¸»å¤‡çŠ¶æ€ã€ä»¥åŠä¸»å¤‡åˆ‡æ¢ç­‰äº‹ä»¶ï¼Œå¹¶é€šè¿‡HSBç»„çš„æ¥å£è¿›è¡Œå¤‡ä»½æ•°æ®çš„æ¥æ”¶å’Œå‘é€ã€‚ HSBä¸šåŠ¡å®æ—¶å¤‡ä»½ï¼š â–« ç”¨æˆ·æ•°æ®ä¿¡æ¯å¤‡ä»½ â–« CAPWAPéš§é“ä¿¡æ¯å¤‡ä»½ â–« APè¡¨é¡¹å¤‡ä»½ â–« DHCPåœ°å€ä¿¡æ¯å¤‡ä»½ é…ç½®ï¼š é…ç½®æ¡ˆä¾‹ AC2é…ç½®ä¸AC1ç›¸åŒï¼Œæ­¤å¤„ä¸å†èµ˜è¿°ã€‚ capwapéš§é“ä½¿ç”¨virtual-ipï¼Œcapwap source ip-address 10.0.10.X åŒé“¾è·¯åŒæœºçƒ­å¤‡ è¯¥æ–¹æ¡ˆé™¤äº†æ”¯æŒä¸»å¤‡å¤‡ä»½ä¹‹å¤–ï¼Œè¿˜æ”¯æŒè´Ÿè½½åˆ†æ‹…æ¨¡å¼ã€‚è´Ÿè½½åˆ†æ‹…æ¨¡å¼ä¸‹å¯ä»¥æŒ‡å®šä¸€éƒ¨åˆ†AP çš„ä¸»ACä¸ºAC1ï¼Œä¸å…¶å»ºç«‹CAPWAPä¸»é“¾è·¯ï¼Œä¸€éƒ¨åˆ†APçš„ä¸»ACä¸ºAC2ï¼Œä¸å…¶å»ºç«‹CAPWAPä¸» é“¾è·¯ã€‚ â€¢ å»ºç«‹ä¸»é“¾è·¯æ—¶ï¼Œé™¤äº†Discoveryé˜¶æ®µè¦ä¼˜é€‰å‡ºä¸»ACï¼Œå…¶ä»–è¿‡ç¨‹è·Ÿæ­£å¸¸æƒ…å†µä¸‹çš„CAPWAPéš§é“ å»ºç«‹è¿‡ç¨‹ä¸€è‡´ã€‚ â€¢ åœ¨Discoveryé˜¶æ®µï¼Œä½¿èƒ½åŒé“¾è·¯å¤‡ä»½åŠŸèƒ½åï¼ŒAPå¼€å§‹å‘é€Discovery RequestæŠ¥æ–‡ï¼Œåˆ†ä¸ºå•æ’­ æ–¹å¼å’Œå¹¿æ’­æ–¹å¼ï¼š â–« å¦‚æœé¢„å…ˆé€šè¿‡é™æ€æ–¹å¼ã€DHCPæœåŠ¡å™¨æ–¹å¼æˆ–DNSæ–¹å¼æŒ‡å®šäº†ä¸»å¤‡ACçš„IPåœ°å€ï¼ŒAPå‘ ACå‘é€å•æ’­Discovery RequestæŠ¥æ–‡è¯·æ±‚ä¸ä¸»å¤‡ACå…³è”ã€‚ â–« å¦‚æœæ²¡æœ‰é…ç½®ACçš„é™æ€IPåœ°å€æˆ–è€…å•æ’­æ²¡æœ‰å›åº”æ—¶ï¼ŒAPå°†å‘é€å¹¿æ’­Discovery RequestæŠ¥æ–‡è¯·æ±‚åŒç½‘æ®µå†…å¯å…³è”çš„ACã€‚ â€¢ ä¸ç®¡æ˜¯å•æ’­å‘ç°è¿˜æ˜¯å¹¿æ’­å‘ç°ï¼Œå¦‚æœä¸»å¤‡ACéƒ½æ­£å¸¸ï¼Œéƒ½ä¼šå›åº”Discovery ResponseæŠ¥æ–‡ï¼Œ å¹¶åœ¨è¯¥æŠ¥æ–‡ä¸­æºå¸¦åŒé“¾è·¯ç‰¹æ€§å¼€å…³ã€ä¼˜å…ˆçº§ã€è´Ÿè½½æƒ…å†µä»¥åŠIPåœ°å€ã€‚ â€¢ APæ”¶é›†åˆ°ä¸»å¤‡ACå›åº”çš„Discovery ResponseæŠ¥æ–‡åï¼Œæ ¹æ®ACçš„ä¼˜å…ˆçº§ã€è®¾å¤‡çš„è´Ÿè½½æƒ…å†µä»¥ åŠAC IPåœ°å€æ¥é€‰æ‹©ä¸»ACå¹¶å¼€å§‹ä¸å…¶å»ºç«‹CAPWAPä¸»é“¾è·¯ï¼Œä¼˜é€‰é¡ºåºå¦‚ä¸‹ï¼š â–« æ¯”è¾ƒACçš„ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§å€¼å°çš„ä¸ºä¸»ACï¼Œé»˜è®¤ä¼˜å…ˆçº§ä¸º0ï¼Œæœ€å¤§å€¼ä¸º7ï¼Œä¼˜å…ˆçº§å–å€¼ è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ã€‚ï¼› â–« ä¼˜å…ˆçº§ç›¸åŒæƒ…å†µä¸‹ï¼Œæ¯”è¾ƒACè®¾å¤‡çš„è´Ÿè½½æƒ…å†µï¼Œå³APä¸ªæ•°å’ŒSTAä¸ªæ•°ï¼Œè´Ÿè½½è½»çš„ä¸ºä¸» ACã€‚ä¼˜å…ˆé€‰æ‹©å½“å‰å¯æ¥å…¥APæ•°å¤§çš„ACä¸ºä¸»ACï¼Œå¦‚æœå½“å‰å¯æ¥å…¥APæ•°ç›¸åŒï¼Œåˆ™é€‰æ‹©å½“ å‰å¯æ¥å…¥STAæ•°å¤§çš„ACä¸ºä¸»ACï¼› â–« è´Ÿè½½ç›¸åŒæƒ…å†µä¸‹ï¼Œæ¯”è¾ƒIPåœ°å€ï¼ŒIPåœ°å€å°çš„ä¸ºä¸»ACã€‚ â€¢ è¯´æ˜ï¼šå½“å‰å¯æ¥å…¥APæ•°&#x3D;å¯æ¥å…¥çš„æœ€å¤§APæ•°-å½“å‰å·²æ¥å…¥çš„APæ•°ï¼Œå½“å‰å¯æ¥å…¥STAæ•°&#x3D;å¯æ¥ å…¥çš„æœ€å¤§STAæ•°-å½“å‰å·²æ¥å…¥çš„STAæ•° N+1å¤‡ä»½","categories":[{"name":"åŸºç¡€çŸ¥è¯†","slug":"åŸºç¡€çŸ¥è¯†","permalink":"http://example.com/categories/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"}],"tags":[{"name":"vlan pool","slug":"vlan-pool","permalink":"http://example.com/tags/vlan-pool/"},{"name":"option 43","slug":"option-43","permalink":"http://example.com/tags/option-43/"},{"name":"æ¼«æ¸¸","slug":"æ¼«æ¸¸","permalink":"http://example.com/tags/%E6%BC%AB%E6%B8%B8/"}]},{"title":"VRRP","slug":"VRRP","date":"2024-05-25T10:43:59.000Z","updated":"2024-05-25T11:11:58.536Z","comments":true,"path":"2024/05/25/VRRP/","permalink":"http://example.com/2024/05/25/VRRP/","excerpt":"","text":"ç®€ä»‹è™šæ‹Ÿè·¯ç”±å†—ä½™åè®®VRRPï¼ˆVirtual Router Redundancy Protocolï¼‰é€šè¿‡æŠŠå‡ å°è·¯ç”±è®¾å¤‡è”åˆç»„æˆä¸€å°è™šæ‹Ÿçš„è·¯ç”±è®¾å¤‡ï¼Œå°†è™šæ‹Ÿè·¯ç”±è®¾å¤‡çš„IPåœ°å€ä½œä¸ºç”¨æˆ·çš„é»˜è®¤ç½‘å…³å®ç°ä¸å¤–éƒ¨ç½‘ç»œé€šä¿¡ã€‚å½“ç½‘å…³è®¾å¤‡å‘ç”Ÿæ•…éšœæ—¶ï¼ŒVRRPæœºåˆ¶èƒ½å¤Ÿé€‰ä¸¾æ–°çš„ç½‘å…³è®¾å¤‡æ‰¿æ‹…æ•°æ®æµé‡ï¼Œä»è€Œä¿éšœç½‘ç»œçš„å¯é é€šä¿¡ã€‚ éšç€ç½‘ç»œçš„å¿«é€Ÿæ™®åŠå’Œç›¸å…³åº”ç”¨çš„æ—¥ç›Šæ·±å…¥ï¼Œå„ç§å¢å€¼ä¸šåŠ¡ï¼ˆå¦‚IPTVã€è§†é¢‘ä¼šè®®ç­‰ï¼‰å·²ç»å¼€å§‹å¹¿æ³›éƒ¨ç½²ï¼ŒåŸºç¡€ç½‘ç»œçš„å¯é æ€§æ—¥ç›Šæˆä¸ºç”¨æˆ·å…³æ³¨çš„ç„¦ç‚¹ï¼Œèƒ½å¤Ÿä¿è¯ç½‘ç»œä¼ è¾“ä¸ä¸­æ–­å¯¹äºç»ˆç«¯ç”¨æˆ·éå¸¸é‡è¦ã€‚ é€šå¸¸ï¼ŒåŒä¸€ç½‘æ®µå†…çš„æ‰€æœ‰ä¸»æœºä¸Šéƒ½è®¾ç½®ä¸€æ¡ç›¸åŒçš„ã€ä»¥ç½‘å…³ä¸ºä¸‹ä¸€è·³çš„ç¼ºçœè·¯ç”±ã€‚ä¸»æœºå‘å¾€å…¶ä»–ç½‘æ®µçš„æŠ¥æ–‡å°†é€šè¿‡ç¼ºçœè·¯ç”±å‘å¾€ç½‘å…³ï¼Œå†ç”±ç½‘å…³è¿›è¡Œè½¬å‘ï¼Œä»è€Œå®ç°ä¸»æœºä¸å¤–éƒ¨ç½‘ç»œçš„é€šä¿¡ã€‚å½“ç½‘å…³å‘ç”Ÿæ•…éšœæ—¶ï¼Œæœ¬ç½‘æ®µå†…æ‰€æœ‰ä»¥ç½‘å…³ä¸ºç¼ºçœè·¯ç”±çš„ä¸»æœºå°†æ— æ³•ä¸å¤–éƒ¨ç½‘ç»œé€šä¿¡ã€‚å¢åŠ å‡ºå£ç½‘å…³æ˜¯æé«˜ç³»ç»Ÿå¯é æ€§çš„å¸¸è§æ–¹æ³•ï¼Œæ­¤æ—¶å¦‚ä½•åœ¨å¤šä¸ªå‡ºå£ä¹‹é—´è¿›è¡Œé€‰è·¯å°±æˆä¸ºéœ€è¦è§£å†³çš„é—®é¢˜ã€‚ VRRPçš„å‡ºç°å¾ˆå¥½çš„è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚VRRPèƒ½å¤Ÿåœ¨ä¸æ”¹å˜ç»„ç½‘çš„æƒ…å†µä¸‹ï¼Œé‡‡ç”¨å°†å¤šå°è·¯ç”±è®¾å¤‡ç»„æˆä¸€ä¸ªè™šæ‹Ÿè·¯ç”±å™¨ï¼Œé€šè¿‡é…ç½®è™šæ‹Ÿè·¯ç”±å™¨çš„IPåœ°å€ä¸ºé»˜è®¤ç½‘å…³ï¼Œå®ç°é»˜è®¤ç½‘å…³çš„å¤‡ä»½ã€‚å½“ç½‘å…³è®¾å¤‡å‘ç”Ÿæ•…éšœæ—¶ï¼ŒVRRPæœºåˆ¶èƒ½å¤Ÿé€‰ä¸¾æ–°çš„ç½‘å…³è®¾å¤‡æ‰¿æ‹…æ•°æ®æµé‡ï¼Œä»è€Œä¿éšœç½‘ç»œçš„å¯é é€šä¿¡ã€‚ VRRPè·¯ç”±å™¨ï¼ˆVRRP Routerï¼‰ï¼šè¿è¡ŒVRRPåè®®çš„è®¾å¤‡ï¼Œå®ƒå¯èƒ½å±äºä¸€ä¸ªæˆ–å¤šä¸ªè™šæ‹Ÿè·¯ç”±å™¨ï¼Œå¦‚RouterAå’ŒRouterBã€‚ è™šæ‹Ÿè·¯ç”±å™¨ï¼ˆVirtual Routerï¼‰ï¼šåˆç§°VRRPå¤‡ä»½ç»„ï¼Œç”±ä¸€ä¸ªMasterè®¾å¤‡å’Œå¤šä¸ªBackupè®¾å¤‡ç»„æˆï¼Œè¢«å½“ä½œä¸€ä¸ªå…±äº«å±€åŸŸç½‘å†…ä¸»æœºçš„ç¼ºçœç½‘å…³ã€‚å¦‚RouterAå’ŒRouterBå…±åŒç»„æˆäº†ä¸€ä¸ªè™šæ‹Ÿè·¯ç”±å™¨ã€‚ Masterè·¯ç”±å™¨ï¼ˆVirtual Router Masterï¼‰ï¼šæ‰¿æ‹…è½¬å‘æŠ¥æ–‡ä»»åŠ¡çš„VRRPè®¾å¤‡ï¼Œå¦‚RouterAã€‚ Backupè·¯ç”±å™¨ï¼ˆVirtual Router Backupï¼‰ï¼šä¸€ç»„æ²¡æœ‰æ‰¿æ‹…è½¬å‘ä»»åŠ¡çš„VRRPè®¾å¤‡ï¼Œå½“Masterè®¾å¤‡å‡ºç°æ•…éšœæ—¶ï¼Œå®ƒä»¬å°†é€šè¿‡ç«é€‰æˆä¸ºæ–°çš„Masterè®¾å¤‡ï¼Œå¦‚RouterBã€‚ VRIDï¼šè™šæ‹Ÿè·¯ç”±å™¨çš„æ ‡è¯†ã€‚å¦‚RouterAå’ŒRouterBç»„æˆçš„è™šæ‹Ÿè·¯ç”±å™¨çš„VRIDä¸º1ã€‚ è™šæ‹ŸIPåœ°å€(Virtual IP Address)ï¼šè™šæ‹Ÿè·¯ç”±å™¨çš„IPåœ°å€ï¼Œä¸€ä¸ªè™šæ‹Ÿè·¯ç”±å™¨å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªIPåœ°å€ï¼Œç”±ç”¨æˆ·é…ç½®ã€‚å¦‚RouterAå’ŒRouterBç»„æˆçš„è™šæ‹Ÿè·¯ç”±å™¨çš„è™šæ‹ŸIPåœ°å€ä¸º10.1.1.10&#x2F;24ã€‚ IPåœ°å€æ‹¥æœ‰è€…ï¼ˆIP Address Ownerï¼‰ï¼šå¦‚æœä¸€ä¸ªVRRPè®¾å¤‡å°†è™šæ‹Ÿè·¯ç”±å™¨IPåœ°å€ä½œä¸ºçœŸå®çš„æ¥å£åœ°å€ï¼Œåˆ™è¯¥è®¾å¤‡è¢«ç§°ä¸ºIPåœ°å€æ‹¥æœ‰è€…ã€‚å¦‚æœIPåœ°å€æ‹¥æœ‰è€…æ˜¯å¯ç”¨çš„ï¼Œé€šå¸¸å®ƒå°†æˆä¸ºMasterã€‚å¦‚RouterAï¼Œå…¶æ¥å£çš„IPåœ°å€ä¸è™šæ‹Ÿè·¯ç”±å™¨çš„IPåœ°å€ç›¸åŒï¼Œå‡ä¸º10.1.1.10&#x2F;24ï¼Œå› æ­¤å®ƒæ˜¯è¿™ä¸ªVRRPå¤‡ä»½ç»„çš„IPåœ°å€æ‹¥æœ‰è€…ã€‚ è™šæ‹ŸMACåœ°å€ï¼ˆVirtual MAC Addressï¼‰ï¼šè™šæ‹Ÿè·¯ç”±å™¨æ ¹æ®è™šæ‹Ÿè·¯ç”±å™¨IDç”Ÿæˆçš„MACåœ°å€ã€‚ä¸€ä¸ªè™šæ‹Ÿè·¯ç”±å™¨æ‹¥æœ‰ä¸€ä¸ªè™šæ‹ŸMACåœ°å€ï¼Œæ ¼å¼ä¸ºï¼š00-00-5E-00-01-{VRID}(VRRP for IPv4)ï¼›00-00-5E-00-02-{VRID}(VRRP for IPv6)ã€‚å½“è™šæ‹Ÿè·¯ç”±å™¨å›åº”ARPè¯·æ±‚æ—¶ï¼Œä½¿ç”¨è™šæ‹ŸMACåœ°å€ï¼Œè€Œä¸æ˜¯æ¥å£çš„çœŸå®MACåœ°å€ã€‚å¦‚RouterAå’ŒRouterBç»„æˆçš„è™šæ‹Ÿè·¯ç”±å™¨çš„VRIDä¸º1ï¼Œå› æ­¤è¿™ä¸ªVRRPå¤‡ä»½ç»„çš„MACåœ°å€ä¸º00-00-5E-00-01-01ã€‚ 0000-5e00-01xx å…¶ä¸­xxæ˜¯vrid æŠ¥æ–‡æ ¼å¼vrrpåªæœ‰ä¸€ç§æŠ¥æ–‡ï¼ŒAdvertisementæŠ¥æ–‡ï¼ŒåŸºäºç»„æ’­æ–¹å¼å‘é€ï¼Œç›®çš„ç»„æ’­åœ°å€ä¸º224.0.0.18ï¼Œipåè®®å·ï¼š112 æŠ¥æ–‡å­—æ®µ å«ä¹‰ VRRPv2 VRRPv3 Version VRRPåè®®ç‰ˆæœ¬å·ï¼Œå–å€¼ä¸º2ã€‚ VRRPåè®®ç‰ˆæœ¬å·ï¼Œå–å€¼ä¸º3ã€‚ Type VRRPé€šå‘ŠæŠ¥æ–‡çš„ç±»å‹ï¼Œå–å€¼ä¸º1ï¼Œè¡¨ç¤ºAdvertisementã€‚ VRRPé€šå‘ŠæŠ¥æ–‡çš„ç±»å‹ï¼Œå–å€¼ä¸º1ï¼Œè¡¨ç¤ºAdvertisementã€‚ Virtual Rtr IDï¼ˆVRIDï¼‰ è™šæ‹Ÿè·¯ç”±å™¨IDï¼Œå–å€¼èŒƒå›´æ˜¯1ï½255ã€‚ è™šæ‹Ÿè·¯ç”±å™¨IDï¼Œå–å€¼èŒƒå›´æ˜¯1ï½255ã€‚ Priority Masterè®¾å¤‡åœ¨å¤‡ä»½ç»„ä¸­çš„ä¼˜å…ˆçº§ï¼Œå–å€¼èŒƒå›´æ˜¯0ï½255ã€‚0è¡¨ç¤ºè®¾å¤‡åœæ­¢å‚ä¸VRRPå¤‡ä»½ç»„ï¼Œç”¨æ¥ä½¿å¤‡ä»½è®¾å¤‡å°½å¿«æˆä¸ºMasterè®¾å¤‡ï¼Œè€Œä¸å¿…ç­‰åˆ°è®¡æ—¶å™¨è¶…æ—¶ï¼›255åˆ™ä¿ç•™ç»™IPåœ°å€æ‹¥æœ‰è€…ã€‚ç¼ºçœå€¼æ˜¯100ã€‚ Masterè®¾å¤‡åœ¨å¤‡ä»½ç»„ä¸­çš„ä¼˜å…ˆçº§ï¼Œå–å€¼èŒƒå›´æ˜¯0ï½255ã€‚0è¡¨ç¤ºè®¾å¤‡åœæ­¢å‚ä¸VRRPå¤‡ä»½ç»„ï¼Œç”¨æ¥ä½¿å¤‡ä»½è®¾å¤‡å°½å¿«æˆä¸ºMasterè®¾å¤‡ï¼Œè€Œä¸å¿…ç­‰åˆ°è®¡æ—¶å™¨è¶…æ—¶ï¼›255åˆ™ä¿ç•™ç»™IPåœ°å€æ‹¥æœ‰è€…ã€‚ç¼ºçœå€¼æ˜¯100ã€‚ Count IP Addrs&#x2F;Count IPvX Addr å¤‡ä»½ç»„ä¸­è™šæ‹ŸIPv4åœ°å€çš„ä¸ªæ•°ã€‚ å¤‡ä»½ç»„ä¸­è™šæ‹ŸIPv4æˆ–è™šæ‹ŸIPv6åœ°å€çš„ä¸ªæ•°ã€‚ Auth Type VRRPæŠ¥æ–‡çš„è®¤è¯ç±»å‹ã€‚åè®®ä¸­æŒ‡å®šäº†3ç§ç±»å‹ï¼š0ï¼šNon Authenticationï¼Œè¡¨ç¤ºæ— è®¤è¯ã€‚1ï¼šSimple Text Passwordï¼Œè¡¨ç¤ºæ˜æ–‡è®¤è¯æ–¹å¼ã€‚2ï¼šIP Authentication Headerï¼Œè¡¨ç¤ºMD5è®¤è¯æ–¹å¼ã€‚ - Adver Int&#x2F;Max Adver Int VRRPé€šå‘ŠæŠ¥æ–‡çš„å‘é€æ—¶é—´é—´éš”ï¼Œå•ä½æ˜¯ç§’ï¼Œç¼ºçœå€¼ä¸º1ç§’ã€‚ VRRPé€šå‘ŠæŠ¥æ–‡çš„å‘é€æ—¶é—´é—´éš”ï¼Œå•ä½æ˜¯å˜ç§’ï¼Œç¼ºçœå€¼ä¸º100å˜ç§’ï¼ˆ1ç§’ï¼‰ã€‚ Checksum 16ä½æ ¡éªŒå’Œï¼Œç”¨äºæ£€æµ‹VRRPæŠ¥æ–‡ä¸­çš„æ•°æ®ç ´åæƒ…å†µã€‚ 16ä½æ ¡éªŒå’Œï¼Œç”¨äºæ£€æµ‹VRRPæŠ¥æ–‡ä¸­çš„æ•°æ®ç ´åæƒ…å†µã€‚ IP Address&#x2F;IPvX Address(es) VRRPå¤‡ä»½ç»„çš„è™šæ‹ŸIPv4åœ°å€ï¼Œæ‰€åŒ…å«çš„åœ°å€æ•°å®šä¹‰åœ¨Count IP Addrså­—æ®µã€‚ VRRPå¤‡ä»½ç»„çš„è™šæ‹ŸIPv4åœ°å€æˆ–è€…è™šæ‹ŸIPv6åœ°å€ï¼Œæ‰€åŒ…å«çš„åœ°å€æ•°å®šä¹‰åœ¨Count IPvX Addrså­—æ®µã€‚ Authentication Data VRRPæŠ¥æ–‡çš„è®¤è¯å­—ã€‚ç›®å‰åªæœ‰æ˜æ–‡è®¤è¯å’ŒMD5è®¤è¯æ‰ç”¨åˆ°è¯¥éƒ¨åˆ†ï¼Œå¯¹äºå…¶å®ƒè®¤è¯æ–¹å¼ï¼Œä¸€å¾‹å¡«0ã€‚ - rsvd - VRRPæŠ¥æ–‡çš„ä¿ç•™å­—æ®µï¼Œå¿…é¡»è®¾ç½®ä¸º0ã€‚ æ”¯æŒçš„ç½‘ç»œç±»å‹ä¸åŒã€‚VRRPv3é€‚ç”¨äºIPv4å’ŒIPv6ä¸¤ç§ç½‘ç»œï¼Œè€ŒVRRPv2ä»…é€‚ç”¨äºIPv4ç½‘ç»œã€‚ è®¤è¯åŠŸèƒ½ä¸åŒã€‚VRRPv3ä¸æ”¯æŒè®¤è¯åŠŸèƒ½ï¼Œè€ŒVRRPv2æ”¯æŒè®¤è¯åŠŸèƒ½ã€‚ å‘é€é€šå‘ŠæŠ¥æ–‡çš„æ—¶é—´é—´éš”çš„å•ä½ä¸åŒã€‚VRRPv3æ”¯æŒçš„æ˜¯å˜ç§’çº§ï¼Œè€ŒVRRPv2æ”¯æŒçš„æ˜¯ç§’çº§ã€‚ çŠ¶æ€æœº çŠ¶æ€ è¯´æ˜ Initialize è¯¥çŠ¶æ€ä¸ºVRRPä¸å¯ç”¨çŠ¶æ€ï¼Œåœ¨æ­¤çŠ¶æ€æ—¶è®¾å¤‡ä¸ä¼šå¯¹VRRPæŠ¥æ–‡åšä»»ä½•å¤„ç†ã€‚é€šå¸¸åˆšé…ç½®VRRPæ—¶æˆ–è®¾å¤‡æ£€æµ‹åˆ°æ•…éšœæ—¶ä¼šè¿›å…¥InitializeçŠ¶æ€ã€‚æ”¶åˆ°æ¥å£Upçš„æ¶ˆæ¯åï¼Œå¦‚æœè®¾å¤‡çš„ä¼˜å…ˆçº§ä¸º255ï¼Œåˆ™ç›´æ¥æˆä¸ºMasterè®¾å¤‡ï¼›å¦‚æœè®¾å¤‡çš„ä¼˜å…ˆçº§å°äº255ï¼Œåˆ™ä¼šå…ˆåˆ‡æ¢è‡³BackupçŠ¶æ€ã€‚ Master å½“VRRPè®¾å¤‡å¤„äºMasterçŠ¶æ€æ—¶ï¼Œå®ƒå°†ä¼šåšä¸‹åˆ—å·¥ä½œï¼šå®šæ—¶ï¼ˆAdvertisement Intervalï¼‰å‘é€VRRPé€šå‘ŠæŠ¥æ–‡ã€‚ä»¥è™šæ‹ŸMACåœ°å€å“åº”å¯¹è™šæ‹ŸIPåœ°å€çš„ARPè¯·æ±‚ã€‚è½¬å‘ç›®çš„MACåœ°å€ä¸ºè™šæ‹ŸMACåœ°å€çš„IPæŠ¥æ–‡ã€‚å¦‚æœå®ƒæ˜¯è¿™ä¸ªè™šæ‹ŸIPåœ°å€çš„æ‹¥æœ‰è€…ï¼Œåˆ™æ¥æ”¶ç›®çš„IPåœ°å€ä¸ºè¿™ä¸ªè™šæ‹ŸIPåœ°å€çš„IPæŠ¥æ–‡ã€‚å¦åˆ™ï¼Œä¸¢å¼ƒè¿™ä¸ªIPæŠ¥æ–‡ã€‚å¦‚æœæ”¶åˆ°æ¯”è‡ªå·±ä¼˜å…ˆçº§å¤§çš„æŠ¥æ–‡ï¼Œç«‹å³æˆä¸ºBackupã€‚å¦‚æœæ”¶åˆ°ä¸è‡ªå·±ä¼˜å…ˆçº§ç›¸ç­‰çš„VRRPæŠ¥æ–‡ä¸”æœ¬åœ°æ¥å£IPåœ°å€å°äºå¯¹ç«¯æ¥å£IPï¼Œç«‹å³æˆä¸ºBackupã€‚ Backup å½“VRRPè®¾å¤‡å¤„äºBackupçŠ¶æ€æ—¶ï¼Œå®ƒå°†ä¼šåšä¸‹åˆ—å·¥ä½œï¼šæ¥æ”¶Masterè®¾å¤‡å‘é€çš„VRRPé€šå‘ŠæŠ¥æ–‡ï¼Œåˆ¤æ–­Masterè®¾å¤‡çš„çŠ¶æ€æ˜¯å¦æ­£å¸¸ã€‚å¯¹è™šæ‹ŸIPåœ°å€çš„ARPè¯·æ±‚ï¼Œä¸åšå“åº”ã€‚ä¸¢å¼ƒç›®çš„IPåœ°å€ä¸ºè™šæ‹ŸIPåœ°å€çš„IPæŠ¥æ–‡ã€‚å¦‚æœæ”¶åˆ°ä¼˜å…ˆçº§å’Œè‡ªå·±ç›¸åŒæˆ–è€…æ¯”è‡ªå·±å¤§çš„æŠ¥æ–‡ï¼Œåˆ™é‡ç½®Master_Down_Intervalå®šæ—¶å™¨ï¼Œä¸è¿›ä¸€æ­¥æ¯”è¾ƒIPåœ°å€ã€‚Master_Down_Intervalå®šæ—¶å™¨ï¼šBackupè®¾å¤‡åœ¨è¯¥å®šæ—¶å™¨è¶…æ—¶åä»æœªæ”¶åˆ°é€šå‘ŠæŠ¥æ–‡ï¼Œåˆ™ä¼šè½¬æ¢ä¸ºMasterçŠ¶æ€ã€‚è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼šMaster_Down_Interval&#x3D;(3 Advertisement_Interval) + Skew_timeã€‚å…¶ä¸­ï¼ŒSkew_Time&#x3D;(256â€“Priority)&#x2F;256ã€‚*å¦‚æœæ”¶åˆ°æ¯”è‡ªå·±ä¼˜å…ˆçº§å°çš„æŠ¥æ–‡ä¸”è¯¥æŠ¥æ–‡ä¼˜å…ˆçº§æ˜¯0æ—¶ï¼Œå®šæ—¶å™¨æ—¶é—´è®¾ç½®ä¸ºSkew_timeï¼ˆåç§»æ—¶é—´ï¼‰ï¼Œå¦‚æœè¯¥æŠ¥æ–‡ä¼˜å…ˆçº§ä¸æ˜¯0ï¼Œä¸¢å¼ƒæŠ¥æ–‡ï¼Œç«‹åˆ»æˆä¸ºMasterã€‚ VRRPå·¥ä½œè¿‡ç¨‹ VRRPå¤‡ä»½ç»„ä¸­çš„è®¾å¤‡æ ¹æ®ä¼˜å…ˆçº§é€‰ä¸¾å‡ºMasterã€‚Masterè®¾å¤‡é€šè¿‡å‘é€å…è´¹ARPæŠ¥æ–‡ï¼Œå°†è™šæ‹ŸMACåœ°å€é€šçŸ¥ç»™ä¸å®ƒè¿æ¥çš„è®¾å¤‡æˆ–è€…ä¸»æœºï¼Œä»è€Œæ‰¿æ‹…æŠ¥æ–‡è½¬å‘ä»»åŠ¡ã€‚ Masterè®¾å¤‡å‘¨æœŸæ€§å‘å¤‡ä»½ç»„å†…æ‰€æœ‰Backupè®¾å¤‡å‘é€VRRPé€šå‘ŠæŠ¥æ–‡ï¼Œä»¥å…¬å¸ƒå…¶é…ç½®ä¿¡æ¯ï¼ˆä¼˜å…ˆçº§ç­‰ï¼‰å’Œå·¥ä½œçŠ¶å†µã€‚ å¦‚æœMasterè®¾å¤‡å‡ºç°æ•…éšœï¼ŒVRRPå¤‡ä»½ç»„ä¸­çš„Backupè®¾å¤‡å°†æ ¹æ®ä¼˜å…ˆçº§é‡æ–°é€‰ä¸¾æ–°çš„Masterã€‚ VRRPå¤‡ä»½ç»„çŠ¶æ€åˆ‡æ¢æ—¶ï¼ŒMasterè®¾å¤‡ç”±ä¸€å°è®¾å¤‡åˆ‡æ¢ä¸ºå¦å¤–ä¸€å°è®¾å¤‡ï¼Œæ–°çš„Masterè®¾å¤‡ä¼šç«‹å³å‘é€æºå¸¦è™šæ‹Ÿè·¯ç”±å™¨çš„è™šæ‹ŸMACåœ°å€å’Œè™šæ‹ŸIPåœ°å€ä¿¡æ¯çš„å…è´¹ARPæŠ¥æ–‡ï¼Œåˆ·æ–°ä¸å®ƒè¿æ¥çš„ä¸»æœºæˆ–è®¾å¤‡ä¸­çš„MACè¡¨é¡¹ï¼Œä»è€ŒæŠŠç”¨æˆ·æµé‡å¼•åˆ°æ–°çš„Masterè®¾å¤‡ä¸Šæ¥ï¼Œæ•´ä¸ªè¿‡ç¨‹å¯¹ç”¨æˆ·å®Œå…¨é€æ˜ã€‚ åŸMasterè®¾å¤‡æ•…éšœæ¢å¤æ—¶ï¼Œè‹¥è¯¥è®¾å¤‡ä¸ºIPåœ°å€æ‹¥æœ‰è€…ï¼ˆä¼˜å…ˆçº§ä¸º255ï¼‰ï¼Œå°†ç›´æ¥åˆ‡æ¢è‡³MasterçŠ¶æ€ã€‚è‹¥è¯¥è®¾å¤‡ä¼˜å…ˆçº§å°äº255ï¼Œå°†é¦–å…ˆåˆ‡æ¢è‡³BackupçŠ¶æ€ï¼Œä¸”å…¶ä¼˜å…ˆçº§æ¢å¤ä¸ºæ•…éšœå‰é…ç½®çš„ä¼˜å…ˆçº§ã€‚ Backupè®¾å¤‡çš„ä¼˜å…ˆçº§é«˜äºMasterè®¾å¤‡æ—¶ï¼Œç”±Backupè®¾å¤‡çš„å·¥ä½œæ–¹å¼ï¼ˆæŠ¢å æ–¹å¼å’ŒéæŠ¢å æ–¹å¼ï¼‰å†³å®šæ˜¯å¦é‡æ–°é€‰ä¸¾Masterã€‚ æŠ¢å æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰ï¼šåœ¨æŠ¢å æ¨¡å¼ä¸‹ï¼Œå¦‚æœBackupè®¾å¤‡çš„ä¼˜å…ˆçº§æ¯”å½“å‰Masterè®¾å¤‡çš„ä¼˜å…ˆçº§é«˜ï¼Œåˆ™ä¸»åŠ¨å°†è‡ªå·±åˆ‡æ¢æˆMasterã€‚ éæŠ¢å æ¨¡å¼ï¼šåœ¨éæŠ¢å æ¨¡å¼ä¸‹ï¼Œåªè¦Masterè®¾å¤‡æ²¡æœ‰å‡ºç°æ•…éšœï¼ŒBackupè®¾å¤‡å³ä½¿éšåè¢«é…ç½®äº†æ›´é«˜çš„ä¼˜å…ˆçº§ä¹Ÿä¸ä¼šæˆä¸ºMasterè®¾å¤‡ã€‚ ç”±æ­¤å¯è§ï¼Œä¸ºäº†ä¿è¯Masterè®¾å¤‡å’ŒBackupè®¾å¤‡èƒ½å¤Ÿåè°ƒå·¥ä½œï¼ŒVRRPéœ€è¦å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š Masterè®¾å¤‡çš„é€‰ä¸¾ã€‚ Masterè®¾å¤‡çŠ¶æ€çš„é€šå‘Šã€‚ ä¸‹é¢å°†ä»ä¸Šè¿°ä¸¤ä¸ªæ–¹é¢è¯¦ç»†ä»‹ç»VRRPçš„å·¥ä½œè¿‡ç¨‹ã€‚ Masterè®¾å¤‡çš„é€‰ä¸¾ VRRPæ ¹æ®ä¼˜å…ˆçº§æ¥ç¡®å®šè™šæ‹Ÿè·¯ç”±å™¨ä¸­æ¯å°è®¾å¤‡çš„è§’è‰²ï¼ˆMasterè®¾å¤‡æˆ–Backupè®¾å¤‡ï¼‰ã€‚ä¼˜å…ˆçº§è¶Šé«˜ï¼Œåˆ™è¶Šæœ‰å¯èƒ½æˆä¸ºMasterè®¾å¤‡ã€‚ åˆå§‹åˆ›å»ºçš„VRRPè®¾å¤‡å·¥ä½œåœ¨InitializeçŠ¶æ€ï¼Œæ”¶åˆ°æ¥å£Upçš„æ¶ˆæ¯åï¼Œå¦‚æœè®¾å¤‡çš„ä¼˜å…ˆçº§ä¸º255ï¼Œåˆ™ç›´æ¥æˆä¸ºMasterè®¾å¤‡ï¼›å¦‚æœè®¾å¤‡çš„ä¼˜å…ˆçº§å°äº255ï¼Œåˆ™ä¼šå…ˆåˆ‡æ¢è‡³BackupçŠ¶æ€ï¼Œå¾…Master_Down_Intervalå®šæ—¶å™¨è¶…æ—¶åå†åˆ‡æ¢è‡³MasterçŠ¶æ€ã€‚é¦–å…ˆåˆ‡æ¢è‡³MasterçŠ¶æ€çš„VRRPè®¾å¤‡é€šè¿‡VRRPé€šå‘ŠæŠ¥æ–‡çš„äº¤äº’è·çŸ¥è™šæ‹Ÿè®¾å¤‡ä¸­å…¶ä»–æˆå‘˜çš„ä¼˜å…ˆçº§ï¼Œè¿›è¡ŒMasterçš„é€‰ä¸¾ï¼š å¦‚æœVRRPæŠ¥æ–‡ä¸­Masterè®¾å¤‡çš„ä¼˜å…ˆçº§é«˜äºæˆ–ç­‰äºè‡ªå·±çš„ä¼˜å…ˆçº§ï¼Œåˆ™Backupè®¾å¤‡ä¿æŒBackupçŠ¶æ€ã€‚ å¦‚æœVRRPæŠ¥æ–‡ä¸­Masterè®¾å¤‡çš„ä¼˜å…ˆçº§ä½äºè‡ªå·±çš„ä¼˜å…ˆçº§ï¼Œé‡‡ç”¨æŠ¢å æ–¹å¼çš„Backupè®¾å¤‡å°†åˆ‡æ¢è‡³MasterçŠ¶æ€ï¼Œé‡‡ç”¨éæŠ¢å æ–¹å¼çš„Backupè®¾å¤‡ä»ä¿æŒBackupçŠ¶æ€ã€‚ å¦‚æœå¤šä¸ªVRRPè®¾å¤‡åŒæ—¶åˆ‡æ¢åˆ°MasterçŠ¶æ€ï¼Œé€šè¿‡VRRPé€šå‘ŠæŠ¥æ–‡çš„äº¤äº’è¿›è¡Œåå•†åï¼Œä¼˜å…ˆçº§è¾ƒä½çš„VRRPè®¾å¤‡å°†åˆ‡æ¢æˆBackupçŠ¶æ€ï¼Œä¼˜å…ˆçº§æœ€é«˜çš„VRRPè®¾å¤‡æˆä¸ºæœ€ç»ˆçš„Masterè®¾å¤‡ï¼›ä¼˜å…ˆçº§ç›¸åŒæ—¶ï¼ŒVRRPè®¾å¤‡ä¸ŠVRRPå¤‡ä»½ç»„æ‰€åœ¨æ¥å£ä¸»IPåœ°å€è¾ƒå¤§çš„æˆä¸ºMasterè®¾å¤‡ã€‚ å¦‚æœåˆ›å»ºçš„VRRPè®¾å¤‡ä¸ºIPåœ°å€æ‹¥æœ‰è€…ï¼Œæ”¶åˆ°æ¥å£Upçš„æ¶ˆæ¯åï¼Œå°†ä¼šç›´æ¥åˆ‡æ¢è‡³MasterçŠ¶æ€ã€‚ Masterè®¾å¤‡çŠ¶æ€çš„é€šå‘Š Masterè®¾å¤‡å‘¨æœŸæ€§åœ°å‘é€VRRPé€šå‘ŠæŠ¥æ–‡ï¼Œåœ¨VRRPå¤‡ä»½ç»„ä¸­å…¬å¸ƒå…¶é…ç½®ä¿¡æ¯ï¼ˆä¼˜å…ˆçº§ç­‰ï¼‰å’Œå·¥ä½œçŠ¶å†µã€‚Backupè®¾å¤‡é€šè¿‡æ¥æ”¶åˆ°VRRPæŠ¥æ–‡çš„æƒ…å†µæ¥åˆ¤æ–­Masterè®¾å¤‡æ˜¯å¦å·¥ä½œæ­£å¸¸ã€‚ å½“Masterè®¾å¤‡ä¸»åŠ¨æ”¾å¼ƒMasteråœ°ä½ï¼ˆå¦‚Masterè®¾å¤‡é€€å‡ºå¤‡ä»½ç»„ï¼‰æ—¶ï¼Œä¼šå‘é€ä¼˜å…ˆçº§ä¸º0çš„é€šå‘ŠæŠ¥æ–‡ï¼Œç”¨æ¥ä½¿Backupè®¾å¤‡å¿«é€Ÿåˆ‡æ¢æˆMasterè®¾å¤‡ï¼Œè€Œä¸ç”¨ç­‰åˆ°Master_Down_Intervalå®šæ—¶å™¨è¶…æ—¶ã€‚è¿™ä¸ªåˆ‡æ¢çš„æ—¶é—´ç§°ä¸ºSkew timeï¼Œè®¡ç®—æ–¹å¼ä¸ºï¼šï¼ˆ256ï¼Backupè®¾å¤‡çš„ä¼˜å…ˆçº§ï¼‰&#x2F;256ï¼Œå•ä½ä¸ºç§’ã€‚ å½“Masterè®¾å¤‡å‘ç”Ÿç½‘ç»œæ•…éšœè€Œä¸èƒ½å‘é€é€šå‘ŠæŠ¥æ–‡çš„æ—¶å€™ï¼ŒBackupè®¾å¤‡å¹¶ä¸èƒ½ç«‹å³çŸ¥é“å…¶å·¥ä½œçŠ¶å†µã€‚ç­‰åˆ°Master_Down_Intervalå®šæ—¶å™¨è¶…æ—¶åï¼Œæ‰ä¼šè®¤ä¸ºMasterè®¾å¤‡æ— æ³•æ­£å¸¸å·¥ä½œï¼Œä»è€Œå°†çŠ¶æ€åˆ‡æ¢ä¸ºMasterã€‚å…¶ä¸­ï¼ŒMaster_Down_Intervalå®šæ—¶å™¨å–å€¼ä¸ºï¼š3Ã—Advertisement_Intervalï¼‹Skew_timeï¼Œå•ä½ä¸ºç§’ã€‚ VRRPè´Ÿè½½åˆ†æ‹…è´Ÿè½½åˆ†æ‹…æ˜¯æŒ‡å¤šä¸ªVRRPå¤‡ä»½ç»„åŒæ—¶æ‰¿æ‹…ä¸šåŠ¡ï¼ŒVRRPè´Ÿè½½åˆ†æ‹…ä¸VRRPä¸»å¤‡å¤‡ä»½çš„åŸºæœ¬åŸç†å’ŒæŠ¥æ–‡åå•†è¿‡ç¨‹éƒ½æ˜¯ç›¸åŒçš„ã€‚åŒæ ·å¯¹äºæ¯ä¸€ä¸ªVRRPå¤‡ä»½ç»„ï¼Œéƒ½åŒ…å«ä¸€ä¸ªMasterè®¾å¤‡å’Œè‹¥å¹²Backupè®¾å¤‡ã€‚ä¸ä¸»å¤‡å¤‡ä»½æ–¹å¼ä¸åŒç‚¹åœ¨äºï¼šè´Ÿè½½åˆ†æ‹…æ–¹å¼éœ€è¦å»ºç«‹å¤šä¸ªVRRPå¤‡ä»½ç»„ï¼Œå„å¤‡ä»½ç»„çš„Masterè®¾å¤‡å¯ä»¥ä¸åŒï¼›åŒä¸€å°VRRPè®¾å¤‡å¯ä»¥åŠ å…¥å¤šä¸ªå¤‡ä»½ç»„ï¼Œåœ¨ä¸åŒçš„å¤‡ä»½ç»„ä¸­å…·æœ‰ä¸åŒçš„ä¼˜å…ˆçº§ã€‚ é…ç½®ä¸¤ä¸ªVRRPå¤‡ä»½ç»„ã€‚ VRRPå¤‡ä»½ç»„1ï¼šRouterAä¸ºMasterè®¾å¤‡ï¼ŒRouterBä¸ºBackupè®¾å¤‡ã€‚ VRRPå¤‡ä»½ç»„2ï¼šRouterBä¸ºMasterè®¾å¤‡ï¼ŒRouterAä¸ºBackupè®¾å¤‡ã€‚ ä¸€éƒ¨åˆ†ç”¨æˆ·å°†VRRPå¤‡ä»½ç»„1ä½œä¸ºç½‘å…³ï¼Œå¦ä¸€éƒ¨åˆ†ç”¨æˆ·å°†VRRPå¤‡ä»½ç»„2ä½œä¸ºç½‘å…³ã€‚è¿™æ ·æ—¢å¯å®ç°å¯¹ä¸šåŠ¡æµé‡çš„è´Ÿè½½åˆ†æ‹…ï¼ŒåŒæ—¶ï¼Œä¹Ÿèµ·åˆ°äº†ç›¸äº’å¤‡ä»½çš„ä½œç”¨ã€‚ VRRPç›‘è§†ä¸Šè¡Œç«¯å£ å‘½ä»¤ï¼šä¸Šè¡Œæ¥å£è§†å›¾ï¼Œvrrp vrid 1 track interface g 0&#x2F;0&#x2F;1 increased(æˆ–è€…reduced) 30ï¼ˆå¢åŠ æˆ–å‡å°‘ä¼˜å…ˆçº§ï¼‰ VRRPå¤‡ä»½ç»„åªèƒ½æ„ŸçŸ¥å…¶æ‰€åœ¨æ¥å£çŠ¶æ€çš„å˜åŒ–ï¼Œå½“VRRPè®¾å¤‡ä¸Šè¡Œæ¥å£æˆ–ç›´è¿é“¾è·¯å‘ç”Ÿæ•…éšœæ—¶ï¼ŒVRRPæ— æ³•æ„ŸçŸ¥ï¼Œæ­¤æ—¶ä¼šå¼•èµ·ä¸šåŠ¡æµé‡ä¸­æ–­ã€‚é€šè¿‡éƒ¨ç½²VRRPä¸æ¥å£çŠ¶æ€è”åŠ¨ç›‘è§†ä¸Šè¡Œæ¥å£å¯ä»¥æœ‰æ•ˆåœ°è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œå½“Masterè®¾å¤‡çš„ä¸Šè¡Œæ¥å£æˆ–ç›´è¿é“¾è·¯å‘ç”Ÿæ•…éšœæ—¶ï¼Œé€šè¿‡è°ƒæ•´è‡ªèº«ä¼˜å…ˆçº§ï¼Œè§¦å‘ä¸»å¤‡åˆ‡æ¢ï¼Œç¡®ä¿æµé‡æ­£å¸¸è½¬å‘ã€‚ VRRPå¯ä»¥é€šè¿‡Increasedå’ŒReducedæ–¹å¼æ¥ç›‘è§†æ¥å£çŠ¶æ€ï¼š å¦‚æœVRRPè®¾å¤‡ä¸Šé…ç½®ä»¥Increasedæ–¹å¼ç›‘è§†ä¸€ä¸ªæ¥å£ï¼Œå½“è¢«ç›‘è§†çš„æ¥å£çŠ¶æ€å˜æˆDownåï¼Œè¯¥VRRPè®¾å¤‡çš„ä¼˜å…ˆçº§å¢åŠ æŒ‡å®šå€¼ã€‚ å¦‚æœVRRPè®¾å¤‡ä¸Šé…ç½®ä»¥Reducedæ–¹å¼ç›‘è§†ä¸€ä¸ªæ¥å£ï¼Œå½“è¢«ç›‘è§†çš„æ¥å£çŠ¶æ€å˜ä¸ºDownåï¼Œè¯¥VRRPè®¾å¤‡çš„ä¼˜å…ˆçº§é™ä½æŒ‡å®šå€¼ã€‚","categories":[{"name":"åŸºç¡€çŸ¥è¯†","slug":"åŸºç¡€çŸ¥è¯†","permalink":"http://example.com/categories/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"}],"tags":[{"name":"VRRP","slug":"VRRP","permalink":"http://example.com/tags/VRRP/"}]},{"title":"SSH","slug":"SSH","date":"2024-05-22T08:34:38.000Z","updated":"2024-05-22T09:09:45.385Z","comments":true,"path":"2024/05/22/SSH/","permalink":"http://example.com/2024/05/22/SSH/","excerpt":"","text":"1.serveré…ç½®rsa[server]rsa local-key-pair create[server]dis rsa local-key-pair publicï¼ˆæŸ¥çœ‹ï¼‰2.å…¨å±€å¼€å¯stelnet[server]stelnet server enable3.vtyæ¥å£é…ç½®[server]user-interface vty 0 4 [server-ui-vty0-4]authentication-mode aaa [server-ui-vty0-4]protocol inbound ssh4.åˆ›å»ºç”¨æˆ·åå’Œå¯†ç [server]aaa[server-aaa]local-user client01 password cipher huawei123[server-aaa]local-user client01 service-type ssh [server-aaa]local-user client01 privilege level 3ï¼ˆåŒç†åˆ›å»ºclient02ï¼‰5.è®¾ç½®æœåŠ¡ç«¯å£å·[server]ssh server port 10256.å®¢æˆ·ç«¯ä¸Šåˆ›å»ºrsaæœ¬åœ°å¯†é’¥[client01]rsa local-key-pair create7.å°†å®¢æˆ·ç«¯å¯†é’¥å¤åˆ¶åˆ°æœåŠ¡å™¨[server]rsa peer-public-key client01[server-rsa-public-key]public-key-code beginEnter â€œRSA key codeâ€ view, return last view with â€œpublic-key-code endâ€.[server-rsa-key-code][server-rsa-key-code]3047[server-rsa-key-code] 0240[server-rsa-key-code] BB44D49F 0A455501 33FC2A58 9EA52FF3 7C3A29A5[server-rsa-key-code] 43A29D63 1D74F975 FAF91466 EF0D2222 A8AE038B[server-rsa-key-code] 2DAA1CE0 5F22B5D9 F6D0F2F0 EB0747B9 4D916AE1[server-rsa-key-code] 5B83DE2D[server-rsa-key-code] 0203[server-rsa-key-code] 010001 [server-rsa-key-code]public-key-code end[server-rsa-public-key]peer-public-key end [server]ssh user client01 assign rsa-key client018.å®¢æˆ·ç«¯ä¸Šå¼€å¯SSHé¦–æ¬¡ç™»å½•éªŒè¯[client01]ssh client first-time enable [client01]stelnet 2.2.2.2 1025ï¼ˆç™»å½•ï¼‰","categories":[{"name":"ipå®éªŒ","slug":"ipå®éªŒ","permalink":"http://example.com/categories/ip%E5%AE%9E%E9%AA%8C/"}],"tags":[{"name":"SSH","slug":"SSH","permalink":"http://example.com/tags/SSH/"}]},{"title":"BGPæ€»ç»“","slug":"BGPæ€»ç»“","date":"2024-05-11T05:13:37.000Z","updated":"2024-07-24T15:02:23.309Z","comments":true,"path":"2024/05/11/BGPæ€»ç»“/","permalink":"http://example.com/2024/05/11/BGP%E6%80%BB%E7%BB%93/","excerpt":"","text":"BGPä½¿ç”¨TCPä½œä¸ºå…¶ä¼ è¾“å±‚åè®®ï¼ˆç«¯å£å·ä¸º179ï¼‰ï¼Œä½¿ç”¨è§¦å‘å¼è·¯ç”±æ›´æ–°ï¼Œè€Œä¸æ˜¯å‘¨æœŸæ€§è·¯ç”±æ›´æ–°ã€‚â€”BGPè¦æƒ³å»ºç«‹é‚»å±…å…³ç³»ï¼Œå¿…é¡»ä¿è¯å»ºç«‹é‚»å±…å…³ç³»çš„ä¸¤ç«¯èƒ½å¤Ÿpingé€š BGPèƒ½å¤Ÿæ‰¿è½½å¤§æ‰¹é‡çš„è·¯ç”±ä¿¡æ¯ï¼Œèƒ½å¤Ÿæ”¯æ’‘å¤§è§„æ¨¡ç½‘ç»œã€‚ BGPæä¾›äº†ä¸°å¯Œçš„è·¯ç”±ç­–ç•¥ï¼Œèƒ½å¤Ÿçµæ´»çš„è¿›è¡Œè·¯ç”±é€‰è·¯ï¼Œå¹¶èƒ½æŒ‡å¯¼å¯¹ç­‰ä½“æŒ‰ç­–ç•¥å‘å¸ƒè·¯ç”±ã€‚ BGPèƒ½å¤Ÿæ”¯æ’‘MPLS/VPNçš„åº”ç”¨ï¼Œä¼ é€’å®¢æˆ·VPNè·¯ç”±ã€‚ BGPæä¾›äº†è·¯ç”±èšåˆå’Œè·¯ç”±è¡°å‡åŠŸèƒ½ç”¨äºé˜²æ­¢è·¯ç”±æŒ¯è¡ï¼Œé€šè¿‡è¿™ä¸¤é¡¹åŠŸèƒ½æœ‰æ•ˆåœ°æé«˜äº†ç½‘ç»œç¨³å®šæ€§ã€‚ ASèŒƒå›´ï¼š1-65535 BGPç‰ˆæœ¬ï¼šBGP4+ ä¸€å°è·¯ç”±å™¨ä¸èƒ½é…ç½®å¤šä¸ªBGPè¿›ç¨‹ åªä¼ é€’è·¯ç”±ä¿¡æ¯ï¼Œä¸ä¼šæš´éœ²ASå†…æ‹“æ‰‘ä¿¡æ¯ BGPå¯¹ç­‰ä½“ EBGPï¼šå¯¹ç­‰ä½“ä¸¤ç«¯å±äºä¸åŒçš„AS IBGPï¼šå¯¹ç­‰ä½“ä¸¤ç«¯å±äºåŒä¸€ä¸ªAS å»ºç«‹BGPå¯¹ç­‰ä½“çš„æ—¶å€™å¯ä»¥ä½¿ç”¨ç‰©ç†æ¥å£å»ºç«‹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨loopbackæ¥å£å»ºç«‹ EBGPå¯¹ç­‰ä½“ï¼šå»ºè®®ä½¿ç”¨ç‰©ç†æ¥å£å»ºç«‹ â‘ ä½¿ç”¨ç‰©ç†æ¥å£å»ºç«‹ï¼š [AR1]bgp 100 [AR1-bgp]router-id 1.1.1.1 [AR1-bgp]peer 10.0.12.2 as-number 200 â‘¡ä½¿ç”¨loopbackæ¥å£å»ºç«‹ï¼š [Ar4]bgp 200 [Ar4-bgp]peer 5.5.5.5 as-number 300 [Ar4-bgp]peer 5.5.5.5 connect-interface loopback0 å¦‚æœä½¿ç”¨loopbackæ¥å£å»ºç«‹å¯¹ç­‰ä½“ï¼Œå¿…é¡»è¦æŒ‡æ˜å»ºç«‹å¯¹ç­‰ä½“çš„æ¥å£ [Ar4-bgp]router-id 4.4.4.4 æŒ‡å®šrouter id [Ar4-bgp]peer 5.5.5.5 ebgp-max-hop EBGPå»ºç«‹å¯¹ç­‰ä½“å…³ç³»é»˜è®¤å‘å‡ºæŠ¥æ–‡TTLå€¼ä¸º1ï¼Œå¦‚æœç”¨loopbackæ¥å£å»ºç«‹ï¼Œåˆ°è¾¾loopbackæ¥å£TTLå€¼å˜æˆ0ï¼Œæ­¤æ—¶æŠ¥æ–‡ä¼šä¸¢å¼ƒï¼Œæ‰€ä»¥éœ€è¦æ›´æ”¹æ¥å£çš„TTLï¼Œpeer 5.5.5.5 ebgp-max-hopå‘½ä»¤å¯ä»¥ç›´æ¥è®¾ç½®TTLï¼Œè‡³å°‘è®¾ç½®ä¸º2ï¼Œå¦‚æœä¸è®¾ç½®ï¼Œæ­¤æ—¶TTLå€¼ä¸º255 IBGPå¯¹ç­‰ä½“ï¼šå»ºè®®ä½¿ç”¨loopbackæ¥å£å»ºç«‹ï¼ˆæ›´ç¨³å®šï¼‰ IBGPå»ºç«‹å¯¹ç­‰ä½“å…³ç³»ï¼Œå‘é€æŠ¥æ–‡TTLå€¼ä¸º255ï¼Œæ‰€ä»¥ä¸ç”¨è€ƒè™‘TTLä¸å¯è¾¾é—®é¢˜ â‘ ä½¿ç”¨loopbackæ¥å£å»ºç«‹ï¼š [Ar4]bgp 200 [Ar4-bgp]peer 2.2.2.2 as-number 200 [Ar4-bgp]peer 2.2.2.2 connect-interface loopback0 â‘¡ä½¿ç”¨ç‰©ç†æ¥å£å»ºç«‹ï¼š [Ar4]bgp 200 [Ar4-bgp]peer 10.0.34.4 as-number 200 BGPå¯¹ç­‰ä½“å…³ç³»å»ºç«‹ æŠ¥æ–‡å¤´éƒ¨ Openæ¶ˆæ¯ï¼šæ˜¯TCPè¿æ¥å»ºç«‹åå‘é€çš„ç¬¬ä¸€ä¸ªæ¶ˆæ¯ï¼Œç”¨äºå»ºç«‹BGPå¯¹ç­‰ä½“ä¹‹é—´çš„è¿æ¥å…³ç³»ã€‚å¯¹ç­‰ä½“åœ¨æ¥æ”¶åˆ°Openæ¶ˆæ¯å¹¶åå•†æˆåŠŸåï¼Œå°†å‘é€Keepaliveæ¶ˆæ¯ç¡®è®¤å¹¶ä¿æŒè¿æ¥çš„æœ‰æ•ˆæ€§ã€‚ç¡®è®¤åï¼Œå¯¹ç­‰ä½“é—´å¯ä»¥è¿›è¡ŒUpdateã€Notificationã€Keepaliveå’ŒRoute-refreshæ¶ˆæ¯çš„äº¤æ¢ã€‚ Updateæ¶ˆæ¯ï¼šç”¨äºåœ¨å¯¹ç­‰ä½“ä¹‹é—´äº¤æ¢è·¯ç”±ä¿¡æ¯ã€‚Updateæ¶ˆæ¯å¯ä»¥å‘å¸ƒå¤šæ¡å±æ€§ç›¸åŒçš„å¯è¾¾è·¯ç”±ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥æ’¤é”€å¤šæ¡ä¸å¯è¾¾è·¯ç”±ä¿¡æ¯ã€‚ ä¸€æ¡Updateæ¶ˆæ¯å¯ä»¥å‘å¸ƒå¤šæ¡å…·æœ‰ç›¸åŒè·¯ç”±å±æ€§çš„å¯è¾¾è·¯ç”±ï¼Œè¿™äº›è·¯ç”±å¯å…±äº«ä¸€ç»„è·¯ç”±å±æ€§ã€‚æ‰€æœ‰åŒ…å«åœ¨ä¸€ä¸ªç»™å®šçš„Updateæ¶ˆæ¯é‡Œçš„è·¯ç”±å±æ€§é€‚ç”¨äºè¯¥Updateæ¶ˆæ¯ä¸­çš„NLRIï¼ˆNetwork Layer Reachability Informationï¼‰å­—æ®µé‡Œçš„æ‰€æœ‰ç›®çš„åœ°ï¼ˆç”¨IPå‰ç¼€è¡¨ç¤ºï¼‰ã€‚ ä¸€æ¡Updateæ¶ˆæ¯å¯ä»¥æ’¤é”€å¤šæ¡ä¸å¯è¾¾è·¯ç”±ã€‚æ¯ä¸€ä¸ªè·¯ç”±é€šè¿‡ç›®çš„åœ°ï¼ˆç”¨IPå‰ç¼€è¡¨ç¤ºï¼‰æ¸…æ¥šçš„å®šä¹‰äº†BGP Speakerä¹‹é—´å…ˆå‰é€šå‘Šè¿‡çš„è·¯ç”±ã€‚ ä¸€æ¡Updateæ¶ˆæ¯å¯ä»¥åŒæ—¶å‘å¸ƒå¯è¾¾è·¯ç”±ï¼Œå¹¶ä¸”æ’¤é”€å¦ä¸€éƒ¨åˆ†ä¸å¯è¾¾è·¯ç”±ã€‚ä¸€æ¡Updateæ¶ˆæ¯ä¹Ÿå¯ä»¥åªç”¨äºæ’¤é”€è·¯ç”±ï¼Œè¿™æ ·å°±ä¸éœ€è¦åŒ…æ‹¬è·¯å¾„å±æ€§æˆ–è€…NLRIã€‚ç›¸åï¼Œä¹Ÿå¯ä»¥åªç”¨äºé€šå‘Šå¯è¾¾è·¯ç”±ï¼Œå°±ä¸éœ€è¦æºå¸¦æ’¤é”€è·¯ç”±ä¿¡æ¯äº†ã€‚ Notificationæ¶ˆæ¯ï¼šå½“BGPæ£€æµ‹åˆ°é”™è¯¯çŠ¶æ€æ—¶ï¼Œå°±å‘å¯¹ç­‰ä½“å‘å‡ºNotificationæ¶ˆæ¯ï¼Œä¹‹åBGPè¿æ¥ä¼šç«‹å³ä¸­æ–­ã€‚ Keepaliveæ¶ˆæ¯ï¼šBGPä¼šå‘¨æœŸæ€§çš„å‘å¯¹ç­‰ä½“å‘å‡ºKeepaliveæ¶ˆæ¯ï¼Œç”¨æ¥ä¿æŒè¿æ¥çš„æœ‰æ•ˆæ€§ã€‚ç¼ºçœæƒ…å†µä¸‹ï¼Œé—´éš”60sï¼Œä¿æŒ180s Route-refreshæ¶ˆæ¯ï¼šRoute-refreshæ¶ˆæ¯ç”¨æ¥è¯·æ±‚å¯¹ç­‰ä½“é‡æ–°å‘é€æ‰€æœ‰çš„å¯è¾¾è·¯ç”±ä¿¡æ¯ã€‚ åœ¨æ‰€æœ‰BGPè®¾å¤‡ä½¿èƒ½Route-refreshèƒ½åŠ›çš„æƒ…å†µä¸‹ï¼Œå¦‚æœBGPçš„å…¥å£è·¯ç”±ç­–ç•¥å‘ç”Ÿäº†å˜åŒ–ï¼Œæœ¬åœ°BGPè®¾å¤‡ä¼šå‘å¯¹ç­‰ä½“å‘å¸ƒRoute-refreshæ¶ˆæ¯ï¼Œæ”¶åˆ°æ­¤æ¶ˆæ¯çš„å¯¹ç­‰ä½“ä¼šå°†å…¶è·¯ç”±ä¿¡æ¯é‡æ–°å‘ç»™æœ¬åœ°BGPè®¾å¤‡ã€‚è¿™æ ·ï¼Œå¯ä»¥åœ¨ä¸ä¸­æ–­BGPè¿æ¥çš„æƒ…å†µä¸‹ï¼Œå¯¹BGPè·¯ç”±è¡¨è¿›è¡ŒåŠ¨æ€åˆ·æ–°ï¼Œå¹¶åº”ç”¨æ–°çš„è·¯ç”±ç­–ç•¥ã€‚ BGPçŠ¶æ€æœº IdleçŠ¶æ€æ˜¯BGPåˆå§‹çŠ¶æ€ã€‚åœ¨IdleçŠ¶æ€ä¸‹ï¼ŒBGPæ‹’ç»é‚»å±…å‘é€çš„è¿æ¥è¯·æ±‚ã€‚åªæœ‰åœ¨æ”¶åˆ°æœ¬è®¾å¤‡çš„Startäº‹ä»¶åï¼ŒBGPæ‰å¼€å§‹å°è¯•å’Œå…¶ä»–BGPå¯¹ç­‰ä½“è¿›è¡ŒTCPè¿æ¥ï¼Œå¹¶è½¬è‡³ConnectçŠ¶æ€ã€‚ æ³¨æ„ï¼š Startäº‹ä»¶æ˜¯ç”±ä¸€ä¸ªæ“ä½œè€…é…ç½®ä¸€ä¸ªBGPè¿›ç¨‹ï¼Œæˆ–è€…é‡ç½®ä¸€ä¸ªå·²ç»å­˜åœ¨çš„è¿›ç¨‹æˆ–è€…è®¾å¤‡è½¯ä»¶é‡ç½®BGPè¿›ç¨‹å¼•èµ·çš„ã€‚ ä»»ä½•çŠ¶æ€ä¸­æ”¶åˆ°NotificationæŠ¥æ–‡æˆ–TCPæ‹†é“¾é€šçŸ¥ç­‰Erroräº‹ä»¶åï¼ŒBGPéƒ½ä¼šè½¬è‡³IdleçŠ¶æ€ã€‚ åœ¨ConnectçŠ¶æ€ä¸‹ï¼ŒBGPå¯åŠ¨è¿æ¥é‡ä¼ å®šæ—¶å™¨ï¼ˆConnect Retryï¼‰ï¼Œç­‰å¾…TCPå®Œæˆè¿æ¥ã€‚ å¦‚æœTCPè¿æ¥æˆåŠŸï¼Œé‚£ä¹ˆBGPå‘å¯¹ç­‰ä½“å‘é€OpenæŠ¥æ–‡ï¼Œå¹¶è½¬è‡³OpenSentçŠ¶æ€ã€‚ å¦‚æœTCPè¿æ¥å¤±è´¥ï¼Œé‚£ä¹ˆBGPè½¬è‡³ActiveçŠ¶æ€ã€‚ å¦‚æœè¿æ¥é‡ä¼ å®šæ—¶å™¨è¶…æ—¶ï¼ŒBGPä»æ²¡æœ‰æ”¶åˆ°BGPå¯¹ç­‰ä½“çš„å“åº”ï¼Œé‚£ä¹ˆBGPç»§ç»­å°è¯•å’Œå¯¹ç­‰ä½“è¿›è¡ŒTCPè¿æ¥ï¼Œåœç•™åœ¨ConnectçŠ¶æ€ã€‚ åœ¨ActiveçŠ¶æ€ä¸‹ï¼ŒBGPæ€»æ˜¯åœ¨è¯•å›¾å»ºç«‹TCPè¿æ¥ã€‚ å¦‚æœTCPè¿æ¥æˆåŠŸï¼Œé‚£ä¹ˆBGPå‘å¯¹ç­‰ä½“å‘é€OpenæŠ¥æ–‡ï¼Œå…³é—­è¿æ¥é‡ä¼ å®šæ—¶å™¨ï¼Œå¹¶è½¬è‡³OpenSentçŠ¶æ€ã€‚ å¦‚æœTCPè¿æ¥å¤±è´¥ï¼Œé‚£ä¹ˆBGPåœç•™åœ¨ActiveçŠ¶æ€ã€‚ å¦‚æœè¿æ¥é‡ä¼ å®šæ—¶å™¨è¶…æ—¶ï¼ŒBGPä»æ²¡æœ‰æ”¶åˆ°BGPå¯¹ç­‰ä½“çš„å“åº”ï¼Œé‚£ä¹ˆBGPè½¬è‡³ConnectçŠ¶æ€ã€‚ åœ¨OpenSentçŠ¶æ€ä¸‹ï¼ŒBGPç­‰å¾…å¯¹ç­‰ä½“çš„OpenæŠ¥æ–‡ï¼Œå¹¶å¯¹æ”¶åˆ°çš„OpenæŠ¥æ–‡ä¸­çš„ASå·ã€ç‰ˆæœ¬å·ã€è®¤è¯ç ç­‰è¿›è¡Œæ£€æŸ¥ã€‚ å¦‚æœæ”¶åˆ°çš„OpenæŠ¥æ–‡æ­£ç¡®ï¼Œé‚£ä¹ˆBGPå‘é€KeepaliveæŠ¥æ–‡ï¼Œå¹¶è½¬è‡³OpenConfirmçŠ¶æ€ã€‚ å¦‚æœå‘ç°æ”¶åˆ°çš„OpenæŠ¥æ–‡æœ‰é”™è¯¯ï¼Œé‚£ä¹ˆBGPå‘é€NotificationæŠ¥æ–‡ç»™å¯¹ç­‰ä½“ï¼Œå¹¶è½¬è‡³IdleçŠ¶æ€ã€‚ åœ¨OpenConfirmçŠ¶æ€ä¸‹ï¼ŒBGPç­‰å¾…Keepaliveæˆ–NotificationæŠ¥æ–‡ã€‚å¦‚æœæ”¶åˆ°KeepaliveæŠ¥æ–‡ï¼Œåˆ™è½¬è‡³EstablishedçŠ¶æ€ï¼Œå¦‚æœæ”¶åˆ°NotificationæŠ¥æ–‡ï¼Œåˆ™è½¬è‡³IdleçŠ¶æ€ã€‚ åœ¨EstablishedçŠ¶æ€ä¸‹ï¼ŒBGPå¯ä»¥å’Œå¯¹ç­‰ä½“äº¤æ¢Updateã€Keepaliveã€Route-refreshæŠ¥æ–‡å’ŒNotificationæŠ¥æ–‡ã€‚ å¦‚æœæ”¶åˆ°æ­£ç¡®çš„Updateæˆ–KeepaliveæŠ¥æ–‡ï¼Œé‚£ä¹ˆBGPå°±è®¤ä¸ºå¯¹ç«¯å¤„äºæ­£å¸¸è¿è¡ŒçŠ¶æ€ï¼Œå°†ä¿æŒBGPè¿æ¥ã€‚ å¦‚æœæ”¶åˆ°é”™è¯¯çš„Updateæˆ–KeepaliveæŠ¥æ–‡ï¼Œé‚£ä¹ˆBGPå‘é€NotificationæŠ¥æ–‡é€šçŸ¥å¯¹ç«¯ï¼Œå¹¶è½¬è‡³IdleçŠ¶æ€ã€‚ Route-refreshæŠ¥æ–‡ä¸ä¼šæ”¹å˜BGPçŠ¶æ€ã€‚ å¦‚æœæ”¶åˆ°NotificationæŠ¥æ–‡ï¼Œé‚£ä¹ˆBGPè½¬è‡³IdleçŠ¶æ€ã€‚ å¦‚æœæ”¶åˆ°TCPæ‹†é“¾é€šçŸ¥ï¼Œé‚£ä¹ˆBGPæ–­å¼€è¿æ¥ï¼Œè½¬è‡³IdleçŠ¶æ€ã€‚ BGPå¯¹ç­‰ä½“åŒæ–¹çš„çŠ¶æ€å¿…é¡»éƒ½ä¸ºEstablishedï¼ŒBGPå¯¹ç­‰ä½“ï¼ˆä¹Ÿå¯ä»¥ç§°ä¸ºBGPé‚»å±…ï¼‰å…³ç³»æ‰èƒ½æˆç«‹ï¼ŒåŒæ–¹é€šè¿‡UpdateæŠ¥æ–‡äº¤æ¢è·¯ç”±ä¿¡æ¯ã€‚ BGPè·¯ç”±çš„ç”Ÿæˆ 1ï¼‰networkï¼šé€æ¡åœ¨BGPåè®®ä¸­æ³¨å…¥è·¯ç”±ï¼ˆå…¶ä¸­originå±æ€§ä½â€œiâ€ï¼‰ æ³¨æ„ï¼šnetworkæ³¨å…¥çš„è·¯ç”±å¿…é¡»æ˜¯è·¯ç”±å™¨çš„è·¯ç”±è¡¨å­˜åœ¨çš„è·¯ç”± 2ï¼‰import-routeï¼šå°†æŸä¸ªåè®®çš„è·¯ç”±å¼•å…¥åˆ°è·¯ç”±è¡¨ä¸­ï¼Œç›´è¿è·¯ç”±ã€é™æ€è·¯ç”±ã€OSPFè·¯ç”±ã€IS-ISè·¯ç”±ç­‰ï¼ˆoriginå±æ€§ä½â€œincompleteâ€ï¼‰ 3ï¼‰è·¯ç”±èšåˆ bgp 200 aggregate 10.1.0.0 22 detail-suppressed ï¼ˆdetail-suppressedï¼šBGPåªä¼šå‘å¯¹ç­‰ä½“é€šå‘Šèšåˆåçš„è·¯ç”±ï¼Œè€Œä¸é€šå‘Šèšåˆå‰çš„æ˜ç»†è·¯ç”±ï¼‰ è‡ªåŠ¨èšåˆï¼šsummary automatic è‡ªåŠ¨èšåˆï¼šå¯¹BGPå¼•å…¥çš„è·¯ç”±è¿›è¡Œèšåˆã€‚é…ç½®è‡ªåŠ¨èšåˆåï¼Œå¯¹å‚åŠ èšåˆçš„å…·ä½“è·¯ç”±è¿›è¡ŒæŠ‘åˆ¶ã€‚é…ç½®è‡ªåŠ¨èšåˆåï¼ŒBGPå°†æŒ‰ç…§è‡ªç„¶ç½‘æ®µèšåˆè·¯ç”±ï¼ˆå¦‚10.1.1.1/24å’Œ10.2.1.1/24å°†èšåˆä¸ºAç±»åœ°å€10.0.0.0/8ï¼‰ï¼Œå¹¶ä¸”BGPå‘å¯¹ç­‰ä½“åªå‘é€èšåˆåçš„è·¯ç”±ã€‚ ï¼ˆè‡ªåŠ¨èšåˆåªèƒ½èšåˆimportå¼•å…¥çš„è·¯ç”±ï¼‰ ä¼˜å…ˆçº§ï¼šæ‰‹åŠ¨ï¼è‡ªåŠ¨ï¼networkï¼importï¼ä»å¯¹ç­‰ä½“å­¦åˆ° BGPå¯¹ç­‰ä½“é€šå‘ŠåŸåˆ™ åªå‘å¸ƒæœ€ä¼˜è·¯ç”±â€”ä¸‹ä¸€è·³å¯è¾¾ã€æœ€ä¼˜è·¯ç”± ä»EBGPå¯¹ç­‰ä½“è·å–çš„è·¯ç”±ï¼Œä¼šå‘å¸ƒç»™æ‰€æœ‰å¯¹ç­‰ä½“ã€‚ IBGPæ°´å¹³åˆ†å‰²ï¼šä»IBGPå¯¹ç­‰ä½“è·å–çš„è·¯ç”±ï¼Œä¸ä¼šå‘é€ç»™IBGPå¯¹ç­‰ä½“ã€‚ BGPåŒæ­¥è§„åˆ™æŒ‡çš„æ˜¯ï¼šå½“ä¸€å°è·¯ç”±å™¨ä»è‡ªå·±çš„IBGPå¯¹ç­‰ä½“å­¦ä¹ åˆ°ä¸€æ¡BGPè·¯ç”±æ—¶ï¼ˆè¿™ç±»è·¯ç”±è¢«ç§°ä¸ºIBGPè·¯ç”±ï¼‰ï¼Œå®ƒå°†ä¸èƒ½ä½¿ç”¨è¯¥æ¡è·¯ç”±æˆ–æŠŠè¿™æ¡è·¯ç”±é€šå‘Šç»™è‡ªå·±çš„EBGPå¯¹ç­‰ä½“ï¼Œé™¤éå®ƒåˆä»IGPåè®®ï¼ˆä¾‹å¦‚OSPFç­‰ï¼Œæ­¤å¤„ä¹ŸåŒ…å«é™æ€è·¯ç”±ï¼‰å­¦ä¹ åˆ°è¿™æ¡è·¯ç”±ï¼Œä¹Ÿå°±æ˜¯è¦æ±‚IBGPè·¯ç”±ä¸IGPè·¯ç”±åŒæ­¥ã€‚åŒæ­¥è§„åˆ™ä¸»è¦ç”¨äºè§„é¿BGPè·¯ç”±é»‘æ´é—®é¢˜ã€‚ è·¯ç”±é»‘æ´ï¼šè§£å†³åŠæ³•ï¼š â‘ BGPâ€“IGPäº’ç›¸å¼•å…¥ è¯¥æ–¹æ³•ä¸å»ºè®® â‘¡IBGPå…¨äº’è” â‘¢MPLS BGPå±æ€§ AS_pathå±æ€§ï¼š è¯¥å±æ€§ä¸ºå…¬è®¤å¿…éµå±æ€§ï¼Œæ˜¯å‰å¾€ç›®æ ‡ç½‘ç»œçš„è·¯ç”±ç»è¿‡çš„ASå·åˆ—è¡¨ï¼› ä½œç”¨ï¼šç¡®ä¿è·¯ç”±åœ¨EBGPå¯¹ç­‰ä½“ä¹‹é—´ä¼ é€’æ— ç¯ï¼›å¦å¤–ä¹Ÿä½œä¸ºè·¯ç”±ä¼˜é€‰çš„è¡¡é‡æ ‡å‡†ä¹‹ä¸€ï¼› è·¯ç”±åœ¨è¢«é€šå‘Šç»™EBGPå¯¹ç­‰ä½“æ—¶ï¼Œè·¯ç”±å™¨ä¼šåœ¨è¯¥è·¯ç”±çš„AS_Pathä¸­è¿½åŠ ä¸Šæœ¬åœ°çš„ASå·ï¼›è·¯ç”±è¢«é€šå‘Šç»™IBGPå¯¹ç­‰ä½“æ—¶ï¼ŒAS_Pathä¸ä¼šå‘ç”Ÿæ”¹å˜ã€‚ AS_pathé˜²ç¯æœºåˆ¶ï¼šè·¯ç”±æ¯ç»è¿‡ä¸€ä¸ªASå°±ä¼šåœ¨AS_pathä¸­è®°å½•ç»è¿‡çš„AS å·ï¼Œå½“è·¯ç”±å™¨æ”¶åˆ°updateæŠ¥æ–‡ï¼Œæ£€æŸ¥å‘ç°AS_pathä¸­å«æœ‰æœ¬ASå·ï¼Œä¸æ¥æ”¶è¯¥è·¯ç”±ï¼Œä»è€Œé˜²æ­¢äº†è·¯ç”±ç¯è·¯çš„äº§ç”Ÿã€‚ AS_pathå½±å“è·¯ç”±ä¼˜é€‰ï¼šæ”¶åˆ°åŒä¸€ä¸ªç½‘æ®µå¤šæ¡è·¯ï¼Œæ¯”è¾ƒAS_pathå±æ€§ï¼Œå“ªæ¡è·¯ç”±çš„AS_Pathå±æ€§å€¼è¾ƒçŸ­ï¼Œä¹Ÿå³ASå·çš„ä¸ªæ•°æ›´å°‘ï¼Œå°±ä¼˜é€‰å“ªæ¡è·¯ç”±ã€‚ AS-PATHç±»å‹ï¼š AS_SEQENCEï¼šASåœ¨ä¼ é€’æ—¶æ˜¯æœ‰åºçš„ï¼Œé»˜è®¤å°±æ˜¯è¯¥ç±»å‹ AS_SETï¼šæ— åºçš„ï¼Œåœ¨åšè·¯ç”±èšåˆæ—¶å¯ä»¥ä½¿ç”¨è¯¥ç±»å‹ã€‚è·¯ç”±èšåˆè§£å†³äº†ä¸¤ç±»é—®é¢˜ï¼Œä¸€æ˜¯å‡è½»äº†è®¾å¤‡çš„è´Ÿæ‹…ï¼ŒäºŒæ˜¯éšè—äº†æ˜ç»†çš„è·¯ç”±ä¿¡æ¯ï¼Œå‡å°‘äº†è·¯ç”±éœ‡è¡çš„å½±å“ã€‚ä½†æ˜¯è·¯ç”±èšåˆåï¼ŒAS_Pathå±æ€§ä¸¢å¤±ï¼Œå­˜åœ¨äº§ç”Ÿç¯è·¯çš„é£é™©ï¼Œä¸ºæ­¤å¯ä»¥é€šè¿‡AS_SETç±»å‹çš„AS_Pathå±æ€§æºå¸¦èšåˆå‰çš„ASè·¯å¾„ä¿¡æ¯ã€‚ ä¿®æ”¹AS_pathï¼š åœ¨exportæ–¹å‘ä¸Šä¿®æ”¹ï¼Œä¿®æ”¹å®Œä¹‹åï¼Œå†åŠ ä¸Šæœ¬aså†å‘å¸ƒå‡ºå»ã€‚ä¾‹å¦‚ï¼šæ·»åŠ ä¸€ä¸ª100aså·ï¼šå‘å¸ƒå‡ºå»æ˜¯64512ï¼ˆåŠ ä¸Šæœ¬asï¼‰ã€100ï¼ˆè¿½åŠ çš„ï¼‰ã€64513ï¼ˆä¸Šä¸€ä¸ªç»å†çš„aså·ï¼‰ â‘ additive # acl number 2000 rule 5 permit source 10.10.10.10 0 # route-policy aa permit node 10 if-match acl 2000 apply as-path 500 additive # bgp 200 peer 5.5.5.5 route-policy aa export â‘¡overwrite # acl number 2000 rule 5 permit source 10.10.10.10 0 # route-policy aa permit node 10 if-match acl 2000 apply as-path 500 overwrite # bgp 200 peer 5.5.5.5 route-policy aa export Originå±æ€§ Originå±æ€§ç”¨æ¥å®šä¹‰è·¯å¾„ä¿¡æ¯çš„æ¥æºï¼Œæ ‡è®°ä¸€æ¡è·¯ç”±æ˜¯æ€ä¹ˆæˆä¸ºBGPè·¯ç”±çš„ã€‚å®ƒæœ‰ä»¥ä¸‹3ç§ç±»å‹ï¼š IGPï¼šå…·æœ‰æœ€é«˜çš„ä¼˜å…ˆçº§ã€‚é€šè¿‡è·¯ç”±å§‹å‘ASçš„IGPå¾—åˆ°çš„è·¯ç”±ä¿¡æ¯ï¼Œæ¯”å¦‚é€šè¿‡networkå‘½ä»¤æ³¨å…¥åˆ°BGPè·¯ç”±è¡¨çš„è·¯ç”±ï¼Œå…¶Originå±æ€§ä¸ºIGPã€‚ EGPï¼šä¼˜å…ˆçº§æ¬¡ä¹‹ã€‚é€šè¿‡EGPå¾—åˆ°çš„è·¯ç”±ä¿¡æ¯ï¼Œå…¶Originå±æ€§ä¸ºEGPã€‚ Incompleteï¼šä¼˜å…ˆçº§æœ€ä½ã€‚é€šè¿‡å…¶ä»–æ–¹å¼å­¦ä¹ åˆ°çš„è·¯ç”±ä¿¡æ¯ã€‚æ¯”å¦‚BGPé€šè¿‡import-routeå‘½ä»¤å¼•å…¥çš„è·¯ç”±ï¼Œå…¶Originå±æ€§ä¸ºIncompleteã€‚ å½“å»å¾€åŒä¸€ä¸ªç›®çš„åœ°å­˜åœ¨å¤šæ¡ä¸åŒOriginå±æ€§çš„è·¯ç”±æ—¶ï¼Œåœ¨å…¶ä»–æ¡ä»¶éƒ½ç›¸åŒçš„æƒ…å†µä¸‹ï¼ŒBGPå°†æŒ‰å¦‚Originçš„ä¸‹é¡ºåºä¼˜é€‰è·¯ç”±ï¼šIGP &gt; EGP &gt; Incompleteã€‚ä¹Ÿå°±æ˜¯i &gt; e &gt; ? ï¼ˆæ³¨æ„ï¼šå¦‚æœospfå­¦ä¹ åˆ°1.1.1.1ä¸€æ¡è·¯ç”±ï¼Œbgpä¸­network1.1.1.1ï¼Œbgpè·¯ç”±è¡¨ä¸­ä¸ä¼šé€šå‘Šè¿™ä¸ªè·¯ç”±ï¼Œå› ä¸ºospfå­¦ä¹ åˆ°çš„ä¼˜å…ˆï¼Œbgpä¼ é€’çš„ä¸€ä¸ªæœºåˆ¶ï¼‰ Next-Hop BGPçš„ä¸‹ä¸€è·³å±æ€§å’ŒIGPçš„æœ‰æ‰€ä¸åŒï¼Œä¸ä¸€å®šå°±æ˜¯é‚»å±…çš„IPåœ°å€ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼ŒNext_Hopå±æ€§éµå¾ªä¸‹é¢çš„è§„åˆ™ï¼š BGP Speakeråœ¨å‘EBGPå¯¹ç­‰ä½“å‘å¸ƒæŸæ¡è·¯ç”±æ—¶ï¼Œä¼šæŠŠè¯¥è·¯ç”±ä¿¡æ¯çš„ä¸‹ä¸€è·³å±æ€§è®¾ç½®ä¸ºæœ¬åœ°ä¸å¯¹ç«¯å»ºç«‹BGPé‚»å±…å…³ç³»çš„æ¥å£åœ°å€ã€‚ BGP Speakerå°†æœ¬åœ°å§‹å‘è·¯ç”±å‘å¸ƒç»™IBGPå¯¹ç­‰ä½“æ—¶ï¼Œä¼šæŠŠè¯¥è·¯ç”±ä¿¡æ¯çš„ä¸‹ä¸€è·³å±æ€§è®¾ç½®ä¸ºæœ¬åœ°ä¸å¯¹ç«¯å»ºç«‹BGPé‚»å±…å…³ç³»çš„æ¥å£åœ°å€ã€‚ BGP Speakeråœ¨å‘IBGPå¯¹ç­‰ä½“å‘å¸ƒä»EBGPå¯¹ç­‰ä½“å­¦æ¥çš„è·¯ç”±æ—¶ï¼Œå¹¶ä¸æ”¹å˜è¯¥è·¯ç”±ä¿¡æ¯çš„ä¸‹ä¸€è·³å±æ€§ã€‚ BGPè·¯ç”±å™¨æœ¬èº«å§‹å‘çš„è·¯ç”±ï¼Œä¸‹ä¸€è·³æ˜¯0.0.0.0 IBGPåœ¨è¿›è¡Œè·¯ç”±ä¼ é€’æ—¶ï¼Œä¸‹ä¸€è·³åœ°å€ ä¸å˜ä¼šé€ æˆè·¯ç”±ä¸å¯è¾¾è¿™ç§æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸‹å‘½ä»¤ä¿®æ”¹ [AR2-bgp]peer 4.4.4.4 next-hop-local Local_Preference Local_Preferenceå³æœ¬åœ°ä¼˜å…ˆçº§å±æ€§ï¼Œæ˜¯å…¬è®¤ä»»æ„å±æ€§ï¼Œå¯ä»¥ç”¨äºå‘Šè¯‰ASä¸­çš„è·¯ç”±å™¨ï¼Œå“ªæ¡è·¯å¾„æ˜¯ç¦»å¼€æœ¬ASçš„é¦–é€‰è·¯å¾„ã€‚ Local_Preferenceå±æ€§å€¼è¶Šå¤§åˆ™BGPè·¯ç”±è¶Šä¼˜ã€‚ç¼ºçœçš„Local_Preferenceå€¼ä¸º100ã€‚ è¯¥å±æ€§åªèƒ½è¢«ä¼ é€’ç»™IBGPå¯¹ç­‰ä½“ï¼Œè€Œä¸èƒ½ä¼ é€’ç»™EBGPå¯¹ç­‰ä½“ã€‚è¶Šå¤§è¶Šä¼˜ã€‚ æ³¨æ„äº‹é¡¹ï¼š Local_Preferenceå±æ€§åªèƒ½åœ¨IBGPå¯¹ç­‰ä½“é—´ä¼ é€’ï¼ˆé™¤éåšäº†ç­–ç•¥å¦åˆ™Local_Preferenceå€¼åœ¨IBGPå¯¹ç­‰ä½“é—´ä¼ é€’è¿‡ç¨‹ä¸­ä¸ä¼šä¸¢å¤±ï¼‰ï¼Œè€Œä¸èƒ½åœ¨EBGPå¯¹ç­‰ä½“é—´ä¼ é€’ï¼Œå¦‚æœåœ¨EBGPå¯¹ç­‰ä½“é—´æ”¶åˆ°çš„è·¯ç”±çš„è·¯å¾„å±æ€§ä¸­æºå¸¦äº†Local_Preferenceï¼Œåˆ™ä¼šè¿›è¡Œé”™è¯¯å¤„ç†ã€‚ ä½†æ˜¯å¯ä»¥åœ¨**ASè¾¹ç•Œè·¯ç”±å™¨ä¸Šä½¿ç”¨Importæ–¹å‘çš„ç­–ç•¥æ¥ä¿®æ”¹Local_Preferenceå±æ€§å€¼ã€‚**ä¹Ÿå°±æ˜¯åœ¨æ”¶åˆ°è·¯ç”±ä¹‹åï¼Œåœ¨æœ¬åœ°ä¸ºè·¯ç”±èµ‹äºˆLocal_Preferenceã€‚ ä½¿ç”¨bgp default local-preferenceå‘½ä»¤ä¿®æ”¹ç¼ºçœLocal_Preferenceå€¼ï¼Œè¯¥å€¼ç¼ºçœä¸º100ã€‚ è·¯ç”±å™¨åœ¨å‘å…¶EBGPå¯¹ç­‰ä½“å‘é€è·¯ç”±æ›´æ–°æ—¶ï¼Œä¸èƒ½æºå¸¦Local_Preferenceå±æ€§ï¼Œä½†æ˜¯å¯¹æ–¹æ¥æ”¶è·¯ç”±ä¹‹åï¼Œä¼šåœ¨æœ¬åœ°ä¸ºè¿™æ¡è·¯ç”±èµ‹ä¸€ä¸ªç¼ºçœLocal_Preferenceå€¼ï¼ˆ100ï¼‰ï¼Œç„¶åå†å°†è·¯ç”±ä¼ é€’ç»™è‡ªå·±çš„IBGPå¯¹ç­‰ä½“ã€‚ æœ¬åœ°ä½¿ç”¨networkå‘½ä»¤åŠimport-routeå‘½ä»¤å¼•å…¥çš„è·¯ç”±ï¼Œ Local_Preferenceä¸ºç¼ºçœå€¼100ï¼Œå¹¶èƒ½åœ¨ASå†…å‘å…¶ä»–IBGPå¯¹ç­‰ä½“ä¼ é€’ï¼Œä¼ é€’è¿‡ç¨‹ä¸­é™¤éå—è·¯ç”±ç­–ç•¥å½±å“ï¼Œå¦åˆ™Local_Preferenceä¸å˜ Communityï¼ˆå›¢ä½“ï¼‰ Communityå±æ€§ä¸ºå¯é€‰è¿‡æ¸¡å±æ€§ï¼Œæ˜¯ä¸€ç§è·¯ç”±æ ‡è®°ï¼Œç”¨äºç®€åŒ–è·¯ç”±ç­–ç•¥çš„æ‰§è¡Œã€‚ å¯ä»¥å°†æŸäº›è·¯ç”±åˆ†é…ä¸€ä¸ªç‰¹å®šçš„Communityå±æ€§å€¼ï¼Œä¹‹åå°±å¯ä»¥åŸºäºCommunityå€¼è€Œä¸æ˜¯ç½‘ç»œå‰ç¼€/æ©ç ä¿¡æ¯æ¥åŒ¹é…è·¯ç”±å¹¶æ‰§è¡Œç›¸åº”çš„ç­–ç•¥äº†ã€‚ MED ï¼ˆMulti-Exit Discriminatorï¼Œå¤šå‡ºå£é‰´åˆ«å™¨ï¼‰æ˜¯å¯é€‰éè¿‡æ¸¡å±æ€§ï¼Œæ˜¯ä¸€ç§åº¦é‡å€¼ï¼Œç”¨äºå‘å¤–éƒ¨å¯¹ç­‰ä½“æŒ‡å‡ºè¿›å…¥æœ¬ASçš„é¦–é€‰è·¯å¾„ï¼Œå³å½“è¿›å…¥æœ¬ASçš„å…¥å£æœ‰å¤šä¸ªæ—¶ï¼ŒASå¯ä»¥ä½¿ç”¨MEDåŠ¨æ€åœ°å½±å“å…¶ä»–ASé€‰æ‹©è¿›å…¥çš„è·¯å¾„ã€‚ MEDå±æ€§å€¼è¶Šå°åˆ™BGPè·¯ç”±è¶Šä¼˜ã€‚ MEDä¸»è¦ç”¨äºåœ¨ASä¹‹é—´å½±å“BGPçš„é€‰è·¯ã€‚MEDè¢«ä¼ é€’ç»™EBGPå¯¹ç­‰ä½“åï¼Œå¯¹ç­‰ä½“åœ¨å…¶ASå†…ä¼ é€’è·¯ç”±æ—¶ï¼Œæºå¸¦è¯¥MEDå€¼ï¼Œä½†å°†è·¯ç”±å†æ¬¡ä¼ é€’ç»™å…¶EBGPå¯¹ç­‰ä½“æ—¶ï¼Œç¼ºçœä¸ä¼šæºå¸¦MEDå±æ€§ã€‚0-4294967295 æ³¨æ„äº‹é¡¹ï¼š ç¼ºçœæƒ…å†µä¸‹ï¼Œè·¯ç”±å™¨åªæ¯”è¾ƒæ¥è‡ªåŒä¸€ç›¸é‚»ASçš„BGPè·¯ç”±çš„MEDå€¼ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœå»å¾€åŒä¸€ä¸ªç›®çš„åœ°çš„ä¸¤æ¡è·¯ç”±æ¥è‡ªä¸åŒçš„ç›¸é‚»ASï¼Œåˆ™ä¸è¿›è¡ŒMEDå€¼çš„æ¯”è¾ƒã€‚ ä¸€å°BGPè·¯ç”±å™¨å°†è·¯ç”±é€šå‘Šç»™EBGPå¯¹ç­‰ä½“æ—¶ï¼Œæ˜¯å¦æºå¸¦MEDå±æ€§ï¼Œéœ€è¦æ ¹æ®ä»¥ä¸‹æ¡ä»¶è¿›è¡Œåˆ¤æ–­ï¼ˆä¸å¯¹EBGPå¯¹ç­‰ä½“ä½¿ç”¨ç­–ç•¥çš„æƒ…å†µä¸‹ï¼‰ï¼š å¦‚æœè¯¥BGPè·¯ç”±æ˜¯æœ¬åœ°å§‹å‘ï¼ˆæœ¬åœ°é€šè¿‡networkæˆ–import-routeå‘½ä»¤å¼•å…¥ï¼‰çš„ï¼Œåˆ™ç¼ºçœæºå¸¦MEDå±æ€§å‘é€ç»™EBGPå¯¹ç­‰ä½“ã€‚ å¦‚æœè¯¥BGPè·¯ç”±ä¸ºä»BGPå¯¹ç­‰ä½“å­¦ä¹ åˆ°ï¼Œé‚£ä¹ˆè¯¥è·¯ç”±ä¼ é€’ç»™EBGPå¯¹ç­‰ä½“æ—¶ç¼ºçœä¸ä¼šæºå¸¦MEDå±æ€§ã€‚ åœ¨IBGPå¯¹ç­‰ä½“ä¹‹é—´ä¼ é€’è·¯ç”±æ—¶ï¼ŒMEDå€¼ä¼šè¢«ä¿ç•™å¹¶ä¼ é€’ï¼Œé™¤ééƒ¨ç½²äº†ç­–ç•¥ï¼Œå¦åˆ™MEDå€¼åœ¨ä¼ é€’è¿‡ç¨‹ä¸­ä¸å‘ç”Ÿæ”¹å˜ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚ å¦‚æœè·¯ç”±å™¨é€šè¿‡IGPå­¦ä¹ åˆ°ä¸€æ¡è·¯ç”±ï¼Œå¹¶é€šè¿‡networkæˆ–import-routeçš„æ–¹å¼å°†è·¯ç”±å¼•å…¥BGPï¼Œäº§ç”Ÿçš„BGPè·¯ç”±çš„MEDå€¼ç»§æ‰¿è·¯ç”±åœ¨IGPä¸­çš„metricã€‚ å¯ä»¥ä½¿ç”¨default medå‘½ä»¤ä¿®æ”¹ç¼ºçœçš„MEDå€¼ï¼Œdefault medå‘½ä»¤åªå¯¹æœ¬è®¾å¤‡ä¸Šç”¨import-routeå‘½ä»¤å¼•å…¥çš„è·¯ç”±å’ŒBGPçš„èšåˆè·¯ç”±ç”Ÿæ•ˆã€‚ Preferred-Valueï¼ˆåè®®é¦–é€‰å€¼ï¼‰ æ˜¯åä¸ºè®¾å¤‡çš„ç‰¹æœ‰å±æ€§ï¼Œè¯¥å±æ€§ä»…åœ¨æœ¬åœ°æœ‰æ•ˆã€‚å½“BGPè·¯ç”±è¡¨ä¸­å­˜åœ¨åˆ°ç›¸åŒç›®çš„åœ°çš„è·¯ç”±æ—¶ï¼Œå°†ä¼˜å…ˆé€‰æ‹©Preferred-Valueå€¼é«˜çš„è·¯ç”±ã€‚ å–å€¼èŒƒå›´ï¼š0~65535ï¼›è¯¥å€¼è¶Šå¤§ï¼Œåˆ™è·¯ç”±è¶Šä¼˜å…ˆã€‚ Preferred-Valueåªèƒ½åœ¨è·¯ç”±å™¨æœ¬åœ°é…ç½®ï¼Œè€Œä¸”åªå½±å“æœ¬è®¾å¤‡çš„è·¯ç”±ä¼˜é€‰ã€‚è¯¥å±æ€§ä¸ä¼šä¼ é€’ç»™ä»»ä½•BGPå¯¹ç­‰ä½“ã€‚ è·¯ç”±åå°„å™¨ ä½œç”¨ï¼šè§£å†³IBGPå…¨äº’è”çš„é—®é¢˜ 1ã€RRä»EBGPå­¦ä¹ åˆ°çš„ï¼Œä¼šå‘é€ç»™clientå’Œéclient 2ã€RRä»éclientå­¦ä¹ åˆ°çš„è·¯ç”±ï¼Œä¼šåå°„ç»™è‡ªå·±çš„clientï¼Œä½†æ˜¯ä¸ä¼šç»™éclient 3ã€RRä»clientå­¦ä¹ åˆ°çš„è·¯ç”±ï¼Œä¼šåå°„éè‡ªå·±çš„éclientå’Œclient ééä¸ä¼  è·¯ç”±åå°„å™¨ä¸­çš„é˜²ç¯ï¼šOriginator_IDï¼ŒCluster_List RRå°†ä¸€æ¡BGPè·¯ç”±è¿›è¡Œåå°„æ—¶ä¼šåœ¨åå°„å‡ºå»çš„è·¯ç”±ä¸­å¢åŠ Originator_IDï¼Œå…¶å€¼ä¸ºæœ¬åœ°ASä¸­é€šå‘Šè¯¥è·¯ç”±çš„BGPè·¯ç”±å™¨Router IDã€‚ è‹¥ASå†…å­˜åœ¨å¤šä¸ªRRï¼Œåˆ™Originator_IDå±æ€§ç”±ç¬¬ä¸€ä¸ªRRåˆ›å»ºï¼Œå¹¶ä¸”ä¸è¢«åç»­çš„RRï¼ˆè‹¥æœ‰ï¼‰æ‰€æ›´æ”¹ã€‚ å½“BGPè·¯ç”±å™¨æ”¶åˆ°ä¸€æ¡æºå¸¦Originator_IDå±æ€§çš„IBGPè·¯ç”±ï¼Œå¹¶ä¸”Originator_IDå±æ€§å€¼ä¸è‡ªèº«çš„Router IDç›¸åŒï¼Œåˆ™å®ƒä¼šå¿½ç•¥å…³äºè¯¥æ¡è·¯ç”±çš„æ›´æ–°ã€‚ è·¯ç”±åå°„ç°‡åŒ…æ‹¬åå°„å™¨RRåŠå…¶Clientã€‚ä¸€ä¸ªASå†…å…è®¸å­˜åœ¨å¤šä¸ªè·¯ç”±åå°„ç°‡ï¼ˆå¦‚ä¸‹å›¾ï¼‰ã€‚ æ¯ä¸€ä¸ªç°‡éƒ½æœ‰å”¯ä¸€çš„ç°‡IDï¼ˆCluster_IDï¼Œç¼ºçœæ—¶ä¸ºRRçš„BGP Router ID ï¼‰ã€‚ å½“ä¸€æ¡è·¯ç”±è¢«åå°„å™¨åå°„åï¼Œè¯¥RRï¼ˆè¯¥ç°‡ï¼‰çš„Cluster_IDå°±ä¼šè¢«æ·»åŠ è‡³è·¯ç”±çš„Cluster_listå±æ€§ä¸­ã€‚ å½“RRæ”¶åˆ°ä¸€æ¡æºå¸¦Cluster_listå±æ€§çš„BGPè·¯ç”±ï¼Œä¸”è¯¥å±æ€§å€¼ä¸­åŒ…å«è¯¥ç°‡çš„Cluster_IDæ—¶ï¼ŒRRè®¤ä¸ºè¯¥æ¡è·¯ç”±å­˜åœ¨ç¯è·¯ï¼Œå› æ­¤å°†å¿½ç•¥å…³äºè¯¥æ¡è·¯ç”±çš„æ›´æ–°ã€‚ é…ç½®ï¼š åœ¨RRè·¯ç”±å™¨ä¸Šé…ç½®ï¼š Bgp 200 peer 6.6.6.6 reflect-client --è°æ˜¯clientï¼Œå°±peerè° ç¼ºçœæƒ…å†µä¸‹ï¼Œæ¯ä¸ªè·¯ç”±åå°„å™¨ä½¿ç”¨è‡ªå·±çš„Router IDä½œä¸ºé›†ç¾¤IDã€‚ [Huawei-bgp] reflector cluster-id 20.2.2.2 è·¯ç”±ä¼˜é€‰åŸåˆ™ï¼š P L L A O M E N æ¼‚äº®è€ç”·äºº pâ€”Preference Value (è¶Šå¤§è¶Šä¼˜ï¼Œä»…é™è·¯ç”±å™¨æœ¬åœ°) Lâ€” Local Preferenceï¼Œæœ¬åœ°ä¼˜å…ˆçº§ (è¶Šå¤§è¶Šä¼˜ï¼ŒåŒä¸€ASå†…çš„è·¯ç”±å™¨ï¼‰ Lâ€” æ‰‹åŠ¨èšåˆ-&gt;è‡ªåŠ¨èšåˆ-&gt;network-&gt;importï¼Œä¸ºæœ¬åœ°å§‹å‘ A â€”AS Path (çŸ­çš„ä¼˜å…ˆ) O â€”Originï¼Œèµ·æºi(network)&gt;e(EBGP)&gt;? (import-route) Mâ€”MED (å€¼è¶Šå°è¶Šä¼˜ï¼Œæœ¬ASå†…æˆ–ä¸Šæ¸¸ASå†…æ‰€æœ‰è·¯ç”±å™¨ï¼ŒEBGPé‚»å±…ä¸Šè®¾ç½®) Eâ€” EBGPä¼˜äºIBGP (å‰é¢éƒ½ä¸€æ ·ï¼Œæ¯”ä¸å‡ºæœ€ä¼˜è·¯å¾„æ—¶) Nâ€” Next-Hopï¼Œä¸‹ä¸€è·³(BGPé€‰æ‹©IGPä¸‹ä¸€è·³costå€¼æœ€å°çš„) 9.ä¼˜é€‰Cluster-Listæœ€çŸ­çš„è·¯ç”± 10.ä¼˜é€‰Router-IDï¼ˆOrigintor- IDï¼‰æœ€å°çš„è®¾å¤‡é€šå‘Šçš„è·¯ç”± 11.ä¼˜é€‰å…·æœ‰æœ€å°çš„IPåœ°å€çš„å¯¹ç­‰ä½“é€šå‘Šçš„è·¯ç”± å‰å…«æ¡å…¨éƒ¨ç›¸åŒå½¢æˆè·¯ç”±è´Ÿè½½åˆ†æ‹…","categories":[{"name":"åŸºç¡€çŸ¥è¯†","slug":"åŸºç¡€çŸ¥è¯†","permalink":"http://example.com/categories/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"}],"tags":[{"name":"BGP","slug":"BGP","permalink":"http://example.com/tags/BGP/"}]},{"title":"ç»„æ’­","slug":"ç»„æ’­","date":"2024-05-10T06:52:53.000Z","updated":"2024-05-11T05:11:37.034Z","comments":true,"path":"2024/05/10/ç»„æ’­/","permalink":"http://example.com/2024/05/10/%E7%BB%84%E6%92%AD/","excerpt":"","text":"ç»„æ’­ç®€ä»‹ç»„æ’­ï¼ˆMulticastï¼‰æ˜¯åœ¨ä¸€å°æºIPä¸»æœºå’Œå¤šå°ï¼ˆä¸€ç»„ï¼‰IPä¸»æœºä¹‹é—´è¿›è¡Œï¼Œä¸­é—´çš„ç½‘ç»œè®¾å¤‡æ ¹ æ®æ¥æ”¶è€…çš„éœ€è¦ï¼Œæœ‰é€‰æ‹©æ€§åœ°å¯¹æ•°æ®è¿›è¡Œå¤åˆ¶å’Œè½¬å‘ã€‚ â€¢ ç»„æ’­æŠ€æœ¯æœ‰æ•ˆåœ°æ»¡è¶³äº†å•ç‚¹å‘é€ã€å¤šç‚¹æ¥æ”¶çš„éœ€æ±‚ï¼Œå®ç°äº†IPç½‘ç»œä¸­ç‚¹åˆ°å¤šç‚¹ä¸šåŠ¡æ•°æ®çš„é«˜ æ•ˆä¼ é€ï¼Œèƒ½å¤Ÿå¤§é‡èŠ‚çº¦ç½‘ç»œå¸¦å®½ã€é™ä½ç½‘ç»œè´Ÿè½½ã€‚ â€¢ ç»„æ’­åˆ†å‘æ ‘ï¼šç»„æ’­æµé‡çš„è½¬å‘è·¯å¾„ ç»„æ’­åœ°å€ï¼š224.0.0.0â€“239.255.255.255 ç»„æ’­MACï¼š RPFæ£€æŸ¥ï¼š IGMPv1IGMPv1åè®®ä¸»è¦åŸºäºæŸ¥è¯¢å’Œå“åº”æœºåˆ¶å®Œæˆç»„æ’­ç»„ç®¡ç†ã€‚å½“ä¸€ä¸ªç½‘æ®µå†…æœ‰å¤šä¸ªç»„æ’­è®¾å¤‡æ—¶ï¼Œç”±äºå®ƒä»¬éƒ½å¯ä»¥æ¥æ”¶åˆ°ä¸»æœºå‘é€çš„æˆå‘˜æŠ¥å‘ŠæŠ¥æ–‡ï¼Œå› æ­¤åªéœ€è¦é€‰å–å…¶ä¸­ä¸€å°ç»„æ’­è®¾å¤‡å‘é€æŸ¥è¯¢æŠ¥æ–‡ï¼Œè¯¥ç»„æ’­è®¾å¤‡ç§°ä¸ºIGMPæŸ¥è¯¢å™¨ï¼ˆQuerierï¼‰ã€‚åœ¨IGMPv1ä¸­ï¼Œç”±ç»„æ’­è·¯ç”±åè®®PIMé€‰ä¸¾å‡ºå”¯ä¸€çš„ç»„æ’­ä¿¡æ¯è½¬å‘è€…ï¼ˆAssert Winneræˆ–DRï¼‰ä½œä¸ºIGMPçš„æŸ¥è¯¢å™¨ï¼Œè´Ÿè´£è¯¥ç½‘æ®µçš„ç»„æˆå‘˜å…³ç³»æŸ¥è¯¢ã€‚ ï¼ˆä¸å…·å¤‡é€‰ä¸¾æŸ¥è¯¢å™¨ï¼Œä¾èµ–PIMåè®®é€‰ä¸¾ï¼‰ IGMPv1æŠ¥æ–‡IGMPv1æŠ¥æ–‡å°è£…åœ¨IPæŠ¥æ–‡ä¸­ï¼Œç”±8ä¸ªå­—èŠ‚ç»„æˆã€‚IGMPv1åŒ…æ‹¬ä¸¤ç§ç±»å‹çš„æŠ¥æ–‡ï¼š æ™®éç»„æŸ¥è¯¢æŠ¥æ–‡ï¼ˆGeneral Queryï¼‰ï¼šæŸ¥è¯¢å™¨å‘å…±äº«ç½‘ç»œä¸Šæ‰€æœ‰ä¸»æœºå‘é€çš„æŸ¥è¯¢æŠ¥æ–‡ï¼Œç”¨äºäº†è§£å“ªäº›ç»„æ’­ç»„å­˜åœ¨æˆå‘˜ã€‚ï¼ˆ60sä¸€æ¬¡ï¼‰ æˆå‘˜æŠ¥å‘ŠæŠ¥æ–‡ï¼ˆReportï¼‰ï¼šä¸»æœºå‘æŸ¥è¯¢å™¨å‘é€çš„æŠ¥å‘ŠæŠ¥æ–‡ï¼Œç”¨äºç”³è¯·åŠ å…¥æŸä¸ªç»„æ’­ç»„æˆ–è€…åº”ç­”æŸ¥è¯¢æŠ¥æ–‡ã€‚ å­—æ®µ è¯´æ˜ Version IGMPç‰ˆæœ¬ï¼Œå€¼ä¸º1ã€‚ Type æŠ¥æ–‡ç±»å‹ã€‚è¯¥å­—æ®µæœ‰ä»¥ä¸‹ä¸¤ç§å–å€¼ï¼š0x1ï¼šè¡¨ç¤ºæ™®éç»„æŸ¥è¯¢æŠ¥æ–‡ã€‚0x2ï¼šè¡¨ç¤ºæˆå‘˜æŠ¥å‘ŠæŠ¥æ–‡ã€‚ Unused åœ¨IGMPv1ä¸­ï¼Œè¯¥å­—æ®µåœ¨å‘é€æ—¶è¢«è®¾ä¸º0ï¼Œå¹¶åœ¨æ¥æ”¶æ—¶è¢«å¿½ç•¥ã€‚ Checksum æ ¡éªŒå’Œã€‚ Group Address ç»„æ’­ç»„åœ°å€ã€‚åœ¨æ™®éç»„æŸ¥è¯¢æŠ¥æ–‡ä¸­ï¼Œè¯¥å­—æ®µè®¾ä¸º0ï¼›åœ¨æˆå‘˜æŠ¥å‘ŠæŠ¥æ–‡ä¸­ï¼Œè¯¥å­—æ®µä¸ºæˆå‘˜åŠ å…¥çš„ç»„æ’­ç»„åœ°å€ã€‚ æŸ¥è¯¢ç»„æ’­ç»„æˆå‘˜æœºåˆ¶ æ™®éç»„æŸ¥è¯¢å’Œå“åº”è¿‡ç¨‹å¦‚ä¸‹ï¼š IGMPæŸ¥è¯¢å™¨å‘é€ç›®çš„åœ°å€ä¸º224.0.0.1ï¼ˆè¡¨ç¤ºåŒä¸€ç½‘æ®µå†…æ‰€æœ‰ä¸»æœºå’Œè®¾å¤‡ï¼‰çš„æ™®éç»„æŸ¥è¯¢æŠ¥æ–‡ï¼›æ”¶åˆ°è¯¥æŸ¥è¯¢æŠ¥æ–‡çš„ç»„æˆå‘˜å¯åŠ¨å®šæ—¶å™¨ã€‚ æ™®éç»„æŸ¥è¯¢æŠ¥æ–‡æ˜¯å‘¨æœŸæ€§å‘é€çš„ï¼Œå‘é€å‘¨æœŸå¯ä»¥é€šè¿‡å‘½ä»¤é…ç½®ã€‚HostAå’ŒHostBä½œä¸ºç»„æ’­ç»„G1çš„æˆå‘˜ï¼Œæ”¶åˆ°æ™®éç»„æŸ¥è¯¢æŠ¥æ–‡åï¼Œåœ¨æœ¬åœ°å¯åŠ¨å®šæ—¶å™¨Timer-G1ã€‚ ç¬¬ä¸€ä¸ªå®šæ—¶å™¨ï¼ˆ10sï¼‰è¶…æ—¶çš„ç»„æˆå‘˜å‘é€é’ˆå¯¹è¯¥ç»„çš„æŠ¥å‘ŠæŠ¥æ–‡ã€‚ å‡è®¾HostAä¸Šçš„Timer-G1é¦–å…ˆè¶…æ—¶ï¼ŒHostAå‘è¯¥ç½‘æ®µå‘é€ç›®çš„åœ°å€ä¸ºG1çš„æŠ¥å‘ŠæŠ¥æ–‡ã€‚ä¹Ÿæƒ³åŠ å…¥ç»„G1çš„HostBæ”¶åˆ°æ­¤æŠ¥å‘ŠæŠ¥æ–‡ï¼Œåˆ™åœæ­¢å®šæ—¶å™¨Timer-G1ï¼Œä¸å†å‘é€é’ˆå¯¹G1çš„æŠ¥å‘ŠæŠ¥æ–‡ã€‚è¿™æ ·æŠ¥å‘ŠæŠ¥æ–‡è¢«æŠ‘åˆ¶ï¼Œå¯ä»¥å‡å°‘ç½‘æ®µä¸Šçš„æµé‡ã€‚ IGMPæŸ¥è¯¢å™¨æ¥æ”¶åˆ°HostAçš„æŠ¥å‘ŠæŠ¥æ–‡åï¼Œäº†è§£åˆ°æœ¬ç½‘æ®µå†…å­˜åœ¨ç»„æ’­ç»„G1çš„æˆå‘˜ï¼Œåˆ™ç”±ç»„æ’­è·¯ç”±åè®®ç”Ÿæˆï¼ˆï¼ŒG1ï¼‰ç»„æ’­è½¬å‘è¡¨é¡¹ï¼Œâ€œâ€ä»£è¡¨ä»»æ„ç»„æ’­æºã€‚ç½‘ç»œä¸­ä¸€æ—¦æœ‰ç»„æ’­ç»„G1çš„æ•°æ®åˆ°è¾¾DeviceAï¼Œå°†å‘è¯¥ç½‘æ®µè½¬å‘ã€‚ åŠ ç»„æœºåˆ¶ ä¸»æœºHostCä¸ç­‰å¾…æ™®éç»„æŸ¥è¯¢æŠ¥æ–‡çš„åˆ°æ¥ï¼Œä¸»åŠ¨å‘é€é’ˆå¯¹G2çš„æŠ¥å‘ŠæŠ¥æ–‡ä»¥å£°æ˜åŠ å…¥ç»„æ’­ç»„G2ã€‚ IGMPæŸ¥è¯¢å™¨æ¥æ”¶åˆ°HostCçš„æŠ¥å‘ŠæŠ¥æ–‡åï¼Œäº†è§£åˆ°æœ¬ç½‘æ®µå†…å‡ºç°äº†ç»„æ’­ç»„G2çš„æˆå‘˜ï¼Œåˆ™ç”Ÿæˆç»„æ’­è½¬å‘é¡¹ï¼ˆ*ï¼ŒG2ï¼‰ã€‚ç½‘ç»œä¸­ä¸€æ—¦æœ‰G2çš„æ•°æ®åˆ°è¾¾DeviceAï¼Œå°†å‘è¯¥ç½‘æ®µè½¬å‘ã€‚ ç¦»ç»„æœºåˆ¶IGMPv1æ²¡æœ‰ä¸“é—¨å®šä¹‰ç¦»å¼€ç»„çš„æŠ¥æ–‡ã€‚ä¸»æœºç¦»å¼€ç»„æ’­ç»„åï¼Œåœæ­¢å‘é€æˆå‘˜æŠ¥å‘ŠæŠ¥æ–‡ã€‚æ ¹æ®ä¸»æœºæƒ³è¦ç¦»å¼€çš„ç»„æ’­ç»„ä¸­æ˜¯å¦è¿˜æœ‰å…¶ä»–æˆå‘˜ï¼Œå¤„ç†æœºåˆ¶æœ‰æ‰€ä¸åŒã€‚å¦‚å›¾2æ‰€ç¤ºã€‚ å‡è®¾HostAæƒ³è¦é€€å‡ºç»„æ’­ç»„G1 HostAæ”¶åˆ°IGMPæŸ¥è¯¢å™¨å‘é€çš„æ™®éç»„æŸ¥è¯¢æŠ¥æ–‡æ—¶ï¼Œä¸å†å‘é€é’ˆå¯¹G1çš„æŠ¥å‘ŠæŠ¥æ–‡ã€‚ç”±äºç½‘æ®µå†…è¿˜å­˜åœ¨G1ç»„æˆå‘˜HostBï¼ŒHostBä¼šå‘IGMPæŸ¥è¯¢å™¨å‘é€é’ˆå¯¹G1çš„æŠ¥å‘ŠæŠ¥æ–‡ï¼Œå› æ­¤IGMPæŸ¥è¯¢å™¨æ„ŸçŸ¥ä¸åˆ°HostAçš„ç¦»å¼€ã€‚ å‡è®¾HostCæƒ³è¦é€€å‡ºç»„æ’­ç»„G2 HostCæ”¶åˆ°IGMPæŸ¥è¯¢å™¨å‘é€çš„æ™®éç»„æŸ¥è¯¢æŠ¥æ–‡æ—¶ï¼Œä¸å†å‘é€é’ˆå¯¹G2çš„æŠ¥å‘ŠæŠ¥æ–‡ã€‚ç”±äºç½‘æ®µå†…ä¸å­˜åœ¨ç»„G2çš„å…¶ä»–æˆå‘˜ï¼ŒIGMPæŸ¥è¯¢å™¨ä¸ä¼šæ”¶åˆ°G2ç»„æˆå‘˜çš„æŠ¥å‘ŠæŠ¥æ–‡ï¼Œåˆ™åœ¨ä¸€å®šæ—¶é—´ï¼ˆç¼ºçœå€¼ä¸º130ç§’ï¼‰åï¼Œåˆ é™¤G2æ‰€å¯¹åº”çš„ç»„æ’­è½¬å‘è¡¨é¡¹ã€‚ 130&#x3D;60Ã—2+10 IGMPv2IGMPv2çš„å·¥ä½œæœºåˆ¶ä¸IGMPv1åŸºæœ¬ç›¸åŒï¼Œæœ€å¤§çš„ä¸åŒä¹‹å¤„åœ¨äºIGMPv2å¢åŠ äº†æŸ¥è¯¢å™¨é€‰ä¸¾å’Œç¦»å¼€ç»„æœºåˆ¶ã€‚IGMPv2å¯ä»¥ä½¿IGMPæŸ¥è¯¢å™¨åŠæ—¶äº†è§£åˆ°ç½‘æ®µå†…å“ªäº›ç»„æ’­ç»„å·²ä¸å­˜åœ¨æˆå‘˜ï¼Œä»è€ŒåŠæ—¶æ›´æ–°ç»„æˆå‘˜å…³ç³»ï¼Œå‡å°‘ç½‘ç»œä¸­å†—ä½™çš„ç»„æ’­æµé‡ã€‚ ä¸IGMPv1ç›¸æ¯”ï¼ŒIGMPv2çš„å˜åŒ–å¦‚ä¸‹ï¼š é™¤äº†æ™®éç»„æŸ¥è¯¢æŠ¥æ–‡å’Œæˆå‘˜æŠ¥å‘ŠæŠ¥æ–‡ä¹‹å¤–ï¼ŒIGMPv2æ–°å¢äº†ä¸¤ç§æŠ¥æ–‡ï¼š æˆå‘˜ç¦»å¼€æŠ¥æ–‡ï¼ˆLeaveï¼‰ï¼šæˆå‘˜ç¦»å¼€ç»„æ’­ç»„æ—¶ä¸»åŠ¨å‘æŸ¥è¯¢å™¨å‘é€çš„æŠ¥æ–‡ï¼Œç”¨äºå®£å‘Šè‡ªå·±ç¦»å¼€äº†æŸä¸ªç»„æ’­ç»„ã€‚ ç‰¹å®šç»„æŸ¥è¯¢æŠ¥æ–‡ï¼ˆGroup-Specific Queryï¼‰ï¼šæŸ¥è¯¢å™¨å‘å…±äº«ç½‘æ®µå†…æŒ‡å®šç»„æ’­ç»„å‘é€çš„æŸ¥è¯¢æŠ¥æ–‡ï¼Œç”¨äºæŸ¥è¯¢è¯¥ç»„æ’­ç»„æ˜¯å¦å­˜åœ¨æˆå‘˜ã€‚ IGMPv2å¯¹æ™®éç»„æŸ¥è¯¢æŠ¥æ–‡æ ¼å¼ä¹Ÿåšäº†æ”¹è¿›ï¼Œæ·»åŠ äº†æœ€å¤§å“åº”æ—¶é—´ï¼ˆMax Response Timeï¼‰å­—æ®µã€‚æ­¤å­—æ®µå–å€¼å¯ä»¥é€šè¿‡å‘½ä»¤é…ç½®ï¼Œç”¨äºæ§åˆ¶æˆå‘˜å¯¹äºæŸ¥è¯¢æŠ¥æ–‡çš„å“åº”é€Ÿåº¦ã€‚ IGMPv2æŠ¥æ–‡ï¼šå›¾1 IGMPv2æŠ¥æ–‡æ ¼å¼ å­—æ®µ è¯´æ˜ Type æŠ¥æ–‡ç±»å‹ã€‚è¯¥å­—æ®µæœ‰ä»¥ä¸‹å››ç§å–å€¼ï¼š0x11ï¼šè¡¨ç¤ºæŸ¥è¯¢æŠ¥æ–‡ã€‚IGMPv2çš„æŸ¥è¯¢æŠ¥æ–‡åŒ…æ‹¬æ™®éç»„æŸ¥è¯¢æŠ¥æ–‡å’Œç‰¹å®šç»„æŸ¥è¯¢æŠ¥æ–‡ä¸¤ç±»ã€‚0x12ï¼šè¡¨ç¤ºIGMPv1æˆå‘˜æŠ¥å‘ŠæŠ¥æ–‡ã€‚0x16ï¼šè¡¨ç¤ºIGMPv2æˆå‘˜æŠ¥å‘ŠæŠ¥æ–‡ã€‚0x17ï¼šè¡¨ç¤ºæˆå‘˜ç¦»å¼€æŠ¥æ–‡ã€‚ Max Response Time æœ€å¤§å“åº”æ—¶é—´ã€‚æˆå‘˜ä¸»æœºåœ¨æ”¶åˆ°IGMPæŸ¥è¯¢å™¨å‘é€çš„æ™®éç»„æŸ¥è¯¢æŠ¥æ–‡åï¼Œéœ€è¦åœ¨æœ€å¤§å“åº”æ—¶é—´å†…åšå‡ºå›åº”ã€‚è¯¥å­—æ®µä»…åœ¨IGMPæŸ¥è¯¢æŠ¥æ–‡ä¸­æœ‰æ•ˆã€‚ Checksum æ ¡éªŒå’Œã€‚ Group Address ç»„æ’­ç»„åœ°å€ã€‚åœ¨æ™®éç»„æŸ¥è¯¢æŠ¥æ–‡ä¸­ï¼Œè¯¥å­—æ®µè®¾ä¸º0ã€‚åœ¨ç‰¹å®šç»„æŸ¥è¯¢æŠ¥æ–‡ä¸­ï¼Œè¯¥å­—æ®µä¸ºè¦æŸ¥è¯¢çš„ç»„æ’­ç»„åœ°å€ã€‚åœ¨æˆå‘˜æŠ¥å‘ŠæŠ¥æ–‡å’Œç¦»å¼€æŠ¥æ–‡ä¸­ï¼Œè¯¥å­—æ®µä¸ºæˆå‘˜è¦åŠ å…¥æˆ–ç¦»å¼€çš„ç»„æ’­ç»„åœ°å€ã€‚ v2æŸ¥è¯¢å™¨é€‰ä¸¾æœºåˆ¶åœ¨IGMPv2ä¸­ï¼ŒæŸ¥è¯¢å™¨çš„é€‰ä¸¾è¿‡ç¨‹å¦‚ä¸‹ï¼š åˆå§‹çŠ¶æ€ä¸‹ï¼Œæ‰€æœ‰è¿è¡ŒIGMPv2çš„ç»„æ’­è®¾å¤‡ï¼ˆDeviceAå’ŒDeviceBï¼‰éƒ½è®¤ä¸ºè‡ªå·±æ˜¯æŸ¥è¯¢å™¨ï¼Œå‘æœ¬ç½‘æ®µå†…çš„æ‰€æœ‰ä¸»æœºå’Œç»„æ’­è®¾å¤‡å‘é€æ™®éç»„æŸ¥è¯¢æŠ¥æ–‡ã€‚DeviceAå’ŒDeviceBåœ¨æ”¶åˆ°å¯¹æ–¹å‘é€çš„æ™®éç»„æŸ¥è¯¢æŠ¥æ–‡åï¼Œå°†æŠ¥æ–‡çš„æºIPåœ°å€ä¸è‡ªå·±çš„æ¥å£åœ°å€ä½œæ¯”è¾ƒã€‚é€šè¿‡æ¯”è¾ƒï¼ŒIPåœ°å€æœ€å°çš„ç»„æ’­è®¾å¤‡å°†æˆä¸ºæŸ¥è¯¢å™¨ï¼Œå…¶ä»–ç»„æ’­è®¾å¤‡æˆä¸ºéæŸ¥è¯¢å™¨ã€‚å¦‚å›¾æ‰€ç¤ºï¼ŒDeviceAçš„æ¥å£åœ°å€å°äºDeviceBï¼Œåˆ™DeviceAå½“é€‰ä¸ºæŸ¥è¯¢å™¨ï¼ŒDeviceBä¸ºéæŸ¥è¯¢å™¨ã€‚ ç¡®å®šæŸ¥è¯¢å™¨åï¼Œå°†ç”±IGMPæŸ¥è¯¢å™¨ï¼ˆDeviceAï¼‰å‘æœ¬ç½‘æ®µå†…çš„æ‰€æœ‰ä¸»æœºå’Œå…¶ä»–ç»„æ’­è®¾å¤‡å‘é€æ™®éç»„æŸ¥è¯¢æŠ¥æ–‡ï¼Œè€ŒéæŸ¥è¯¢å™¨ï¼ˆDeviceBï¼‰åˆ™ä¸å†å‘é€æ™®éç»„æŸ¥è¯¢æŠ¥æ–‡ã€‚ éæŸ¥è¯¢å™¨ï¼ˆDeviceBï¼‰ä¸Šéƒ½ä¼šå¯åŠ¨ä¸€ä¸ªå®šæ—¶å™¨ï¼ˆå³å…¶ä»–æŸ¥è¯¢å™¨å­˜åœ¨æ—¶é—´å®šæ—¶å™¨Other Querier Present Timerï¼‰ã€‚åœ¨è¯¥å®šæ—¶å™¨è¶…æ—¶å‰ï¼Œå¦‚æœæ”¶åˆ°äº†æ¥è‡ªæŸ¥è¯¢å™¨çš„æŸ¥è¯¢æŠ¥æ–‡ï¼Œåˆ™é‡ç½®è¯¥å®šæ—¶å™¨ï¼›å¦åˆ™ï¼Œå°±è®¤ä¸ºåŸæŸ¥è¯¢å™¨å¤±æ•ˆï¼Œå¹¶å‘èµ·æ–°çš„æŸ¥è¯¢å™¨é€‰ä¸¾è¿‡ç¨‹ã€‚ v2ç¦»ç»„æœºåˆ¶åœ¨IGMPv2ä¸­ï¼Œæˆå‘˜ç¦»å¼€ç»„æ’­ç»„æ—¶å¯ä»¥ä¸»åŠ¨å‘æŸ¥è¯¢å™¨å‘é€ç¦»å¼€æŠ¥æ–‡ï¼Œå®£å‘Šè‡ªå·±ç¦»å¼€äº†æŸä¸ªç»„æ’­ç»„ã€‚ ä¸»æœºHostAç¦»å¼€ç»„æ’­ç»„G1çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š HostAå‘æœ¬åœ°ç½‘æ®µå†…çš„æ‰€æœ‰ç»„æ’­è®¾å¤‡ï¼ˆç›®çš„åœ°å€ä¸º224.0.0.2ï¼‰å‘é€é’ˆå¯¹ç»„G1çš„ç¦»å¼€æŠ¥æ–‡ã€‚ æŸ¥è¯¢å™¨æ”¶åˆ°ç¦»å¼€æŠ¥æ–‡ï¼Œä¼šå‘é€é’ˆå¯¹ç»„G1çš„ç‰¹å®šç»„æŸ¥è¯¢æŠ¥æ–‡ã€‚å‘é€é—´éš”å’Œå‘é€æ¬¡æ•°å¯ä»¥é€šè¿‡å‘½ä»¤é…ç½®ï¼Œç¼ºçœæƒ…å†µä¸‹æ¯éš”1ç§’å‘é€ä¸€æ¬¡ï¼Œå…±å‘é€ä¸¤æ¬¡ã€‚åŒæ—¶æŸ¥è¯¢å™¨å¯åŠ¨ç»„æˆå‘˜å…³ç³»å®šæ—¶å™¨ï¼ˆTimer-Membership&#x3D;å‘é€é—´éš”xå‘é€æ¬¡æ•°ï¼‰ã€‚ å¦‚æœè¯¥ç½‘æ®µå†…è¿˜å­˜åœ¨ç»„G1çš„å…¶ä»–æˆå‘˜ï¼ˆå¦‚HostBï¼‰ï¼Œè¿™äº›æˆå‘˜åœ¨æ”¶åˆ°æŸ¥è¯¢å™¨å‘é€çš„ç‰¹å®šç»„æŸ¥è¯¢æŠ¥æ–‡åï¼Œä¼šç«‹å³å‘é€é’ˆå¯¹ç»„G1çš„æŠ¥å‘ŠæŠ¥æ–‡ã€‚æŸ¥è¯¢å™¨æ”¶åˆ°é’ˆå¯¹ç»„G1çš„æŠ¥å‘ŠæŠ¥æ–‡åå°†ç»§ç»­ç»´æŠ¤è¯¥ç»„æˆå‘˜å…³ç³»ã€‚å¦‚æœè¯¥ç½‘æ®µå†…ä¸å­˜åœ¨ç»„G1çš„å…¶ä»–æˆå‘˜ï¼ŒæŸ¥è¯¢å™¨å°†ä¸ä¼šæ”¶åˆ°é’ˆå¯¹ç»„G1çš„æŠ¥å‘ŠæŠ¥æ–‡ã€‚åœ¨Timer-Membershipè¶…æ—¶åï¼ŒæŸ¥è¯¢å™¨å°†åˆ é™¤ï¼ˆ*ï¼ŒG1ï¼‰å¯¹åº”çš„IGMPç»„è¡¨é¡¹ã€‚å½“æœ‰ç»„G1çš„ç»„æ’­æ•°æ®åˆ°è¾¾æŸ¥è¯¢å™¨æ—¶ï¼ŒæŸ¥è¯¢å™¨å°†ä¸ä¼šå‘ä¸‹æ¸¸è½¬å‘ã€‚ IGMPv3IGMPv3ä¸»è¦æ˜¯ä¸ºäº†é…åˆSSMï¼ˆSource-Specific Multicastï¼‰æ¨¡å‹å‘å±•èµ·æ¥çš„ï¼Œæä¾›äº†åœ¨æŠ¥æ–‡ä¸­æºå¸¦ç»„æ’­æºä¿¡æ¯çš„èƒ½åŠ›ï¼Œå³ä¸»æœºå¯ä»¥å¯¹ç»„æ’­æºè¿›è¡Œé€‰æ‹©ã€‚ ä¸IGMPv2ç›¸æ¯”ï¼ŒIGMPv3æŠ¥æ–‡çš„å˜åŒ–å¦‚ä¸‹ï¼š IGMPv3æŠ¥æ–‡åŒ…å«ä¸¤å¤§ç±»ï¼šæŸ¥è¯¢æŠ¥æ–‡å’Œæˆå‘˜æŠ¥å‘ŠæŠ¥æ–‡ã€‚IGMPv3æ²¡æœ‰å®šä¹‰ä¸“é—¨çš„æˆå‘˜ç¦»å¼€æŠ¥æ–‡ï¼Œæˆå‘˜ç¦»å¼€é€šè¿‡ç‰¹å®šç±»å‹çš„æŠ¥å‘ŠæŠ¥æ–‡æ¥ä¼ è¾¾ã€‚ æŸ¥è¯¢æŠ¥æ–‡ä¸­ä¸ä»…åŒ…å«æ™®éç»„æŸ¥è¯¢æŠ¥æ–‡å’Œç‰¹å®šç»„æŸ¥è¯¢æŠ¥æ–‡ï¼Œè¿˜æ–°å¢äº†ç‰¹å®šæºç»„æŸ¥è¯¢æŠ¥æ–‡ï¼ˆGroup-and-Source-Specific Queryï¼‰ã€‚è¯¥æŠ¥æ–‡ç”±æŸ¥è¯¢å™¨å‘å…±äº«ç½‘æ®µå†…ç‰¹å®šç»„æ’­ç»„æˆå‘˜å‘é€ï¼Œç”¨äºæŸ¥è¯¢è¯¥ç»„æˆå‘˜æ˜¯å¦æ„¿æ„æ¥æ”¶ç‰¹å®šæºå‘é€çš„æ•°æ®ã€‚ç‰¹å®šæºç»„æŸ¥è¯¢é€šè¿‡åœ¨æŠ¥æ–‡ä¸­æºå¸¦ä¸€ä¸ªæˆ–å¤šä¸ªç»„æ’­æºåœ°å€æ¥è¾¾åˆ°è¿™ä¸€ç›®çš„ã€‚ æˆå‘˜æŠ¥å‘ŠæŠ¥æ–‡ä¸ä»…åŒ…å«ä¸»æœºæƒ³è¦åŠ å…¥çš„ç»„æ’­ç»„ï¼Œè€Œä¸”åŒ…å«ä¸»æœºæƒ³è¦æ¥æ”¶æ¥è‡ªå“ªäº›ç»„æ’­æºçš„æ•°æ®ã€‚IGMPv3å¢åŠ äº†é’ˆå¯¹ç»„æ’­æºçš„è¿‡æ»¤æ¨¡å¼ï¼ˆINCLUDE&#x2F;EXCLUDEï¼‰ï¼Œå°†ç»„æ’­ç»„ä¸æºåˆ—è¡¨ä¹‹é—´çš„å¯¹åº”å…³ç³»ç®€å•çš„è¡¨ç¤ºä¸ºï¼ˆGï¼ŒINCLUDEï¼Œ(S1ã€S2â€¦)ï¼‰ï¼Œè¡¨ç¤ºåªæ¥æ”¶æ¥è‡ªæŒ‡å®šç»„æ’­æºS1ã€S2â€¦â€¦å‘å¾€ç»„Gçš„æ•°æ®ï¼›æˆ–ï¼ˆGï¼ŒEXCLUDEï¼Œ(S1ã€S2â€¦)ï¼‰ï¼Œè¡¨ç¤ºæ¥æ”¶é™¤äº†ç»„æ’­æºS1ã€S2â€¦â€¦ä¹‹å¤–çš„ç»„æ’­æºå‘ç»™ç»„Gçš„æ•°æ®ã€‚å½“ç»„æ’­ç»„ä¸ç»„æ’­æºåˆ—è¡¨çš„å¯¹åº”å…³ç³»å‘ç”Ÿäº†å˜åŒ–ï¼ŒIGMPv3æŠ¥å‘ŠæŠ¥æ–‡ä¼šå°†è¯¥å…³ç³»å˜åŒ–å­˜æ”¾äºç»„è®°å½•ï¼ˆGroup Recordï¼‰å­—æ®µï¼Œå‘é€ç»™IGMPæŸ¥è¯¢å™¨ã€‚ åœ¨IGMPv3ä¸­ä¸€ä¸ªæˆå‘˜æŠ¥å‘ŠæŠ¥æ–‡å¯ä»¥æºå¸¦å¤šä¸ªç»„æ’­ç»„ä¿¡æ¯ï¼Œè€Œä¹‹å‰çš„ç‰ˆæœ¬ä¸€ä¸ªæˆå‘˜æŠ¥å‘Šåªèƒ½æºå¸¦ä¸€ä¸ªç»„æ’­ç»„ã€‚è¿™æ ·åœ¨IGMPv3ä¸­æŠ¥æ–‡æ•°é‡å¤§å¤§å‡å°‘ã€‚ IGMPv3æŠ¥æ–‡ å­—æ®µ è¯´æ˜ Type æŠ¥æ–‡ç±»å‹ï¼Œå–å€¼ä¸º0x11ã€‚ Max Response Code æœ€å¤§å“åº”æ—¶é—´ã€‚æˆå‘˜ä¸»æœºåœ¨æ”¶åˆ°IGMPæŸ¥è¯¢å™¨å‘é€çš„æ™®éç»„æŸ¥è¯¢æŠ¥æ–‡åï¼Œéœ€è¦åœ¨æœ€å¤§å“åº”æ—¶é—´å†…åšå‡ºå›åº”ã€‚ Checksum æ ¡éªŒå’Œã€‚ Group Address ç»„æ’­ç»„åœ°å€ã€‚åœ¨æ™®éç»„æŸ¥è¯¢æŠ¥æ–‡ä¸­ï¼Œè¯¥å­—æ®µè®¾ä¸º0ï¼›åœ¨ç‰¹å®šç»„æŸ¥è¯¢æŠ¥æ–‡å’Œç‰¹å®šæºç»„æŸ¥è¯¢æŠ¥æ–‡ä¸­ï¼Œè¯¥å­—æ®µä¸ºè¦æŸ¥è¯¢çš„ç»„æ’­ç»„åœ°å€ã€‚ Resv ä¿ç•™å­—æ®µã€‚å‘é€æŠ¥æ–‡æ—¶è¯¥å­—æ®µè®¾ä¸º0ï¼›æ¥æ”¶æŠ¥æ–‡æ—¶ï¼Œå¯¹è¯¥å­—æ®µä¸åšå¤„ç†ã€‚ S è¯¥æ¯”ç‰¹ä½ä¸º1æ—¶ï¼Œæ‰€æœ‰æ”¶åˆ°æ­¤æŸ¥è¯¢æŠ¥æ–‡çš„å…¶ä»–è®¾å¤‡ä¸å¯åŠ¨å®šæ—¶å™¨åˆ·æ–°è¿‡ç¨‹ï¼Œä½†æ˜¯æ­¤æŸ¥è¯¢æŠ¥æ–‡å¹¶ä¸æŠ‘åˆ¶æŸ¥è¯¢å™¨é€‰ä¸¾è¿‡ç¨‹å’Œè®¾å¤‡çš„ä¸»æœºä¾§å¤„ç†è¿‡ç¨‹ã€‚ QRV å¦‚æœè¯¥å­—æ®µé0ï¼Œåˆ™è¡¨ç¤ºæŸ¥è¯¢å™¨çš„å¥å£®ç³»æ•°ï¼ˆRobustness Variableï¼‰ã€‚å¦‚æœè¯¥å­—æ®µä¸º0ï¼Œåˆ™è¡¨ç¤ºæŸ¥è¯¢å™¨çš„å¥å£®ç³»æ•°å¤§äº7ã€‚è®¾å¤‡æ¥æ”¶åˆ°æŸ¥è¯¢æŠ¥æ–‡æ—¶ï¼Œå¦‚æœå‘ç°è¯¥å­—æ®µé0ï¼Œåˆ™å°†è‡ªå·±çš„å¥å£®ç³»æ•°è°ƒæ•´ä¸ºè¯¥å­—æ®µçš„å€¼ï¼›å¦‚æœå‘ç°è¯¥å­—æ®µä¸º0ï¼Œåˆ™ä¸åšå¤„ç†ã€‚ QQIC IGMPæŸ¥è¯¢å™¨çš„æŸ¥è¯¢é—´éš”ï¼Œå•ä½ä¸ºç§’ã€‚éæŸ¥è¯¢å™¨æ”¶åˆ°æŸ¥è¯¢æŠ¥æ–‡æ—¶ï¼Œå¦‚æœå‘ç°è¯¥å­—æ®µé0ï¼Œåˆ™å°†è‡ªå·±çš„æŸ¥è¯¢é—´éš”å‚æ•°è°ƒæ•´ä¸ºè¯¥å­—æ®µçš„å€¼ï¼›å¦‚æœå‘ç°è¯¥å­—æ®µä¸º0ï¼Œåˆ™ä¸åšå¤„ç†ã€‚ Number of Sources æŠ¥æ–‡ä¸­åŒ…å«çš„ç»„æ’­æºçš„æ•°é‡ã€‚å¯¹äºæ™®éç»„æŸ¥è¯¢æŠ¥æ–‡å’Œç‰¹å®šç»„æŸ¥è¯¢æŠ¥æ–‡ï¼Œè¯¥å­—æ®µä¸º0ï¼›å¯¹äºç‰¹å®šæºç»„æŸ¥è¯¢æŠ¥æ–‡ï¼Œè¯¥å­—æ®µé0ã€‚æ­¤å‚æ•°çš„å¤§å°å—åˆ°æ‰€åœ¨ç½‘ç»œMTUå¤§å°çš„é™åˆ¶ã€‚ Source Address ç»„æ’­æºåœ°å€ï¼Œå…¶æ•°é‡å—åˆ°Number of Sourceså­—æ®µå€¼å¤§å°çš„é™åˆ¶ã€‚ å­—æ®µ è¯´æ˜ Type æŠ¥æ–‡ç±»å‹ï¼Œå–å€¼ä¸º0x22ã€‚ Reserved ä¿ç•™å­—æ®µã€‚å‘é€æŠ¥æ–‡æ—¶è¯¥å­—æ®µè®¾ä¸º0ï¼›æ¥æ”¶æŠ¥æ–‡æ—¶ï¼Œå¯¹è¯¥å­—æ®µä¸åšå¤„ç†ã€‚ Checksum IGMPæŠ¥æ–‡çš„æ ¡éªŒå’Œã€‚æ ¡éªŒå’Œæ˜¯IGMPæŠ¥æ–‡é•¿åº¦ï¼ˆå³IPæŠ¥æ–‡çš„æ•´ä¸ªæœ‰æ•ˆè´Ÿè½½ï¼‰çš„16ä½æ£€æµ‹ï¼Œè¡¨ç¤ºIGMPä¿¡æ¯è¡¥ç ä¹‹å’Œçš„è¡¥ç ã€‚Checksumå­—æ®µåœ¨è¿›è¡Œæ ¡éªŒè®¡ç®—æ—¶è®¾ä¸º0ã€‚å½“å‘é€æŠ¥æ–‡æ—¶ï¼Œå¿…é¡»è®¡ç®—æ ¡éªŒå’Œå¹¶æ’å…¥åˆ°Checksumå­—æ®µä¸­å»ã€‚å½“æ¥æ”¶æŠ¥æ–‡æ—¶ï¼Œæ ¡éªŒå’Œå¿…é¡»åœ¨å¤„ç†è¯¥æŠ¥æ–‡ä¹‹å‰è¿›è¡Œæ£€éªŒã€‚ Number of Group Records (M) æŠ¥æ–‡ä¸­åŒ…å«çš„ç»„è®°å½•çš„æ•°é‡ã€‚ Group Record ç»„è®°å½•ã€‚Group Recordå­—æ®µçš„æ ¼å¼å¦‚å›¾3æ‰€ç¤ºï¼Œè§£é‡Šå¦‚è¡¨3æ‰€ç¤ºã€‚ å­—æ®µ è¯´æ˜ Record Type ç»„è®°å½•çš„ç±»å‹ã€‚å…±åˆ†ä¸ºä¸‰å¤§ç±»ã€‚å½“å‰çŠ¶æ€æŠ¥å‘Šã€‚ç”¨äºå¯¹æŸ¥è¯¢æŠ¥æ–‡è¿›è¡Œå“åº”ï¼Œé€šå‘Šè‡ªå·±ç›®å‰çš„çŠ¶æ€ï¼Œå…±ä¸¤ç§ï¼šMODE_IS_INCLUDEï¼Œè¡¨ç¤ºæ¥æ”¶æºåœ°å€åˆ—è¡¨åŒ…å«çš„æºå‘å¾€è¯¥ç»„çš„ç»„æ’­æ•°æ®ã€‚å¦‚æœæŒ‡å®šæºåœ°å€åˆ—è¡¨ä¸ºç©ºï¼Œè¯¥æŠ¥æ–‡æ— æ•ˆã€‚MODE_IS_EXCLUDEï¼Œè¡¨ç¤ºä¸æ¥æ”¶æºåœ°å€åˆ—è¡¨åŒ…å«çš„æºå‘å¾€è¯¥ç»„çš„ç»„æ’­æ•°æ®ã€‚è¿‡æ»¤æ¨¡å¼æ”¹å˜æŠ¥å‘Šã€‚å½“ç»„å’Œæºçš„å…³ç³»åœ¨INCLUDEå’ŒEXCLUDEä¹‹é—´åˆ‡æ¢æ—¶ï¼Œä¼šé€šå‘Šè¿‡æ»¤æ¨¡å¼å‘ç”Ÿå˜åŒ–ï¼Œå…±ä¸¤ç§ï¼šCHANGE_TO_INCLUDE_MODEï¼Œè¡¨ç¤ºè¿‡æ»¤æ¨¡å¼ç”±EXCLUDEè½¬æ¢åˆ°INCLUDEï¼Œæ¥æ”¶æºåœ°å€åˆ—è¡¨åŒ…å«çš„æ–°ç»„æ’­æºå‘å¾€è¯¥ç»„æ’­ç»„çš„æ•°æ®ã€‚å¦‚æœæŒ‡å®šæºåœ°å€åˆ—è¡¨ä¸ºç©ºï¼Œä¸»æœºå°†ç¦»å¼€ç»„æ’­ç»„ã€‚CHANGE_TO_EXCLUDE_MODEï¼Œè¡¨ç¤ºè¿‡æ»¤æ¨¡å¼ç”±INCLUDEè½¬æ¢åˆ°EXCLUDEï¼Œæ‹’ç»æºåœ°å€åˆ—è¡¨åŒ…å«çš„æ–°ç»„æ’­æºå‘å¾€è¯¥ç»„çš„ç»„æ’­æ•°æ®ã€‚æºåˆ—è¡¨æ”¹å˜æŠ¥å‘Šã€‚å½“æŒ‡å®šæºå‘ç”Ÿæ”¹å˜æ—¶ï¼Œä¼šé€šå‘Šæºåˆ—è¡¨å‘ç”Ÿå˜åŒ–ï¼Œå…±ä¸¤ç§ï¼šALLOW_NEW_SOURCESï¼Œè¡¨ç¤ºåœ¨ç°æœ‰çš„åŸºç¡€ä¸Šï¼Œéœ€è¦æ¥æ”¶æºåœ°å€åˆ—è¡¨åŒ…å«çš„ç»„æ’­æºå‘å¾€è¯¥ç»„æ’­ç»„çš„ç»„æ’­æ•°æ®ã€‚å¦‚æœå½“å‰å¯¹åº”å…³ç³»ä¸ºINCLUDEï¼Œåˆ™å‘ç°æœ‰æºåˆ—è¡¨ä¸­æ·»åŠ è¿™äº›ç»„æ’­æºï¼›å¦‚æœå½“å‰å¯¹åº”å…³ç³»ä¸ºEXCLUDEï¼Œåˆ™ä»ç°æœ‰é˜»å¡æºåˆ—è¡¨ä¸­åˆ é™¤è¿™äº›ç»„æ’­æºã€‚BLOCK_OLD_SOURCESï¼Œè¡¨ç¤ºåœ¨ç°æœ‰çš„åŸºç¡€ä¸Šï¼Œä¸å†æ¥æ”¶æºåœ°å€åˆ—è¡¨åŒ…å«çš„ç»„æ’­æºå‘å¾€è¯¥ç»„æ’­ç»„çš„ç»„æ’­æ•°æ®ã€‚å¦‚æœå½“å‰å¯¹åº”å…³ç³»ä¸ºINCLUDEï¼Œåˆ™ä»ç°æœ‰æºåˆ—è¡¨ä¸­åˆ é™¤è¿™äº›ç»„æ’­æºï¼›å¦‚æœå½“å‰å¯¹åº”å…³ç³»ä¸ºEXCLUDEï¼Œåˆ™å‘ç°æœ‰æºåˆ—è¡¨ä¸­æ·»åŠ è¿™äº›ç»„æ’­æºã€‚ Aux Data Len è¾…åŠ©æ•°æ®é•¿åº¦ã€‚åœ¨IGMPv3çš„æŠ¥å‘ŠæŠ¥æ–‡ä¸­ï¼Œä¸å­˜åœ¨è¾…åŠ©æ•°æ®å­—æ®µï¼Œè¯¥å­—æ®µè®¾ä¸º0ã€‚ Number of Sources (N) æœ¬è®°å½•ä¸­åŒ…å«çš„æºåœ°å€æ•°é‡ã€‚ Multicast Address ç»„æ’­ç»„åœ°å€ã€‚ Source Address ç»„æ’­æºåœ°å€ã€‚ Auxiliary Data è¾…åŠ©æ•°æ®ã€‚é¢„ç•™ç»™IGMPåç»­æ‰©å±•æˆ–åç»­ç‰ˆæœ¬ã€‚åœ¨IGMPv3çš„æŠ¥å‘ŠæŠ¥æ–‡ä¸­ï¼Œä¸å­˜åœ¨è¾…åŠ©æ•°æ®ã€‚ IGMPv3å·¥ä½œæœºåˆ¶åœ¨å·¥ä½œæœºåˆ¶ä¸Šï¼Œä¸IGMPv2ç›¸æ¯”ï¼ŒIGMPv3å¢åŠ äº†ä¸»æœºå¯¹ç»„æ’­æºçš„é€‰æ‹©èƒ½åŠ›ã€‚ ç‰¹å®šæºç»„åŠ å…¥ IGMPv3çš„æˆå‘˜æŠ¥å‘ŠæŠ¥æ–‡çš„ç›®çš„åœ°å€ä¸º224.0.0.22ï¼ˆè¡¨ç¤ºåŒä¸€ç½‘æ®µæ‰€æœ‰ä½¿èƒ½IGMPv3çš„è®¾å¤‡ï¼‰ã€‚é€šè¿‡åœ¨æŠ¥å‘ŠæŠ¥æ–‡ä¸­æºå¸¦ç»„è®°å½•ï¼Œä¸»æœºåœ¨åŠ å…¥ç»„æ’­ç»„çš„åŒæ—¶ï¼Œèƒ½å¤Ÿæ˜ç¡®è¦æ±‚æ¥æ”¶æˆ–ä¸æ¥æ”¶ç‰¹å®šç»„æ’­æºå‘å‡ºçš„ç»„æ’­æ•°æ®ã€‚å¦‚å›¾4æ‰€ç¤ºï¼Œç½‘ç»œä¸­å­˜åœ¨S1å’ŒS2ä¸¤ä¸ªç»„æ’­æºï¼Œå‡å‘ç»„æ’­ç»„Gå‘é€ç»„æ’­æ•°æ®ï¼ŒHostä»…å¸Œæœ›æ¥æ”¶ä»ç»„æ’­æºS1å‘å¾€ç»„æ’­ç»„Gçš„ä¿¡æ¯ã€‚ å¦‚æœHostå’Œç»„æ’­è®¾å¤‡ä¹‹é—´è¿è¡Œçš„æ˜¯IGMPv1æˆ–IGMPv2ï¼ŒHoståŠ å…¥ç»„æ’­ç»„Gæ—¶æ— æ³•å¯¹ç»„æ’­æºè¿›è¡Œé€‰æ‹©ï¼Œæ— è®ºå…¶æ˜¯å¦éœ€è¦ï¼Œéƒ½ä¼šåŒæ—¶æ¥æ”¶åˆ°æ¥è‡ªç»„æ’­æºS1å’ŒS2çš„æ•°æ®ã€‚å¦‚æœé‡‡ç”¨IGMPv3ï¼Œæˆå‘˜ä¸»æœºå¯ä»¥å‘é€IGMPv3æŠ¥å‘Šï¼ˆGï¼ŒINCLUDEï¼Œ(S1)ï¼‰ï¼Œé€‰æ‹©ä»…æ¥æ”¶æºS1å‘ç»„æ’­ç»„Gå‘é€çš„æ•°æ®ã€‚ ç‰¹å®šæºç»„æŸ¥è¯¢ å½“æ¥æ”¶åˆ°ç»„æˆå‘˜å‘é€çš„æ”¹å˜ç»„æ’­ç»„ä¸æºåˆ—è¡¨çš„å¯¹åº”å…³ç³»çš„æŠ¥å‘Šæ—¶ï¼ˆæ¯”å¦‚CHANGE_TO_INCLUDE_MODEã€CHANGE_TO_EXCLUDE_MODEï¼‰ï¼ŒIGMPæŸ¥è¯¢å™¨ä¼šå‘é€ç‰¹å®šæºç»„æŸ¥è¯¢æŠ¥æ–‡ã€‚å¦‚æœç»„æˆå‘˜å¸Œæœ›æ¥æ”¶å…¶ä¸­ä»»æ„ä¸€ä¸ªæºçš„ç»„æ’­æ•°æ®ï¼Œå°†åé¦ˆæŠ¥å‘ŠæŠ¥æ–‡ã€‚IGMPæŸ¥è¯¢å™¨æ ¹æ®åé¦ˆçš„ç»„æˆå‘˜æŠ¥å‘Šæ›´æ–°è¯¥ç»„å¯¹åº”çš„æºåˆ—è¡¨ã€‚ å„ä¸ªç‰ˆæœ¬æ¯”è¾ƒ IGMP Snooping å½“Routerå°†ç»„æ’­æŠ¥æ–‡è½¬å‘è‡³Switchä»¥åï¼ŒSwitchè´Ÿè´£å°†ç»„æ’­æŠ¥æ–‡è½¬å‘ç»™ç»„æ’­ç”¨æˆ·ã€‚ç”±äºç»„ æ’­æŠ¥æ–‡çš„ç›®çš„åœ°å€ä¸ºç»„æ’­ç»„åœ°å€ï¼Œåœ¨äºŒå±‚è®¾å¤‡ä¸Šæ˜¯å­¦ä¹ ä¸åˆ°è¿™ä¸€ç±»MACè¡¨é¡¹çš„ï¼Œå› æ­¤ç»„æ’­ æŠ¥æ–‡å°±ä¼šåœ¨æ‰€æœ‰æ¥å£è¿›è¡Œå¹¿æ’­ï¼Œå’Œå®ƒåœ¨åŒä¸€å¹¿æ’­åŸŸå†…çš„ç»„æ’­æˆå‘˜å’Œéç»„æ’­æˆå‘˜éƒ½èƒ½æ”¶åˆ°ç»„ æ’­æŠ¥æ–‡ã€‚è¿™æ ·ä¸ä½†æµªè´¹äº†ç½‘ç»œå¸¦å®½ï¼Œè€Œä¸”å½±å“äº†ç½‘ç»œä¿¡æ¯å®‰å…¨ã€‚ â€¢ IGMP Snoopingæœ‰æ•ˆåœ°è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚é…ç½®IGMP Snoopingåï¼ŒäºŒå±‚ç»„æ’­è®¾å¤‡å¯ä»¥ä¾¦å¬ å’Œåˆ†æç»„æ’­ç”¨æˆ·å’Œä¸Šæ¸¸è·¯ç”±å™¨ä¹‹é—´çš„IGMPæŠ¥æ–‡ï¼Œæ ¹æ®è¿™äº›ä¿¡æ¯å»ºç«‹äºŒå±‚ç»„æ’­è½¬å‘è¡¨é¡¹ï¼Œæ§ åˆ¶ç»„æ’­æ•°æ®æŠ¥æ–‡è½¬å‘ã€‚è¿™æ ·å°±é˜²æ­¢äº†ç»„æ’­æ•°æ®åœ¨äºŒå±‚ç½‘ç»œä¸­çš„å¹¿æ’­ã€‚ â€¢ è·¯ç”±å™¨ç«¯å£å½¢æˆåä¼šå¯åŠ¨è€åŒ–è®¡æ—¶å™¨ï¼ˆé»˜è®¤180sï¼‰,å½“è·¯ç”±å™¨ç«¯å£æ”¶åˆ°æ–°çš„æ™®éç»„æŸ¥è¯¢ååˆ· æ–°è¯¥è®¡æ—¶å™¨ã€‚ â€¢ æˆå‘˜ç«¯å£å½¢æˆåä¼šå¯åŠ¨è€åŒ–è®¡æ—¶å™¨ï¼ˆé»˜è®¤180sï¼‰,å½“æˆå‘˜ç«¯å£æ”¶åˆ°æ–°çš„æˆå‘˜å…³ç³»æŠ¥å‘ŠæŠ¥æ–‡å åˆ·æ–°è¯¥è®¡æ—¶å™¨ã€‚ â€¢ IGMP Snoopingä¸å†ä½¿ç”¨æˆå‘˜å…³ç³»æŠ¥å‘ŠæŠ¥æ–‡æŠ‘åˆ¶æœºåˆ¶ï¼š â–« ç”±äºIGMP Snoopingéœ€è¦ç›‘å¬IGMPæŠ¥æ–‡æ‰èƒ½å†³å®šç«¯å£è§’è‰²ï¼Œè¿›è€ŒæŒ‡å¯¼è½¬å‘ï¼Œæ‰€ä»¥æ‰€ æœ‰ç»„æˆå‘˜éƒ½éœ€è¦å‘é€IGMPç»„æˆå‘˜å…³ç³»æŠ¥å‘ŠæŠ¥æ–‡ã€‚ â–« å½“IGMP Snoopingè®¾å¤‡æ”¶åˆ°æˆå‘˜å…³ç³»æŠ¥å‘ŠæŠ¥æ–‡åï¼Œåªå°†æˆå‘˜å…³ç³»æŠ¥å‘ŠæŠ¥æ–‡ä»è·¯ç”±å™¨æ¥ å£å‘é€å‡ºå»ï¼Œä»è€Œé¿å…å…¶ä½™ç»„æˆå‘˜æ”¶åˆ°æˆå‘˜å…³ç³»æŠ¥å‘ŠæŠ¥æ–‡ï¼Œä¸è§¦å‘æˆå‘˜å…³ç³»æŠ¥å‘ŠæŠ¥æ–‡ æŠ‘åˆ¶æœºåˆ¶ã€‚ â€¢ æ”¶åˆ°IGMPç¦»å¼€æŠ¥æ–‡åï¼Œæˆå‘˜ç«¯å£çš„è€åŒ–å®šæ—¶å™¨ &#x3D; å¥å£®ç³»æ•°ï¼ˆé»˜è®¤2ï¼‰ x ç‰¹å®šç»„æŸ¥è¯¢é—´éš” ï¼ˆé»˜è®¤1sï¼‰ã€‚ IGMP SSM MappingSSMï¼ˆSource-Specific Multicastï¼‰ç§°ä¸ºæŒ‡å®šæºç»„æ’­ï¼Œè¦æ±‚è®¾å¤‡èƒ½äº†è§£æˆå‘˜ä¸»æœºåŠ å…¥ç»„æ’­ç»„æ—¶æ‰€æŒ‡å®šçš„ç»„æ’­æºã€‚å¦‚æœæˆå‘˜ä¸»æœºä¸Šè¿è¡ŒIGMPv3ï¼Œå¯ä»¥åœ¨IGMPv3æŠ¥å‘ŠæŠ¥æ–‡ä¸­ç›´æ¥æŒ‡å®šç»„æ’­æºåœ°å€ã€‚ä½†æ˜¯æŸäº›æƒ…å†µä¸‹ï¼Œæˆå‘˜ä¸»æœºåªèƒ½è¿è¡ŒIGMPv1æˆ–IGMPv2ï¼Œä¸ºäº†ä½¿å…¶ä¹Ÿèƒ½å¤Ÿä½¿ç”¨SSMæœåŠ¡ï¼Œè®¾å¤‡ä¸Šéœ€è¦æä¾›IGMP SSM MappingåŠŸèƒ½ã€‚ IGMP SSM Mappingçš„æœºåˆ¶æ˜¯ï¼šé€šè¿‡åœ¨è®¾å¤‡ä¸Šé™æ€é…ç½®SSMåœ°å€çš„æ˜ å°„è§„åˆ™ï¼Œå°†IGMPv1å’ŒIGMPv2æŠ¥å‘ŠæŠ¥æ–‡ä¸­çš„ï¼ˆ*, Gï¼‰ä¿¡æ¯è½¬åŒ–ä¸ºå¯¹åº”çš„ï¼ˆG, INCLUDE, (S1, S2â€¦)ï¼‰ä¿¡æ¯ï¼Œä»¥æä¾›SSMç»„æ’­æœåŠ¡ã€‚ é…ç½®äº†SSM Mappingè§„åˆ™åï¼Œå½“IGMPæŸ¥è¯¢å™¨æ”¶åˆ°æ¥è‡ªæˆå‘˜ä¸»æœºçš„IGMPv1æˆ–IGMPv2æŠ¥å‘ŠæŠ¥æ–‡æ—¶ï¼Œé¦–å…ˆæ£€æŸ¥è¯¥æŠ¥æ–‡ä¸­æ‰€æºå¸¦çš„ç»„æ’­ç»„åœ°å€Gï¼Œç„¶åæ ¹æ®æ£€æŸ¥ç»“æœçš„ä¸åŒåˆ†åˆ«è¿›è¡Œå¤„ç†ã€‚ å¦‚æœGåœ¨ASMï¼ˆAny-Source Multicastï¼‰èŒƒå›´å†…ï¼Œåˆ™åªæä¾›ASMæœåŠ¡ã€‚ å¦‚æœGåœ¨SSMç»„åœ°å€èŒƒå›´å†…ï¼ˆç¼ºçœæƒ…å†µä¸‹ä¸º232.0.0.0ï½232.255.255.255ï¼‰ï¼š å¦‚æœè®¾å¤‡ä¸Šæ²¡æœ‰Gå¯¹åº”çš„SSM Mappingè§„åˆ™ï¼Œåˆ™æ— æ³•æä¾›SSMæœåŠ¡ï¼Œä¸¢å¼ƒè¯¥æŠ¥æ–‡ã€‚ å¦‚æœè®¾å¤‡ä¸Šæœ‰Gå¯¹åº”çš„SSM Mappingè§„åˆ™ï¼Œåˆ™ä¾æ®è§„åˆ™å°†æŠ¥å‘ŠæŠ¥æ–‡ä¸­æ‰€åŒ…å«çš„ï¼ˆ*, Gï¼‰ä¿¡æ¯æ˜ å°„ä¸ºï¼ˆG, INCLUDE, (S1, S2â€¦)ï¼‰ä¿¡æ¯ï¼Œæä¾›SSMæœåŠ¡ã€‚ SSMç½‘ç»œçš„ç”¨æˆ·ç½‘æ®µä¸­HostAè¿è¡ŒIGMPv3ã€HostBè¿è¡ŒIGMPv2ã€HostCè¿è¡ŒIGMPv1ã€‚HostBå’ŒHostCæ— æ³•å‡çº§åˆ°IGMPv3ï¼Œå¦‚æœè¦ä¸ºè¯¥ç½‘æ®µä¸­çš„æ‰€æœ‰ä¸»æœºæä¾›SSMæœåŠ¡ï¼Œéœ€è¦åœ¨IGMPæŸ¥è¯¢å™¨ï¼ˆDeviceï¼‰ä¸Šä½¿èƒ½IGMP SSM Mappingå¹¶é…ç½®ç›¸åº”çš„æ˜ å°„è§„åˆ™ã€‚ å‡å¦‚åœ¨Deviceä¸Šé…ç½®å¦‚ä¸‹æ˜ å°„å…³ç³»ï¼š ç»„æ’­ç»„åœ°å€ æ˜ å°„çš„ç»„æ’­æºåœ°å€ 232.0.0.0&#x2F;8 10.10.1.1 232.1.0.0&#x2F;16 10.10.2.2 232.1.0.0&#x2F;16 10.10.3.3 232.1.1.0&#x2F;24 10.10.4.4 ç»è¿‡æ˜ å°„åï¼ŒDeviceæ”¶åˆ°HostBå’ŒHostCçš„æˆå‘˜æŠ¥å‘ŠæŠ¥æ–‡æ—¶ï¼Œé¦–å…ˆåˆ¤æ–­æŠ¥æ–‡æºå¸¦çš„ç»„åœ°å€æ˜¯å¦åœ¨SSMèŒƒå›´å†…ï¼Œå‘ç°åœ¨SSMèŒƒå›´å†…ï¼Œåˆ™æ ¹æ®é…ç½®çš„æ˜ å°„è§„åˆ™ç”Ÿæˆå¦‚ä¸‹æ‰€ç¤ºçš„ç»„æ’­è¡¨é¡¹ã€‚å¦‚æœä¸€ä¸ªç»„åœ°å€æ˜ å°„äº†å¤šä¸ªæºï¼Œåˆ™ç”Ÿæˆå¤šä¸ªï¼ˆSï¼ŒGï¼‰è¡¨é¡¹ã€‚ åœ¨æ˜ å°„è¿‡ç¨‹ä¸­ï¼Œä¸€ä¸ªç»„æ’­ç»„åœ°å€åªè¦èƒ½åœ¨è§„åˆ™ä¸­åŒ¹é…åˆ°ï¼Œéƒ½ä¼šç”Ÿæˆä¸€æ¡ç›¸åº”çš„è¡¨é¡¹ã€‚å› æ­¤232.1.1.1æœ‰å››æ¡è¡¨é¡¹ï¼Œ232.1.2.2æœ‰ä¸‰æ¡è¡¨é¡¹ã€‚ IGMPv1&#x2F;IGMPv2æŠ¥å‘ŠæŠ¥æ–‡ä¸­çš„ç»„åœ°å€ ç”Ÿæˆçš„ç»„æ’­è¡¨é¡¹ 232.1.1.1 ï¼ˆæ¥è‡ªHostCï¼‰ ï¼ˆ10.10.1.1ï¼Œ232.1.1.1ï¼‰ï¼ˆ10.10.2.2ï¼Œ232.1.1.1ï¼‰ï¼ˆ10.10.3.3ï¼Œ232.1.1.1ï¼‰ï¼ˆ10.10.4.4ï¼Œ232.1.1.1ï¼‰ 232.1.2.2 ï¼ˆæ¥è‡ªHostBï¼‰ ï¼ˆ10.10.1.1ï¼Œ232.1.2.2ï¼‰ï¼ˆ10.10.2.2ï¼Œ232.1.2.2ï¼‰ï¼ˆ10.10.3.3ï¼Œ232.1.2.2ï¼‰ IGMP Proxy PIM DMPIM-DMï¼šå¯†é›†æ¨¡å¼ï¼Œé‡‡ç”¨çš„æ˜¯â€œæ¨â€æ¨¡å¼ï¼Œé€‚ç”¨äºæˆå‘˜æ¯”è¾ƒå°‘ï¼Œç›¸å¯¹å¯†é›†çš„åœºæ™¯ PIM-SMï¼šç¨€ç–æ¨¡å¼ é‡‡ç”¨çš„æ˜¯â€œæ‹‰â€æ¨¡å¼ï¼Œé€‚ç”¨äºæˆå‘˜å¤šï¼Œä½†æ˜¯æˆå‘˜ä¸é›†ä¸­çš„åœºæ™¯ PIMï¼ˆProtocol Independent Multicastï¼Œåè®®æ— å…³ç»„æ’­ï¼‰æ˜¯åŸŸå†…ç»„æ’­è·¯ç”±åè®®ï¼Œåˆ©ç”¨å•æ’­è·¯ç”±ä¿¡æ¯ï¼Œå¯¹ç»„æ’­æ¶ˆæ¯è¿›è¡ŒRPFæ£€æŸ¥ï¼Œåˆ›å»ºç»„æ’­è·¯ç”±è¡¨é¡¹ã€‚ä¸ºIPç»„æ’­æä¾›è·¯ç”±ä¿¡æ¯çš„åè®®å¯ä»¥æ˜¯ä»»ä½•å•æ’­è·¯ç”±åè®®ï¼Œæ¯”å¦‚é™æ€è·¯ç”±ã€RIPã€OSPFã€IS-ISã€BGPç­‰ã€‚ç»„æ’­è·¯ç”±å’Œå•æ’­è·¯ç”±åè®®æ— å…³ï¼Œåªæ˜¯é€šè¿‡å•æ’­è·¯ç”±è¡¨äº§ç”Ÿç›¸åº”ç»„æ’­è·¯ç”±è¡¨é¡¹ã€‚ ç›®å‰åœ¨å®é™…ç½‘ç»œä¸­ï¼ŒPIMåè®®æœ‰ä¸‰ç§æ¨¡å¼ï¼šPIM-DMã€ä½¿ç”¨ASMï¼ˆAny-Source Multicastï¼‰æ¨¡å‹çš„PIM-SMï¼Œä½¿ç”¨SSMï¼ˆSource-Specific Multicastï¼‰æ¨¡å‹çš„PIM-SMã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒåŒä¸€ä¸ªPIMåŸŸä¸­ä¸èƒ½åŒæ—¶è¿è¡ŒPIM-DMå’ŒPIM-SMã€‚ PIMåè®®ä¸­ä¾æ®ç»„æ’­åˆ†å‘æ ‘è½¬å‘æ•°æ®ï¼Œç»„æ’­åˆ†å‘æ ‘æœ‰ä¸¤ç§ï¼ŒSPTå’ŒRPT ä»¥ç»„æ’­æºä¸ºæ ¹ï¼Œç»„æ’­ç»„æˆå‘˜ä¸ºå¶å­çš„ç»„æ’­åˆ†å‘æ ‘ç§°ä¸ºSPTï¼ˆShortest Path Treeï¼‰ï¼Œåœ¨PIM-DMä¸PIM-SMä¸­å‡æœ‰ä½¿ç”¨ã€‚ä»¥RPï¼ˆRendezvous Pointï¼‰ä¸ºæ ¹ï¼Œç»„æ’­ç»„æˆå‘˜ä¸ºå¶å­çš„ç»„æ’­åˆ†å‘æ ‘ç§°ä¸ºRPTï¼ˆRP Treeï¼‰ï¼Œåœ¨PIM-SMä¸­ä½¿ç”¨ã€‚ PIM-DMåŸŸä¸­ç»„æ’­æ•°æ®è½¬å‘çš„å®ç°è¿‡ç¨‹æ˜¯ï¼š é‚»å±…å‘ç°Neighbor Discoveryï¼‰ï¼šåœ¨PIM-DMåŸŸä¸­ï¼ŒPIMè®¾å¤‡é€šè¿‡å‘¨æœŸæ€§çš„å‘æ‰€æœ‰å…¶ä»–PIMè®¾å¤‡å‘é€Helloæ¶ˆæ¯ï¼Œæ¥å‘ç°PIMé‚»å±…ï¼Œç»´æŠ¤PIMè®¾å¤‡ä¹‹é—´çš„PIMé‚»å±…å…³ç³»ã€‚ç¼ºçœæƒ…å†µä¸‹ï¼Œæ— è®ºPIMè®¾å¤‡æ˜¯å¦æ”¶åˆ°æ¥è‡ªé‚»å±…çš„Helloæ¶ˆæ¯ï¼Œéƒ½ä¼šæ¥æ”¶å…¶ä»–çš„PIMæ§åˆ¶æ¶ˆæ¯æˆ–ç»„æ’­æŠ¥æ–‡ã€‚ä½†æ˜¯å¦‚æœPIMè®¾å¤‡é…ç½®äº†é‚»å±…æ£€æŸ¥åŠŸèƒ½ï¼Œåˆ™åªæœ‰åœ¨PIMè®¾å¤‡æ¥æ”¶åˆ°æ¥è‡ªé‚»å±…çš„Helloæ¶ˆæ¯åï¼Œæ‰ä¼šæ¥æ”¶å…¶ä»–çš„PIMæ§åˆ¶æ¶ˆæ¯æˆ–ç»„æ’­æŠ¥æ–‡ã€‚ æ‰©æ•£Floodingï¼‰ï¼šPIM-DMå‡è®¾ç½‘ç»œä¸­çš„æ¯ä¸ªå­ç½‘éƒ½å­˜åœ¨è‡³å°‘ä¸€ä¸ªç»„æ’­ç»„æˆå‘˜ï¼Œå› æ­¤ç»„æ’­æ•°æ®å°†è¢«æ‰©æ•£åˆ°ç½‘ç»œä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œç½‘ç»œä¸­æ‰€æœ‰çš„PIMè®¾å¤‡éƒ½èƒ½æ¥æ”¶åˆ°ç»„æ’­æ•°æ®ã€‚ å‰ªæï¼ˆPruneï¼‰ï¼šç»„æ’­æ•°æ®æ‰©æ•£åˆ°ç½‘ç»œä¸­åï¼ŒPIM-DMå¯¹æ²¡æœ‰ç»„æ’­æ•°æ®æ¥æ”¶è€…çš„åˆ†æ”¯è¿›è¡Œå‰ªæï¼Œåªä¿ç•™åŒ…å«æ¥æ”¶è€…çš„åˆ†æ”¯ï¼Œå³ç¡®ä¿ç½‘ç»œä¸­åªæœ‰éœ€è¦ç»„æ’­æ•°æ®çš„PIMè®¾å¤‡èƒ½å¤Ÿæ¥æ”¶åˆ°ç»„æ’­æ•°æ®ï¼Œä¸éœ€è¦ç»„æ’­æ•°æ®çš„PIMè®¾å¤‡æ¥æ”¶ä¸åˆ°ç»„æ’­æ•°æ®ã€‚ çŠ¶æ€åˆ·æ–°ï¼ˆState-Refreshï¼‰ï¼šå¦‚æœè®¾å¤‡å¤„äºå‰ªæçŠ¶æ€ï¼Œå…¶ä¸Šæ¸¸PIMè®¾å¤‡ä¼šç»´æŠ¤ä¸€ä¸ªâ€œå‰ªæå®šæ—¶å™¨â€ã€‚å½“å‰ªæå®šæ—¶å™¨è¶…æ—¶ï¼Œä¸Šæ¸¸PIMè®¾å¤‡æ¢å¤å¯¹ä¸éœ€è¦æ•°æ®çš„ä¸‹æ¸¸PIMè®¾å¤‡çš„æ•°æ®è½¬å‘ï¼Œè¿™æ ·ä¼šå¯¼è‡´ä¸å¿…è¦çš„ç½‘ç»œèµ„æºæµªè´¹ã€‚é‡‡ç”¨çŠ¶æ€åˆ·æ–°å¯ä½¿ç¦»ç»„æ’­æºæœ€è¿‘çš„ç¬¬ä¸€è·³è®¾å¤‡å‘¨æœŸæ€§å‘é€State-Refreshæ¶ˆæ¯ï¼Œåˆ·æ–°æ‰€æœ‰è®¾å¤‡çš„å‰ªæå®šæ—¶å™¨çŠ¶æ€ï¼Œå¯¹ä¸éœ€è¦æ•°æ®çš„ä¸‹æ¸¸è®¾å¤‡å§‹ç»ˆä¿æŒå‰ªæçŠ¶æ€ã€‚ å«æ¥Graftï¼‰ï¼šå½“è¢«å‰ªæåˆ†æ”¯çš„èŠ‚ç‚¹ä¸Šå‡ºç°äº†ç»„æ’­ç»„æˆå‘˜æ—¶ï¼Œä¸ºäº†å‡å°‘è¯¥èŠ‚ç‚¹æ¢å¤æˆè½¬å‘çŠ¶æ€æ‰€éœ€çš„æ—¶é—´ï¼ŒPIM-DMä½¿ç”¨å«æ¥æœºåˆ¶ä¸»åŠ¨æ¢å¤å…¶å¯¹ç»„æ’­æ•°æ®çš„è½¬å‘ã€‚ æ–­è¨€ï¼ˆAssertï¼‰ï¼šå¦‚æœåœ¨ä¸€ä¸ªç½‘æ®µå†…å‡ºç°å¤šå°PIMè®¾å¤‡ï¼Œåˆ™ç›¸åŒçš„ç»„æ’­æŠ¥æ–‡å¯èƒ½ä¼šè¢«é‡å¤å‘é€åˆ°è¯¥ç½‘æ®µã€‚é€šè¿‡æ–­è¨€å¯ä»¥ä¸ºç½‘æ®µé€‰å®šå”¯ä¸€çš„ç»„æ’­æ•°æ®è½¬å‘è€…ï¼Œé¿å…å†—ä½™çš„ç»„æ’­æ•°æ®è½¬å‘ã€‚ é‚»å±…å‘ç°PIMè®¾å¤‡åœ¨æ¯ä¸ªä½¿èƒ½äº†PIMçš„æ¥å£ä¸Šï¼Œéƒ½ä¼šå¯¹å¤–å‘é€Helloæ¶ˆæ¯ã€‚å°è£…Helloæ¶ˆæ¯çš„ç»„æ’­æŠ¥æ–‡æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š ç›®çš„åœ°å€æ˜¯224.0.0.13ï¼Œè¡¨ç¤ºåŒä¸€ç½‘æ®µä¸­æ‰€æœ‰PIMè®¾å¤‡ æºåœ°å€ä¸ºæ¥å£çš„IPåœ°å€ TTLæ•°å€¼ä¸º1ï¼Œä»…å‘é€ç»™é‚»å±…æ¥å£ Helloæ¶ˆæ¯å…·æœ‰å‘ç°é‚»å±…ã€åå•†å„é¡¹åè®®å‚æ•°ã€ç»´æŒé‚»å±…å…³ç³»çš„ä½œç”¨ã€‚ å‘ç°PIMé‚»å±… åŒä¸€ç½‘æ®µä¸­çš„PIMè®¾å¤‡éƒ½å¿…é¡»æ¥æ”¶ç›®çš„åœ°å€ä¸º224.0.0.13çš„ç»„æ’­æŠ¥æ–‡ã€‚è¿™æ ·åœ¨æ”¶åˆ°Helloæ¶ˆæ¯ä»¥åï¼Œç›´æ¥ç›¸è¿çš„ç»„æ’­è®¾å¤‡ä¹‹é—´ï¼Œå°±å¯ä»¥çŸ¥é“è‡ªå·±çš„é‚»å±…ä¿¡æ¯ã€‚ åå•†å„é¡¹åè®®å‚æ•° Helloæ¶ˆæ¯ä¸­æºå¸¦å¤šé¡¹åè®®å‚æ•°ï¼Œé‚»å±…ä¹‹é—´é€šè¿‡Helloæ¶ˆæ¯æ¥è¿›è¡Œåå•†ï¼Œè¿™äº›å‚æ•°åŒ…æ‹¬ï¼š DR_Priorityï¼šè¡¨ç¤ºå„è®¾å¤‡æ¥å£ç«é€‰DRçš„ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§è¶Šé«˜è¶Šå®¹æ˜“è·èƒœã€‚ Holdtimeï¼šè¡¨ç¤ºä¿æŒé‚»å±…ä¸ºå¯è¾¾çŠ¶æ€çš„è¶…æ—¶æ—¶é—´ã€‚ LAN_Delayï¼šè¡¨ç¤ºå…±äº«ç½‘æ®µå†…ä¼ è¾“Pruneæ¶ˆæ¯çš„å»¶è¿Ÿæ—¶é—´ã€‚ Override-Intervalï¼šè¡¨ç¤ºHelloæ¶ˆæ¯]ä¸­æºå¸¦çš„å¦å†³å‰ªæçš„æ—¶é—´é—´éš”ã€‚ ç»´æŒé‚»å±…å…³ç³» PIMè®¾å¤‡ä¹‹é—´å‘¨æœŸæ€§åœ°å‘é€Helloæ¶ˆæ¯ã€‚å¦‚æœHoldtimeè¶…æ—¶è¿˜æ²¡æœ‰æ”¶åˆ°è¯¥PIMé‚»å±…å‘å‡ºçš„æ–°çš„Helloæ¶ˆæ¯ï¼Œåˆ™è®¤ä¸ºè¯¥é‚»å±…ä¸å¯è¾¾ï¼Œå°†å…¶ä»é‚»å±…åˆ—è¡¨ä¸­æ¸…é™¤ã€‚ PIMé‚»å±…çš„å˜åŒ–å°†å¯¼è‡´ç½‘ç»œä¸­ç»„æ’­æ‹“æ‰‘çš„å˜åŒ–ã€‚å¦‚æœç»„æ’­åˆ†å‘æ ‘ä¸Šçš„æŸä¸Šæ¸¸é‚»å±…æˆ–ä¸‹æ¸¸é‚»å±…ä¸å¯è¾¾ï¼Œå°†å¯¼è‡´ç»„æ’­è·¯ç”±é‡æ–°æ”¶æ•›ï¼Œç»„æ’­åˆ†å‘æ ‘è¿ç§»ã€‚ ç»´æŠ¤é‚»å±…å…³ç³» 30s é‚»å±…è¶…æ—¶æ—¶é—´105s æ‰©æ•£æœºåˆ¶å…¨ç½‘å»ºç«‹ï¼ˆSï¼ŒGï¼‰è·¯ç”±è¡¨é¡¹ ç»„æ’­æºå¼€å§‹å‘é€ç»„æ’­æ•°æ®ï¼Œç»„æ’­æ•°æ®å…¨ç½‘è¿›è¡Œè½¬å‘ï¼Œç”Ÿæˆï¼ˆSï¼ŒG ï¼‰è¡¨é¡¹ï¼Œè¡¨é¡¹é»˜è®¤è€åŒ–æ—¶é—´210sï¼Œï¼Œè¶…è¿‡210sæ²¡æœ‰ç»„æ’­æ•°æ®è½¬å‘ï¼Œå°†åˆ é™¤è¡¨é¡¹ï¼Œæœ‰ç»„æ’­ æ•°æ®çš„æ—¶å€™é‡æ–°å»ºç«‹è¡¨é¡¹ æ‰©æ•£æœºåˆ¶ä¼šå‘¨æœŸæ€§ï¼ˆé»˜è®¤180sï¼‰å…¨ç½‘æ‰©æ•£ç»„æ’­æ•°æ®ï¼Œå‘¨æœŸæ€§æ‰©æ•£çš„ä¸»è¦ç›®çš„æ˜¯æ¢æµ‹æ˜¯å¦æœ‰æ–°æˆå‘˜åŠ ç»„ï¼Œä½†æ˜¯ç”±äºå…¨ç½‘æ‰©æ•£ç»„æ’­æ•°æ®ä¼šæµªè´¹å¤§é‡å¸¦å®½ï¼Œæ‰€ä»¥ç°åœ¨çš„ç»„æ’­ç½‘ç»œä¸€èˆ¬ä½¿ç”¨â€œçŠ¶æ€åˆ·æ–°æœºåˆ¶â€åŠ ä¸Šâ€œå«æ¥æœºåˆ¶â€æ¥å®ç°å‘¨æœŸæ€§å…¨ç½‘æ‰©æ•£æ„ŸçŸ¥æ–°æˆå‘˜åŠ ç»„çš„ç›®çš„ã€‚ å‰ªæå¦‚æœè·¯ç”±å™¨ä¸‹æ¸¸æ²¡æœ‰ç»„æˆå‘˜ï¼Œå°†å‘ä¸Šæ¸¸å‘èµ·å‰ªæï¼Œå‰ªåˆ°æœ€åä¸€ä¸ªä¸éœ€è¦å‘ç»„æ’­æŠ¥æ–‡çš„è·¯ç”±å™¨ å‰ªææ¥å£ä¼šæœ‰ä¸€ä¸ªè®¡æ—¶å™¨ï¼Œ210sï¼Œè®¡æ—¶å™¨è¶…æ—¶ï¼Œæ¥å£å°†åŠ å…¥ä¸‹æ¸¸æ¥å£ï¼Œè½¬å‘ç»„æ’­æŠ¥æ–‡ çŠ¶æ€åˆ·æ–°æœºåˆ¶çŠ¶æ€åˆ·æ–°æŠ¥æ–‡60så‘ä¸€æ¬¡ å¯¹äºå‰ªæç«¯å£è€Œè¨€ï¼Œæ”¶åˆ°çŠ¶æ€åˆ·æ–°æŠ¥æ–‡ï¼Œè®¡æ—¶å™¨å°†é‡ç½® ç¦»ç»„æ’­æºæœ€è¿‘çš„ç¬¬ä¸€è·³è·¯ç”±å™¨å‘¨æœŸæ€§è§¦å‘State-Refreshæ¶ˆæ¯ã€‚State-Refreshæ¶ˆæ¯åœ¨å…¨ç½‘æ‰©æ•£ï¼Œåˆ·æ–°æ‰€æœ‰è®¾å¤‡ä¸Šçš„å‰ªæå®šæ—¶å™¨çŠ¶æ€ï¼Œå¯¹ä¸éœ€è¦æ•°æ®çš„ä¸‹æ¸¸è®¾å¤‡å§‹ç»ˆä¿æŒå‰ªæçŠ¶æ€ã€‚ å«æ¥ä¸€æ—¦æœ‰æ–°æˆå‘˜åŠ å…¥ï¼Œå¶å­è·¯ç”±å™¨ä¼šåŸºäºæœ¬åœ°çš„ç»„æ’­è·¯ç”±è¡¨å‘ä¸Šæ¸¸å‘é€GraftæŠ¥æ–‡ï¼Œè¯·æ±‚ä¸Šæ¸¸è·¯ç”±å™¨æ¢å¤ç›¸åº”å‡ºæ¥å£è½¬å‘ï¼Œå°†å…¶æ·»åŠ åœ¨ï¼ˆSï¼ŒGï¼‰è¡¨é¡¹ä¸‹æ¸¸æ¥å£åˆ—è¡¨ä¸­ã€‚ ä¸‹æ¸¸å‘é€Graftæ¶ˆæ¯ï¼Œè¯·æ±‚ä¸Šæ¸¸æ¢å¤å¯¹åº”å‡ºæ¥å£çš„è½¬å‘ã€‚ä¸Šæ¸¸æ”¶åˆ°Graftæ¶ˆæ¯åï¼Œå°†ä¸‹æ¸¸çš„å‡ºæ¥å£æ¢å¤è½¬å‘ æ–­è¨€åœ¨ç»„æ’­ç½‘ç»œä¸­ï¼Œå¦‚æœå‡ºç°å¦‚ä¸‹æƒ…å†µï¼Œåˆ™è¯´æ˜ç½‘æ®µä¸Šè¿˜å­˜åœ¨ç€å…¶ä»–çš„ç»„æ’­è½¬å‘è€…ã€‚ è¯¥ç»„æ’­æŠ¥æ–‡ä¸èƒ½é€šè¿‡RPFæ£€æŸ¥ã€‚ æ¥æ”¶åˆ°è¯¥ç»„æ’­æŠ¥æ–‡çš„æ¥å£æ˜¯æœ¬è®¾å¤‡ä¸Šï¼ˆSï¼ŒGï¼‰è¡¨é¡¹ä¸­çš„ä¸€ä¸ªä¸‹æ¸¸æ¥å£ã€‚ æ­¤æ—¶ï¼Œè®¾å¤‡ä¼šæ‰§è¡ŒAssertæœºåˆ¶ã€‚è®¾å¤‡ä»è¯¥ä¸‹æ¸¸æ¥å£å‘é€Assertæ¶ˆæ¯ã€‚åŒæ—¶ï¼Œè¯¥ä¸‹æ¸¸æ¥å£ä¹Ÿæ¥æ”¶åˆ°äº†æ¥è‡ªè¯¥ç½‘æ®µä¸Šå…¶ä»–ç»„æ’­è½¬å‘è€…çš„Assertæ¶ˆæ¯ã€‚Assertæ¶ˆæ¯çš„ç›®çš„åœ°å€ä¸º224.0.0.13ï¼Œæºåœ°å€ä¸ºä¸‹æ¸¸æ¥å£åœ°å€ï¼ŒTTLä¸º1ã€‚Assertæ¶ˆæ¯ä¸­æºå¸¦è¯¥PIMè®¾å¤‡åˆ°ç»„æ’­æºæˆ–RPçš„å¼€é”€ã€æ‰€é‡‡ç”¨çš„å•æ’­è·¯ç”±åè®®çš„ä¼˜å…ˆçº§å’Œç»„æ’­ç»„åœ°å€Gã€‚ è®¾å¤‡å°†è‡ªèº«æ¡ä»¶ä¸å¯¹æ–¹æŠ¥æ–‡ä¸­æºå¸¦çš„ä¿¡æ¯è¿›è¡Œæ¯”è¾ƒï¼Œç§°ä¸ºAssertç«é€‰ã€‚è§„åˆ™å¦‚ä¸‹ï¼š å•æ’­è·¯ç”±åè®®ä¼˜å…ˆçº§è¾ƒé«˜è€…è·èƒœã€‚ å¦‚æœä¼˜å…ˆçº§ç›¸åŒï¼Œåˆ™åˆ°ç»„æ’­æºæˆ–RPçš„å¼€é”€è¾ƒå°è€…è·èƒœã€‚ å¦‚æœä»¥ä¸Šéƒ½ç›¸åŒï¼Œåˆ™ä¸‹æ¸¸æ¥å£IPåœ°å€æœ€å¤§è€…è·èƒœã€‚ æ ¹æ®Assertç«é€‰ç»“æœï¼Œè®¾å¤‡å°†æ‰§è¡Œä¸åŒçš„æ“ä½œï¼š å¦‚æœè·èƒœï¼Œåˆ™è¯¥ä¸‹æ¸¸æ¥å£ä¿æŒè½¬å‘çŠ¶æ€ï¼Œè®¾å¤‡è´Ÿè´£åç»­åœ¨è¯¥ç½‘æ®µä¸Šçš„ï¼ˆSï¼ŒGï¼‰è½¬å‘ï¼Œè¯¥ä¸‹æ¸¸æ¥å£ç§°ä¸ºAssert winnerã€‚ å¦‚æœè½è´¥ï¼Œåˆ™ç¦æ­¢è¯¥ä¸‹æ¸¸æ¥å£è½¬å‘ç»„æ’­æŠ¥æ–‡ï¼Œå°†å…¶ä»ï¼ˆSï¼ŒGï¼‰è¡¨é¡¹ä¸‹æ¸¸æ¥å£åˆ—è¡¨ä¸­åˆ é™¤ã€‚è¯¥ä¸‹æ¸¸æ¥å£ç§°ä¸ºAssert loserã€‚ Assertç«é€‰ç»“æŸåï¼Œè¯¥ç½‘æ®µä¸Šåªå­˜åœ¨ä¸€ä¸ªæœ‰ä¸‹æ¸¸æ¥å£çš„ä¸Šæ¸¸è®¾å¤‡ï¼Œåªä¼ è¾“ä¸€ä»½ç»„æ’­æŠ¥æ–‡ã€‚Assert winnerå‘¨æœŸæ€§å‘é€Assertæ¶ˆæ¯ï¼Œç»´æŒAssert winnerçš„çŠ¶æ€ã€‚è‹¥Assert loserçš„å®šæ—¶å™¨è¶…æ—¶åï¼ŒAssert loserä»æ²¡æœ‰æ”¶åˆ°Assert winnerçš„Assertæ¶ˆæ¯ï¼Œåˆ™é‡æ–°æ·»åŠ ä¸‹æ¸¸æ¥å£è½¬å‘ç»„æ’­æ•°æ®ã€‚ å¦‚å›¾6æ‰€ç¤ºï¼Œå¦‚æœDeviceBå’ŒDeviceCéƒ½èƒ½å¤Ÿæ¥æ”¶åˆ°ç»„æ’­æºSourceå‘å‡ºçš„ç»„æ’­æŠ¥æ–‡ï¼Œå¹¶ä¸”å‡èƒ½é€šè¿‡RPFæ£€æŸ¥ï¼Œåˆ›å»ºï¼ˆSï¼ŒGï¼‰è¡¨é¡¹ã€‚DeviceBã€DeviceCçš„ä¸‹æ¸¸æ¥å£è¿æ¥åœ¨åŒä¸€ç½‘æ®µï¼Œé‚£ä¹ˆDeviceBå’ŒDeviceCå°±ä¼šåŒæ—¶å‘è¯¥ç½‘æ®µå‘é€ç»„æ’­æ•°æ®ã€‚Assertæœºåˆ¶å¯ä»¥ä¿è¯ä¸€ä¸ªç½‘æ®µåªèƒ½å­˜åœ¨ä¸€ä¸ªç»„æ’­æ•°æ®è½¬å‘è€…ã€‚Assertè¿‡ç¨‹å¦‚ä¸‹ï¼š DeviceBä»ä¸‹æ¸¸æ¥å£æ¥æ”¶åˆ°DeviceCå‘æ¥çš„ç»„æ’­æŠ¥æ–‡ï¼ŒRPFæ£€æŸ¥å¤±è´¥ï¼ŒæŠ¥æ–‡è¢«ä¸¢å¼ƒã€‚åŒæ—¶ï¼ŒDeviceBå‘è¯¥ç½‘æ®µå‘é€Assertæ¶ˆæ¯ã€‚ DeviceCå°†è‡ªèº«çš„è·¯ç”±ä¿¡æ¯ä¸å¯¹æ–¹çš„Assertæ¶ˆæ¯ä¸­æºå¸¦çš„è·¯ç”±ä¿¡æ¯è¿›è¡Œæ¯”è¾ƒï¼Œç”±äºè‡ªèº«åˆ°ç»„æ’­æºçš„å¼€é”€è¾ƒå¤§è€Œè½è´¥ã€‚äºæ˜¯ç¦æ­¢è¯¥ä¸‹æ¸¸æ¥å£è½¬å‘ç»„æ’­æŠ¥æ–‡ï¼Œå°†å…¶ä»DeviceCçš„ï¼ˆSï¼ŒGï¼‰è¡¨é¡¹çš„ä¸‹æ¸¸æ¥å£åˆ—è¡¨ä¸­åˆ é™¤ã€‚ DeviceCä»è¯¥ç½‘æ®µæ¥æ”¶åˆ°DeviceBå‘æ¥çš„ç»„æ’­æŠ¥æ–‡ï¼ŒRPFæ£€æŸ¥å¤±è´¥ï¼ŒæŠ¥æ–‡è¢«ä¸¢å¼ƒã€‚Assertè¿‡ç¨‹ç»“æŸã€‚ PIM SM RPä»‹ç»ï¼š æ±‡èšç‚¹RPï¼ˆRendezvous Pointï¼‰ä¸ºç½‘ç»œä¸­ä¸€å°é‡è¦çš„PIMè·¯ç”±å™¨ï¼Œç”¨äºå¤„ç†æºç«¯DRæ³¨å†Œä¿¡æ¯åŠç»„æˆå‘˜åŠ å…¥ è¯·æ±‚ï¼Œç½‘ç»œä¸­çš„æ‰€æœ‰PIMè·¯ç”±å™¨éƒ½å¿…é¡»çŸ¥é“RPçš„åœ°å€ï¼Œç±»ä¼¼äºä¸€ä¸ªä¾›æ±‚ä¿¡æ¯çš„æ±‡èšä¸­å¿ƒã€‚ â€¢ ç›®å‰å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼é…ç½®RPï¼š â–« é™æ€RPï¼šåœ¨ç½‘ç»œä¸­çš„æ‰€æœ‰PIMè·¯ç”±å™¨ä¸Šé…ç½®ç›¸åŒçš„RPåœ°å€ï¼Œé™æ€æŒ‡å®šRPçš„ä½ç½®ã€‚ â–« åŠ¨æ€RPï¼šé€šè¿‡é€‰ä¸¾æœºåˆ¶åœ¨å¤šä¸ªC-RPï¼ˆCandidate-RPï¼Œå€™é€‰RPï¼‰ä¹‹é—´é€‰ä¸¾å‡ºRPã€‚ â€¢ PIM-SMï¼ˆASMï¼‰æ¨¡å¼é¦–æ¬¡å½¢æˆç»„æ’­åˆ†å‘æ ‘ä¸»è¦ä¾èµ–RPTæ„å»ºæœºåˆ¶ï¼Œç»„æ’­æºæ³¨å†Œæœºåˆ¶ä¸DRé€‰ä¸¾æœºåˆ¶ã€‚ â–« RPTæ„å»ºæœºåˆ¶ï¼šç»„æ’­å¶å­è·¯ç”±å™¨ä¸»åŠ¨å»ºç«‹åˆ°RPçš„ç»„æ’­åˆ†å‘æ ‘ï¼ˆRPTï¼‰ â–« ç»„æ’­æºæ³¨å†Œæœºåˆ¶ï¼šé€šè¿‡è¯¥æœºåˆ¶å½¢æˆç»„æ’­æºåˆ°RPçš„ç»„æ’­åˆ†å‘æ ‘ï¼ˆSPTï¼‰ â–« DRé€‰ä¸¾æœºåˆ¶ï¼šDRè´Ÿè´£æºç«¯æˆ–ç»„æˆå‘˜ç«¯ç»„æ’­æŠ¥æ–‡çš„æ”¶å‘ï¼Œé¿å…é‡å¤ç»„æ’­æŠ¥æ–‡ï¼ŒåŒæ—¶æˆå‘˜ç«¯DRè¿˜è´Ÿè´£å‘é€JoinåŠ ç»„æ¶ˆæ¯ã€‚ â€¢ å½“ç»„æ’­åˆ†å‘æ ‘ï¼ˆSPTæˆ–RPTï¼‰ç¨³å®šåï¼Œæˆå‘˜ç«¯DRä¼šå‘¨æœŸæ€§å‘é€Join&#x2F;PruneæŠ¥æ–‡ï¼Œç”¨äºç»´æŠ¤ç»„æ’­åˆ†å‘æ ‘ã€‚ â€¢ å¦‚æœç»„æ’­åœ¨ä¸€æ®µæ—¶é—´åï¼ˆé»˜è®¤210sï¼‰æ²¡æœ‰æµé‡åˆ™SPTæ ‘ä¼šæ¶ˆå¤±ï¼Œæˆå‘˜ç«¯DRæ¢å¤åˆ°RPçš„RPTæ ‘ã€‚ PIMï¼ˆSSMï¼‰ â€¢ PIM-SMï¼ˆSSMï¼‰æ— éœ€Assertæœºåˆ¶","categories":[{"name":"åŸºç¡€çŸ¥è¯†","slug":"åŸºç¡€çŸ¥è¯†","permalink":"http://example.com/categories/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"}],"tags":[{"name":"IGMP","slug":"IGMP","permalink":"http://example.com/tags/IGMP/"},{"name":"PIM","slug":"PIM","permalink":"http://example.com/tags/PIM/"}]},{"title":"STPæ‹“æ‰‘å˜æ›´æœºåˆ¶","slug":"STPæ‹“æ‰‘å˜æ›´æœºåˆ¶","date":"2024-05-08T12:28:37.000Z","updated":"2024-05-08T12:57:02.129Z","comments":true,"path":"2024/05/08/STPæ‹“æ‰‘å˜æ›´æœºåˆ¶/","permalink":"http://example.com/2024/05/08/STP%E6%8B%93%E6%89%91%E5%8F%98%E6%9B%B4%E6%9C%BA%E5%88%B6/","excerpt":"","text":"ä¸ºä»€ä¹ˆè¦æœ‰STPæ‹“æ‰‘å˜åŒ–æœºåˆ¶ç½‘ç»œä¸­å‘ç”Ÿæ‹“æ‰‘å˜åŒ–æ—¶ï¼Œä¾‹å¦‚é“¾è·¯ä¸­æ–­æˆ–æ¥å£å¼‚å¸¸Downç­‰æƒ…å†µï¼Œç”±äºMACåœ°å€è€åŒ–æ—¶é—´çš„å­˜åœ¨ï¼ˆç¼ºçœä¸º5åˆ†é’Ÿï¼‰ï¼Œå¦‚æœä¸åŠæ—¶é€šçŸ¥ä¸Šæ¸¸è®¾å¤‡ï¼Œåˆ™å¯èƒ½ä¼šå¯¼è‡´ä¸Šæ¸¸è®¾å¤‡çš„æŠ¥æ–‡åœ¨è¿™æ®µæ—¶é—´å†…ä¸€ç›´å‘ä¸€ä¸ªä¸å¯è¾¾çš„é“¾è·¯å‘é€ã€‚ æ‹“æ‰‘æ”¹å˜å¯¼è‡´MACåœ°å€è¡¨é”™è¯¯ æœ¬ä¾‹ä¸­ï¼ŒSW3ä¸­çš„MACåœ°å€è¡¨é¡¹å®šä¹‰äº†é€šè¿‡ç«¯å£GigabitEthernet 0&#x2F;0&#x2F;2å¯ä»¥åˆ°è¾¾ä¸»æœº1ï¼Œé€šè¿‡ç«¯å£GigabitEthernet 0&#x2F;0&#x2F;3å¯ä»¥åˆ°è¾¾ä¸»æœº2ã€‚ç”±äºSW2çš„æ ¹ç«¯å£äº§ç”Ÿæ•…éšœï¼Œå¯¼è‡´ç”Ÿæˆæ ‘æ‹“æ‰‘é‡æ–°æ”¶æ•›ï¼Œåœ¨ç”Ÿæˆæ ‘æ‹“æ‰‘å®Œæˆæ”¶æ•›ä¹‹åï¼Œä»ä¸»æœº1åˆ°ä¸»æœº2çš„å¸§ä»ç„¶ä¸èƒ½åˆ°è¾¾ç›®çš„åœ°ã€‚è¿™æ˜¯å› ä¸ºMACåœ°å€è¡¨é¡¹è€åŒ–æ—¶é—´æ˜¯300ç§’ï¼Œä¸»æœº2å‘å¾€ä¸»æœº1çš„å¸§åˆ°è¾¾SW3åï¼ŒSW3ä¼šç»§ç»­é€šè¿‡ç«¯å£GigabitEthernet 0&#x2F;0&#x2F;2è½¬å‘è¯¥æ•°æ®å¸§ã€‚é‚£ä¹ˆè¯¥æ€ä¹ˆå¿«é€Ÿæ¢å¤è½¬å‘ï¼Ÿ æ‹“æ‰‘å˜æ›´ä»¥åŠMACåœ°å€è¡¨é¡¹æ›´æ–°çš„å…·ä½“è¿‡ç¨‹å¦‚ä¸‹ï¼š SW2æ„ŸçŸ¥åˆ°ç½‘ç»œæ‹“æ‰‘å‘ç”Ÿå˜åŒ–åï¼Œä¼šç«‹å³å‘SW3å‘é€TCN BPDUæŠ¥æ–‡ã€‚SW3æ”¶åˆ°SW2å‘æ¥çš„TCN BPDUæŠ¥æ–‡åï¼Œä¼šæŠŠé…ç½®BPDUæŠ¥æ–‡ä¸­çš„Flagsçš„TCAä½è®¾ç½®1ï¼Œç„¶åå‘é€ç»™SW2ï¼Œå‘ŠçŸ¥SW2æˆ‘å·²ç»æ”¶åˆ°ä½ å‘é€çš„TCN BPDUã€‚SW3å‘æ ¹æ¡¥è½¬å‘TCN BPDUæŠ¥æ–‡ã€‚SW1æŠŠé…ç½®BPDUæŠ¥æ–‡ä¸­çš„Flagsçš„TCä½å’ŒTCAä½è®¾ç½®ä¸º1åå‘é€ï¼Œé€šçŸ¥ä¸‹æ¸¸è®¾å¤‡æˆ‘å·²ç»æ”¶åˆ°ä½ å‘é€çš„TCN BPDUï¼Œå¹¶é€šçŸ¥ä¸‹æ¸¸äº¤æ¢æœºæŠŠMACåœ°å€è¡¨é¡¹çš„è€åŒ–æ—¶é—´ç”±é»˜è®¤çš„300 sä¿®æ”¹ä¸ºForward Delayçš„æ—¶é—´ï¼ˆé»˜è®¤ä¸º15 sï¼‰ï¼Œä¹‹åä¼šæŒç»­ä¸æ–­çš„å‘é€TC bit &#x3D; 1çš„BPDUæŒç»­35sã€‚æœ€å¤šç­‰å¾…15 sä¹‹åï¼ŒSW3ä¸­çš„é”™è¯¯MACåœ°å€è¡¨é¡¹ä¼šè¢«è‡ªåŠ¨æ¸…é™¤ã€‚æ­¤åï¼ŒSW3å°±èƒ½é‡æ–°å¼€å§‹MACè¡¨é¡¹çš„å­¦ä¹ åŠè½¬å‘æ“ä½œã€‚ è¯´æ˜ï¼š TCN BPDUæŠ¥æ–‡ä¸»è¦ç”¨æ¥å‘ä¸Šæ¸¸è®¾å¤‡ä¹ƒè‡³æ ¹æ¡¥é€šçŸ¥æ‹“æ‰‘å˜åŒ–ã€‚ TCAæ ‡è®°ç½®ä½çš„é…ç½®BPDUæŠ¥æ–‡ä¸»è¦æ˜¯ä¸Šæ¸¸è®¾å¤‡ç”¨æ¥å‘ŠçŸ¥ä¸‹æ¸¸è®¾å¤‡å·²ç»çŸ¥é“æ‹“æ‰‘å˜åŒ–ï¼Œé€šçŸ¥ä¸‹æ¸¸è®¾å¤‡åœæ­¢å‘é€TCN BPDUæŠ¥æ–‡ã€‚ ç½®ä½çš„TCæ ‡è®°çš„é…ç½®BPDUæŠ¥æ–‡ä¸»è¦æ˜¯ä¸Šæ¸¸è®¾å¤‡ç”¨æ¥å‘ŠçŸ¥ä¸‹æ¸¸è®¾å¤‡æ‹“æ‰‘å‘ç”Ÿå˜åŒ–ï¼Œè¯·ä¸‹æ¸¸è®¾å¤‡ç›´æ¥åˆ é™¤æ¡¥MACåœ°å€è¡¨é¡¹ï¼Œä»è€Œè¾¾åˆ°å¿«é€Ÿæ”¶æ•›çš„ç›®çš„ã€‚ æ„ŸçŸ¥æ‹“æ‰‘æ”¹å˜ä»€ä¹ˆæƒ…å†µä¸‹STPä¼šæ„ŸçŸ¥åˆ°æ‹“æ‰‘å‘ç”Ÿäº†æ”¹å˜å‘¢ï¼Ÿæœ‰ä¸‹é¢å››ç§ï¼ ï¼ˆ1ï¼‰å½“DPç«¯å£è¿›å…¥åˆ°ForwardingçŠ¶æ€è®¤ä¸ºæ‹“æ‰‘å‘ç”Ÿäº†æ”¹å˜ã€‚ å¦‚ä¸Šå›¾å½“S2çš„g0&#x2F;0&#x2F;3æ¥å£(ä¸ä¸»æœºç›´æ¥ç›¸è¿çš„æ¥å£éƒ½æ˜¯DPç«¯å£)ç»è¿‡å¤§æ¦‚30sè¿›å…¥åˆ°ForwardingçŠ¶æ€ä¹‹åï¼ŒS2çš„RPç«¯å£ä¼šç«‹å³å‘æ ¹æ¡¥å‘é€ä¸€ä¸ªTCN BPDUå‘ŠçŸ¥æ ¹æ¡¥æ‹“æ‰‘å‘ç”Ÿäº†æ”¹å˜ï¼Œæ ¹æ¡¥ä¹Ÿä¼šå‘S2äº¤æ¢æœºå›å¤ä¸€ä¸ªTC bit &#x3D; 1å’ŒTCA bit &#x3D; 1çš„BPDUï¼Œå¹¶ä¸”æ ¹æ¡¥ä¼šå°†TC bit &#x3D; 1çš„æŠ¥æ–‡æ³›æ´ªåˆ°å…¨ç½‘äº¤æ¢æœºï¼ŒæŒç»­35sã€‚ S3çš„DPæ¥å£ä»shutdowné‡æ–°è¿›å…¥åˆ°ForwardingçŠ¶æ€ä¸æ­¤æƒ…å†µç±»ä¼¼ã€‚ ï¼ˆ2ï¼‰æ ¹æ¡¥çš„DPå¤±æ•ˆç›´æ¥å‘é€TC BPDUã€‚ å¦‚ä¸Šå›¾ï¼Œå½“æ ¹æ¡¥çš„DPå¤±æ•ˆä¹‹åï¼ŒS3äº¤æ¢æœºçš„RPä¹Ÿéšå³å¤±æ•ˆï¼ŒDPç«‹å³æˆä¸ºRPå¹¶å‘S2çš„APæŒç»­ä¸æ–­çš„å‘é€TCN BPDUã€‚å½“S2çš„APç»è¿‡å¤§æ¦‚30sè¿›å…¥åˆ°ForwardingçŠ¶æ€ä¹‹åä¼šå‘S3çš„DPå›å¤ä¸€ä¸ªTCA bit &#x3D; 1çš„BPDUï¼Œå‘ŠçŸ¥S3æˆ‘å·²æ”¶åˆ°ä½ å‘é€çš„TCN BPDUå¹¶ä¸”é€šè¿‡è‡ªå·±çš„RPå°†TCN BPDUå‘é€ç»™æ ¹æ¡¥ï¼Œæ ¹æ¡¥ä¹Ÿä¼šå‘S2äº¤æ¢æœºå›å¤ä¸€ä¸ªTC bit &#x3D; 1å’ŒTCA bit &#x3D; 1çš„BPDUï¼Œå¹¶ä¸”æ ¹æ¡¥ä¼šå°†TC bit &#x3D; 1çš„æŠ¥æ–‡æ³›æ´ªåˆ°å…¨ç½‘äº¤æ¢æœºæŒç»­35sã€‚ (3)RPå¤±æ•ˆæˆ–è€…RPè¿›å…¥åˆ°ForwardingçŠ¶æ€ã€‚ S3çš„RPå¤±æ•ˆå…¶å®ç­‰åŒäºæ ¹æ¡¥çš„DPå¤±æ•ˆå¯¼è‡´S3çš„RPå¤±æ•ˆã€‚S2çš„RPå¤±æ•ˆç­‰åŒäº 1.æ‹“æ‰‘æ”¹å˜å¯¼è‡´MACåœ°å€è¡¨é”™è¯¯ã€‚(4)éæ ¹æ¡¥çš„DPç«¯å£å¤±æ•ˆä¸è®¤ä¸ºæ‹“æ‰‘å‘ç”Ÿäº†æ”¹å˜ã€‚ å¦‚ä¸Šå›¾ä¸¤ç§æƒ…å†µï¼Œéæ ¹æ¡¥çš„DPå¤±æ•ˆéƒ½ä¸ä¼šè®¤ä¸ºæ‹“æ‰‘å‘ç”Ÿäº†æ”¹å˜ã€‚ æ€»ç»“ï¼šstpå‘ç”Ÿæ‹“æ‰‘å˜æ›´çš„æ¡ä»¶ï¼š1ã€å¤„äºè½¬å‘çŠ¶æ€æˆ–è€…ç›‘å¬çŠ¶æ€çš„ç«¯å£è¿‡æ¸¡åˆ°é˜»å¡çŠ¶æ€ï¼Œè¿™ä¸ªçŠ¶æ€é€šå¸¸æ˜¯é“¾è·¯æ•…éšœ2ã€å¤„äºæœªå¯ç”¨çŠ¶æ€çš„ç«¯å£è¿›å…¥è½¬å‘çŠ¶æ€ï¼Œè¿™ä¸ªçŠ¶æ€é€šå¸¸æ˜¯å¢åŠ äº†æ–°çš„é“¾è·¯3ã€äº¤æ¢æœºä»æŒ‡å®šç«¯å£æ”¶åˆ°TCNBPDUæŠ¥æ–‡ã€‚ stpç¼ºç‚¹ï¼š1.æ”¶æ•›é€Ÿåº¦æ…¢ï¼Œæ•…éšœåˆ‡æ¢æ—¶é—´å¤ªé•¿ï¼ˆ30-50ç§’ï¼‰2.ç½‘ç»œä¸­å¤§é‡ä¸»æœºé¢‘ç¹ä¸Šä¸‹çº¿ï¼Œä¼šå¯¼è‡´TCN BPDUå¤§é‡å‘é€ï¼Œå¯¼è‡´Macåœ°å€è¡¨ä¸ç¨³å®š RSTPå¯¹STPçš„æ”¹è¿›ï¼š RSTPå¯¹STPçš„æ”¹è¿›ï¼š é€šè¿‡ç«¯å£è§’è‰²çš„å¢è¡¥ï¼Œç®€åŒ–äº†ç”Ÿæˆæ ‘åè®®çš„ç†è§£åŠéƒ¨ç½²ï¼› ç«¯å£çŠ¶æ€çš„é‡æ–°åˆ’åˆ†ï¼› é…ç½®BPDUæ ¼å¼çš„æ”¹å˜ï¼Œå……åˆ†åˆ©ç”¨äº†STPåè®®æŠ¥æ–‡ä¸­çš„Flagå­—æ®µï¼Œæ˜ç¡®äº†ç«¯å£è§’è‰²ï¼› é…ç½®BPDUçš„å¤„ç†å‘ç”Ÿå˜åŒ–ï¼› å¿«é€Ÿæ”¶æ•›ï¼› å¢åŠ ä¿æŠ¤åŠŸèƒ½ã€‚ æ”¹è¿›ç‚¹1ï¼šç«¯å£è§’è‰²çš„æ”¹è¿›ï¼šRSTPçš„ç«¯å£è§’è‰²å…±æœ‰4ç§ï¼šæ ¹ç«¯å£ã€æŒ‡å®šç«¯å£ã€Alternateç«¯å£å’ŒBackupç«¯å£ã€‚ æ ¹ç«¯å£å’ŒæŒ‡å®šç«¯å£çš„ä½œç”¨åŒSTPä¸­å®šä¹‰ï¼ŒAlternateç«¯å£å’ŒBackupç«¯å£çš„æè¿°å¦‚ä¸‹ï¼š ä»é…ç½®BPDUæŠ¥æ–‡å‘é€è§’åº¦æ¥çœ‹ï¼š Alternateç«¯å£å°±æ˜¯ç”±äºå­¦ä¹ åˆ°å…¶å®ƒç½‘æ¡¥å‘é€çš„é…ç½®BPDUæŠ¥æ–‡è€Œé˜»å¡çš„ç«¯å£ Backupç«¯å£å°±æ˜¯ç”±äºå­¦ä¹ åˆ°è‡ªå·±å‘é€çš„é…ç½®BPDUæŠ¥æ–‡è€Œé˜»å¡çš„ç«¯å£ ä»ç”¨æˆ·æµé‡è§’åº¦æ¥çœ‹ï¼š Alternateç«¯å£æä¾›äº†ä»æŒ‡å®šæ¡¥åˆ°æ ¹çš„å¦ä¸€æ¡å¯åˆ‡æ¢è·¯å¾„ï¼Œä½œä¸ºæ ¹ç«¯å£çš„å¤‡ä»½ç«¯å£ Backupç«¯å£ä½œä¸ºæŒ‡å®šç«¯å£çš„å¤‡ä»½ï¼Œæä¾›äº†å¦ä¸€æ¡ä»æ ¹æ¡¥åˆ°ç›¸åº”ç½‘æ®µçš„å¤‡ä»½é€šè·¯ ç»™ä¸€ä¸ªRSTPåŸŸå†…æ‰€æœ‰ç«¯å£åˆ†é…è§’è‰²çš„è¿‡ç¨‹å°±æ˜¯æ•´ä¸ªæ‹“æ‰‘æ”¶æ•›çš„è¿‡ç¨‹ æ”¹è¿›ç‚¹2ï¼šç«¯å£çŠ¶æ€çš„æ”¹è¿›RSTPçš„çŠ¶æ€è§„èŒƒç¼©å‡ä¸º3ç§ï¼Œæ ¹æ®ç«¯å£æ˜¯å¦è½¬å‘ç”¨æˆ·æµé‡å’Œå­¦ä¹ MACåœ°å€æ¥åˆ’åˆ†: DiscardingçŠ¶æ€ï¼šä¸è½¬å‘ç”¨æˆ·æµé‡ä¹Ÿä¸å­¦ä¹ MACåœ°å€ LearningçŠ¶æ€ï¼šä¸è½¬å‘ç”¨æˆ·æµé‡ä½†æ˜¯å­¦ä¹ MACåœ°å€ ForwardingçŠ¶ï¼šæ—¢è½¬å‘ç”¨æˆ·æµé‡åˆå­¦ä¹ MACåœ°å€ã€‚ STPç«¯å£çŠ¶æ€ RSTPç«¯å£çŠ¶æ€ ç«¯å£åœ¨æ‹“æ‰‘ä¸­çš„è§’è‰² Forwarding Forwarding åŒ…æ‹¬æ ¹ç«¯å£ã€æŒ‡å®šç«¯å£ Learning Learning åŒ…æ‹¬æ ¹ç«¯å£ã€æŒ‡å®šç«¯å£ Listening Discarding åŒ…æ‹¬æ ¹ç«¯å£ã€æŒ‡å®šç«¯å£ Blocking Discarding åŒ…æ‹¬Alternateç«¯å£ã€Backupç«¯å£ Disabled Discarding åŒ…æ‹¬Disableç«¯å£ æ”¹è¿›ç‚¹3ï¼šé…ç½®BPDU - RST BPDURSTPçš„é…ç½®BPDUå……åˆ†åˆ©ç”¨äº†STPæŠ¥æ–‡ä¸­çš„Flagå­—æ®µï¼Œæ˜ç¡®äº†ç«¯å£è§’è‰² é™¤äº†ä¿è¯å’ŒSTPæ ¼å¼åŸºæœ¬ä¸€è‡´ä¹‹å¤–ï¼ŒRSTPä½œäº†å¦‚ä¸‹å˜åŒ–ï¼š Typeå­—æ®µï¼šé…ç½®BPDUç±»å‹ä¸å†æ˜¯0è€Œæ˜¯2ï¼Œæ‰€ä»¥è¿è¡ŒSTPçš„è®¾å¤‡æ”¶åˆ°RSTPçš„é…ç½®BPDUæ—¶ä¼šä¸¢å¼ƒ Flagå­—æ®µï¼šä½¿ç”¨äº†åŸæ¥ä¿ç•™çš„ä¸­é—´6ä½ï¼Œè¿™æ ·æ”¹å˜çš„é…ç½®BPDUå«åšRST BPDU RST BPDUæŠ¥æ–‡æ ¼å¼ï¼šRST BPDUä¸STPé…ç½®BPDUæŠ¥æ–‡æ ¼å¼ä¸åŒç‚¹ BPDUç±»å‹ï¼Œ1 Byteï¼ŒRST BPDUçš„ç±»å‹å€¼ä¸º0x02ã€‚ æ ‡å¿—ï¼Œ1 Byteï¼ŒåŒ…æ‹¬ï¼š bit 7ï¼šTCAï¼Œè¡¨ç¤ºæ‹“æ‰‘å˜åŒ–ç¡®è®¤ï¼› bit 6ï¼šAgreementï¼Œè¡¨ç¤ºåŒæ„ï¼Œç”¨äºP&#x2F;Aæœºåˆ¶ï¼› bit 5ï¼šForwardingï¼Œè¡¨ç¤ºè½¬å‘çŠ¶æ€ï¼› bit 4ï¼šLearningï¼Œè¡¨ç¤ºå­¦ä¹ çŠ¶æ€ï¼› bit 3å’Œbit 2ï¼šè¡¨ç¤ºç«¯å£è§’è‰², 00è¡¨ç¤ºæœªçŸ¥ç«¯å£, 01è¡¨ç¤ºæ›¿ä»£æˆ–å¤‡ä»½ç«¯å£, 10è¡¨ç¤ºæ ¹ç«¯å£, 11è¡¨ç¤ºæŒ‡å®šç«¯å£ bit 1ï¼šProposalï¼Œè¡¨ç¤ºæè®®ï¼Œç”¨äºP&#x2F;Aæœºåˆ¶ï¼› bit 0ï¼šTCï¼Œè¡¨ç¤ºæ‹“æ‰‘å˜åŒ–ã€‚ æ”¹è¿›ç‚¹4ï¼šé…ç½®BPDUçš„å¤„ç†RSTPå¯¹é…ç½®BPDUçš„å‘é€æ–¹å¼è¿›è¡Œäº†æ”¹è¿› åœ¨æ‹“æ‰‘ç¨³å®šåï¼Œæ— è®ºéæ ¹æ¡¥è®¾å¤‡æ˜¯å¦æ¥æ”¶åˆ°æ ¹æ¡¥ä¼ æ¥çš„é…ç½®BPDUæŠ¥æ–‡ï¼Œéæ ¹æ¡¥è®¾å¤‡ä»ç„¶æŒ‰ç…§Hello Timeè§„å®šçš„æ—¶é—´é—´éš”å‘é€é…ç½®BPDUï¼Œè¯¥è¡Œä¸ºå®Œå…¨ç”±æ¯å°è®¾å¤‡è‡ªä¸»è¿›è¡Œ æ›´çŸ­çš„BPDUè¶…æ—¶æ—¶é—´å¦‚æœä¸€ä¸ªç«¯å£åœ¨è¶…æ—¶æ—¶é—´ï¼ˆå³ä¸‰ä¸ªå‘¨æœŸï¼Œè¶…æ—¶æ—¶é—´ï¼Hello TimeÃ—3ï¼‰å†…æ²¡æœ‰æ”¶åˆ°ä¸Šæ¸¸è®¾å¤‡å‘é€è¿‡æ¥çš„é…ç½®BPDUï¼Œé‚£ä¹ˆè¯¥è®¾å¤‡è®¤ä¸ºä¸æ­¤é‚»å±…ä¹‹é—´çš„åå•†å¤±è´¥ STPéœ€è¦å…ˆç­‰å¾…ä¸€ä¸ªMax Age å¤„ç†æ¬¡ä¼˜BPDUå½“ä¸€ä¸ªç«¯å£æ”¶åˆ°ä¸Šæ¸¸çš„æŒ‡å®šæ¡¥å‘æ¥çš„RST BPDUæŠ¥æ–‡æ—¶ï¼Œè¯¥ç«¯å£ä¼šå°†è‡ªèº«ç¼“å­˜çš„RST BPDUä¸æ”¶åˆ°çš„RST BPDUè¿›è¡Œæ¯”è¾ƒå¦‚æœè¯¥ç«¯å£ç¼“å­˜çš„RST BPDUä¼˜äºæ”¶åˆ°çš„RST BPDUï¼Œé‚£ä¹ˆè¯¥ç«¯å£ä¼šç›´æ¥ä¸¢å¼ƒæ”¶åˆ°çš„RST BPDUï¼Œç«‹å³å›åº”è‡ªèº«ç¼“å­˜çš„RST BPDUï¼Œä»è€ŒåŠ å¿«æ”¶æ•›é€Ÿåº¦ STPï¼š STPåªæœ‰æŒ‡å®šç«¯å£ä¼šç«‹å³å¤„ç†æ¬¡ä¼˜BPDUï¼Œå…¶ä»–ç«¯å£ä¼šå¿½ç•¥æ¬¡ä¼˜BPDUï¼Œç­‰åˆ°Max Ageè®¡æ—¶å™¨è¶…æ—¶åï¼Œç¼“å­˜çš„æ¬¡ä¼˜BPDUæ‰ä¼šè€åŒ–ï¼Œç„¶åå‘é€è‡ªèº«æ›´ä¼˜çš„BPDUï¼Œè¿›è¡Œæ–°ä¸€è½®çš„æ‹“æ‰‘æ”¶æ•›ã€‚ RSTPï¼š RSTPå¤„ç†æ¬¡ä¼˜BPDUæŠ¥æ–‡ä¸å†ä¾èµ–äºä»»ä½•å®šæ—¶å™¨ï¼Œè§£å†³æ‹“æ‰‘æ”¶æ•›ï¼ŒåŒæ—¶RSTPçš„ä»»ä½•ç«¯å£è§’è‰²éƒ½ä¼šå¤„ç†æ¬¡ä¼˜BPDUï¼Œä»è€ŒåŠ å¿«äº†æ‹“æ‰‘æ”¶æ•›ã€‚ æ”¹è¿›ç‚¹5ï¼šå¿«é€Ÿæ”¶æ•›æœºåˆ¶å¿«é€Ÿæ”¶æ•›æœºåˆ¶ï¼š å¦‚æœç½‘ç»œä¸­ä¸€ä¸ªæ ¹ç«¯å£å¤±æ•ˆï¼Œé‚£ä¹ˆç½‘ç»œä¸­æœ€ä¼˜çš„Alternateç«¯å£å°†æˆä¸ºæ ¹ç«¯å£ï¼Œè¿›å…¥ForwardingçŠ¶æ€ã€‚å› ä¸ºé€šè¿‡è¿™ä¸ªAlternateç«¯å£è¿æ¥çš„ç½‘æ®µä¸Šå¿…ç„¶æœ‰ä¸ªæŒ‡å®šç«¯å£å¯ä»¥é€šå¾€æ ¹æ¡¥ å¦‚æœç½‘ç»œä¸­ä¸€æŒ‡å®šç«¯å£å¤±æ•ˆï¼Œé‚£ä¹ˆç½‘ç»œä¸­æœ€ä¼˜çš„Backupç«¯å£å°†æˆä¸ºæŒ‡å®šç«¯å£ï¼Œè¿›å…¥ForwardingçŠ¶æ€ã€‚å› ä¸ºBackupç«¯å£ä½œä¸ºæŒ‡å®šç«¯å£çš„å¤‡ä»½ï¼Œæä¾›äº†å¦ä¸€æ¡ä»æ ¹æ¡¥åˆ°ç›¸åº”ç½‘æ®µçš„å¤‡ä»½é€šè·¯ ##### è¾¹ç¼˜ç«¯å£ (Edge Port)æœºåˆ¶ï¼š åœ¨RSTPé‡Œé¢ï¼Œå¦‚æœæŸä¸€ä¸ªç«¯å£ä½äºæ•´ä¸ªç½‘ç»œçš„è¾¹ç¼˜ï¼Œå³ä¸å†ä¸å…¶ä»–äº¤æ¢è®¾å¤‡è¿æ¥ï¼Œè€Œæ˜¯ç›´æ¥ä¸ç»ˆç«¯è®¾å¤‡ç›´è¿ï¼Œè¿™ç§ç«¯å£å¯ä»¥è®¾ç½®ä¸ºè¾¹ç¼˜ç«¯å£ è¾¹ç¼˜ç«¯å£ä¸å‚ä¸RSTPè®¡ç®—ï¼Œå¯ä»¥ç”±Discardingç›´æ¥è¿›å…¥ForwardingçŠ¶æ€ï¼ŒåŒæ—¶è¾¹ç¼˜ç«¯å£çš„UPå’ŒDownï¼Œä¸ä¼šå¼•èµ·ç½‘ç»œæ‹“æ‰‘çš„å˜åŠ¨ ä½†æ˜¯ä¸€æ—¦è¾¹ç¼˜ç«¯å£æ”¶åˆ°é…ç½®BPDUï¼Œå°±ä¸§å¤±äº†è¾¹ç¼˜ç«¯å£å±æ€§ï¼Œæˆä¸ºæ™®é€šSTPç«¯å£ï¼Œå¹¶é‡æ–°è¿›è¡Œç”Ÿæˆæ ‘è®¡ç®—ï¼Œä»è€Œå¼•èµ·ç½‘ç»œéœ‡è¡ Proposal&#x2F;Agreementæœºåˆ¶ï¼šç®€ç§°P&#x2F;Aæœºåˆ¶ï¼ŒRSTPé€šè¿‡P&#x2F;Aæœºåˆ¶åŠ å¿«äº†ä¸Šæ¸¸ç«¯å£è¿›å…¥ForwardingçŠ¶æ€çš„é€Ÿåº¦ã€‚ å½“ä¸€ä¸ªç«¯å£è¢«é€‰ä¸¾æˆä¸ºæŒ‡å®šç«¯å£ä¹‹å,ä¼šå…ˆè¿›å…¥DiscardingçŠ¶æ€ï¼Œå†é€šè¿‡P&#x2F;Aæœºåˆ¶å¿«é€Ÿè¿›å…¥ForwardingçŠ¶æ€ äº‹å®ä¸Šå¯¹äºSTPï¼ŒæŒ‡å®šç«¯å£çš„é€‰æ‹©å¯ä»¥å¾ˆå¿«å®Œæˆï¼Œä¸»è¦çš„é€Ÿåº¦ç“¶é¢ˆåœ¨äºï¼šä¸ºäº†é¿å…ç¯è·¯ï¼Œå¿…é¡»ç­‰å¾…è¶³å¤Ÿé•¿çš„æ—¶é—´ï¼Œä½¿å…¨ç½‘çš„ç«¯å£çŠ¶æ€å…¨éƒ¨ç¡®å®šï¼Œä¹Ÿå°±æ˜¯è¯´å¿…é¡»è¦ç­‰å¾…è‡³å°‘ä¸€ä¸ªForward Delayæ‰€æœ‰ç«¯å£æ‰èƒ½è¿›è¡Œè½¬å‘ã€‚ è€ŒRSTPçš„ä¸»è¦ç›®çš„å°±æ˜¯æ¶ˆé™¤è¿™ä¸ªç“¶é¢ˆï¼Œé€šè¿‡é˜»å¡è‡ªå·±çš„éæ ¹ç«¯å£æ¥ä¿è¯ä¸ä¼šå‡ºç°ç¯è·¯ã€‚è€Œä½¿ç”¨P&#x2F;Aæœºåˆ¶åŠ å¿«äº†ä¸Šæ¸¸ç«¯å£è¿›å…¥ForwardingçŠ¶æ€çš„é€Ÿåº¦ã€‚ æ”¹è¿›ç‚¹6ï¼šæ‹“æ‰‘å˜æ›´æœºåˆ¶åœ¨RSTPä¸­æ£€æµ‹æ‹“æ‰‘æ˜¯å¦å‘ç”Ÿå˜åŒ–åªæœ‰ä¸€ä¸ªæ ‡å‡†ï¼šä¸€ä¸ªéè¾¹ç¼˜ç«¯å£è¿ç§»åˆ°ForwardingçŠ¶æ€ã€‚ ä¸€æ—¦æ£€æµ‹åˆ°æ‹“æ‰‘å‘ç”Ÿå˜åŒ–ï¼Œå°†è¿›è¡Œå¦‚ä¸‹å¤„ç†ï¼š ä¸ºæœ¬äº¤æ¢è®¾å¤‡çš„æ‰€æœ‰éè¾¹ç¼˜æŒ‡å®šç«¯å£å’Œæ ¹ç«¯å£å¯åŠ¨ä¸€ä¸ªTC While Timerï¼Œè¯¥è®¡æ—¶å™¨å€¼æ˜¯Hello Timeçš„ä¸¤å€ã€‚åœ¨è¿™ä¸ªæ—¶é—´å†…ï¼Œæ¸…ç©ºçŠ¶æ€å‘ç”Ÿå˜åŒ–çš„ç«¯å£ä¸Šå­¦ä¹ åˆ°çš„MACåœ°å€ã€‚ åŒæ—¶ï¼Œç”±éè¾¹ç¼˜æŒ‡å®šç«¯å£å’Œæ ¹ç«¯å£å‘å¤–å‘é€RST BPDUï¼Œå…¶ä¸­TCç½®ä½ã€‚ä¸€æ—¦TC While Timerè¶…æ—¶ï¼Œåˆ™åœæ­¢å‘é€RST BPDUã€‚ å…¶ä»–äº¤æ¢è®¾å¤‡æ¥æ”¶åˆ°RST BPDUåï¼Œæ¸…ç©ºæ‰€æœ‰ç«¯å£ï¼ˆé™¤äº†æ”¶åˆ°RST BPDUçš„ç«¯å£å’Œè¾¹ç¼˜ç«¯å£ï¼‰å­¦ä¹ åˆ°MACåœ°å€ï¼Œç„¶åä¹Ÿä¸ºè‡ªå·±æ‰€æœ‰çš„éè¾¹ç¼˜æŒ‡å®šç«¯å£å’Œæ ¹ç«¯å£å¯åŠ¨TC While Timerï¼Œé‡å¤ä¸Šè¿°è¿‡ç¨‹ã€‚ å¦‚æ­¤ï¼Œç½‘ç»œä¸­å°±ä¼šäº§ç”ŸRST BPDUçš„æ³›æ´ªã€‚ RSTPä¸STPçš„å…¼å®¹ RSTPå¯ä»¥å…¼å®¹STPï¼šRSTPå¯ä»¥å’ŒSTPäº’æ“ä½œï¼Œä½†æ˜¯æ­¤æ—¶ä¼šä¸§å¤±å¿«é€Ÿæ”¶æ•›ç­‰RSTPä¼˜åŠ¿ã€‚ å½“ä¸€ä¸ªç½‘æ®µé‡Œæ—¢æœ‰è¿è¡ŒSTPçš„äº¤æ¢è®¾å¤‡åˆæœ‰è¿è¡ŒRSTPçš„äº¤æ¢è®¾å¤‡ï¼ŒSTPäº¤æ¢è®¾å¤‡ä¼šå¿½ç•¥RSTPçš„BPDU è¿è¡ŒRSTPçš„äº¤æ¢è®¾å¤‡åœ¨æŸç«¯å£ä¸Šæ¥æ”¶åˆ°è¿è¡ŒSTPçš„äº¤æ¢è®¾å¤‡å‘å‡ºçš„é…ç½®BPDUï¼Œåœ¨ä¸¤ä¸ªHello Timeæ—¶é—´ä¹‹åï¼Œä¾¿æŠŠè‡ªå·±çš„ç«¯å£è½¬æ¢åˆ°STPå·¥ä½œæ¨¡å¼ï¼Œå‘é€é…ç½®BPDUï¼Œä»è€Œå®ç°äº†äº’æ“ä½œã€‚","categories":[{"name":"åŸºç¡€çŸ¥è¯†","slug":"åŸºç¡€çŸ¥è¯†","permalink":"http://example.com/categories/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"}],"tags":[{"name":"stpæ‹“æ‰‘å˜æ›´","slug":"stpæ‹“æ‰‘å˜æ›´","permalink":"http://example.com/tags/stp%E6%8B%93%E6%89%91%E5%8F%98%E6%9B%B4/"}]},{"title":"PPP/PPPoE","slug":"PPP-PPPoE","date":"2024-05-02T07:23:54.000Z","updated":"2024-07-16T12:09:56.046Z","comments":true,"path":"2024/05/02/PPP-PPPoE/","permalink":"http://example.com/2024/05/02/PPP-PPPoE/","excerpt":"","text":"PPPï¼ˆç‚¹åˆ°ç‚¹åè®® ï¼‰ï¼Œè¯¥åè®®æ”¯æŒè®¤è¯ï¼ˆPAPã€CHAPï¼‰ã€è¯¥åè®®ä¸­è¿˜åŒ…æ‹¬LCPã€NCPåè®® PPPé“¾è·¯çš„å»ºç«‹æœ‰ä¸‰ä¸ªé˜¶æ®µçš„åå•†è¿‡ç¨‹ï¼Œé“¾è·¯å±‚åå•†ã€è®¤è¯åå•†ï¼ˆå¯é€‰ï¼‰å’Œç½‘ç»œå±‚åå•†ã€‚1ï¼‰é“¾è·¯å±‚åå•†ï¼šé€šè¿‡LCPæŠ¥æ–‡è¿›è¡Œé“¾è·¯å‚æ•°åå•†ï¼Œå»ºç«‹é“¾è·¯å±‚è¿æ¥ã€‚ é“¾è·¯å±‚åè®®ï¼ˆLCPï¼‰åå•†çš„å‚æ•°æœ‰MRUï¼ˆæœ€å¤§æ¥æ”¶å•å…ƒï¼‰ã€è®¤è¯æ–¹å¼ï¼ˆä¸è®¤è¯ã€PAPã€CHAPï¼‰ã€é­”æœ¯å­—ï¼ˆæ£€æµ‹æ˜¯å¦æœ‰ç¯è·¯ï¼‰ 2ï¼‰è®¤è¯åå•†ï¼ˆå¯é€‰ï¼‰ï¼šé€šè¿‡é“¾è·¯å»ºç«‹é˜¶æ®µåå•†çš„è®¤è¯æ–¹å¼è¿›è¡Œé“¾è·¯è®¤è¯ã€‚ 3ï¼‰ç½‘ç»œå±‚åå•† ï¼šé€šè¿‡NCPåå•†æ¥é€‰æ‹©å’Œé…ç½®ä¸€ä¸ªç½‘ç»œå±‚åè®®å¹¶è¿›è¡Œç½‘ç»œå±‚å‚æ•°åå•†ã€‚ PPPåå•†æ—¶æ¥å£çŠ¶æ€çš„å˜åŒ–ï¼š æ­£å¸¸PPPé“¾è·¯å»ºç«‹éœ€è¦ç»å†é“¾è·¯å»ºç«‹é˜¶æ®µã€è®¤è¯é˜¶æ®µå’Œç½‘ç»œå±‚åå•†é˜¶æ®µï¼Œè¯¦ç»†è¿‡ç¨‹å¦‚ä¸‹ï¼šé€šä¿¡åŒæ–¹å¼€å§‹å»ºç«‹PPPé“¾è·¯æ—¶ï¼Œå…ˆè¿›å…¥åˆ°Establishé˜¶æ®µã€‚åœ¨Establishé˜¶æ®µï¼Œè¿›è¡ŒLCPåå•†ï¼šåå•†é€šä¿¡åŒæ–¹çš„MRUï¼ˆMaximum Receive Unitï¼Œæœ€å¤§æ¥æ”¶å•å…ƒï¼‰ã€è®¤è¯æ–¹å¼å’Œé­”æœ¯å­—ï¼ˆMagic Numberï¼‰ç­‰é€‰é¡¹ã€‚åå•†æˆåŠŸåè¿›å…¥OpenedçŠ¶æ€ï¼Œè¡¨ç¤ºåº•å±‚é“¾è·¯å·²å»ºç«‹ã€‚å¦‚æœé…ç½®äº†è®¤è¯ï¼Œå°†è¿›å…¥Authenticateé˜¶æ®µã€‚å¦åˆ™ç›´æ¥è¿›å…¥Networké˜¶æ®µã€‚åœ¨Authenticateé˜¶æ®µï¼Œä¼šæ ¹æ®è¿æ¥å»ºç«‹é˜¶æ®µåå•†çš„è®¤è¯æ–¹å¼è¿›è¡Œé“¾è·¯è®¤è¯ã€‚è®¤è¯æ–¹å¼æœ‰ä¸¤ç§ï¼šPAPå’ŒCHAPã€‚å¦‚æœè®¤è¯æˆåŠŸï¼Œè¿›å…¥Networké˜¶æ®µï¼Œå¦åˆ™è¿›å…¥Terminateé˜¶æ®µï¼Œæ‹†é™¤é“¾è·¯ï¼ŒLCPçŠ¶æ€è½¬ä¸ºDownã€‚åœ¨Networké˜¶æ®µï¼ŒPPPé“¾è·¯è¿›è¡ŒNCPåå•†ã€‚é€šè¿‡NCPåå•†æ¥é€‰æ‹©å’Œé…ç½®ä¸€ä¸ªç½‘ç»œå±‚åè®®å¹¶è¿›è¡Œç½‘ç»œå±‚å‚æ•°åå•†ã€‚æœ€å¸¸è§çš„NCPåè®®æ˜¯IPCPï¼Œç”¨æ¥åå•†IPå‚æ•°ã€‚åœ¨Terminateé˜¶æ®µï¼Œå¦‚æœæ‰€æœ‰çš„èµ„æºéƒ½è¢«é‡Šæ”¾ï¼Œé€šä¿¡åŒæ–¹å°†å›åˆ°Deadé˜¶æ®µã€‚PPPè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯ä»¥éšæ—¶ä¸­æ–­è¿æ¥ï¼Œç‰©ç†é“¾è·¯æ–­å¼€ã€è®¤è¯å¤±è´¥ã€è¶…æ—¶å®šæ—¶å™¨æ—¶é—´åˆ°ã€ç®¡ç†å‘˜é€šè¿‡é…ç½®å…³é—­è¿æ¥ç­‰åŠ¨ä½œéƒ½å¯èƒ½å¯¼è‡´é“¾è·¯è¿›å…¥Terminateé˜¶æ®µã€‚ ç½‘ç»œè¿è¥å•†å¦‚ä½•å¯¹ç”¨æˆ·ä¸Šç½‘è¡Œä¸ºè¿›è¡Œæ”¶è´¹å’Œæ§åˆ¶ ï¼Ÿ é’ˆå¯¹ç‰¹å®šçš„æ•°æ®åŒ…ï¼Œå°±å¿…é¡»è¯†åˆ«å‘é€æ–¹çš„èº«ä»½ã€‚ åœ¨ä»¥å¤ªç½‘é“¾è·¯ä¸Šï¼Œä»¥å¤ªç½‘æŠ€æœ¯è™½ç„¶å…·æœ‰ç®€å•æ˜“ç”¨ï¼Œæˆæœ¬ä½ç­‰ç‰¹ç‚¹ï¼Œä½†æ˜¯ä»¥å¤ªç½‘å¹¿æ’­ç½‘ç»œçš„å±æ€§ï¼Œä½¿å¾—å…¶é€šä¿¡åŒæ–¹æ— æ³•ç›¸äº’éªŒè¯å¯¹æ–¹çš„èº«ä»½ï¼Œå› è€Œé€šä¿¡æ˜¯ä¸å®‰å…¨çš„ã€‚ åœ¨PPPé“¾è·¯ä¸Šï¼Œç”±äºPPPåè®®è‡ªå¸¦è®¤è¯åŠŸèƒ½ï¼Œå› æ­¤å¯ä»¥å®Œç¾çš„è§£å†³ä¸Šè¿°é—®é¢˜ã€‚ä½†æ˜¯ï¼ŒPPPé“¾è·¯åˆæ— æ³•å®ç°å¤šç”¨æˆ·ä¸Šç½‘çš„éœ€æ±‚ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªçŸ›ç›¾é—®é¢˜ï¼Œè§£å†³ç”¨æˆ·ä¸Šç½‘è¡Œä¸ºç®¡ç†å’Œæ”¶è´¹çš„é—®é¢˜ï¼Œæå‡ºäº†å°†PPPæ•°æ®å¸§å°è£…åœ¨ä»¥å¤ªç½‘æ•°æ®å¸§é‡Œè¾¹ä»è€Œåœ¨ä»¥å¤ªç½‘ç½‘ç»œä¸­ä¼ è¾“çš„æŠ€æœ¯â€”â€”PPPoEæŠ€æœ¯ã€‚ è¿™é‡Œçš„PPPï¼Œå°±æ˜¯æŒ‡çš„PPPåè®®æ•°æ®å¸§ï¼Œè€Œoå°±æ˜¯overçš„æ„æ€ï¼ŒEå°±æ˜¯Ethernetçš„æ„æ€ï¼Œå› æ­¤ï¼ŒPPPoEå½¢è±¡çš„è¯´å°±æ˜¯â€œåœ¨ä»¥å¤ªç½‘ä¸Šçš„PPPåè®®â€ã€‚ PPPoEæŠ€æœ¯å¯ä»¥å°†ç”¨æˆ·è¿æ¥åˆ°è¿œç¨‹æ¥å…¥è®¾å¤‡ä¸Šï¼Œå¹¶æä¾›è‰¯å¥½è®¿é—®æ§åˆ¶åŠŸèƒ½ï¼Œæä¾›äº†ä¸€ç§ç»æµçš„ç”¨æˆ·æ¥å…¥æŠ€æœ¯ï¼Œå¹¶å®ç°äº†å¯¹ç”¨æˆ·çš„æ§åˆ¶ã€‚ PPPoEåè®®é‡‡ç”¨Client&#x2F;Serveræ¨¡å¼ï¼Œæ™®é€šç”¨æˆ·ä¸€èˆ¬ä¸ºClientï¼Œè€Œè¿è¥å•†ä¸ºServerã€‚ PPPoEçš„å»ºç«‹åˆ†ä¸ºDiscoveré˜¶æ®µå’ŒPPP Sessioné˜¶æ®µã€‚ Discoveré˜¶æ®µï¼šä¸»è¦æ˜¯é€‰æ‹©PPPoEæœåŠ¡å™¨ï¼Œå¹¶ç¡®å®šæ‰€è¦å»ºç«‹çš„ä¼šè¯æ ‡è¯†ç¬¦Session IDã€‚ å½“Clientè¦è¿è¡ŒPPPoEæ—¶ï¼Œé¦–å…ˆä»¥å¹¿æ’­çš„å½¢å¼å‘é€ä¸€ä¸ªPADIï¼ˆPPPoE Active Discovery Initiationï¼‰æŠ¥æ–‡ï¼Œè¯¥æŠ¥æ–‡ä¸­å«æœ‰Clientç«¯è¦è¯·æ±‚çš„æœåŠ¡ä¿¡æ¯ PPPoEæœåŠ¡å™¨åœ¨æ”¶åˆ°è¯¥æŠ¥æ–‡åï¼Œä¼šä»¥å•æ’­çš„æ–¹å¼å‘é€ä¸€ä¸ªPADOï¼ˆPPPoE Active Discovery Offerï¼‰æŠ¥æ–‡ï¼Œå¯¹Clientç«¯çš„PADIæŠ¥æ–‡è¿›è¡Œå›åº”ã€‚ PPPoE Clientç«¯åœ¨æ”¶åˆ°è¿™ä¸ªæŠ¥æ–‡åï¼Œä¼šå‘PPPoE Serverå‘é€PADRï¼ˆPPPoE Active Discovery Requestï¼‰æŠ¥æ–‡ã€‚åœ¨è¿™ä¸ªæŠ¥æ–‡ä¸­ï¼ŒPPPoE Clientä¼šåˆ›å»ºå¹¶æºå¸¦ä¸€ä¸ªPPPoE Sessionã€‚ PPPoE Serverè¿˜ä¼šå‘å®¢æˆ·ç«¯å‘é€PADSï¼ˆPPPoE Active Discovery Session-confirmationï¼‰æŠ¥æ–‡ï¼Œè¡¨ç¤ºæ”¶åˆ°äº†è¯¥Session IDã€‚ å‘é€PADTï¼ˆPPPOE Active Discovery Terminateï¼‰æŠ¥æ–‡ï¼Œç»ˆæ­¢è¿æ¥ PPP Sessioné˜¶æ®µï¼šå³æ‰§è¡Œæ ‡å‡†çš„PPPè¿‡ç¨‹ï¼ŒåŒ…æ‹¬LCPåå•†ã€PAP&#x2F;CHAPè®¤è¯ã€NCPåå•†ç­‰é˜¶æ®µã€‚ PPPä¼šè¯é˜¶æ®µåŒ…æ‹¬LCPåå•†ã€PAP&#x2F;CHAPè®¤è¯ã€NCPåå•†ç­‰é˜¶æ®µã€‚éœ€ç»“åˆPPPé“¾è·¯å»ºç«‹è¿‡ç¨‹æ¥åˆ†æ é…ç½®","categories":[{"name":"åŸºç¡€çŸ¥è¯†","slug":"åŸºç¡€çŸ¥è¯†","permalink":"http://example.com/categories/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"}],"tags":[{"name":"PPP","slug":"PPP","permalink":"http://example.com/tags/PPP/"},{"name":"PPPoE","slug":"PPPoE","permalink":"http://example.com/tags/PPPoE/"}]},{"title":"IS-ISæ€»ç»“","slug":"IS-ISæ€»ç»“","date":"2024-04-20T11:42:15.000Z","updated":"2024-07-21T14:26:35.282Z","comments":true,"path":"2024/04/20/IS-ISæ€»ç»“/","permalink":"http://example.com/2024/04/20/IS-IS%E6%80%BB%E7%BB%93/","excerpt":"","text":"IS-ISçš„ä»‹ç»IS-IS â€”ä¸­é—´ç³»ç»Ÿåˆ°ä¸­é—´ç³»ç»Ÿ Is-isæœ€å¼€å§‹æ˜¯åœ¨osiæ¨¡å‹ä¸­ï¼Œé€‚ç”¨äºCLNPç½‘ç»œï¼Œç°åœ¨çš„IsisæŒ‡çš„æ˜¯é›†æˆIsis é›†æˆIS-ISç‰¹ç‚¹:æ”¯æŒCLNPç½‘ç»œã€IPç½‘ç»œé‡‡ç”¨æ•°æ®é“¾è·¯å±‚å°è£… OSPFç‰¹ç‚¹:åªæ”¯æŒIPç½‘ç»œé‡‡ç”¨IPæŠ¥æ–‡å°è£… åº”ç”¨åœºæ™¯ï¼š ospfï¼šå›­åŒºç½‘ç»œ Isisï¼šISPéª¨å¹²ç½‘ NASPCLNPåè®®ä¸­ä¸å®ç”¨IPåœ°å€ï¼Œä½¿ç”¨çš„æ˜¯NSAPåœ°å€ NETï¼ˆNetwork Entity Titleï¼Œç½‘ç»œå®ä½“åç§°ï¼‰æ˜¯OSIåè®®æ ˆä¸­è®¾å¤‡çš„ç½‘ç»œå±‚ä¿¡æ¯ï¼Œä¸»è¦ç”¨äºè·¯ç”±è®¡ç®—ï¼Œç”±åŒºåŸŸåœ°å€ï¼ˆArea IDï¼‰å’ŒSystem IDç»„æˆï¼Œå¯ä»¥çœ‹ä½œæ˜¯ç‰¹æ®Šçš„NSAPï¼ˆSELä¸º00çš„NSAPï¼‰ã€‚NETçš„é•¿åº¦ä¸NSAPçš„ç›¸åŒï¼Œæœ€é•¿ä¸º20Byteï¼Œæœ€çŸ­ä¸º8Byteã€‚åœ¨IPç½‘ç»œä¸­è¿è¡ŒIS-ISæ—¶ï¼Œåªéœ€é…ç½®NETï¼Œæ ¹æ®NETåœ°å€è®¾å¤‡å¯ä»¥è·å–åˆ°Area IDä»¥åŠSystem IDã€‚System IDå¿…é¡»å”¯ä¸€ï¼Œç±»ä¼¼ospfä¸­çš„router id ç¤ºä¾‹ï¼š IS-ISæ‹“æ‰‘ç»“æ„IS-ISåœ¨è‡ªæ²»ç³»ç»Ÿå†…é‡‡ç”¨éª¨å¹²åŒºåŸŸä¸ééª¨å¹²åŒºåŸŸä¸¤çº§çš„åˆ†å±‚ç»“æ„ï¼šLevel-1è·¯ç”±å™¨éƒ¨ç½²åœ¨ééª¨å¹²åŒºåŸŸã€‚Level-2è·¯ç”±å™¨å’ŒLevel-1-2è·¯ç”±å™¨éƒ¨ç½²åœ¨éª¨å¹²åŒºåŸŸã€‚æ¯ä¸€ä¸ªééª¨å¹²åŒºåŸŸéƒ½é€šè¿‡Level-1-2è·¯ç”±å™¨ä¸éª¨å¹²åŒºåŸŸç›¸è¿ã€‚ 1ï¼‰IS-ISä¸­è·¯ç”±å™¨çš„åˆ†ç±» Leverl-1ï¼šåªèƒ½å’ŒåŒåŒºåŸŸçš„L1ã€L1&#x2F;2è·¯ç”±å™¨å»ºç«‹L1çš„é‚»æ¥å…³ç³»ï¼Œåªèƒ½æœ‰æœ¬åŒºåŸŸçš„L1 LSDBæ•°æ®åº“ level-2ï¼šå¯ä»¥å’ŒåŒåŒºåŸŸçš„æˆ–è€…ä¸åŒ åŒºåŸŸL2ã€L1&#x2F;2è·¯ç”±å™¨å»ºç«‹L2çš„é‚»æ¥å…³ç³»ï¼Œæ‹¥æœ‰L2çš„LSDB level1-2ï¼šå¯ä»¥ å’ŒåŒåŒºåŸŸçš„L1è·¯ç”±å™¨å»ºç«‹L1çš„é‚»æ¥å…³ç³»ï¼Œä¹Ÿå¯ä»¥å’ŒåŒåŒºåŸŸæˆ–è€…ä¸åŒåŒºåŸŸçš„L2è·¯ç”±å™¨å»ºç«‹L2çš„é‚»æ¥å…³ç³» 2ï¼‰Isisæ”¯æŒ çš„ç½‘ç»œç±»å‹ å¹¿æ’­å’Œç‚¹åˆ°ç‚¹ å¹¿æ’­ï¼ˆBroadcastï¼‰ï¼š å¦‚Ethernetã€‚ç‚¹åˆ°ç‚¹ï¼ˆP2Pï¼‰ï¼š å¦‚PPPã€ HDLCç­‰ã€‚ 3ï¼‰Isisçš„å¼€é”€å€¼ IS-ISä½¿ç”¨Costï¼ˆå¼€é”€ï¼‰ä½œä¸ºè·¯ç”±åº¦é‡å€¼ï¼ŒCostå€¼è¶Šå°ï¼Œåˆ™è·¯å¾„è¶Šä¼˜ã€‚IS-ISé“¾è·¯çš„Costä¸è®¾å¤‡çš„æ¥å£æœ‰å…³ï¼Œä¸OSPFç±»ä¼¼ï¼Œæ¯ä¸€ä¸ªæ¿€æ´»äº†IS-ISçš„æ¥å£éƒ½ä¼šç»´æŠ¤æ¥å£Costã€‚ç„¶è€Œä¸OSPFä¸åŒçš„æ˜¯ï¼ŒIS-ISæ¥å£çš„Coståœ¨ç¼ºçœæƒ…å†µä¸‹å¹¶ä¸ä¸æ¥å£å¸¦å®½ç›¸å…³ï¼ˆåœ¨å®é™…éƒ¨ç½²æ—¶ï¼ŒIS-ISä¹Ÿæ”¯æŒæ ¹æ®å¸¦å®½è°ƒæ•´Costå€¼ï¼‰ï¼Œæ— è®ºæ¥å£å¸¦å®½å¤šå¤§ï¼Œç¼ºçœæ—¶Costä¸º10ã€‚ä¸€æ¡IS-ISè·¯å¾„çš„Costç­‰äºæœ¬è·¯ç”±å™¨åˆ°è¾¾ç›®æ ‡ç½‘æ®µæ²¿é€”çš„æ‰€æœ‰é“¾è·¯çš„Costæ€»å’Œã€‚ IS-ISæœ‰ä¸‰ç§æ–¹å¼æ¥ç¡®å®šæ¥å£çš„å¼€é”€ï¼ŒæŒ‰ç…§ä¼˜å…ˆçº§ç”±é«˜åˆ°ä½åˆ†åˆ«æ˜¯ï¼šæ¥å£å¼€é”€ï¼šä¸ºå•ä¸ªæ¥å£è®¾ç½®å¼€é”€ã€‚å…¨å±€å¼€é”€ï¼šä¸ºæ‰€æœ‰æ¥å£è®¾ç½®å¼€é”€ã€‚è‡ªåŠ¨è®¡ç®—å¼€é”€ï¼šæ ¹æ®æ¥å£å¸¦å®½è‡ªåŠ¨è®¡ç®—å¼€é”€ã€‚ æŠ¥æ–‡æ ¼å¼ é€šç”¨å¤´éƒ¨è§£é‡Šï¼š TLVï¼š IS-ISåè®®å·¥ä½œåŸç†å·¥ä½œåŸç†ï¼šâ‘ å»ºç«‹é‚»æ¥ï¼›â‘¡åŒæ­¥LSDBï¼›â‘¢è®¡ç®—è·¯ç”±ï¼› é‚»æ¥å»ºç«‹IS-ISæŒ‰å¦‚ä¸‹åŸåˆ™å»ºç«‹é‚»æ¥å…³ç³»ï¼š åªæœ‰åŒä¸€å±‚æ¬¡çš„ç›¸é‚»è·¯ç”±å™¨æ‰æœ‰å¯èƒ½æˆä¸ºé‚»æ¥ã€‚å¯¹äºLevel-1è·¯ç”±å™¨æ¥è¯´ï¼ŒArea IDå¿…é¡»ä¸€è‡´ã€‚é“¾è·¯ä¸¤ç«¯IS-ISæ¥å£çš„ç½‘ç»œç±»å‹å¿…é¡»ä¸€è‡´ã€‚é“¾è·¯ä¸¤ç«¯IS-ISæ¥å£çš„åœ°å€å¿…é¡»å¤„äºåŒä¸€ç½‘æ®µï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼‰ã€‚ ä½¿ç”¨IIHï¼ˆIsis hello ï¼‰ï¼šå‘ç°é‚»å±…ï¼›å»ºç«‹é‚»æ¥å…³ç³»ï¼›ç»´æŠ¤é‚»æ¥å…³ç³»ï¼Œ å¹¿æ’­ç½‘ç»œï¼šlevel-1 LAN IIHã€level-2 LAN IIHã€ Level-1 IIHå’ŒLevel-2 IIHå‘é€çš„ç»„æ’­åœ°å€åˆ†åˆ«ä¸º01-80-C2-00-00-14ã€01-80-C2-00-00-15ã€‚ ç‚¹åˆ°ç‚¹ç½‘ç»œä¸­ï¼šP2P IIH IIHï¼š P2P IIHä¸­ç›¸å¯¹äºLAN IIHæ¥è¯´ï¼Œå¤šäº†ä¸€ä¸ªè¡¨ç¤ºæœ¬åœ°é“¾è·¯IDçš„Local Circuit IDå­—æ®µï¼Œç¼ºå°‘äº†è¡¨ç¤ºå¹¿æ’­ç½‘ä¸­DISçš„ä¼˜å…ˆçº§çš„Priorityå­—æ®µä»¥åŠè¡¨ç¤ºDISå’Œä¼ªèŠ‚ç‚¹System IDçš„LAN IDå­—æ®µã€‚ å›¾1-68 IS-IS Helloæ¶ˆæ¯æ ¼å¼ 123456789101112131415161718192021222324252627282930313233+----------------------------------------------+------------| Intradomain Routing Protocol Discriminator | |+----------------------------------------------+ || Length Indicator | |+----------------------------------------------+ || Version/Protocol ID Extension | |+----------------------------------------------+ || ID Length | PDU+----------------------------------------------+ Common| R | R | R | PDU Type | Header+----------------------------------------------+ || Version | |+----------------------------------------------+ || Reserved | |+----------------------------------------------+ || Maximum Area Addresses | |+----------------------------------------------+------------| Reserved/Circuit Type | |+----------------------------------------------+ || Source ID | |+----------------------------------------------+ || Holding Time | |+----------------------------------------------+ PDU| PDU Length | Specific+----------------------------------------------+ Header| R | Priority | |+----------------------------------------------+ || LAN ID | |+----------------------------------------------+ || Local Circuit ID | |+----------------------------------------------+------------| Variable Length Fields (CLV) |+----------------------------------------------+ Reserved&#x2F;Circuit Typeï¼šè¡¨ç¤ºè·¯ç”±å™¨çš„ç±»å‹ï¼ˆ01è¡¨ç¤ºL1ï¼Œ10è¡¨ç¤ºL2ï¼Œ11è¡¨ç¤ºL1&#x2F;L2ï¼‰ã€‚ Source ID ï¼šå‘å‡ºHelloæŠ¥æ–‡çš„è·¯ç”±å™¨çš„System IDã€‚ Holding Time ï¼š ä¿æŒæ—¶é—´ã€‚åœ¨æ­¤æ—¶é—´å†…å¦‚æœæ²¡æœ‰æ”¶åˆ°é‚»æ¥å‘æ¥çš„HelloæŠ¥æ–‡ï¼Œåˆ™ä¸­æ­¢å·²å»ºç«‹çš„é‚»æ¥å…³ç³»ã€‚ Priority ï¼šé€‰ä¸¾DISçš„ä¼˜å…ˆçº§ï¼Œå–å€¼èŒƒå›´ä¸º0ï½127ã€‚æ•°å€¼è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šé«˜ã€‚è¯¥å­—æ®µåªåœ¨å¹¿æ’­ç½‘ä¸­çš„Helloæ¶ˆæ¯(LAN IIHæ¶ˆæ¯)æºå¸¦ï¼›ç‚¹åˆ°ç‚¹ç½‘ç»œçš„Helloæ¶ˆæ¯(P2P IIHæ¶ˆæ¯)æ²¡æœ‰æ­¤å­—æ®µï¼Œä¹Ÿæ²¡æœ‰æ­¤å­—æ®µä¹‹å‰çš„Rä¿ç•™ä½ã€‚ LAN ID ï¼š åŒ…æ‹¬DISçš„System IDå’Œä¼ªèŠ‚ç‚¹IDã€‚è¯¥å­—æ®µåªåœ¨å¹¿æ’­ç½‘ä¸­çš„Helloæ¶ˆæ¯(LAN IIHæ¶ˆæ¯)æºå¸¦ï¼›ç‚¹åˆ°ç‚¹ç½‘ç»œçš„Helloæ¶ˆæ¯(P2P IIHæ¶ˆæ¯)æ²¡æœ‰æ­¤å­—æ®µã€‚ Local Circuit ID ï¼šæœ¬åœ°é“¾è·¯IDã€‚è¯¥å­—æ®µåªåœ¨ç‚¹åˆ°ç‚¹ç½‘ç»œçš„Helloæ¶ˆæ¯(P2P IIHæ¶ˆæ¯)æºå¸¦ï¼›å¹¿æ’­ç½‘ä¸­çš„Helloæ¶ˆæ¯(LAN IIHæ¶ˆæ¯)æ²¡æœ‰æ­¤å­—æ®µã€‚ å¹¿æ’­ç±»å‹ï¼š ç‚¹åˆ°ç‚¹ç±»å‹ï¼š é€‰ä¸¾DISï¼š åœ¨å¹¿æ’­ç½‘ç»œä¸­ï¼ŒIS-ISéœ€è¦åœ¨ä¸€ä¸ªå¹¿æ’­ç½‘ç»œä¸­çš„æ‰€æœ‰çš„è·¯ç”±å™¨ä¸­é€‰ä¸¾ä¸€ä¸ªè·¯ç”±å™¨ä½œä¸ºDISï¼ˆDesignated Intermediate Systemï¼‰ã€‚DISç”¨æ¥åˆ›å»ºå’Œæ›´æ–°ä¼ªèŠ‚ç‚¹ï¼ˆPseudonodesï¼‰ï¼Œå¹¶è´Ÿè´£ç”Ÿæˆä¼ªèŠ‚ç‚¹çš„LSPï¼Œç”¨æ¥æè¿°è¿™ä¸ªç½‘ç»œä¸Šæœ‰å“ªäº›ç½‘ç»œè®¾å¤‡ã€‚ä¼ªèŠ‚ç‚¹æ˜¯ç”¨æ¥æ¨¡æ‹Ÿå¹¿æ’­ç½‘ç»œçš„ä¸€ä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼Œå¹¶éçœŸå®çš„è·¯ç”±å™¨ã€‚åœ¨IS-ISä¸­ï¼Œä¼ªèŠ‚ç‚¹ç”¨DISçš„System IDå’ŒCircuit IDï¼ˆé0å€¼ï¼‰æ ‡è¯†ã€‚ Level-1å’ŒLevel-2çš„DISæ˜¯åˆ†åˆ«é€‰ä¸¾çš„ï¼Œç”¨æˆ·å¯ä»¥ä¸ºä¸åŒçº§åˆ«çš„DISé€‰ä¸¾è®¾ç½®ä¸åŒçš„ä¼˜å…ˆçº§ã€‚ DISé€‰ä¸¾åŸåˆ™ï¼š â‘ ä¼˜å…ˆçº§ï¼š0-127 é»˜è®¤64ï¼Œè¶Šå¤§è¶Šä¼˜ï¼Œä¼˜å…ˆçº§0ä¹Ÿå‚ä¸é€‰ä¸¾ â‘¡MACåœ°å€ï¼šè¶Šå¤§è¶Šä¼˜ DISå‘é€Hello PDUçš„æ—¶é—´é—´éš”æ˜¯æ™®é€šè·¯ç”±å™¨çš„1&#x2F;3ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿DISå‡ºç°æ•…éšœæ—¶èƒ½å¤Ÿè¢«æ›´å¿«é€Ÿåœ°è¢«å‘ç°ã€‚ IS-ISä¸­DISä¸OSPFåè®®ä¸­DRï¼ˆDesignated Routerï¼‰çš„åŒºåˆ«ï¼š1.åœ¨IS-ISå¹¿æ’­ç½‘ä¸­ï¼Œä¼˜å…ˆçº§ä¸º0çš„è·¯ç”±å™¨ä¹Ÿå‚ä¸DISçš„é€‰ä¸¾ï¼Œè€Œåœ¨OSPFä¸­ä¼˜å…ˆçº§ä¸º0çš„è·¯ç”±å™¨åˆ™ä¸å‚ä¸DRçš„é€‰ä¸¾ã€‚2.åœ¨IS-ISå¹¿æ’­ç½‘ä¸­ï¼Œå½“æœ‰æ–°çš„è·¯ç”±å™¨åŠ å…¥ï¼Œå¹¶ç¬¦åˆæˆä¸ºDISçš„æ¡ä»¶æ—¶ï¼Œè¿™ä¸ªè·¯ç”±å™¨ä¼šè¢«é€‰ä¸­æˆä¸ºæ–°çš„DISï¼ŒåŸæœ‰çš„ä¼ªèŠ‚ç‚¹è¢«åˆ é™¤ã€‚æ­¤æ›´æ”¹ä¼šå¼•èµ·ä¸€ç»„æ–°çš„LSPæ³›æ´ªã€‚è€Œåœ¨OSPFä¸­ï¼Œå½“ä¸€å°æ–°è·¯ç”±å™¨åŠ å…¥åï¼Œå³ä½¿å®ƒçš„DRä¼˜å…ˆçº§å€¼æœ€å¤§ï¼Œä¹Ÿä¸ä¼šç«‹å³æˆä¸ºè¯¥ç½‘æ®µä¸­çš„DRã€‚â€”-ISisä¸­çš„DISæ”¯æŒæŠ¢å ï¼Œospfä¸­çš„DRå’ŒBDRä¸æ”¯æŒæŠ¢å 3.åœ¨IS-ISå¹¿æ’­ç½‘ä¸­ï¼ŒåŒä¸€ç½‘æ®µä¸Šçš„åŒä¸€çº§åˆ«çš„è·¯ç”±å™¨ä¹‹é—´éƒ½ä¼šå½¢æˆé‚»æ¥å…³ç³»ï¼ŒåŒ…æ‹¬æ‰€æœ‰çš„éDISè·¯ç”±å™¨ä¹‹é—´ä¹Ÿä¼šå½¢æˆé‚»æ¥å…³ç³»ã€‚è€Œåœ¨OSPFä¸­ï¼Œè·¯ç”±å™¨åªä¸DRå’ŒBDRå»ºç«‹é‚»æ¥å…³ç³»ã€‚ â€“-Isisä¸­å»ºç«‹çš„éƒ½æ˜¯é‚»æ¥çš„å…³ç³» åŒæ­¥é“¾è·¯çŠ¶æ€æ•°æ®åº“L1å’ŒL2åˆ†åˆ«æœ‰è‡ªå·±çš„LSDB LSDBä¸­åŒ…å«çš„å°±æ˜¯LSPï¼ŒLSPæè¿°è·¯ç”±å™¨çš„é“¾è·¯çŠ¶æ€ä¿¡æ¯ display isis lsdb Database information for ISIS(1)Level-1 Link State DatabaseLSPID Seq Num Checksum Holdtime Length ATT&#x2F;P&#x2F;OL-â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“0100.0000.1001.00-00* 0x00000005 0x13a8 1187 97 0&#x2F;0&#x2F;00100.0000.1001.01-00* 0x00000001 0xda2e 1185 55 0&#x2F;0&#x2F;00100.0000.2002.00-00 0x00000004 0x94e9 1188 86 1&#x2F;0&#x2F;0Total LSP(s): 5 (In TLV)-Leaking Route, (By LSPID)-Self LSP, +-Self LSP(Extended), ATT-Attached, P-Partition, OL-Overload0100.0000.1001ï¼ˆè·¯ç”±å™¨çš„ç³»ç»ŸIDï¼‰.00ï¼ˆå®èŠ‚ç‚¹è¿˜æ˜¯ä¼ªèŠ‚ç‚¹ï¼Œ00è¡¨ç¤ºå®èŠ‚ç‚¹ï¼Œé0è¡¨ç¤ºä¼ªèŠ‚ç‚¹ï¼‰-00ï¼ˆLSPåˆ†ç‰‡ï¼‰ï¼ˆè¡¨ç¤ºæ˜¯æœ¬è·¯ç”±å™¨äº§ç”Ÿçš„ï¼‰ LSP å›¾1-70 L1&#x2F;L2 LSPæ ¼å¼ 12345678910111213141516171819202122232425262728293031+----------------------------------------------+------------| Intradomain Routing Protocol Discriminator | |+----------------------------------------------+ || Length Indicator | |+----------------------------------------------+ || Version/Protocol ID Extension | |+----------------------------------------------+ || ID Length | PDU+----------------------------------------------+ Common| R | R | R | PDU Type | Header+----------------------------------------------+ || Version | |+----------------------------------------------+ || Reserved | |+----------------------------------------------+ || Maximum Area Addresses | |+----------------------------------------------+------------| PDU Length | |+----------------------------------------------+ || Remaining Lifetime | |+----------------------------------------------+ || LSP ID | PDU+----------------------------------------------+ Specific| Sequency Number | Header+----------------------------------------------+ || Checksum | |+----------------------------------------------+ || P | ATT | OL | IS Type | |+----------------------------------------------+------------| Variable Length Fields(CLV) |+----------------------------------------------+ Remaining Lifetime : LSPçš„ç”Ÿå­˜æ—¶é—´ï¼Œä»¥ç§’ä¸ºå•ä½ã€‚ LSP ID:ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼ŒSystem IDã€ä¼ªèŠ‚ç‚¹IDå’ŒLSPåˆ†ç‰‡åçš„ç¼–å·ã€‚ Sequence Number: LSPçš„åºåˆ—å·ã€‚åœ¨è·¯ç”±å™¨å¯åŠ¨æ—¶æ‰€å‘é€çš„ç¬¬ä¸€ä¸ªLSPæŠ¥æ–‡ä¸­çš„åºåˆ—å·ä¸º1ï¼Œä»¥åå½“éœ€è¦ç”Ÿæˆæ–°çš„LSPæ—¶ï¼Œæ–°LSPçš„åºåˆ—å·åœ¨å‰ä¸€ä¸ªLSPåºåˆ—å·çš„åŸºç¡€ä¸ŠåŠ 1ã€‚æ›´é«˜çš„åºåˆ—å·æ„å‘³ç€æ›´æ–°çš„LSPã€‚ Checksum ï¼š LSPçš„æ ¡éªŒå’Œã€‚ ATTï¼ˆAttachmentï¼‰ï¼šç”±Level-1-2è·¯ç”±å™¨äº§ç”Ÿï¼Œç”¨æ¥æŒ‡æ˜å§‹å‘è·¯ç”±å™¨æ˜¯å¦ä¸å…¶å®ƒåŒºåŸŸç›¸è¿ã€‚è™½ç„¶æ­¤æ ‡å¿—ä½ä¹Ÿå­˜åœ¨äºLevel-1å’ŒLevel-2çš„LSPä¸­ï¼Œä½†å®é™…ä¸Šæ­¤å­—æ®µåªå’ŒLevel-1-2è·¯ç”±å™¨å§‹å‘çš„L1 LSPæœ‰å…³ã€‚ OLï¼ˆLSDB Overloadï¼Œ1bitï¼‰ï¼šè¿‡è½½æ ‡å¿—ä½ã€‚è®¾ç½®äº†è¿‡è½½æ ‡å¿—ä½çš„LSPè™½ç„¶è¿˜ä¼šåœ¨ç½‘ç»œä¸­æ‰©æ•£ï¼Œä½†æ˜¯åœ¨è®¡ç®—é€šè¿‡è¶…è½½è·¯ç”±å™¨çš„è·¯ç”±æ—¶ä¸ä¼šè¢«é‡‡ç”¨ã€‚å³å¯¹è·¯ç”±å™¨è®¾ç½®è¿‡è½½ä½åï¼Œå…¶å®ƒè·¯ç”±å™¨åœ¨è¿›è¡ŒSPFè®¡ç®—æ—¶ä¸ä¼šè€ƒè™‘è¿™å°è·¯ç”±å™¨ã€‚å½“è·¯ç”±å™¨å†…å­˜ä¸è¶³æ—¶ï¼Œç³»ç»Ÿè‡ªåŠ¨åœ¨å‘é€çš„LSPæŠ¥æ–‡ä¸­è®¾ç½®è¿‡è½½æ ‡å¿—ä½ã€‚ IS Type(2bit)ï¼šç”ŸæˆLSPçš„è·¯ç”±å™¨çš„ç±»å‹ã€‚ç”¨æ¥æŒ‡æ˜æ˜¯Level-1è¿˜æ˜¯Level-2è·¯ç”±å™¨ï¼ˆ01è¡¨ç¤ºLevel-1ï¼Œ11è¡¨ç¤ºLevel-2ï¼‰ã€‚ 3ï¼‰Isisè·¯ç”±è®¡ç®— â‘ L1çš„è·¯ç”±å™¨åªèƒ½é€šè¿‡L1çš„LSBDè®¡ç®—å­¦ä¹ åˆ°L1çš„è·¯ç”± â€”åªæœ‰L1é‚»æ¥å…³ç³»çš„è·¯ç”± â‘¡L2çš„è·¯ç”±å™¨ç»´æŠ¤L2çš„LSDBï¼Œä½†æ˜¯å¯ä»¥å­¦ä¹ æ‰€æœ‰çš„è·¯ç”±ï¼ŒåŒ…æ‹¬L1å’ŒL2çš„è·¯ç”±â€”å…¨ç½‘è·¯ç”± â‘¢L1&#x2F;2ä¼šå‘L1åŒºåŸŸä¸‹å‘ä¸€æ¡L1çš„ç¼ºçœè·¯ç”±ï¼ŒL1å¯ä»¥é€šè¿‡è¯¥ç¼ºçœè·¯ç”±åˆ°è¾¾L2 â‘£è·¯ç”±æ¸—é€ï¼šå°†L2è·¯ç”±åœ¨L1&#x2F;2è·¯ç”±å™¨ä¸Šè¿›è¡Œå¼•å…¥ï¼Œè®©L1è·¯ç”±å™¨å¯ä»¥å­¦ä¹ åˆ°L2çš„æ˜ç»†è·¯ç”± [R2-isis-1]import-route isis level-2 into level-1 4ã€IS-ISåè®®çš„æŠ¥æ–‡ ospfâ€“IsisæŠ¥æ–‡çš„å¯¹åº” Hello â€”&gt;IIH DD â€”&gt;CSNP LSR â€”&gt;PSNP LSU â€”&gt;LSP LSACK â€”&gt;PSNP LSA â€”&gt;LSP æ ¹æ®æŠ¥æ–‡çš„ç§ç±»ï¼Œè®¤è¯å¯ä»¥åˆ†ä¸ºä»¥ä¸‹ä¸‰ç±»ï¼šæ¥å£è®¤è¯ï¼šåœ¨æ¥å£è§†å›¾ä¸‹é…ç½®ï¼Œå¯¹Level-1å’ŒLevel-2çš„HelloæŠ¥æ–‡è¿›è¡Œè®¤è¯ã€‚åŒºåŸŸè®¤è¯ï¼šåœ¨IS-ISè¿›ç¨‹è§†å›¾ä¸‹é…ç½®ï¼Œå¯¹Level-1çš„CSNPã€PSNPå’ŒLSPæŠ¥æ–‡è¿›è¡Œè®¤è¯ã€‚è·¯ç”±åŸŸè®¤è¯ï¼šåœ¨IS-ISè¿›ç¨‹è§†å›¾ä¸‹é…ç½®ï¼Œå¯¹Level-2çš„CSNPã€PSNPå’ŒLSPæŠ¥æ–‡è¿›è¡Œè®¤è¯ã€‚ æ ¹æ®æŠ¥æ–‡çš„è®¤è¯æ–¹å¼ï¼Œå¯ä»¥åˆ†ä¸ºä»¥ä¸‹å››ç±»ï¼šç®€å•è®¤è¯ï¼šå°†é…ç½®çš„å¯†ç ç›´æ¥åŠ å…¥æŠ¥æ–‡ä¸­ï¼Œè¿™ç§åŠ å¯†æ–¹å¼å®‰å…¨æ€§è¾ƒå…¶ä»–ä¸¤ç§æ–¹å¼ä½ã€‚MD5è®¤è¯ï¼šé€šè¿‡å°†é…ç½®çš„å¯†ç è¿›è¡ŒMD5ç®—æ³•åŠ å¯†ä¹‹åå†åŠ å…¥æŠ¥æ–‡ä¸­ï¼Œæé«˜å¯†ç çš„å®‰å…¨æ€§ã€‚Keychianè®¤è¯ï¼šé€šè¿‡é…ç½®éšæ—¶é—´å˜åŒ–çš„å¯†ç é“¾è¡¨æ¥è¿›ä¸€æ­¥æå‡ç½‘ç»œçš„å®‰å…¨æ€§ã€‚HMAC-SHA256è®¤è¯ï¼šé€šè¿‡å°†é…ç½®çš„å¯†ç è¿›è¡ŒHMAC-SHA256ç®—æ³•åŠ å¯†ä¹‹åå†åŠ å…¥æŠ¥æ–‡ä¸­ï¼Œæé«˜å¯†ç çš„å®‰å…¨æ€§ã€‚ 5ã€IS-ISåè®®é…ç½® [r1]isis è¿›å…¥Isisè¿›ç¨‹ï¼Œé»˜è®¤è¿›ç¨‹1 [r1-isis-1]network-entity 49.0001.0000.0000.0001.00 é…ç½®NETåœ°å€ï¼Œå…¶ä¸­system idå¿…é¡»å”¯ä¸€ [r1-isis-1]is-level level-1 ä¿®æ”¹è·¯ç”±çš„çº§åˆ«ï¼Œé»˜è®¤ä¸ºL1&#x2F;2è·¯ç”±å™¨ [R2-GigabitEthernet0&#x2F;0&#x2F;0]isis enable 100 å®£å‘Šç½‘æ®µè¿›å…¥Isisè¿›ç¨‹100 [R2-isis-1]is-name R2 å°†system idç”¨nameè¡¨ç¤º [R2-GigabitEthernet0&#x2F;0&#x2F;1]isis circuit-level level-2 ä¿®æ”¹æ¥å£çš„é“¾è·¯çº§åˆ« [r1-GigabitEthernet0&#x2F;0&#x2F;0]isis circuit-type p2p ä¿®æ”¹æ¥å£çš„é“¾è·¯ç±»å‹ [R2-GigabitEthernet0&#x2F;0&#x2F;2]isis dis-priority 127 level-2 ä¿®æ”¹æ¥å£çš„ä¼˜å…ˆçº§ï¼Œå½±å“DISçš„é€‰ä¸¾ï¼Œå¯ä»¥åªé’ˆå¯¹æŸä¸ªlevelè¿›è¡Œæ›´æ”¹ æŸ¥çœ‹å‘½ä»¤ Display isis peer æŸ¥çœ‹Isisé‚»å±… Display Isis interface æŸ¥çœ‹DISçš„é€‰ä¸¾ã€ Display Isis route æŸ¥çœ‹Isisè·¯ç”±","categories":[{"name":"åŸºç¡€çŸ¥è¯†","slug":"åŸºç¡€çŸ¥è¯†","permalink":"http://example.com/categories/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"}],"tags":[{"name":"IS-IS","slug":"IS-IS","permalink":"http://example.com/tags/IS-IS/"}]},{"title":"opsfæ€»ç»“","slug":"opsfæ€»ç»“","date":"2024-04-18T12:24:37.000Z","updated":"2024-07-18T08:40:56.230Z","comments":true,"path":"2024/04/18/opsfæ€»ç»“/","permalink":"http://example.com/2024/04/18/opsf%E6%80%BB%E7%BB%93/","excerpt":"","text":"ospfåè®®å·¥ä½œåŸç†å·¥ä½œè¿‡ç¨‹ï¼šâ‘ å»ºç«‹é‚»å±…å…³ç³»ï¼ˆhello 2-wayçŠ¶æ€ï¼‰æ¯å°è·¯ç”±å™¨éƒ½ä¼šäº§ç”Ÿlsaï¼Œè·¯ç”±å™¨å°†æ¥æ”¶åˆ°çš„lsaæ”¾å…¥è‡ªå·±çš„lsdbä¸­ï¼›â‘¡åŒæ­¥LSDBï¼ˆDDã€LSRã€LSUã€LSACK fullçŠ¶æ€ï¼‰ï¼›â‘¢è®¡ç®—è·¯ç”±ï¼ˆæœ¬è·¯ç”±å™¨é€šè¿‡è‡ªå·±çš„LSDBï¼Œä»¥è‡ªå·±ä¸ºæ ¹èŠ‚ç‚¹ï¼Œè®¡ç®—æœ€çŸ­è·¯å¾„æ ‘ï¼Œæœ€ç»ˆå¾—åˆ°è·¯ç”±ï¼‰SPFç®—æ³•ï¼› ospfæ”¯æŒçš„ç½‘ç»œç±»å‹ï¼šå¹¿æ’­ã€NBMAã€ç‚¹åˆ°ç‚¹ã€ç‚¹åˆ°å¤šç‚¹ ospfè®¡ç®—ï¼›è®¡ç®—è·¯ç”±+è®¡ç®—æ‹“æ‰‘ ospfæŠ¥æ–‡é‡‡ç”¨IPå°è£…ï¼Œåè®®å·89ï¼Œ ospfv2ï¼ˆipv4ï¼‰ï¼Œospfv3ï¼ˆipv6ï¼‰ ospfç»„æ’­æ›´æ–° 224.0.0.5ï¼ˆæ‰€æœ‰è¿è¡Œospfåè®®çš„è·¯ç”±å™¨ä¾¦å¬ï¼‰ 224.0.0.6ï¼ˆDRå’ŒBDRä¾¦å¬ï¼‰ Router idåœ¨è‡ªæ²»ç³»ç»Ÿä¸­å”¯ä¸€æ ‡è¯†ä¸€å°è¿è¡Œospfçš„è·¯ç”±å™¨ï¼Œ32ä½æ— ç¬¦å·æ•´æ•° é€‰ä¸¾è§„åˆ™ï¼šæ‰‹åŠ¨é…ç½®ï¼ˆå»ºè®®ï¼‰ï¼Œå¦‚æœæ²¡æœ‰æ‰‹åŠ¨é…ç½®ï¼Œåˆ™è·¯ç”±å™¨ä½¿ç”¨Loopbackæ¥å£ä¸­æœ€å¤§çš„IPåœ°å€ä½œä¸ºRouter idï¼Œå¦‚æœæ²¡æœ‰é…ç½®Loopbackæ¥å£ï¼Œåˆ™ä½¿ç”¨ç‰©ç†æ¥å£ä¸­æœ€å¤§çš„IPåœ°å€ Costå€¼ç¼ºçœæ¥å£cost&#x3D;ï¼ˆ100mib&#x2F;sï¼‰&#x2F; æ¥å£å¸¦å®½ï¼Œä¿®æ”¹100mid&#x2F;sæ”¹å˜cost ä¹Ÿå¯ä»¥ç›´æ¥ä¿®æ”¹ ç´¯è®¡costä½œä¸ºå¼€é”€å€¼ï¼Œæµé‡ä»æºç½‘ç»œåˆ°ç›®çš„ç½‘ç»œæ‰€ç»è¿‡æ‰€æœ‰è·¯ç”±å™¨çš„å‡ºæ¥å£çš„costæ€»å’Œ HelloæŠ¥æ–‡ å‘é€é—´éš”10sï¼Œå¤±æ•ˆ40sï¼Œä¿®æ”¹å‘é€ï¼Œå¤±æ•ˆä¹Ÿå˜ï¼Œå¤±æ•ˆå§‹ç»ˆä¸ºå‘é€çš„4å€ å‘½ä»¤ï¼šæ¥å£è§†å›¾ä¸‹ï¼Œospf timer hello 10 ospfé‚»å±…å»ºç«‹å¤±è´¥ ï¼Œå¯èƒ½åŸå› ï¼šâ‘ ç‰©ç†é“¾è·¯æ•…éšœï¼›â‘¡ospfç‰ˆæœ¬ä¸ä¸€è‡´ï¼›â‘¢åŒºåŸŸIDä¸ä¸€è‡´ï¼›â‘£è®¤è¯ç±»å‹ä¸ä¸€è‡´ï¼›â‘¤è®¤è¯æ•°æ®ä¸ä¸€è‡´ï¼›â‘¥æ©ç ä¸ä¸€è‡´ï¼›ï¼ˆåªå‡ºç°åœ¨å¹¿æ’­å‹ç½‘ç»œä¸­ï¼Œç‚¹åˆ°ç‚¹ç½‘ç»œä¸æ£€æŸ¥æ©ç ä¿¡æ¯ï¼‰â‘¦helloæŠ¥æ–‡é—´éš”ä¸ä¸€è‡´ï¼›â‘§router idä¸€è‡´ï¼›ï¼ˆåä¸ºè®¾å¤‡é‡åˆ°router idä¸€è‡´ï¼Œä¼šé‡æ–°é…ç½®router idï¼‰ DDæŠ¥æ–‡DDæŠ¥æ–‡éƒ¨åˆ†å­—æ®µè§£é‡ŠIï¼šå½“å‘é€è¿ç»­å¤šä¸ªDDæŠ¥æ–‡æ—¶ï¼Œå¦‚æœè¿™æ˜¯ç¬¬ä¸€ä¸ªDDæŠ¥æ–‡ï¼Œåˆ™ç½®ä¸º1ï¼Œå¦åˆ™ç½®ä¸º0ã€‚M (More)ï¼šå½“å‘é€è¿ç»­å¤šä¸ªDDæŠ¥æ–‡æ—¶ï¼Œå¦‚æœè¿™æ˜¯æœ€åä¸€ä¸ªDDæŠ¥æ–‡ï¼Œåˆ™ç½®ä¸º0ã€‚å¦åˆ™ç½®ä¸º1ï¼Œè¡¨ç¤ºåé¢è¿˜æœ‰å…¶ä»–çš„DDæŠ¥æ–‡ã€‚MS (Master&#x2F;Slave)ï¼šå½“ä¸¤å°OSPFè·¯ç”±å™¨äº¤æ¢DDæŠ¥æ–‡æ—¶ï¼Œé¦–å…ˆéœ€è¦ç¡®å®šåŒæ–¹çš„ä¸»ä»å…³ç³»ï¼ŒRouter IDå¤§çš„ä¸€æ–¹ä¼šæˆä¸ºMasterã€‚å½“å€¼ä¸º1æ—¶è¡¨ç¤ºå‘é€æ–¹ä¸ºMasterã€‚DD sequence numberï¼šDDæŠ¥æ–‡åºåˆ—å·ã€‚ä¸»ä»åŒæ–¹åˆ©ç”¨åºåˆ—å·æ¥ä¿è¯DDæŠ¥æ–‡ä¼ è¾“çš„å¯é æ€§å’Œå®Œæ•´æ€§ã€‚ é“¾è·¯çŠ¶æ€ç±»å‹ã€é“¾è·¯çŠ¶æ€IDã€é€šå‘Šè·¯ç”±å™¨ä¸‰å…ƒç»„å”¯ä¸€åœ°æ ‡è¯†äº†ä¸€ä¸ªLSAã€‚é“¾è·¯çŠ¶æ€è€åŒ–æ—¶é—´ ã€é“¾è·¯çŠ¶æ€åºåˆ—å· ã€æ ¡éªŒå’Œç”¨äºåˆ¤æ–­LSAçš„æ–°æ—§ ospfçŠ¶æ€æœºä¹‹å‰çš„æ‰‹å†™ç¬”è®°ğŸ˜ DRå’ŒBDRæ—¢ä¾¦å¬224.0.0.5ä¹Ÿä¾¦å¬224.0.0.6 æ¯ä¸ªç½‘æ®µé€‰ä¸¾ä¸€ä¸ª DRï¼šæŒ‡å®šè·¯ç”±å™¨ï¼Œè´Ÿè´£åœ¨MAç½‘ç»œä¸­å»ºç«‹å’Œç»´æŠ¤é‚»æ¥å…³ç³»ï¼Œå¹¶è´Ÿè´£lsaåŒæ­¥ DRå’Œå…¶ä»–æ‰€æœ‰è·¯ç”±å™¨å½¢æˆé‚»æ¥å…³ç³»ï¼Œå…¶ä»–è·¯ç”±å™¨ä¹‹é—´ä¸ç›´æ¥äº¤æ¢é“¾è·¯çŠ¶æ€ä¿¡æ¯ åœ¨DRå¤±æ•ˆæ—¶å€™ï¼ŒBDRæ¥æ›¿ DRé»˜è®¤ä¼˜å…ˆçº§1ï¼ˆ0-255ï¼‰è¶Šå¤§è¶Šä¼˜ï¼ŒéæŠ¢å ï¼Œä¼˜å…ˆçº§ä¸º0çš„ä¸å‚ä¸é€‰ä¸¾ è·¯ç”±ç±»å‹ä¸‹è¡¨ä¸­æŒ‰ä¼˜å…ˆçº§ä»é«˜åˆ°ä½é¡ºåºåˆ—å‡ºäº†è·¯ç”±ç±»å‹ è·¯ç”±ç±»å‹ å«ä¹‰ Intra Area åŒºåŸŸå†…è·¯ç”±ã€‚ Inter Area åŒºåŸŸé—´è·¯ç”±ã€‚ ç¬¬ä¸€ç±»å¤–éƒ¨è·¯ç”±ï¼ˆType1 Externalï¼‰ è¿™ç±»è·¯ç”±çš„å¯ä¿¡ç¨‹åº¦é«˜ä¸€äº›ï¼Œæ‰€ä»¥è®¡ç®—å‡ºçš„å¤–éƒ¨è·¯ç”±çš„å¼€é”€ä¸è‡ªæ²»ç³»ç»Ÿå†…éƒ¨çš„è·¯ç”±å¼€é”€æ˜¯ç›¸å½“çš„ï¼Œå¹¶ä¸”å’ŒOSPFè‡ªèº«è·¯ç”±çš„å¼€é”€å…·æœ‰å¯æ¯”æ€§ã€‚åˆ°ç¬¬ä¸€ç±»å¤–éƒ¨è·¯ç”±çš„å¼€é”€&#x3D;æœ¬è®¾å¤‡åˆ°ç›¸åº”çš„ASBRçš„å¼€é”€+ASBRåˆ°è¯¥è·¯ç”±ç›®çš„åœ°å€çš„å¼€é”€ã€‚ ç¬¬äºŒç±»å¤–éƒ¨è·¯ç”±ï¼ˆType2 Externalï¼‰ è¿™ç±»è·¯ç”±çš„å¯ä¿¡åº¦æ¯”è¾ƒä½ï¼Œæ‰€ä»¥OSPFåè®®è®¤ä¸ºä»ASBRåˆ°è‡ªæ²»ç³»ç»Ÿä¹‹å¤–çš„å¼€é”€è¿œè¿œå¤§äºåœ¨è‡ªæ²»ç³»ç»Ÿä¹‹å†…åˆ°è¾¾ASBRçš„å¼€é”€ã€‚æ‰€ä»¥ï¼ŒOSPFè®¡ç®—è·¯ç”±å¼€é”€æ—¶åªè€ƒè™‘ASBRåˆ°è‡ªæ²»ç³»ç»Ÿä¹‹å¤–çš„å¼€é”€ï¼Œå³åˆ°ç¬¬äºŒç±»å¤–éƒ¨è·¯ç”±çš„å¼€é”€&#x3D;ASBRåˆ°è¯¥è·¯ç”±ç›®çš„åœ°å€çš„å¼€é”€ã€‚ LSA LSAç±»å‹ LSAä½œç”¨ Router-LSAï¼ˆType1ï¼‰ æ¯ä¸ªè®¾å¤‡éƒ½ä¼šäº§ç”Ÿï¼Œæè¿°äº†è®¾å¤‡çš„é“¾è·¯çŠ¶æ€å’Œå¼€é”€ï¼Œåœ¨æ‰€å±çš„åŒºåŸŸå†…ä¼ æ’­ã€‚ Network-LSAï¼ˆType2ï¼‰ ç”±DRï¼ˆDesignated Routerï¼‰äº§ç”Ÿï¼Œæè¿°æœ¬ç½‘æ®µçš„é“¾è·¯çŠ¶æ€ï¼Œåœ¨æ‰€å±çš„åŒºåŸŸå†…ä¼ æ’­ã€‚ Network-summary-LSAï¼ˆType3ï¼‰ ç”±ABRäº§ç”Ÿï¼Œæè¿°åŒºåŸŸå†…æŸä¸ªç½‘æ®µçš„è·¯ç”±ï¼Œå¹¶é€šå‘Šç»™å‘å¸ƒæˆ–æ¥æ”¶æ­¤LSAçš„éTotally STUBæˆ–NSSAåŒºåŸŸã€‚ä¾‹å¦‚ï¼šABRåŒæ—¶å±äºArea0å’ŒArea1ï¼ŒArea0å†…å­˜åœ¨ç½‘æ®µ10.1.1.0ï¼ŒArea1å†…å­˜åœ¨ç½‘æ®µ11.1.1.0ï¼ŒABRä¸ºArea0ç”Ÿæˆåˆ°ç½‘æ®µ11.1.1.0çš„Type3 LSAï¼›ABRä¸ºArea1ç”Ÿæˆåˆ°ç½‘æ®µ10.1.1.0çš„Type3 LSAï¼Œå¹¶é€šå‘Šç»™å‘å¸ƒæˆ–æ¥æ”¶æ­¤LSAçš„éTotally Stubæˆ–NSSAåŒºåŸŸã€‚ ASBR-summary-LSAï¼ˆType4ï¼‰ ç”±ABRäº§ç”Ÿï¼Œæè¿°åˆ°ASBRçš„è·¯ç”±ï¼Œé€šå‘Šç»™é™¤ASBRæ‰€åœ¨åŒºåŸŸçš„å…¶ä»–ç›¸å…³åŒºåŸŸã€‚ AS-external-LSAï¼ˆType5ï¼‰ ç”±ASBRäº§ç”Ÿï¼Œæè¿°åˆ°ASå¤–éƒ¨çš„è·¯ç”±ï¼Œé€šå‘Šåˆ°æ‰€æœ‰çš„åŒºåŸŸï¼ˆé™¤äº†STUBåŒºåŸŸå’ŒNSSAåŒºåŸŸï¼‰ã€‚ NSSA LSAï¼ˆType7ï¼‰ ç”±ASBRäº§ç”Ÿï¼Œæè¿°åˆ°ASå¤–éƒ¨çš„è·¯ç”±ï¼Œä»…åœ¨NSSAåŒºåŸŸå†…ä¼ æ’­ã€‚ Opaque LSAï¼ˆType9&#x2F;Type10&#x2F;Type11ï¼‰ Opaque LSAæä¾›ç”¨äºOSPFçš„æ‰©å±•çš„é€šç”¨æœºåˆ¶ã€‚å…¶ä¸­ï¼šType9 LSAä»…åœ¨æ¥å£æ‰€åœ¨ç½‘æ®µèŒƒå›´å†…ä¼ æ’­ã€‚ç”¨äºæ”¯æŒGRçš„Grace LSAå°±æ˜¯Type9 LSAçš„ä¸€ç§ã€‚Type10 LSAåœ¨åŒºåŸŸå†…ä¼ æ’­ã€‚ç”¨äºæ”¯æŒTEçš„LSAå°±æ˜¯Type10 LSAçš„ä¸€ç§ã€‚Type11 LSAåœ¨è‡ªæ²»åŸŸå†…ä¼ æ’­ï¼Œç›®å‰è¿˜æ²¡æœ‰å®é™…åº”ç”¨çš„ä¾‹å­ã€‚ åŒºåŸŸç±»å‹ Router-LSAï¼ˆType1ï¼‰ Network-LSAï¼ˆType2ï¼‰ Network-summary-LSAï¼ˆType3ï¼‰ ASBR-summary-LSAï¼ˆType4ï¼‰ AS-external-LSAï¼ˆType5ï¼‰ NSSA LSAï¼ˆType7ï¼‰ æ™®é€šåŒºåŸŸï¼ˆåŒ…æ‹¬æ ‡å‡†åŒºåŸŸå’Œéª¨å¹²åŒºåŸŸï¼‰ æ˜¯ æ˜¯ æ˜¯ æ˜¯ æ˜¯ å¦ StubåŒºåŸŸ æ˜¯ æ˜¯ æ˜¯ å¦ å¦ å¦ Totally StubåŒºåŸŸ æ˜¯ æ˜¯ å¦ å¦ å¦ å¦ NSSAåŒºåŸŸ æ˜¯ æ˜¯ æ˜¯ å¦ å¦ æ˜¯ Totally NSSAåŒºåŸŸ æ˜¯ æ˜¯ å¦ å¦ å¦ æ˜¯ è·¯ç”±å™¨ç±»å‹Router LSAï¼ˆ1ç±»ï¼‰å•åŒºåŸŸä¸­ä¼šç”¨åˆ°1ç±»ã€2ç±»LSA Router LSAâ€”1ç±»LSA æ‰€æœ‰çš„è·¯ç”±å™¨éƒ½ä¼šäº§ç”Ÿï¼Œæè¿°æœ¬è·¯ç”±å™¨çš„ä¿¡æ¯ æ³›æ´ªåŒºåŸŸï¼šæœ¬åŒºåŸŸ Router LSAä½¿ç”¨Linkæ¥æ‰¿è½½è·¯ç”±å™¨ç›´è¿æ¥å£çš„ä¿¡æ¯ã€‚æ¯æ¡Linkå‡åŒ…å«â€œé“¾è·¯ç±»å‹â€ã€â€œé“¾è·¯IDâ€ã€â€œé“¾è·¯æ•°æ®â€ä»¥åŠâ€œåº¦é‡å€¼â€è¿™å‡ ä¸ªå…³é”®ä¿¡æ¯ã€‚è·¯ç”±å™¨å¯èƒ½ä¼šé‡‡ç”¨ä¸€ä¸ªæˆ–è€…å¤šä¸ªLinkæ¥æè¿°æŸä¸ªæ¥å£ã€‚ 1.link typeï¼šp2p link-idï¼šå¯¹ç«¯çš„route-id dataï¼šè¿æ¥å¯¹ç«¯æ¥å£çš„ip 2.link typeï¼štransnet link-idï¼šDRçš„æ¥å£ipåœ°å€ dataï¼šè¿æ¥DRçš„æ¥å£ip 3.link typeï¼šstubnet link-idï¼šç½‘ç»œåœ°å€ dataï¼šæ©ç  4ï¼Œlink typeï¼švlinkï¼ˆå’Œp2pä¸€æ ·ï¼‰ link-idï¼šå¯¹ç«¯çš„route-id dataï¼šè¿æ¥å¯¹ç«¯æ¥å£çš„ipåœ°å€ å¹¿æ’­å‹ç½‘ç»œä¸­é“¾è·¯ç±»å‹ï¼šTransNet ç‚¹åˆ°ç‚¹ç½‘ç»œä¸­é“¾è·¯ç±»å‹ï¼špoint-to-point ï¼ˆæ‹“æ‰‘ä¿¡æ¯ï¼‰ã€stubnetï¼ˆç½‘ç»œä¿¡æ¯ï¼‰ Router LSAä¸­é“¾è·¯çŠ¶æ€ç±»å‹ã€é“¾è·¯çŠ¶æ€IDã€é€šå‘Šè·¯ç”±å™¨ç”¨è°è¡¨ç¤ºï¼š é“¾è·¯çŠ¶æ€ç±»å‹ï¼šrouter é“¾è·¯çŠ¶æ€IDï¼šæœ¬è·¯ç”±å™¨çš„router id é€šå‘Šè·¯ç”±å™¨ï¼šæœ¬è·¯ç”± Network LSAï¼ˆ2ç±»ï¼‰Network LSAâ€“2ç±»LSA DRè·¯ç”±å™¨ æ³›æ´ªåŒºåŸŸï¼šæœ¬åŒºåŸŸ Network LSAä¸­é“¾è·¯çŠ¶æ€ç±»å‹ã€é“¾è·¯çŠ¶æ€IDã€é€šå‘Šè·¯ç”±å™¨ç”¨è°è¡¨ç¤ºï¼š é“¾è·¯çŠ¶æ€ç±»å‹ï¼šnetwork é“¾è·¯çŠ¶æ€IDï¼šDRè·¯ç”±å™¨çš„æ¥å£IPåœ°å€ é€šå‘Šè·¯ç”±å™¨ï¼šDRè·¯ç”±å™¨çš„router id Link State ID ï¼šDRçš„æ¥å£IPåœ°å€ã€‚ Network Maskï¼šMAç½‘ç»œçš„å­ç½‘æ©ç ã€‚ Attached Routerï¼šè¿æ¥åˆ°è¯¥MAç½‘ç»œçš„è·¯ç”±å™¨çš„Router-IDï¼ˆä¸è¯¥DRå»ºç«‹äº†é‚»æ¥å…³ç³»çš„é‚»å±…çš„Router-IDï¼Œä»¥åŠDRè‡ªå·±çš„Router-IDï¼‰ï¼Œå¦‚æœæœ‰å¤šå°è·¯ç”±å™¨æ¥å…¥è¯¥MAç½‘ç»œï¼Œåˆ™ä½¿ç”¨å¤šä¸ªå­—æ®µæè¿°ã€‚ Network LSAï¼ˆ3ç±»ï¼‰3ç±»LSA ABRäº§ç”Ÿï¼Œæ³›æ´ªèŒƒå›´æœ¬åŒºåŸŸ ä½œç”¨ï¼šç”¨äºå‘ä¸€ä¸ªåŒºåŸŸé€šå‘Šåˆ°è¾¾å¦ä¸€ä¸ªåŒºåŸŸçš„è·¯ç”± ä¸‰ç±»lsaä¼ é€’çš„costè®¡ç®— åŒºåŸŸé—´é˜²ç¯ï¼š 1ï¼‰ééª¨å¹²åŒºå¿…é¡»å’Œéª¨å¹²åŒºarea0ç›¸è¿ï¼Œééª¨å¹²åŒºä¸èƒ½ç›´æ¥è¿›è¡Œé€šä¿¡ 2ï¼‰ä¸‰ç±»LSAä¼ é€’æ˜¯ å•å‘çš„ 3ï¼‰ä»ééª¨å¹²åŒºåŸŸæ”¶åˆ°çš„3ç±»LSAä¸èƒ½ç”¨äºåŒºåŸŸé—´è·¯ç”±çš„è®¡ç®—ã€‚ è™šè¿æ¥OSPFè¦æ±‚éª¨å¹²åŒºåŸŸå¿…é¡»æ˜¯è¿ç»­çš„ï¼Œä½†æ˜¯å¹¶ä¸è¦æ±‚ç‰©ç†ä¸Šè¿ç»­ï¼Œå¯ä»¥ä½¿ç”¨è™šè¿æ¥ä½¿éª¨å¹²åŒºåŸŸåœ¨é€»è¾‘ä¸Šè¿ç»­ã€‚ è™šè¿æ¥å¯ä»¥åœ¨ä»»æ„ä¸¤ä¸ªABRä¸Šå»ºç«‹ï¼Œä½†æ˜¯è¦æ±‚è¿™ä¸¤ä¸ªABRéƒ½æœ‰ç«¯å£è¿æ¥åˆ°ä¸€ä¸ªç›¸åŒçš„ééª¨å¹²åŒºåŸŸã€‚ å»ºç«‹ä¹‹å R3ä¼šæœ‰area 0 ï¼Œarea 2ï¼Œ area 1 çš„lsdb R2æœ‰area 0ï¼Œarea 1çš„lsdbï¼ˆæ³¨æ„æ²¡æœ‰area 2ï¼Œå› ä¸ºR2å»ºç«‹è™šè¿æ¥çš„æ¥å£å±äºarea 1ï¼ŒR3å»ºç«‹è™šè¿æ¥çš„æ¥å£å±äºarea 1ï¼‰ AS External LSAï¼ˆ5ç±»ï¼‰AS-external LSAï¼ˆ5ç±»LSAï¼‰ï¼šç”±ASBRäº§ç”Ÿï¼Œæè¿°åˆ°è¾¾ASå¤–éƒ¨çš„è·¯ç”±ï¼Œè¯¥LSAä¼šè¢«é€šå‘Šåˆ°æ‰€æœ‰çš„åŒºåŸŸ LS Typeï¼šå–å€¼5ï¼Œä»£è¡¨AS-external-LSAã€‚Link State IDï¼šå¤–éƒ¨è·¯ç”±çš„ç›®çš„ç½‘ç»œåœ°å€ã€‚Advertising Routerï¼šç”Ÿæˆè¯¥LSAçš„Router IDã€‚Network Maskï¼šç½‘ç»œæ©ç ã€‚ ASBR-Summary LSAï¼ˆ4ç±»ï¼‰ASBR-Summary LSAï¼ˆ4ç±»LSAï¼‰ï¼šç”±ABRäº§ç”Ÿï¼Œæè¿°åˆ°ASBRçš„è·¯ç”±ï¼Œé€šå‘Šç»™é™¤ASBRæ‰€åœ¨åŒºåŸŸçš„å…¶ä»–ç›¸å…³åŒºåŸŸã€‚ LS Typeï¼šå–å€¼4ï¼Œä»£è¡¨ASBR-Summary LSAã€‚Link State ID ï¼šASBRçš„Router IDã€‚Advertising Router:ç”ŸæˆLSAçš„Router IDã€‚ ospfå¤–éƒ¨è·¯ç”±åœ¨å¼•å…¥æ—¶ï¼Œå¼€é”€å€¼ç±»å‹æœ‰ä¸¤ç§ï¼šé»˜è®¤æƒ…å†µæ˜¯type-2 é…ç½®ï¼š[R7-ospf-1]import-route direct type 1 OSPFè·¯ç”±éµå¾ªä»¥ä¸‹ä¼˜å…ˆçº§é¡ºåºï¼ŒåŒºåŸŸå†…è·¯ç”±&gt;åŒºåŸŸé—´è·¯ç”±&gt;Metric-Type-1å¤–éƒ¨è·¯ç”±&gt;Metric-Type-2å¤–éƒ¨è·¯ç”±ã€‚ ospfè·¯ç”±æ±‡æ€»OSPFè·¯ç”±æ±‡æ€»çš„ç±»å‹ï¼šåœ¨ABRæ‰§è¡Œè·¯ç”±æ±‡æ€»ï¼šå¯¹åŒºåŸŸé—´çš„è·¯ç”±æ‰§è¡Œè·¯ç”±æ±‡æ€»ã€‚åœ¨ASBRæ‰§è¡Œè·¯ç”±æ±‡æ€»ï¼šå¯¹å¼•å…¥çš„å¤–éƒ¨è·¯ç”±æ‰§è¡Œè·¯ç”±æ±‡æ€»ã€‚ åŒºåŸŸé—´è·¯ç”±æ±‡æ€»åœ¨ABRè®¾å¤‡ä¸Šé…ç½®ï¼š [R6-ospf-1-area-0.0.0.3]abr-summary 172.16.0.0 255.255.252.0 å¤–éƒ¨è·¯ç”±æ±‡æ€»åœ¨ASBRä¸Šé…ç½®ï¼š [R8-ospf-1]asbr-summary 10.1.0.0 255.255.240.0 ospfè®¤è¯OSPFæ”¯æŒæŠ¥æ–‡è®¤è¯åŠŸèƒ½ï¼Œåªæœ‰é€šè¿‡è®¤è¯çš„OSPFæŠ¥æ–‡æ‰èƒ½è¢«æ¥æ”¶ã€‚è·¯ç”±å™¨æ”¯æŒä¸¤ç§OSPFæŠ¥æ–‡è®¤è¯æ–¹å¼ï¼Œå½“ä¸¤ç§è®¤è¯æ–¹å¼éƒ½å­˜åœ¨æ—¶ï¼Œä¼˜å…ˆä½¿ç”¨æ¥å£è®¤è¯æ–¹å¼ï¼šåŒºåŸŸè®¤è¯æ–¹å¼ï¼šä¸€ä¸ªOSPFåŒºåŸŸä¸­æ‰€æœ‰çš„è·¯ç”±å™¨åœ¨è¯¥åŒºåŸŸä¸‹çš„è®¤è¯æ¨¡å¼å’Œå£ä»¤å¿…é¡»ä¸€è‡´ã€‚ æ ¹æ®æŠ¥æ–‡çš„è®¤è¯æ–¹å¼ï¼Œå¯ä»¥åˆ†ä¸ºï¼š ç©ºè®¤è¯ ä¸è¿›è¡Œè®¤è¯ã€‚ æ˜æ–‡è®¤è¯ è¿™æ˜¯ä¸€ç§ç®€å•çš„åŠ å¯†æ–¹å¼ï¼Œå°†é…ç½®çš„å¯†ç ç›´æ¥åŠ å…¥æŠ¥æ–‡ä¸­ï¼Œè¿™ç§åŠ å¯†æ–¹å¼å®‰å…¨æ€§ä¸é«˜ã€‚ MD5è®¤è¯ é€šè¿‡å°†é…ç½®çš„å¯†ç è¿›è¡ŒMD5ç­‰åŠ å¯†ç®—æ³•ä¹‹åå†åŠ å…¥æŠ¥æ–‡ä¸­ï¼Œè¿™æ ·æé«˜äº†å¯†ç çš„å®‰å…¨æ€§ã€‚ç›®å‰æ”¯æŒMD5&#x2F;HMAC-MD5ã€‚ Keychainè®¤è¯ Keychainç”±å¤šä¸ªè®¤è¯å¯†é’¥ç»„æˆï¼Œæ¯ä¸ªå¯†é’¥åŒ…å«ä¸€ä¸ªIDå’Œå¯†ç ã€‚å¯†é’¥å­˜åœ¨ç”Ÿå‘½æœŸï¼Œé€šè¿‡å¯†é’¥çš„ç”Ÿå‘½æœŸå¯ä»¥åœ¨Keychainä¸­æ»šåŠ¨é€‰æ‹©ä¸åŒçš„è®¤è¯å¯†é’¥ã€‚Keychainå¯ä»¥æ»šåŠ¨é€‰æ‹©è®¤è¯å¯†é’¥æ¥å¢å¼ºé˜²æ”»å‡»æ€§ã€‚ Keychainä¸ºOSPFæä¾›äº†è®¤è¯ä¿æŠ¤ï¼ŒKeychainé€šè¿‡åŠ¨æ€çš„æ›´æ”¹è®¤è¯ç®—æ³•å’Œå¯†é’¥ï¼Œæé«˜äº†OSPFçš„å®‰å…¨æ€§ã€‚åº”ç”¨Keychainè®¤è¯ï¼Œé™¤äº†å¯ä»¥å¯¹OSPFåè®®æŠ¥æ–‡è¿›è¡Œè®¤è¯ä¹‹å¤–ï¼Œè¿˜å¯ä»¥å¯¹TCPå»ºç«‹è¿æ¥çš„è¿‡ç¨‹è¿›è¡Œè®¤è¯ã€‚ HMAC-SHA256è®¤è¯ é€šè¿‡å°†é…ç½®çš„å¯†ç è¿›è¡ŒHMAC-SHA256ç®—æ³•åŠ å¯†ä¹‹åå†åŠ å…¥æŠ¥æ–‡ä¸­ï¼Œæé«˜å¯†ç çš„å®‰å…¨æ€§ã€‚ [R6-ospf-1-area-0.0.0.3]authentication-mode md5 1 cipher huawei è¯¥åŒºåŸŸä¸­æ‰€æœ‰è·¯ç”±å™¨éƒ½è¦é…ç½® æ¥å£è®¤è¯æ–¹å¼ï¼šç›¸é‚»è·¯ç”±å™¨ç›´è¿æ¥å£ä¸‹çš„è®¤è¯æ¨¡å¼å’Œå£ä»¤å¿…é¡»ä¸€è‡´ã€‚[R2-GigabitEthernet0&#x2F;0&#x2F;0]ospf authentication-mode md5 1 cipher huawei åœ¨ä¸€æ¡é“¾è·¯ä¸Šçš„æ‰€æœ‰æ¥å£ä¸‹é…ç½® ç‰¹æ®ŠåŒºåŸŸ åŒºåŸŸç±»å‹ ä½œç”¨ æ™®é€šåŒºåŸŸ ç¼ºçœæƒ…å†µä¸‹ï¼ŒOSPFåŒºåŸŸè¢«å®šä¹‰ä¸ºæ™®é€šåŒºåŸŸã€‚æ™®é€šåŒºåŸŸåŒ…æ‹¬æ ‡å‡†åŒºåŸŸå’Œéª¨å¹²åŒºåŸŸã€‚æ ‡å‡†åŒºåŸŸæ˜¯æœ€é€šç”¨çš„åŒºåŸŸï¼Œå®ƒä¼ è¾“åŒºåŸŸå†…è·¯ç”±ï¼ŒåŒºåŸŸé—´è·¯ç”±å’Œå¤–éƒ¨è·¯ç”±ã€‚éª¨å¹²åŒºåŸŸæ˜¯è¿æ¥æ‰€æœ‰å…¶ä»–OSPFåŒºåŸŸçš„ä¸­å¤®åŒºåŸŸã€‚éª¨å¹²åŒºåŸŸé€šå¸¸ç”¨Area 0è¡¨ç¤ºã€‚ STUBåŒºåŸŸ ä¸å…è®¸å‘å¸ƒè‡ªæ²»ç³»ç»Ÿå¤–éƒ¨è·¯ç”±ï¼Œåªå…è®¸å‘å¸ƒåŒºåŸŸå†…è·¯ç”±å’ŒåŒºåŸŸé—´çš„è·¯ç”±ã€‚åœ¨STUBåŒºåŸŸä¸­ï¼Œè·¯ç”±å™¨çš„è·¯ç”±è¡¨è§„æ¨¡å’Œè·¯ç”±ä¿¡æ¯ä¼ é€’çš„æ•°é‡éƒ½ä¼šå¤§å¤§å‡å°‘ã€‚ä¸ºäº†ä¿è¯åˆ°è‡ªæ²»ç³»ç»Ÿå¤–çš„è·¯ç”±å¯è¾¾ï¼Œç”±è¯¥åŒºåŸŸçš„ABRå‘å¸ƒType3ç¼ºçœè·¯ç”±ä¼ æ’­åˆ°åŒºåŸŸå†…ï¼Œæ‰€æœ‰åˆ°è‡ªæ²»ç³»ç»Ÿå¤–éƒ¨çš„è·¯ç”±éƒ½å¿…é¡»é€šè¿‡ABRæ‰èƒ½å‘å¸ƒã€‚ Totally STUBåŒºåŸŸ ä¸å…è®¸å‘å¸ƒè‡ªæ²»ç³»ç»Ÿå¤–éƒ¨è·¯ç”±å’ŒåŒºåŸŸé—´çš„è·¯ç”±ï¼Œåªå…è®¸å‘å¸ƒåŒºåŸŸå†…è·¯ç”±ã€‚åœ¨Totally STUBåŒºåŸŸä¸­ï¼Œè·¯ç”±å™¨çš„è·¯ç”±è¡¨è§„æ¨¡å’Œè·¯ç”±ä¿¡æ¯ä¼ é€’çš„æ•°é‡éƒ½ä¼šå¤§å¤§å‡å°‘ã€‚ä¸ºäº†ä¿è¯åˆ°è‡ªæ²»ç³»ç»Ÿå¤–å’Œå…¶ä»–åŒºåŸŸçš„è·¯ç”±å¯è¾¾ï¼Œç”±è¯¥åŒºåŸŸçš„ABRå‘å¸ƒType3ç¼ºçœè·¯ç”±ä¼ æ’­åˆ°åŒºåŸŸå†…ï¼Œæ‰€æœ‰åˆ°è‡ªæ²»ç³»ç»Ÿå¤–éƒ¨å’Œå…¶ä»–åŒºåŸŸçš„è·¯ç”±éƒ½å¿…é¡»é€šè¿‡ABRæ‰èƒ½å‘å¸ƒã€‚ NSSAåŒºåŸŸ NSSAåŒºåŸŸå…è®¸å¼•å…¥è‡ªæ²»ç³»ç»Ÿå¤–éƒ¨è·¯ç”±ï¼Œç”±ASBRå‘å¸ƒType7 LSAé€šå‘Šç»™æœ¬åŒºåŸŸï¼Œè¿™äº›Type7 LSAåœ¨ABRä¸Šè½¬æ¢æˆType5 LSAï¼Œå¹¶ä¸”æ³›æ´ªåˆ°æ•´ä¸ªOSPFåŸŸä¸­ã€‚NSSAåŒºåŸŸåŒæ—¶ä¿ç•™è‡ªæ²»ç³»ç»Ÿå†…çš„STUBåŒºåŸŸçš„ç‰¹å¾ã€‚è¯¥åŒºåŸŸçš„ABRå‘å¸ƒType7ç¼ºçœè·¯ç”±ä¼ æ’­åˆ°åŒºåŸŸå†…ï¼Œæ‰€æœ‰åŸŸé—´è·¯ç”±éƒ½å¿…é¡»é€šè¿‡ABRæ‰èƒ½å‘å¸ƒã€‚ Totally NSSAåŒºåŸŸ Totally NSSAåŒºåŸŸå…è®¸å¼•å…¥è‡ªæ²»ç³»ç»Ÿå¤–éƒ¨è·¯ç”±ï¼Œç”±ASBRå‘å¸ƒType7 LSAé€šå‘Šç»™æœ¬åŒºåŸŸï¼Œè¿™äº›Type7 LSAåœ¨ABRä¸Šè½¬æ¢æˆType5 LSAï¼Œå¹¶ä¸”æ³›æ´ªåˆ°æ•´ä¸ªOSPFåŸŸä¸­ã€‚Totally NSSAåŒºåŸŸåŒæ—¶ä¿ç•™è‡ªæ²»ç³»ç»Ÿå†…çš„Totally STUB AreaåŒºåŸŸçš„ç‰¹å¾ã€‚è¯¥åŒºåŸŸçš„ABRå‘å¸ƒType3å’ŒType7ç¼ºçœè·¯ç”±ä¼ æ’­åˆ°åŒºåŸŸå†…ï¼Œæ‰€æœ‰åŸŸé—´è·¯ç”±éƒ½å¿…é¡»é€šè¿‡ABRæ‰èƒ½å‘å¸ƒã€‚ stubåŒºåŸŸ1ã€2ã€3ã€3ç±»ç¼ºçœLSAï¼ˆABRäº§ç”Ÿçš„ï¼‰ StubåŒºåŸŸçš„ABRä¸å‘StubåŒºåŸŸå†…ä¼ æ’­å®ƒæ¥æ”¶åˆ°çš„ASå¤–éƒ¨è·¯ç”±ï¼ˆä¹Ÿå°±æ˜¯4ç±»ã€5ç±»LSAï¼‰ï¼ŒStubåŒºåŸŸä¸­è·¯ç”±å™¨çš„LSDBã€è·¯ç”±è¡¨è§„æ¨¡éƒ½ä¼šå¤§å¤§å‡å°ã€‚ä¸ºä¿è¯StubåŒºåŸŸèƒ½å¤Ÿåˆ°è¾¾ASå¤–éƒ¨ï¼ŒStubåŒºåŸŸçš„ABRå°†ç”Ÿæˆä¸€æ¡ç¼ºçœè·¯ç”±ï¼ˆä½¿ç”¨3ç±»LSAæè¿°ï¼‰ã€‚ é…ç½®StubåŒºåŸŸæ—¶éœ€è¦æ³¨æ„ä¸‹åˆ—å‡ ç‚¹ï¼šéª¨å¹²åŒºåŸŸä¸èƒ½è¢«é…ç½®ä¸ºStubåŒºåŸŸã€‚StubåŒºåŸŸä¸­çš„æ‰€æœ‰è·¯ç”±å™¨éƒ½å¿…é¡»å°†è¯¥åŒºåŸŸé…ç½®ä¸ºStubã€‚StubåŒºåŸŸå†…ä¸èƒ½å¼•å…¥ä¹Ÿä¸æ¥æ”¶ASå¤–éƒ¨è·¯ç”±ã€‚è™šè¿æ¥ä¸èƒ½ç©¿è¶ŠStubåŒºåŸŸã€‚ Totally StubåŒºåŸŸ1ã€2ã€3ç±»ç¼ºçœLSAï¼ˆABRäº§ç”Ÿçš„ï¼‰ Totally StubåŒºåŸŸæ—¢ä¸å…è®¸ASå¤–éƒ¨è·¯ç”±åœ¨æœ¬åŒºåŸŸå†…ä¼ æ’­ï¼Œä¹Ÿä¸å…è®¸åŒºåŸŸé—´è·¯ç”±åœ¨æœ¬åŒºåŸŸå†…ä¼ æ’­ã€‚Totally StubåŒºåŸŸå†…çš„è·¯ç”±å™¨é€šè¿‡æœ¬åŒºåŸŸABRä¸‹å‘çš„ç¼ºçœè·¯ç”±ï¼ˆä½¿ç”¨3ç±»LSAæè¿°ï¼‰åˆ°è¾¾å…¶ä»–åŒºåŸŸï¼Œä»¥åŠASå¤–éƒ¨é…ç½®Totally StubåŒºåŸŸæ—¶éœ€è¦æ³¨æ„ï¼šä¸StubåŒºåŸŸé…ç½®çš„åŒºåˆ«åœ¨äºï¼Œåœ¨ABRä¸Šéœ€è¦è¿½åŠ no-summaryå…³é”®å­—ã€‚ NSSAäº§ç”ŸèƒŒæ™¯ï¼š 1ã€2ã€3ã€7ç±»ã€7ç±»ç¼ºçœLSAï¼ˆABRäº§ç”Ÿçš„ï¼‰ NSSAåŒºåŸŸèƒ½å¤Ÿå¼•å…¥å¤–éƒ¨è·¯ç”±ï¼ŒåŒæ—¶åˆä¸ä¼šå­¦ä¹ æ¥è‡ªOSPFç½‘ç»œå…¶å®ƒåŒºåŸŸå¼•å…¥çš„å¤–éƒ¨è·¯ç”±ã€‚Totally NSSAä¸NSSAåŒºåŸŸçš„é…ç½®åŒºåˆ«åœ¨äºå‰è€…åœ¨ABRä¸Šéœ€è¦è¿½åŠ no-summaryå…³é”®å­—ã€‚ NSSAåŒºåŸŸ ç›¸å¯¹äºstubåŒºåˆ«åœ¨äºï¼Œå¯ä»¥å¼•å…¥å¤–éƒ¨è·¯ç”±ï¼Œå¤–éƒ¨è·¯ç”±å¼•å…¥åï¼Œä¼šä»¥7ç±»LSAåœ¨NSSAåŒºåŸŸä¸­æ³›æ´ªï¼Œç„¶å åœ¨ABRè®¾å¤‡ä¸Šå°†7ç±»LSAè½¬åŒ–æˆ5ç±»LSAåœ¨å…¶ä»–åŒºåŸŸ æ³›æ´ªã€‚ä¸ºäº†è®©NSSAåŒºåŸŸå†…çš„è·¯ç”±å™¨èƒ½å¤Ÿé€šè¿‡éª¨å¹²åŒºåŸŸåˆ°è¾¾ASå¤–éƒ¨ï¼ŒNSSAåŒºåŸŸçš„ABRä¼šè‡ªåŠ¨å‘è¯¥åŒºåŸŸæ³¨å…¥ä¸€æ¡ç¼ºçœè·¯ç”±ï¼Œè¯¥è·¯ç”±é‡‡ç”¨7ç±»LSAæè¿°ã€‚ è¯´æ˜ï¼šä¸Šå›¾ä¸­ï¼ŒR3ä¸Šæ‰§è¡Œ7è½¬5çš„æ“ä½œï¼ŒæŠŠ5ç±»çš„lsaæ³›æ´ªåˆ°å…¶ä»–åŒºåŸŸï¼Œåˆ«çš„åŒºåŸŸä¼šè®¤ä¸ºR3æ˜¯ASBRï¼ˆå®é™…æ˜¯R5ï¼‰ï¼ŒR2ä½œä¸ºABRä¼šå‘å¸ƒ4ç±»lsaï¼Œæ¥æè¿°R3çš„ä½ç½® Totally NSSAï¼š1ã€2ã€3ç¼ºçœï¼ˆABRäº§ç”Ÿï¼‰ã€7ç±»ã€7ç±»ç¼ºçœLSAï¼ˆABRäº§ç”Ÿçš„ï¼‰ Silent-InterfaceSilent-Interfaceæœ‰ä»¥ä¸‹ç‰¹æ€§ï¼šSilent-Interfaceä¸ä¼šæ¥æ”¶å’Œå‘é€OSPFæŠ¥æ–‡ã€‚Silent-Interfaceçš„ç›´è¿è·¯ç”±ä»å¯ä»¥å‘å¸ƒå‡ºå»ã€‚ é€šå¸¸æˆ‘ä»¬ä¼š å°†è¿æ¥ç»ˆç«¯æˆ–è€…æœåŠ¡å™¨çš„æ¥å£è®¾ç½®æˆSilent-Interface [R1]ospf[R1-ospf-1]area 0[R1-ospf-1-area-0.0.0.0]network 192.168.4.0 0.0.0.255[R1-ospf-1]silent-interface GigabitEthernet 0&#x2F;0&#x2F;1 ä¾‹ R1çš„GE0&#x2F;0&#x2F;1æ¥å£åœ¨OSPF networkå‘½ä»¤çš„ç½‘æ®µèŒƒå›´å†…ã€‚ åˆ°è¾¾è¯¥æ¥å£çš„è·¯ç”±å°†è¢«é€šå‘Šåˆ°OSPFï¼Œä½¿å¾—å…¶ä»–è®¾å¤‡èƒ½å¤Ÿè®¿é—®Serverã€‚ ç”±äºè¯¥æ¥å£ä¸Šæœªè¿æ¥ä»»ä½•å…¶ä»–OSPFè·¯ç”±å™¨ï¼Œå› æ­¤ç®¡ç†å‘˜å°†è¯¥æ¥å£é…ç½®ä¸ºSilent-Interfaceï¼Œè¯¥æ¥å£å°†ä¸å†æ”¶å‘HelloæŠ¥æ–‡ï¼Œä»è€Œé¿å…äº†å¯¹Serverçš„æ€§èƒ½é™ä½ã€‚ è·¯ç”±å™¨å¯¹lsaå¤„ç†æµç¨‹","categories":[{"name":"åŸºç¡€çŸ¥è¯†","slug":"åŸºç¡€çŸ¥è¯†","permalink":"http://example.com/categories/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"}],"tags":[{"name":"ospf","slug":"ospf","permalink":"http://example.com/tags/ospf/"}]},{"title":"äº¤æ¢æœºå·¥ä½œåŸç†","slug":"äº¤æ¢æœºå·¥ä½œåŸç†","date":"2024-03-29T17:08:49.000Z","updated":"2024-03-29T17:15:35.603Z","comments":true,"path":"2024/03/30/äº¤æ¢æœºå·¥ä½œåŸç†/","permalink":"http://example.com/2024/03/30/%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/","excerpt":"","text":"","categories":[{"name":"åŸºç¡€çŸ¥è¯†","slug":"åŸºç¡€çŸ¥è¯†","permalink":"http://example.com/categories/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"}],"tags":[{"name":"äº¤æ¢æœºå·¥ä½œåŸç†","slug":"äº¤æ¢æœºå·¥ä½œåŸç†","permalink":"http://example.com/tags/%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/"}]},{"title":"å­ç½‘åˆ’åˆ†","slug":"å­ç½‘åˆ’åˆ†","date":"2024-03-23T16:39:44.000Z","updated":"2024-03-23T17:25:29.504Z","comments":true,"path":"2024/03/24/å­ç½‘åˆ’åˆ†/","permalink":"http://example.com/2024/03/24/%E5%AD%90%E7%BD%91%E5%88%92%E5%88%86/","excerpt":"","text":"å­ç½‘åˆ’åˆ†é¦–å…ˆä¸ºä»€ä¹ˆè¦å­ç½‘åˆ’åˆ†ï¼Ÿ æœ‰ç±»IPåœ°å€è§„åˆ’çš„ç¼ºé™·ï¼šä½¿ç”¨é»˜è®¤æ©ç çš„é—®é¢˜ï¼šåœ°å€èŒƒå›´è¿‡å¤§æˆ–è¿‡å°ï¼Œå¯¼è‡´IPåœ°å€çš„æµªè´¹ï¼ åœ¨ä¸€ä¸ªç½‘ç»œåœ°å€ä¸­ï¼Œä¸»æœºæ•°ï¼š2çš„næ¬¡æ–¹ï¼Œå¯ç”¨çš„ä¸»æœºæ•°ï¼š2*n-2ï¼ˆè¿™é‡Œnæ˜¯ä¸»æœºæ•°ï¼‰ å¦‚æœè¿™ä¸ªç½‘æ®µåªç”¨äºä¸€ä¸ªå°å‹å±€åŸŸç½‘ï¼Œä¾‹å¦‚ä¸€ä¸ªå®éªŒå®¤ï¼Œåªæœ‰å‡ åå°ä¸»æœºï¼Œé‚£ä¹ˆå¤§å¤§æµªè´¹äº†ipåœ°å€ æ‰€ä»¥ï¼Œå­ç½‘åˆ’åˆ†ç»™è¿™ä¸ªç½‘ç»œåœ°å€åˆ†æˆè‹¥å¹²ä¸ªï¼Œå‡å°‘æµªè´¹ ç›¸å½“äºæŠŠä¸»æœºæ•°å‡åŒ€çš„åˆ†é…ç»™è‹¥å¹²ä¸ªï¼ˆç½‘ç»œå·å€Ÿä½ï¼Œä¸»æœºå·å‡å°‘ï¼‰ ä¾‹å¦‚ç½‘ç»œåœ°å€ï¼š192.168.1.0&#x2F;24ï¼Œç½‘ç»œå·24ä½ï¼Œä¸»æœºå·8ä½ï¼Œå¦‚æœåˆ’æˆä¸¤ä¸ªå­ç½‘ï¼Œç½‘ç»œå·å€Ÿ1ä½ å€Ÿçš„1ä½æ˜¯1æˆ–è€…æ˜¯0 192.168.1.00000000ï¼ˆå‰25ä½å˜æˆç½‘ç»œå·ï¼‰å­ç½‘1ï¼š192.168.1.0&#x2F;25 192.168.1.10000000 å­ç½‘2ï¼š192.168.128.0&#x2F;25 ä¾‹ï¼š192.168.1.0 åˆ†é…ä¸‰ä¸ªéƒ¨é—¨ï¼Œæ¯ä¸ªéƒ¨é—¨30å°ä¸»æœº è¦å€Ÿ2ä½ 00 01 10 11 è¿™å››ç§æ’åˆ—ç»„åˆï¼Œåˆ†ä¸ºå››ä¸ªå­ç½‘ 192.168.1.00 000000 â€“192.168.1.0&#x2F;26 192.168.1.01 000000 â€“192.168.1.64&#x2F;26 192.168.1.10 000000 â€“192.168.1.128&#x2F;26 192.168.1.11 000000 â€“192.168.1.192&#x2F;26 å­ç½‘åˆ’åˆ†çš„åŸç† IPåœ°å€ç”±ç½‘ç»œä½+ä¸»æœºä½ç»„æˆï¼Œå­ç½‘åˆ’åˆ†å°±æ˜¯å€Ÿç”¨ç°æœ‰ç½‘æ®µçš„ä¸»æœºä½çš„æœ€å·¦è¾¹æŸå‡ ä½ä½œä¸ºå­ç½‘ä½ï¼Œåˆ’åˆ†å‡ºå¤šä¸ªå­ç½‘ã€‚ â‘ æŠŠåŸæ¥æœ‰ç±»ç½‘ç»œIPv4åœ°å€ä¸­çš„â€œç½‘ç»œå·â€éƒ¨åˆ†å‘â€œä¸»æœºå·â€éƒ¨åˆ†å€Ÿä½ â‘¡æŠŠä¸€éƒ¨åˆ†åŸæ¥å±äºâ€œä¸»æœºå·â€éƒ¨åˆ†çš„ä½å˜æˆâ€œç½‘ç»œå·â€çš„ä¸€éƒ¨åˆ†ï¼ˆé€šå¸¸ç§°ä¹‹ä¸ºâ€œå­ç½‘å·â€ï¼‰ã€‚ å› æ­¤IPåœ°å€è¿›è¡Œè½¬å˜ï¼šç½‘ç»œå·+ä¸»æœºå· å˜æˆ ç½‘ç»œå·+å­ç½‘å·ï¼ˆmï¼‰+ä¸»æœºå·ï¼ˆnï¼‰ åˆ’åˆ†åå­ç½‘æ•°é‡ï¼š2*m åˆ’åˆ†åæ¯ä¸ªå­ç½‘å¯ç”¨ä¸»æœºæ•°ï¼š2*n-2ï¼ˆä¸»æœºå·å…¨ä¸º0å’Œå…¨ä¸º1ï¼ˆæŒ‡äºŒè¿›åˆ¶ï¼‰çš„ipåœ°å€åˆ†åˆ«ä¸ºç½‘ç»œåœ°å€ä¸å¹¿æ’­åœ°å€ï¼Œæ˜¯ä¸èƒ½åˆ†é…ç»™æŸä¸ªç‰¹å®šçš„ä¸»æœºä½¿ç”¨çš„ï¼‰ å­ç½‘åˆ’åˆ†çš„æ­¥éª¤ â‘  ç¡®å®šæ‰€éœ€å­ç½‘æ•°2*mï¼Œ â‘¡ ç¡®å®šæ¯ä¸ªå­ç½‘å¯ç”¨ä¸»æœºæ•°2*n-2 â‘¢ ç¡®å®šéœ€åƒä¸»æœºå·éƒ¨åˆ†å€Ÿå¤šå°‘ä½ï¼ˆmï¼‰ï¼Œæ‰èƒ½æ»¡è¶³éœ€è¦æ±‚ â‘£ æ ¹æ®ä¸»æœºæ•°å¯å¾—çŸ¥å­ç½‘åœ°å€ç©ºé—´å¤§å°2*n â‘¤ è¿›è¡Œåœ°å€åˆ’åˆ† å­ç½‘åˆ’åˆ†ç¤ºä¾‹ æŸå…¬å¸æœ‰å››ä¸ªéƒ¨é—¨ï¼Œæ¯ä¸ªéƒ¨é—¨æ‹¥æœ‰50å°ä¸»æœºï¼Œåˆ†é…ä¸€ä¸ªCç±»åœ°å€200.161.30.0&#x2F;24,è¯·é—®å¦‚ä½•è¿›è¡Œç½‘ç»œåœ°å€è§„åˆ’ï¼Ÿ a.ç¡®å®šå­ç½‘æ•°ï¼šå››ä¸ªéƒ¨é—¨ï¼Œ2*m&gt;&#x3D;4 b.ç¡®å®šä¸»æœºæ•°ï¼š30å°ä¸»æœºï¼Œ2*n-2&gt;&#x3D;30 c.Cç±»åœ°å€ç½‘ç»œå·ä½24ä½ï¼Œä¸»æœºä½8ä½ï¼Œå‘ç¬¬å››æ®µä¸»æœºä½å€Ÿä½ï¼Œç”±ä¸Šå¯çŸ¥å­ç½‘ä½m&#x3D;2ï¼Œä¸»æœºä½n&#x3D;6 d.å­ç½‘ç©ºé—´ä¸º64ï¼Œå­ç½‘æ•°ä¸º4ï¼Œæ ¹æ®åŸä¸»æœºä½å…«ä½åˆ™åŸç½‘ç»œç©ºé—´ä¸º0-255ï¼Œå…±256ä¸ªï¼Œæ­¤æ—¶æˆ‘ä»¬ç®—å‡ºå­ç½‘ç©ºé—´ä¸º64ï¼Œå¯å¾—å‡ºå››ä¸ªå­ç½‘èŒƒå›´0-63ã€64-127ã€127-192ã€192-255 e. ç¬¬ä¸€ä¸ªå­ç½‘200.161.30.0&#x2F;26-200.161.30.63&#x2F;26 ç¬¬äºŒä¸ªå­ç½‘200.161.30.64&#x2F;26-200.161.30.127&#x2F;26 ç¬¬ä¸‰ä¸ªå­ç½‘200.161.30.128&#x2F;26-200.161.30.191&#x2F;26 ç¬¬å››ä¸ªå­ç½‘200.161.39.192&#x2F;26-200.161.30.255&#x2F;26 f.ä¸»æœºä½å…¨ä¸º0å’Œ1çš„åœ°å€åˆ†åˆ«ä¸ºç½‘ç»œåœ°å€ä¸å¹¿æ’­åœ°å€ï¼Œä¸èƒ½åˆ†é…ç»™ä¸»æœºä½¿ç”¨ï¼Œåˆ™ éƒ¨é—¨1åœ°å€èŒƒå›´ï¼š200.161.30.1-62&#x2F;26 éƒ¨é—¨2åœ°å€èŒƒå›´ï¼š200.161.30.65-12&#x2F;26 éƒ¨é—¨3åœ°å€èŒƒå›´ï¼š200.161.30.129-190&#x2F;26 éƒ¨é—¨4åœ°å€èŒƒå›´ï¼š200.161.30.193-254&#x2F;26","categories":[{"name":"åŸºç¡€çŸ¥è¯†","slug":"åŸºç¡€çŸ¥è¯†","permalink":"http://example.com/categories/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"}],"tags":[{"name":"å­ç½‘åˆ’åˆ†","slug":"å­ç½‘åˆ’åˆ†","permalink":"http://example.com/tags/%E5%AD%90%E7%BD%91%E5%88%92%E5%88%86/"}]},{"title":"WLANåŸºç¡€é…ç½®ï¼ˆapä¸Šçº¿ï¼‰","slug":"WLANåŸºç¡€é…ç½®ï¼ˆapä¸Šçº¿ï¼‰","date":"2023-12-20T10:17:25.000Z","updated":"2023-12-20T10:27:08.822Z","comments":true,"path":"2023/12/20/WLANåŸºç¡€é…ç½®ï¼ˆapä¸Šçº¿ï¼‰/","permalink":"http://example.com/2023/12/20/WLAN%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE%EF%BC%88ap%E4%B8%8A%E7%BA%BF%EF%BC%89/","excerpt":"","text":"æ¦‚å¿µCAPWAPåè®®CAPWAPæ˜¯åŸºäºUDPè¿›è¡Œä¼ è¾“çš„åº”ç”¨å±‚åè®®ï¼ŒCAPWAPåè®®åœ¨ä¼ è¾“å±‚è¿è¾“ä¸¤ç§ç±»å‹çš„æ¶ˆæ¯ï¼š ä¸šåŠ¡æ•°æ®æµé‡ï¼Œå°è£…è½¬å‘æ— çº¿æ•°æ®å¸§ ã€‚â€”â€”é€šè¿‡CAPWAPæ•°æ®éš§é“ã€‚ ç®¡ç†æµé‡ï¼Œç®¡ç†APå’ŒACä¹‹é—´äº¤æ¢çš„ç®¡ç†æ¶ˆæ¯ ã€‚â€”â€”é€šè¿‡CAPWAPæ§åˆ¶éš§é“ã€‚ CAPWAPæ•°æ®å’Œæ§åˆ¶æŠ¥æ–‡åŸºäºä¸åŒçš„UDPç«¯å£å‘é€ï¼š ç®¡ç†æµé‡ç«¯å£ä¸ºUDPç«¯å£5246ã€‚ ä¸šåŠ¡æ•°æ®æµé‡ç«¯å£ä¸ºUDPç«¯å£5247ã€‚ ACè¿æ¥æ–¹å¼ç›´è¿æ¨¡å¼ä¸‹ACéƒ¨ç½²åœ¨ç”¨æˆ·çš„è½¬å‘è·¯å¾„ä¸Šï¼Œé‡‡ç”¨è¿™ç§ç»„ç½‘æ–¹å¼ï¼Œå¯¹ACçš„ååé‡ä»¥åŠå¤„ç†æ•°æ®èƒ½åŠ›è¦æ±‚æ¯”è¾ƒé«˜ï¼Œå¦åˆ™ACä¼šæ˜¯æ•´ä¸ªæ— çº¿ç½‘ç»œå¸¦å®½çš„ç“¶é¢ˆã€‚ä½†ç”¨æ­¤ç§ç»„ç½‘ï¼Œç»„ç½‘æ¶æ„æ¸…æ™°ï¼Œç»„ç½‘å®æ–½èµ·æ¥ç®€å• åœ¨æ—æŒ‚å¼ç»„ç½‘ä¸­ï¼ŒACåªæ‰¿è½½å¯¹APçš„ç®¡ç†åŠŸèƒ½ï¼Œç®¡ç†æµå°è£…åœ¨CAPWAPéš§é“ä¸­ä¼ è¾“ã€‚æ•°æ®ä¸šåŠ¡æµå¯ä»¥é€šè¿‡CAPWAPæ•°æ®éš§é“ç»ACè½¬å‘ï¼Œä¹Ÿå¯ä»¥ä¸ç»è¿‡ACè½¬å‘ç›´æ¥è½¬å‘ï¼Œåè€…æ— çº¿ç”¨æˆ·ä¸šåŠ¡æµç»æ±‡èšäº¤æ¢æœºç”±æ±‡èšäº¤æ¢æœºä¼ è¾“è‡³ä¸Šå±‚ç½‘ç»œã€‚ WLANçš„åŸºæœ¬æ¦‚å¿µ BSSï¼šä¸€ä¸ªAPæ‰€è¦†ç›–çš„èŒƒå›´ï¼Œåœ¨ä¸€ä¸ªBSSçš„æœåŠ¡åŒºåŸŸå†…ï¼ŒSTAå¯ä»¥ç›¸äº’é€šä¿¡ã€‚ BSSIDï¼šæ˜¯æ— çº¿ç½‘ç»œçš„ä¸€ä¸ªèº«ä»½æ ‡è¯†ï¼Œç”¨APçš„MACåœ°å€è¡¨ç¤ºã€‚ SSIDï¼šè¡¨ç¤ºæ— çº¿ç½‘ç»œçš„æ ‡è¯†ï¼Œç”¨æ¥åŒºåˆ†ä¸åŒçš„æ— çº¿ç½‘ç»œã€‚ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬åœ¨ç¬”è®°æœ¬ç”µè„‘ä¸Šæœç´¢å¯æ¥å…¥æ— çº¿ç½‘ç»œæ—¶ï¼Œæ˜¾ç¤ºå‡ºæ¥çš„ç½‘ç»œåç§°å°±æ˜¯SSIDã€‚ VAPæ—©æœŸçš„APåªæ”¯æŒ1ä¸ªBSSï¼Œå¦‚æœè¦åœ¨åŒä¸€ç©ºé—´å†…éƒ¨ç½²å¤šä¸ªBSSï¼Œåˆ™éœ€è¦å®‰æ”¾å¤šä¸ªAPï¼Œè¿™ä¸ä½†å¢åŠ äº†æˆæœ¬ï¼Œè¿˜å ç”¨äº†ä¿¡é“èµ„æºã€‚ä¸ºäº†æ”¹å–„è¿™ç§çŠ¶å†µï¼Œç°åœ¨çš„APé€šå¸¸æ”¯æŒåˆ›å»ºå‡ºå¤šä¸ªè™šæ‹ŸAP (Virtual Access Point, VAP)ã€‚å¦‚å›¾16-13æ‰€ç¤ºï¼Œå®ƒç›¸å½“äºäº¤æ¢æœºä¸­çš„VLAN ESS ä¸ºäº†æ»¡è¶³å®é™…ä¸šåŠ¡çš„éœ€æ±‚ï¼Œéœ€è¦å¯¹BSSçš„è¦†ç›–èŒƒå›´è¿›è¡Œæ‰©å±•ã€‚åŒæ—¶ç”¨æˆ·ä»ä¸€ä¸ªBSSç§»åŠ¨åˆ°å¦ä¸€ä¸ªBSSæ—¶ï¼Œä¸èƒ½æ„ŸçŸ¥åˆ°SSIDçš„å˜åŒ–ï¼Œåˆ™å¯ä»¥é€šè¿‡æ‰©å±•æœåŠ¡é›†ESS (Extend Service Set)å®ç°ã€‚å¦‚å›¾6-14æ‰€ç¤ºï¼Œè¿™æ˜¯ç”±å¤šä¸ªä½¿ç”¨ç›¸åŒSSIDçš„BSSç»„æˆï¼Œæ˜¯é‡‡ç”¨ç›¸åŒçš„SSIDçš„å¤šä¸ªBSSç»„æˆçš„æ›´å¤§è§„æ¨¡çš„è™šæ‹ŸBSSã€‚ å®éªŒ å®éªŒæ­¥éª¤ æ­¥éª¤1ï¼šåŸºæœ¬é…ç½®LSW2çš„é…ç½®system-view[Huawei]undo info-center enable[Huawei]sysname LSW2[LSW2]vlan 100[LSW2-vlan100]quit[LSW2]interface e0&#x2F;0&#x2F;1[LSW2-Ethernet0&#x2F;0&#x2F;1]port link-type trunk[LSW2-Ethernet0&#x2F;0&#x2F;1]port trunk allow-pass vlan 100[LSW2-Ethernet0&#x2F;0&#x2F;1]port trunk pvid vlan 100[LSW2-Ethernet0&#x2F;0&#x2F;1]quit[LSW2]interface e0&#x2F;0&#x2F;2[LSW2-Ethernet0&#x2F;0&#x2F;2]port link-type trunk[LSW2-Ethernet0&#x2F;0&#x2F;2]port trunk allow-pass vlan 100[LSW2-Ethernet0&#x2F;0&#x2F;2]port trunk pvid vlan 100[LSW2-Ethernet0&#x2F;0&#x2F;2]quit[LSW2]interface e0&#x2F;0&#x2F;3[LSW2-Ethernet0&#x2F;0&#x2F;3]port link-type trunk[LSW2-Ethernet0&#x2F;0&#x2F;3]port trunk allow-pass vlan 100[LSW2-Ethernet0&#x2F;0&#x2F;3]quitã€æ€è€ƒ1ã€‘ï¼šä¸ºä»€ä¹ˆLSW2åªåˆ›å»ºVLAN100ï¼Œä¸ç”¨åˆ›å»ºVLAN101ï¼Ÿè§£æï¼šå› ä¸ºæˆ‘ä»¬ç”¨çš„æ˜¯éš§é“è½¬å‘ï¼Œæ•°æ®åˆ°è¾¾AC1åï¼Œæ‰ä¼šæ‰“ä¸Š101æ ‡è®°ç„¶åå‘ç»™LSW1ã€æ€è€ƒ2ã€‘ï¼šä¸ºä»€ä¹ˆè¿æ¥APçš„æ¥å£è¦æ‰“port trunk pvid vlan 100?è§£æï¼šäº¤æ¢æœºæ”¶åˆ°APçš„æ•°æ®å¸§æ‰“ä¸Š100çš„tagå‘é€æŠŠå¸¦ä¸Š100tagçš„æ•°æ®å¸§å»æ‰ç„¶åå‘ç»™APLSW1çš„é…ç½®system-view[Huawei]undo info-center enable[Huawei]sysname LSW1[LSW1]vlan batch 100 101[LSW1]interface g0&#x2F;0&#x2F;1[LSW1-GigabitEthernet0&#x2F;0&#x2F;1]port link-type trunk[LSW1-GigabitEthernet0&#x2F;0&#x2F;1]port trunk allow-pass vlan 100[LSW1-GigabitEthernet0&#x2F;0&#x2F;1]quit[LSW1]interface g0&#x2F;0&#x2F;3[LSW1-GigabitEthernet0&#x2F;0&#x2F;3]port link-type trunk[LSW1-GigabitEthernet0&#x2F;0&#x2F;3]port trunk allow-pass vlan 100 101[LSW1-GigabitEthernet0&#x2F;0&#x2F;3]quit[LSW1]interface g0&#x2F;0&#x2F;2[LSW1-GigabitEthernet0&#x2F;0&#x2F;2]port link-type access[LSW1-GigabitEthernet0&#x2F;0&#x2F;2]port default vlan 101[LSW1-GigabitEthernet0&#x2F;0&#x2F;2]quit[LSW1]interface Vlanif 101[LSW1-Vlanif101]ip address 192.168.101.1 24[LSW1-Vlanif101]undo shutdown[LSW1-Vlanif101]quitAC1çš„é…ç½®system-view[AC6005]undo info-center enable[AC6005]sysname AC1[AC1]vlan batch 100 101[AC1]interface g0&#x2F;0&#x2F;1[AC1-GigabitEthernet0&#x2F;0&#x2F;1]port link-type trunk[AC1-GigabitEthernet0&#x2F;0&#x2F;1]port trunk allow-pass vlan 100 101[AC1-GigabitEthernet0&#x2F;0&#x2F;1]quit[AC1]interface Vlanif 100[AC1-Vlanif100]ip address 192.168.100.1 24[AC1-Vlanif100]undo shutdown[AC1-Vlanif100]quitR1çš„é…ç½®system-view[Huawei]undo info-center enable[Huawei]sysname R1[R1]interface g0&#x2F;0&#x2F;0[R1-GigabitEthernet0&#x2F;0&#x2F;0]ip address 192.168.101.2 24[R1-GigabitEthernet0&#x2F;0&#x2F;0]undo shutdown[R1-GigabitEthernet0&#x2F;0&#x2F;0]quit æ­¥éª¤2ï¼šè®¾ç½®DHCPåˆ›å»ºVLANè®¾ç½®TRUNKä¸šåŠ¡DHCP-è®©STAè·å¾—IPåœ°å€[LSW1]dhcp enable[LSW1]interface Vlanif 101[LSW1-Vlanif101]dhcp select interface[LSW1-Vlanif101]quitç®¡ç†DHCP-è®©APè·å¾—IPåœ°å€system-view[AC1]dhcp enable[AC1]interface Vlanif 100[AC1-Vlanif100]dhcp select interface[AC1-Vlanif100]quit æ­¥éª¤3ï¼šACçš„é…ç½® APä¸Šçº¿ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºAPç»„system-view[AC1]wlan[AC1-wlan-view]ap-group name x &#x2F;&#x2F;åˆ›å»ºAPç»„åå­—å«x[AC1-wlan-ap-group-x]quitç¬¬äºŒæ­¥ï¼šåˆ›å»ºåŸŸç®¡ç†æ¨¡æ¿å¹¶å…³è”åˆ°APç»„[AC1]wlan[AC1-wlan-view]regulatory-domain-profile name x1 &#x2F;&#x2F;åˆ›å»ºåŸŸç®¡ç†æ¨¡æ¿ï¼Œåå­—å«x1[AC1-wlan-regulate-domain-x1]country-code cn &#x2F;&#x2F;å›½å®¶ä»£ç é€‰æ‹©ä¸­å›½[AC1-wlan-regulate-domain-x1]quit[AC1-wlan-view]ap-group name x[AC1-wlan-ap-group-x]regulatory-domain-profile x1 &#x2F;&#x2F;APç»„çš„åŸŸç®¡ç†æ¨¡æ¿æ˜¯x1Warning: Modifying the country code will clear channel, power and antenna gain configurations of the radio and reset the AP. Continue?[Y&#x2F;N]:y[AC1-wlan-ap-group-x]quitç¬¬ä¸‰æ­¥ï¼šé…ç½®ACçš„æ¥å£æºåœ°å€[AC1]capwap source interface Vlanif 100 &#x2F;&#x2F;ACçš„æ¥å£æºåœ°å€ä¸ºVLAN100ç¬¬å››æ­¥ï¼šç¦»çº¿å¯¼å…¥AP[AC1]wlan[AC1-wlan-view]ap auth-mode mac-auth &#x2F;&#x2F;APçš„è®¤è¯æ¨¡å¼ä¸ºMACè®¤è¯[AC1-wlan-view]ap-id 1 ap-mac 00e0-fcd5-1c70 &#x2F;&#x2F;APçš„ç¼–å·å’ŒMACåœ°å€[AC1-wlan-ap-1]ap-name ds &#x2F;&#x2F;APçš„åå­—ä¸ºds[AC1-wlan-ap-1]ap-group x &#x2F;&#x2F;APå±äºAPç»„x[AC1-wlan-view]ap-id 2 ap-mac 00e0-fc1e-3670 &#x2F;&#x2F;APçš„ç¼–å·å’ŒMACåœ°å€[AC1-wlan-ap-2]ap-name xs &#x2F;&#x2F;Apçš„åå­—[AC1-wlan-ap-2]ap-group x &#x2F;&#x2F;APå±äºAPç»„xWarning: This operation may cause AP reset. If the country code changes, it willclear channel, power and antenna gain configurations of the radio, Whether to continue? [Y&#x2F;N]:yæ€è€ƒï¼šAPçš„MACåœ°å€æ˜¯æ€ä¹ˆçŸ¥é“çš„ï¼Ÿè¯»è€…å¯ä»¥é€šè¿‡åœ¨apä¸Šä½¿ç”¨å‘½ä»¤â€œdisplay interface Vlanif 1â€æŸ¥çœ‹å½“å‰apçš„macåœ°å€ï¼Œç„¶åå†å°†macåœ°å€è¿›è¡Œç»‘å®šã€‚æŸ¥çœ‹å‘½ä»¤ï¼š[AC1]display ap allInfo: This operation may take a few seconds. Please wait for a moment.done.Total AP information:nor : normal [2]-â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“ID MAC Name Group IP Type State STA Uptime-â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“1 00e0-fcd5-1c70 ds x 192.168.100.137 AP2050DN nor 0 11M:2S2 00e0-fc1e-3670 xs x 192.168.100.42 AP2050DN nor 0 54S-â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªAPéƒ½è·å–äº†IPåœ°å€ï¼Œæ€è€ƒï¼šä»¥ä¸Šè¿‡ç¨‹ä¸€å…±å‡ åŒ…ï¼ŸAPè·å–IPåœ°å€4ä¸ªåŒ…ï¼šdiscoveryã€offerã€requestã€ackCAPWAPçš„å»ºç«‹2ä¸ªåŒ…ï¼šdiscovery request(udp ç›®çš„ç«¯å£5246å¹¿æ’­æ‰¾AC) discovery response(å•æ’­å›åº”AP)APæ¥å…¥æ§åˆ¶2ä¸ªåŒ…ï¼šjoin request(udp 5246ç«¯å£ å•æ’­) join responseéš§é“ç»´æŒ2ä¸ªåŒ…ï¼šæ•°æ®éš§é“ï¼škeepalive(udp 5247) æ§åˆ¶éš§é“ï¼šecho(udp 5246) é…ç½®VLANä¸šåŠ¡å‚æ•°ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºå®‰å…¨æ¨¡æ¿[AC1]wlan[AC1-wlan-view]security-profile name y1 &#x2F;&#x2F;å®‰å…¨æ¨¡æ¿çš„åå­—å«y1[AC1-wlan-sec-prof-y1]security wpa-wpa2 psk pass-phrase huawei@123 aes &#x2F;&#x2F;å¯†ç æ˜¯huawei@123ï¼Œç”¨AESåŠ å¯†ã€‚[AC1-wlan-sec-prof-y1]quitç¬¬äºŒæ­¥ï¼šåˆ›å»ºSSIDæ¨¡æ¿[AC1]wlan[AC1-wlan-view]ssid-profile name y2 &#x2F;&#x2F;ssidçš„æ¨¡æ¿åå­—å«y2[AC1-wlan-ssid-prof-y2]ssid hcia &#x2F;&#x2F;ssidçš„åç§°å«hcia[AC1-wlan-ssid-prof-y2]quit[AC1-wlan-view]quitç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºVAPæ¨¡æ¿[AC1]wlan[AC1-wlan-view]vap-profile name y &#x2F;&#x2F;vapæ¨¡æ¿çš„åå­—å«y[AC1-wlan-vap-prof-y]forward-mode tunnel &#x2F;&#x2F;è½¬å‘æ¨¡å¼ä¸ºéš§é“[AC1-wlan-vap-prof-y]service-vlan vlan-id 101 &#x2F;&#x2F;æœåŠ¡çš„VLANä¸º101[AC1-wlan-vap-prof-y]security-profile y1 &#x2F;&#x2F;è°ƒç”¨å®‰å…¨æ¨¡æ¿y1[AC1-wlan-vap-prof-y]ssid-profile y2 &#x2F;&#x2F;è°ƒç”¨SSIDæ¨¡æ¿y2[AC1-wlan-vap-prof-y]quitç¬¬å››æ­¥ï¼šåœ¨APç»„é‡Œé¢è°ƒç”¨VAPæ¨¡æ¿[AC1-wlan-view]ap-group name x[AC1-wlan-ap-group-x]vap-profile y wlan 1 radio 0 &#x2F;&#x2F;è°ƒç”¨VAPæ¨¡æ¿y[AC1-wlan-ap-group-x]vap-profile y wlan 1 radio 1 &#x2F;&#x2F;æ€è€ƒï¼šradio0 1 2 æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿæ€è€ƒï¼šè¿™ç›¸è¿‡ç¨‹è¦å‡ ä¸ªåŒ…ï¼ŸWLANä¸šåŠ¡é…ç½®ä¸‹å‘2ä¸ªåŒ…ï¼šConfiguration Update Request Configuration Update Response STAæ¥å…¥ï¼Œå¯ä»¥çœ‹åˆ°æœ‰ä¸¤ä¸ªssidä¸ºhciaçš„æ— çº¿ç½‘ç»œï¼Œåœ¨ä¹‹å‰çš„é…ç½®ä¸­é…ç½®äº†radio 0 ã€1å°±æ˜¯ä¸ºäº†é‡Šæ”¾ä¸¤ä¸ªä¸åŒçš„å°„é¢‘ä¿¡å·ï¼Œé€‰æ‹©å…¶ä¸­ä¸€ä¸ªï¼Œè¾“å…¥ä¹‹å‰åˆ›å»ºçš„å¯†ç huawei@123","categories":[{"name":"ipå®éªŒ","slug":"ipå®éªŒ","permalink":"http://example.com/categories/ip%E5%AE%9E%E9%AA%8C/"}],"tags":[{"name":"apä¸Šçº¿","slug":"apä¸Šçº¿","permalink":"http://example.com/tags/ap%E4%B8%8A%E7%BA%BF/"},{"name":"wlan","slug":"wlan","permalink":"http://example.com/tags/wlan/"}]},{"title":"USG5500é˜²ç«å¢™åŸºç¡€å®éªŒ","slug":"USG5500é˜²ç«å¢™åŸºç¡€å®éªŒ","date":"2023-12-08T09:52:30.000Z","updated":"2023-12-08T10:57:14.753Z","comments":true,"path":"2023/12/08/USG5500é˜²ç«å¢™åŸºç¡€å®éªŒ/","permalink":"http://example.com/2023/12/08/USG5500%E9%98%B2%E7%81%AB%E5%A2%99%E5%9F%BA%E7%A1%80%E5%AE%9E%E9%AA%8C/","excerpt":"","text":"åŸºç¡€é…ç½® 1ã€æœ¬å®éªŒä¸­çš„é˜²ç«å¢™ä¸ºUSG5500ç³»åˆ—é˜²ç«å¢™ï¼› 2ã€ é˜²ç«å¢™ä¸‰ä¸ªæ¥å£çš„IPåœ°å€æŒ‰ç…§ä¸Šå›¾æ‰€ç¤ºè¿›è¡Œé…ç½®ï¼›å°†è¿™ä¸‰ä¸ªæ¥å£åˆ’å…¥ç›¸åº”çš„å®‰å…¨åŸŸï¼› 3ã€é…ç½®é˜²ç«å¢™çš„åŸŸé—´åŒ…è¿‡æ»¤ç­–ç•¥ï¼Œä½¿å¾—PC1èƒ½å¤Ÿä¸»åŠ¨è®¿é—®PC2ï¼Œä½†æ˜¯PC2æ— æ³•ä¸»åŠ¨è®¿é—®PC1ï¼›PC2èƒ½å¤Ÿä¸»åŠ¨è®¿é—®WebServerçš„WEBæœåŠ¡ã€‚ é˜²ç«å¢™é…ç½®ï¼š [FW] interface GigabitEthernet0&#x2F;0&#x2F;1 [FW-GigabitEthernet0&#x2F;0&#x2F;1] ip address 192.168.1.254 24 [FW] interface GigabitEthernet0&#x2F;0&#x2F;2 [FW-GigabitEthernet0&#x2F;0&#x2F;2] ip address 172.16.1.254 24 [FW] interface GigabitEthernet0&#x2F;0&#x2F;3 [FW-GigabitEthernet0&#x2F;0&#x2F;3] ip address 10.1.1.254 24 å°†æ¥å£æ·»åŠ åˆ°ç›¸åº”çš„å®‰å…¨åŒºåŸŸï¼š [FW] firewall zone trust [FW-zone-trust] add interface GigabitEthernet0&#x2F;0&#x2F;1 [FW] firewall zone dmz [FW-zone-dmz] add interface GigabitEthernet0&#x2F;0&#x2F;2 [FW] firewall zone untrust [FW-zone-untrust] add interface GigabitEthernet0&#x2F;0&#x2F;3 é…ç½®åŸŸé—´ç­–ç•¥ï¼Œä½¿å¾—truståŸŸçš„192.168.1.0&#x2F;24ç½‘æ®µç”¨æˆ·èƒ½å¤Ÿè®¿é—®untruståŒºåŸŸçš„10.1.1.0&#x2F;24ç½‘æ®µ [FW] policy interzone trust untrust outbound [FW-policy-interzone-trust-untrust-outbound] policy 10 [FW-policy-interzone-trust-untrust-outbound-10] policy destination 10.1.1.0 0.0.0.255 [FW-policy-interzone-trust-untrust-outbound-10] policy source 192.168.1.0 0.0.0.255 [FW-policy-interzone-trust-untrust-outbound-10] action permit é…ç½®åŸŸé—´ç­–ç•¥ï¼Œä½¿å¾—untrustå¯ä»¥è®¿é—®server [FW] policy interzone dmz untrust inbound [FW-policy-interzone-dmz-untrust-inbound] policy 10 [FW-policy-interzone-dmz-untrust-inbound-10] policy source 10.1.1.0 0.0.0.255 [FW-policy-interzone-dmz-untrust-inbound-10] policy destination 172.16.1.1 0 [FW-policy-interzone-dmz-untrust-inbound-10] policy service service-set http [FW-policy-interzone-dmz-untrust-inbound-10] action permit å®Œæˆä¸Šè¿°é…ç½®åï¼ŒPC1å³å¯ä¸»åŠ¨å‘èµ·è®¿é—®PC2ï¼Œè€ŒPC2æ— æ³•ä¸»åŠ¨è®¿é—®PC1ï¼›å¦å¤–ï¼ŒPC2èƒ½å¤Ÿè®¿é—®WebServerçš„HTTPæœåŠ¡ ï¼ˆpingä¸åŒï¼Œéœ€è¦å†é…ç½®ä¸€æ¡å…è®¸icmpåè®®é€šè¿‡ï¼‰ é€šè¿‡å‘½ä»¤display zoneï¼Œå¯ä»¥æŸ¥çœ‹é˜²ç«å¢™çš„å®‰å…¨åŒºåŸŸã€å®‰å…¨ç­‰çº§ï¼Œä»¥åŠæ¯ä¸ªå®‰å…¨åŒºåŸŸä¸‹çš„æ¥å£. ä½¿ç”¨display firewall packet-filter default å‘½ä»¤ï¼Œèƒ½æŸ¥çœ‹é˜²ç«å¢™çš„ç¼ºçœå®‰å…¨ç­–ç•¥ã€‚å½“æ•°æ®åŒ…ç»è¿‡é˜²ç«å¢™ä¸”ä»ä¸€ä¸ªå®‰å…¨åŸŸè¯•å›¾è®¿é—®å¦ä¸€ä¸ªå®‰å…¨åŸŸæ—¶ï¼Œé˜²ç«å¢™ä¼šæ ¹æ®æ•°æ®åŒ…çš„æµå‘é¦–å…ˆæ£€æŸ¥ç”¨æˆ·å®šä¹‰çš„policy interzoneï¼Œå¦‚æœæ²¡æœ‰è‡ªå®šä¹‰çš„policy interoneï¼Œåˆ™ä¼šçœ‹æ ¹æ®é˜²ç«å¢™çš„ç¼ºçœå®‰å…¨ç­–ç•¥è¿›è¡Œå¤„ç†ã€‚ä¾‹å¦‚ä»ä¸Šé¢çš„æ˜¾ç¤ºä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°local-trustçš„inboundåŠoutboundéƒ½æ˜¯permitï¼Œå› æ­¤å³ä½¿æˆ‘ä»¬æ²¡æœ‰æ˜¾å¼çš„é…ç½®localåŠtrustå®‰å…¨åŒºåŸŸçš„åŒºåŸŸé—´ç­–ç•¥ï¼Œä½†æ˜¯ç”±äºé»˜è®¤çš„ç­–ç•¥å°±æ˜¯æ”¾è¡Œï¼Œæ‰€ä»¥ truståŒºåŸŸçš„ç”¨æˆ·å¯ä»¥ç›´æ¥pingé€šé˜²ç«å¢™çš„æ¥å£ã€‚ å¦‚æœè¦è®©é˜²ç«å¢™é»˜è®¤æ”¾è¡Œæ‰€æœ‰åŸŸé—´çš„æµé‡ï¼Œå¯ä»¥ä½¿ç”¨ï¼šfirewall packet-filter default permit allå‘½ä»¤ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨ç½‘ç»œæ­£å¼æŠ•å…¥ç°ç½‘ä½¿ç”¨ä¹‹å‰ï¼Œæ­¤å‘½ä»¤å¿…é¡»å…³é—­ï¼ˆfirewall packet-filter default deny allï¼‰ï¼Œé’ˆå¯¹éœ€è¦æ”¾è¡Œçš„æµé‡ï¼Œéœ€é€šè¿‡policy interzoneçš„é…ç½®æ¥æ”¾è¡Œï¼Œè€Œä¸èƒ½é²è½åœ°å°†æ‰€æœ‰æµé‡ç»Ÿç»Ÿæ”¾è¡Œã€‚ ä½¿ç”¨display policyå‘½ä»¤ï¼Œèƒ½æŸ¥çœ‹æˆ‘ä»¬å®šä¹‰çš„åŒºåŸŸé—´å®‰å…¨ç­–ç•¥ï¼Œä¾‹å¦‚ï¼š [FW] display policy interzone trust untrust outbound USG5500 natå®éªŒ é˜²ç«å¢™FWçš„é…ç½®å¦‚ä¸‹ï¼š [FW] interface GigabitEthernet0&#x2F;0&#x2F;1 [FW-GigabitEthernet0&#x2F;0&#x2F;1] ip address 192.168.1.254 24 [FW] interface GigabitEthernet0&#x2F;0&#x2F;2 [FW-GigabitEthernet0&#x2F;0&#x2F;2] ip address 172.16.1.254 24 [FW] interface GigabitEthernet0&#x2F;0&#x2F;3 [FW-GigabitEthernet0&#x2F;0&#x2F;3] ip address 200.1.1.1 24 å‘å®‰å…¨åŸŸä¸­æ·»åŠ æ¥å£ [FW] firewall zone trust [FW-zone-trust] add interface GigabitEthernet0&#x2F;0&#x2F;1 [FW] firewall zone dmz [FW-zone-dmz] add interface GigabitEthernet0&#x2F;0&#x2F;2 [FW] firewall zone untrust [FW-zone-untrust] add interface GigabitEthernet0&#x2F;0&#x2F;3 é…ç½®åŸŸé—´åŒ…è¿‡æ»¤ç­–ç•¥ï¼Œä½¿å¾—truståŒºåŸŸçš„192.168.1.0&#x2F;24ç½‘æ®µç”¨æˆ·èƒ½å¤Ÿè®¿é—®Internetï¼š [FW] policy interzone trust untrust outbound [FW-policy-interzone-trust-untrust-outbound] policy 10 [FW-policy-interzone-trust-untrust-outbound-10] policy source 192.168.1.0 0.0.0.255 [FW-policy-interzone-trust-untrust-outbound-10] action permit ä¸Šè¿°é…ç½®è™½ç„¶æ”¾é€šäº†192.168.1.0&#x2F;24è®¿é—®Internetçš„æµé‡ï¼Œä½†æ˜¯ç”±äº192.168.1.0&#x2F;24æ˜¯ç§æœ‰IPåœ°å€ï¼Œä¸èƒ½ç›´æ¥è¿›å…¥å…¬ç½‘ï¼Œå› æ­¤ä¸ºäº†è®©è¿™éƒ¨åˆ†ç”¨æˆ·èƒ½å¤Ÿè®¿é—®å…¬ç½‘ï¼Œè¿˜å¿…é¡»éƒ¨ç½²NATæºåœ°å€è½¬æ¢ [FW] nat address-group 1 200.1.1.10 200.1.1.20 å®šä¹‰NATåœ°å€æ± ï¼Œè¯¥åœ°å€æ± ä½¿ç”¨çš„å…¬ç½‘åœ°å€åŒºé—´æ˜¯200.1.1.10åˆ°200.1.1.20 [FW] nat-policy interzone trust untrust outbound é…ç½®NATç­–ç•¥ [FW-nat-policy-interzone-trust-untrust-outbound] policy 10 [FW-nat-policy-interzone-trust-untrust-outbound-10] policy source 192.168.1.0 0.0.0.255 [FW-nat-policy-interzone-trust-untrust-outbound-10] action source-nat &#x2F;&#x2F;å¯¹åŒ¹é…çš„æµé‡æ‰§è¡Œæºåœ°å€è½¬æ¢ [FW-nat-policy-interzone-trust-untrust-outbound-10] address-group 1 &#x2F;&#x2F;å…³è”natåœ°å€æ± 1 å®Œæˆä¸Šè¿°é…ç½®åï¼Œå†…ç½‘ç”¨æˆ·PC1å³å¯è®¿é—®å…¬ç½‘ç”¨æˆ·PC2ã€‚æ¥ä¸‹æ¥ç»§ç»­é…ç½®é˜²ç«å¢™ï¼Œä½¿å¾—å…¬ç½‘ç”¨æˆ·PC2èƒ½å¤Ÿè®¿é—®WebServerã€‚ é…ç½®åŸŸé—´åŒ…è¿‡æ»¤ç­–ç•¥ï¼Œä½¿å¾—untruståŒºåŸŸçš„Internetç”¨æˆ·èƒ½å¤Ÿè®¿é—®DMZåŒºåŸŸçš„webæœåŠ¡ [FW] policy interzone dmz untrust inbound [FW-policy-interzone-dmz-untrust-inbound] policy 10 [FW-policy-interzone-dmz-untrust-inbound-10] policy destination 172.16.1.1 0 [FW-policy-interzone-dmz-untrust-inbound-10] policy service service-set http [FW-policy-interzone-dmz-untrust-inbound-10] action permit [FW-policy-interzone-dmz-untrust-inbound-10] quit [FW-policy-interzone-dmz-untrust-inbound] quit å®Œæˆä¸Šè¿°é…ç½®åï¼ŒInternetç”¨æˆ·æ˜¯ä¾ç„¶æ— æ³•è®¿é—®WebServerçš„ï¼Œå› ä¸ºWebServeræ˜¯ç§æœ‰IPåœ°å€ï¼Œå› æ­¤è¿˜éœ€è¦é…ç½®NAT serverï¼Œå°†DMZåŸŸå†…çš„WebServeræ˜ å°„åˆ°å…¬ç½‘ã€‚ ä¸‹é¢çš„å‘½ä»¤ï¼Œå°†å†…éƒ¨IPåœ°å€172.16.1.1çš„80ç«¯å£æ˜ å°„åˆ°äº†å…¬ç½‘åœ°å€200.1.1.21çš„80ç«¯å£ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå½“å…¬ç½‘ç”¨æˆ·è®¿é—®200.1.1.21çš„80ç«¯å£æœåŠ¡æ—¶ï¼Œå®é™…ä¸Šè®¿é—®çš„å°±æ˜¯å†…éƒ¨æœåŠ¡å™¨172.16.1.1çš„80ç«¯å£ã€‚ [FW] nat server zone untrust protocol tcp global 200.1.1.21 80 inside 172.16.1.1 80 å®Œæˆä¸Šè¿°é…ç½®åï¼ŒPC2å³å¯ä½¿ç”¨ç›®çš„åœ°å€200.1.1.21æ¥è®¿é—®WebServerã€‚ å½“PC1 ping PC2æ—¶ï¼Œèƒ½å¤Ÿåœ¨FWä¸Šèƒ½çœ‹åˆ°å¦‚ä¸‹ä¼šè¯ï¼š display firewall session table Current Total Sessions : 5 icmp VPN:public â€“&gt; public 192.168.1.1:40373[200.1.1.15:2048]â€“&gt;200.1.1.2:2048 icmp VPN:public â€“&gt; public 192.168.1.1:40885[200.1.1.15:2049]â€“&gt;200.1.1.2:2048 ç•™æ„åˆ°ä¸­æ‹¬å·å†…çš„IPåœ°å€ï¼Œä¾¿æ˜¯è¢«NATè½¬æ¢åçš„IPåœ°å€ã€‚ å½“PC2è®¿é—®Serverçš„WEBæœåŠ¡æ—¶ï¼Œåœ¨FWä¸Šèƒ½çœ‹åˆ°å¦‚ä¸‹ä¼šè¯ï¼š [FW]display firewall session table Current Total Sessions : 1 http VPN:public â€“&gt; public 200.1.1.2:2055â€“&gt;200.1.1.21:80[172.16.1.1:80]","categories":[{"name":"ipå®éªŒ","slug":"ipå®éªŒ","permalink":"http://example.com/categories/ip%E5%AE%9E%E9%AA%8C/"}],"tags":[{"name":"USG5500","slug":"USG5500","permalink":"http://example.com/tags/USG5500/"},{"name":"é˜²ç«å¢™nat","slug":"é˜²ç«å¢™nat","permalink":"http://example.com/tags/%E9%98%B2%E7%81%AB%E5%A2%99nat/"}]},{"title":"rstpå’Œmstp","slug":"rstpå’Œmstp","date":"2023-12-07T10:08:51.000Z","updated":"2023-12-07T10:53:06.725Z","comments":true,"path":"2023/12/07/rstpå’Œmstp/","permalink":"http://example.com/2023/12/07/rstp%E5%92%8Cmstp/","excerpt":"","text":"æ¦‚å¿µSTPä¸‰ä¸ªç‰ˆæœ¬ï¼šSTPï¼ˆ802.1dï¼‰RSTPï¼ˆ802.1wï¼‰MSTP ï¼ˆ802.1sï¼‰ä½œç”¨ï¼šæ‰“ç ´äºŒå±‚ç¯è·¯ï¼Œå®ç°è®¾å¤‡æˆ–è€…é“¾è·¯çš„å†—ä½™STPçš„è®¡ç®—è¿‡ç¨‹â‘ é€‰ä¸¾æ ¹æ¡¥BID&#x3D;ä¼˜å…ˆçº§+MACï¼Œä¼˜å…ˆçº§å€¼è¶Šå°è¶Šä¼˜ï¼Œå¦‚æœä¼˜å…ˆçº§ç›¸ç­‰ï¼ŒMACå°çš„æˆä¸ºæ ¹æ¡¥â‘¡é€‰ä¸¾æ ¹ç«¯å£RPCï¼ˆå°çš„è¶Šä¼˜ï¼‰+ä¸Šè¡Œäº¤æ¢æœºçš„BID+ä¸Šè¡Œäº¤æ¢æœºçš„PIDï¼ˆä¼˜å…ˆçº§å’Œæ¥å£IDï¼Œè¶Šå°è¶Šä¼˜ï¼‰+æœ¬åœ°çš„PIDâ‘¢é€‰ä¸¾æŒ‡å®šæ¥å£RPCï¼ˆå°çš„è¶Šä¼˜ï¼‰+æœ¬ç«¯çš„BID+æœ¬ç«¯çš„PIDï¼ˆå°çš„è¶Šä¼˜ï¼‰â‘£éæŒ‡å®šæ¥å£ ç«¯å£ä¼˜å…ˆçº§ ç«¯å£IDï¼ˆpidï¼‰&#x3D; ç«¯å£ä¼˜å…ˆçº§ï¼ˆPort Priorityï¼‰4 bit+ ç«¯å£ç¼–å·12 bit æ„æˆï¼› ç¼ºçœæƒ…å†µä¸‹ï¼Œç«¯å£ä¼˜å…ˆçº§æ˜¯128ï¼›ç«¯å£ä¼˜å…ˆçº§å–å€¼èŒƒå›´æ˜¯0åˆ°240ï¼Œå–å€¼å¿…é¡»ä¸º16çš„æ•´æ•°å€ã€‚ ä¼˜å…ˆçº§ é»˜è®¤32768 è¶Šå°è¶Šä¼˜ å¿…é¡»æ˜¯4096å€æ•° 0-65535 æ¥å£æ ¹è·¯å¾„å¼€é”€ï¼š 1ã€dot1tGï¼š20000Eï¼š200000 PRC&#x3D;æ ¹æ¡¥åˆ°éæ ¹æ¡¥ç»è¿‡æ‰€æœ‰çš„å…¥æ–¹å‘æ¥å£çš„costç´¯åŠ  STPçš„æ”¶æ•›æ—¶é—´ï¼š â‘ æ ¹æ¡¥æ•…éšœ50sâ‘¡ç›´è¿é“¾è·¯å‘ç”Ÿæ•…éšœ30sâ‘¢éç›´è¿é“¾è·¯æ•…éšœ50s è½¬å‘å»¶è¿Ÿè®¡æ—¶å™¨ï¼š15sBPDUå‘é€æ—¶é—´ï¼š2sè€åŒ–æ—¶é—´ï¼š20s ç«¯å£çŠ¶æ€ï¼šdisable:æœªå¯ç”¨blockingï¼šé˜»å¡listening:ä¾¦å¬learning:å­¦ä¹ forwardingï¼šè½¬å‘ RSTP:ä¸€ã€ç«¯å£è§’è‰²ï¼šæ ¹ç«¯å£æŒ‡å®šç«¯å£A:æ ¹ç«¯å£çš„å¤‡ä»½ç«¯å£ï¼Œæä¾›äº†æŒ‡å®šæ¡¥åˆ°è¾¾æ ¹çš„å¦ä¸€æ¡è·¯å¾„Backup:ä½œä¸ºæŒ‡å®šæ¥å£çš„å¤‡ä»½ï¼Œæä¾›äº†å¦ä¸€æ¡ä»æ ¹æ¡¥åˆ°ç›¸åº”ç½‘æ®µçš„å¤‡ä»½é“¾è·¯ äºŒã€ç«¯å£çŠ¶æ€DiscardingçŠ¶æ€ï¼šä¸è½¬å‘ç”¨æˆ·æµé‡ä¹Ÿä¸å­¦ä¹ MACåœ°å€ï¼›LearningçŠ¶æ€ï¼šä¸è½¬å‘ç”¨æˆ·æµé‡ä½†æ˜¯å­¦ä¹ MACåœ°å€ï¼›ForwardingçŠ¶ï¼šæ—¢è½¬å‘ç”¨æˆ·æµé‡åˆå­¦ä¹ MACåœ°å€ä¸‰ã€é…ç½®BPDUBPDUç±»å‹å’Œflagå­—æ®µå››ã€é…ç½®BPDUçš„å¤„ç†æ‹“æ‰‘ç¨³å®šåï¼Œè¿è¡ŒRSTPåè®®çš„éæ ¹æ¡¥è®¾å¤‡ä¼šå®šæœŸçš„å‘é€é…ç½®BPDURSTPçš„ä»»ä½•ç«¯å£è§’è‰²éƒ½ä¼šå¤„ç†æ¬¡ä¼˜BPDUï¼Œä»è€ŒåŠ å¿«æ‹“æ‰‘æ”¶æ•›äº”ã€P&#x2F;Aä½œç”¨ï¼šä¿è¯ä¸€ä¸ªæŒ‡å®šæ¥å£ä»discardingâ€”&gt;forwardingè§¦å‘ï¼šåªæœ‰æŒ‡å®šdiscardingçŠ¶æ€ä¸‹æ‰å¯ä»¥è§¦å‘P&#x2F;Aæœºåˆ¶ï¼Œå¿…é¡»æ˜¯æ ¹ç«¯å£åœ¨forwardingçŠ¶æ€ä¸‹å›å¤ä¸€ä¸ªA&#x3D;1çš„ä¸€ä¸ªBPDU â‘  é€‰ä¸¾æ ¹æ¡¥ã€æ ¹æ¥å£ã€æŒ‡å®šæ¥å£ï¼Œç„¶åæ ¹æ¥å£ã€æŒ‡å®šæ¥å£å¤„äºdiscardingâ‘¡æ ¹æ¡¥çš„æŒ‡å®šæ¥å£å¤„äºdiscarsingï¼Œè§¦å‘åˆ°P&#x2F;Aï¼Œæ ¹æ¡¥ä¼šä»æŒ‡å®šæ¥å£å‘é€P&#x3D;1BPDUï¼›â‘¢éæ ¹æ¡¥çš„æ ¹æ¥å£æ”¶åˆ°P&#x3D;1çš„BPDUï¼Œä¼šå¯åŠ¨ä¸€ä¸ªåŒæ­¥è¿‡ç¨‹ï¼Œå°†éè¾¹ç¼˜æ¥å£å…¨éƒ¨é˜»å¡ï¼ŒåŒæ­¥å®Œæˆä¹‹åï¼Œæ ¹æ¥å£åˆ‡æ¢åˆ°è½¬å‘çŠ¶æ€ï¼Œå¹¶ä¸”ä»æ ¹æ¥å£å‘é€A&#x3D;1 BPDUâ‘£æ ¹æ¡¥æ”¶åˆ°A&#x3D;1 BPDUï¼Œç«‹å³åˆ‡æ¢ä¸ºè½¬å‘çŠ¶æ€ï¼Œå®ç°æŒ‡å®šæ¥å£çš„å¿«é€Ÿæ”¶æ•› ä¿æŠ¤åŠŸèƒ½ï¼š1ã€BPDUä¿æŠ¤å­˜åœ¨é—®é¢˜ï¼šè¾¹ç¼˜ç«¯å£æ”¶åˆ°BPDUä¹‹åï¼Œæ¥å£ä¼šå˜æˆæ™®é€šæ¥å£ï¼Œé‚£ä¹ˆä¼šå¼•èµ·ç½‘ç»œä¸­ç”Ÿæˆæ ‘é‡æ–°è®¡ç®—ï¼Œå¯¹ç½‘ç»œé€ æˆå½±å“ã€‚è§£å†³ï¼šå¼€å¯BPDUä¿æŠ¤åŠŸèƒ½ï¼Œåªè¦è¾¹ç¼˜ç«¯å£æ”¶åˆ°BPDUï¼Œäº¤æ¢æœºç«‹å³æŠŠæ¥å£ç½®ä½Error-downï¼ŒåŒæ—¶ä¼šäº§ç”Ÿå‘Šè­¦ã€‚ï¼ˆæ¥å£æ¢å¤ä¸¤ç§æ–¹å¼ï¼šæ‰‹å·¥æ¢å¤ã€è‡ªåŠ¨æ¢å¤ï¼‰ 2ã€æ ¹ä¿æŠ¤ å­˜åœ¨é—®é¢˜ï¼šåŠ å…¥åœ¨ä¸€ä¸ªç¨³å®šçš„STPç½‘ç»œï¼Œæ­¤æ—¶æ ¹æ¡¥è¿æ¥ä¸€å°äº¤æ¢æœºï¼Œè¯¥äº¤æ¢æœºæ”¯æŒç”Ÿæˆæ ‘ï¼Œå‘é€BPDUï¼ŒSTPç½‘ç»œé‡æ–°è®¡ç®—ï¼›å¦‚æœæ–°åŠ å…¥çš„äº¤æ¢æœºæ¯”æ ¹æ¡¥ä¼˜å…ˆçº§æ›´ä¼˜ï¼Œä¼šæŠ¢å æ ¹æ¡¥çš„ä½ç½®ï¼Œä»è€Œå¼•èµ·ç½‘ç»œéœ‡è¡è§£å†³ï¼šæ ¹æ¡¥çš„æŒ‡å®šæ¥å£ä¸‹æ¿€æ´»è·Ÿä¿æŠ¤åŠŸèƒ½ï¼Œå¦‚ä½•æ¥å£æ”¶åˆ°äº†æ›´ä¼˜çš„BPDUï¼Œä¼šå¿½ç•¥å¹¶ä¸”åˆ‡æ¢åˆ°discardingã€‚æ³¨æ„ï¼šè·Ÿä¿æŠ¤åªèƒ½åœ¨æŒ‡å®šæ¥å£ä¸‹æ¿€æ´»ã€‚çŠ¶æ€æ¢å¤ï¼šå¦‚æœæ¥å£ä¸å†æ”¶åˆ°æ›´ä¼˜çš„BPDUï¼Œåœ¨ä¸€æ®µæ—¶é—´åï¼ˆ2*è½¬å‘å»¶è¿Ÿæ—¶é—´ï¼‰è‡ªåŠ¨æ¢å¤è½¬å‘çŠ¶æ€ã€‚ 3ã€ç¯è·¯ä¿æŠ¤å­˜åœ¨é—®é¢˜ï¼šAPå•å‘æ•…éšœï¼šå‡å¦‚äº¤æ¢æœºä¹‹é—´é€šè¿‡å…‰çº¤ï¼ˆä¸€æ”¶ä¸€å‘ï¼‰ï¼Œé“¾è·¯å‘ç”Ÿå•å‘æ•…éšœï¼ŒAPæ¥å£è€åŒ–æ—¶é—´åæ²¡æœ‰æ”¶åˆ°BPDU,æ¥å£ä¼šæˆä¸ºDPå¹¶åˆ‡æ¢åˆ°è½¬å‘çŠ¶æ€ï¼Œå¹¶è½¬å‘æµé‡ï¼Œç¯è·¯äº§ç”ŸRPå•å‘æ•…éšœï¼šå‡å¦‚äº¤æ¢æœºä¹‹é—´é€šè¿‡å…‰çº¤ï¼ˆä¸€æ”¶ä¸€å‘ï¼‰ï¼Œé“¾è·¯å‘ç”Ÿå•å‘æ•…éšœï¼Œå¯¼è‡´DPåˆ°RPçš„å•å‘æ•…éšœï¼ŒRPåœ¨ä¸€æ®µæ—¶é—´æ²¡æœ‰æ”¶åˆ°BPDUï¼ŒAPä¼šåˆ‡æ¢åˆ°RPè§’è‰²ï¼ŒRPåˆ‡æ¢åˆ°DPï¼Œæ”¶æ•›å®Œæˆï¼ŒDPå¼€å§‹è½¬å‘ä¸šåŠ¡æµé‡ï¼Œç¯è·¯äº§ç”Ÿã€‚è§£å†³ï¼šåœ¨APæ¥å£ä¸‹å¼€å¯ç¯è·¯ä¿æŠ¤åŠŸèƒ½ï¼Œå¦‚ä½•æ¥å£é•¿æ—¶é—´æ²¡æœ‰BPDU ,é‚£ä¹ˆAPæ¥å£åˆ‡æ¢æˆDPï¼Œç«¯å£çŠ¶æ€ä¿æŒdiscardingçŠ¶æ€ï¼Œé¿å…ç¯è·¯ã€‚ åœ¨RPæ¥å£ä¸‹å¼€å¯ç¯è·¯ä¿æŠ¤åŠŸèƒ½ï¼Œå¦‚ä½•æ¥å£é•¿æ—¶é—´æ²¡æœ‰BPDUï¼Œé‚£ä¹ˆä¼šé‡æ–°è®¡ç®—é€‰ä¸¾æ ¹ç«¯å£ï¼Œå¹¶å°†åŸç«¯å£è°ƒæ•´ä¸ºDPï¼Œæ¥å£çŠ¶æ€ä¿æŒdiscardingçŠ¶æ€ï¼Œé¿å…ç¯è·¯ã€‚ 4ã€æ‹“æ‰‘å˜æ›´ä¿æŠ¤ï¼ˆTC protectionï¼‰å­˜åœ¨é—®é¢˜ï¼šå‡å¦‚ç½‘ç»œä¸­å­˜åœ¨æ”»å‡»è€…ï¼Œä¼šä»¿å†’TCç½®ä½ä¸º1çš„BPDUæŠ¥æ–‡å‘é€å¤§é‡çš„TC BPDUï¼Œäº¤æ¢æœºæ”¶åˆ°BPDUä¹‹åï¼Œä¼šåˆ é™¤macåœ°å€è¡¨é¡¹ï¼Œä¼šæ¶ˆè€—å¤§é‡çš„è®¾å¤‡èµ„æºã€‚è§£å†³ï¼šé»˜è®¤æƒ…å†µäº¤æ¢æœºå¼€å¯äº†æ‹“æ‰‘å˜æ›´ä¿æŠ¤ï¼Œç¼ºçœ2såªä¼šå¤„ç†å¼‚å¸¸TC BPDUï¼Œè¶…å‡ºçš„éƒ¨åˆ†ç­‰å¾…ä¸€æ®µæ—¶é—´å¤„ç† å¦‚ä½•ç”ŸæˆSTPæ ‘ï¼Ÿä¸»è¦é€šè¿‡æ¯”è¾ƒ4ä¸ªå‚æ•°ï¼šæ ¹æ¡¥IDã€æ ¹è·¯å¾„å¼€é”€ã€ç½‘æ¡¥IDå’Œç«¯å£IDï¼Œå€¼è¶Šå°ï¼Œè¶Šä¼˜å…ˆã€‚è€Œè¿™äº›å‚æ•°ï¼Œéƒ½æ˜¯æŠ¥æ–‡BPDUä¸­çš„å­—æ®µã€‚æ ¹æ¡¥é€‰ä¸¾ï¼šæ¯”è¾ƒæ ¹æ¡¥IDï¼Œæœ€å°èƒœå‡ºã€‚æ ¹ç«¯å£é€‰ä¸¾ï¼šä¾æ¬¡æ¯”è¾ƒRPCã€å¯¹ç«¯BIDã€å¯¹ç«¯PIDå’Œæœ¬ç«¯PIDï¼Œæœ€å°èƒœå‡ºã€‚æŒ‡å®šç«¯å£é€‰ä¸¾ï¼šä¾æ¬¡æ¯”è¾ƒRPCã€æœ¬ç«¯BIDå’Œæœ¬ç«¯PIDï¼Œæœ€å°èƒœå‡ºã€‚ åœ¨ç¡®å®šäº†æ ¹ç«¯å£å’ŒæŒ‡å®šç«¯å£ä¹‹åï¼Œäº¤æ¢æœºä¸Šæ‰€æœ‰å‰©ä½™çš„éæ ¹ç«¯å£å’ŒéæŒ‡å®šç«¯å£è¢«é˜»å¡ã€‚ MSTPï¼šä¸€ã€æ¦‚å¿µMST Regionï¼šMultiple Spanning Tree Regionï¼Œå¤šç”Ÿæˆæ ‘åŸŸï¼‰ï¼Œä¹Ÿå¯ç®€ç§°MSTåŸŸMSTIï¼ˆMultiple Spanning Tree Instanceï¼Œå¤šç”Ÿæˆæ ‘å®ä¾‹ï¼‰ï¼šMSTIä½¿ç”¨Instance IDæ ‡è¯†ï¼Œä¸º0~4094ã€‚Instance0æ˜¯ç¼ºçœå­˜åœ¨çš„ï¼Œè€Œä¸”ç¼ºçœæ—¶ï¼Œåä¸ºäº¤æ¢æœºä¸Šæ‰€æœ‰çš„VLANéƒ½æ˜ å°„åˆ°äº†Instance0ã€‚é€šè¿‡è®¾ç½®VLANæ˜ å°„è¡¨ï¼ˆå³VLANå’ŒMSTIçš„å¯¹åº”å…³ç³»è¡¨ï¼‰ï¼ŒæŠŠVLANå’ŒMSTIè”ç³»èµ·æ¥ã€‚æ¯ä¸ªVLANåªèƒ½å¯¹åº”ä¸€ä¸ªMSTIï¼Œå³åŒä¸€VLANçš„æ•°æ®åªèƒ½åœ¨ä¸€ä¸ªMSTIä¸­ä¼ è¾“ï¼Œè€Œä¸€ä¸ªMSTIå¯èƒ½å¯¹åº”å¤šä¸ªVLANã€‚CSTå…¬å…±ç”Ÿæˆæ ‘ï¼šæ˜¯è¿æ¥äº¤æ¢ç½‘ç»œå†…æ‰€æœ‰MSTåŸŸçš„ä¸€æ£µç”Ÿæˆæ ‘ISTï¼ˆå†…éƒ¨ç”Ÿæˆæ ‘ï¼‰æ˜¯å„MSTåŸŸå†…çš„ä¸€æ£µç”Ÿæˆæ ‘ã€‚CISTï¼ˆå…¬å…±å’Œå†…éƒ¨ç”Ÿæˆæ ‘ï¼‰é€šè¿‡ç”Ÿæˆæ ‘åè®®è®¡ç®—ç”Ÿæˆçš„ï¼Œè¿æ¥ä¸€ä¸ªäº¤æ¢ç½‘ç»œå†…æ‰€æœ‰äº¤æ¢è®¾å¤‡çš„å•ç”Ÿæˆæ ‘SSTï¼ˆSingle Spanning Treeï¼Œå•ç”Ÿæˆæ ‘ï¼‰æœ‰ä¸¤ç§æƒ…å†µï¼šè¿è¡Œç”Ÿæˆæ ‘åè®®çš„äº¤æ¢è®¾å¤‡åªèƒ½å±äºä¸€ä¸ªç”Ÿæˆæ ‘ã€‚MSTåŸŸä¸­åªæœ‰ä¸€ä¸ªäº¤æ¢è®¾å¤‡ï¼Œè¿™ä¸ªäº¤æ¢è®¾å¤‡æ„æˆå•ç”Ÿæˆæ ‘ã€‚ æ€»æ ¹ï¼ˆCIST Rootï¼‰æ˜¯CISTçš„æ ¹æ¡¥ åŸŸæ ¹ï¼ˆRegional Rootï¼‰åˆ†ä¸ºISTåŸŸæ ¹å’ŒMSTIåŸŸæ ¹ã€‚ISTåŸŸæ ¹ï¼Œåœ¨MSTåŸŸä¸­ISTç”Ÿæˆæ ‘ä¸­è·ç¦»æ€»æ ¹æœ€è¿‘çš„äº¤æ¢è®¾å¤‡æ˜¯ISTåŸŸæ ¹ï¼ŒMSTIåŸŸæ ¹æ˜¯æ¯ä¸ªå¤šç”Ÿæˆæ ‘å®ä¾‹çš„æ ‘æ ¹ ä¸»æ¡¥ï¼ˆMaster Bridgeï¼‰æ˜¯IST Masterï¼Œå®ƒæ˜¯åŸŸå†…è·ç¦»æ€»æ ¹æœ€è¿‘çš„äº¤æ¢è®¾å¤‡ï¼Œå¦‚æœæ€»æ ¹åœ¨MSTåŸŸä¸­ï¼Œåˆ™æ€»æ ¹ä¸ºè¯¥åŸŸçš„ä¸»æ¡¥ æ–°å¢çš„ç«¯å£è§’è‰²ï¼šâ‘ Masterç«¯å£ Masterç«¯å£æ˜¯MSTåŸŸå’Œæ€»æ ¹ç›¸è¿çš„æ‰€æœ‰è·¯å¾„ä¸­æœ€çŸ­è·¯å¾„ä¸Šçš„ç«¯å£ï¼Œå®ƒæ˜¯äº¤æ¢è®¾å¤‡ä¸Šè¿æ¥MSTåŸŸåˆ°æ€»æ ¹çš„ç«¯å£ã€‚Masterç«¯å£æ˜¯åŸŸä¸­çš„æŠ¥æ–‡å»å¾€æ€»æ ¹çš„å¿…ç»ä¹‹è·¯ã€‚Masterç«¯å£æ˜¯ç‰¹æ®ŠåŸŸè¾¹ç¼˜ç«¯å£ï¼ŒMasterç«¯å£åœ¨CISTä¸Šçš„è§’è‰²æ˜¯Root Portï¼Œåœ¨å…¶å®ƒå„å®ä¾‹ä¸Šçš„è§’è‰²éƒ½æ˜¯Masterç«¯å£ã€‚ â‘¡åŸŸè¾¹ç¼˜ç«¯å£åŸŸè¾¹ç¼˜ç«¯å£æ˜¯æŒ‡ä½äºMSTåŸŸçš„è¾¹ç¼˜å¹¶è¿æ¥å…¶å®ƒMSTåŸŸæˆ–SSTçš„ç«¯å£ MSTPè®¡ç®—ä¼˜å…ˆçº§å‘é‡è¯´æ˜ï¼šæ ¹äº¤æ¢è®¾å¤‡IDï¼šæ ¹äº¤æ¢è®¾å¤‡IDç”¨äºé€‰æ‹©CISTä¸­çš„æ ¹äº¤æ¢è®¾å¤‡ã€‚æ ¹äº¤æ¢è®¾å¤‡ID &#x3D; Priority(16 bit) + MAC(48 bit)ã€‚å…¶ä¸­Priorityä¸ºMSTI0çš„ä¼˜å…ˆçº§ã€‚å¤–éƒ¨è·¯å¾„å¼€é”€ï¼ˆExternal Root Path Costï¼ŒERPCï¼‰ï¼šä»CISTçš„åŸŸæ ¹åˆ°è¾¾æ€»æ ¹çš„è·¯å¾„å¼€é”€ã€‚MSTåŸŸå†…æ‰€æœ‰äº¤æ¢è®¾å¤‡ä¸Šä¿å­˜çš„å¤–éƒ¨è·¯å¾„å¼€é”€ç›¸åŒã€‚è‹¥CISTæ ¹äº¤æ¢è®¾å¤‡åœ¨åŸŸä¸­ï¼Œåˆ™åŸŸå†…æ‰€æœ‰äº¤æ¢è®¾å¤‡ä¸Šä¿å­˜çš„å¤–éƒ¨è·¯å¾„å¼€é”€ä¸º0ã€‚åŸŸæ ¹IDï¼šåŸŸæ ¹IDç”¨äºé€‰æ‹©MSTIä¸­çš„åŸŸæ ¹ã€‚åŸŸæ ¹ID &#x3D; Priority(16 bit) + MAC(48 bit)ã€‚å…¶ä¸­Priorityä¸ºMSTI0çš„ä¼˜å…ˆçº§ã€‚å†…éƒ¨è·¯å¾„å¼€é”€ï¼ˆInternal Root Path Costï¼ŒIRPCï¼‰ï¼šæœ¬æ¡¥åˆ°è¾¾åŸŸæ ¹çš„è·¯å¾„å¼€é”€ã€‚åŸŸè¾¹ç¼˜ç«¯å£ä¿å­˜çš„å†…éƒ¨è·¯å¾„å¼€é”€å¤§äºéåŸŸè¾¹ç¼˜ç«¯å£ä¿å­˜çš„å†…éƒ¨è·¯å¾„å¼€é”€ã€‚æŒ‡å®šäº¤æ¢è®¾å¤‡IDï¼šCISTæˆ–MSTIå®ä¾‹çš„æŒ‡å®šäº¤æ¢è®¾å¤‡æ˜¯æœ¬æ¡¥é€šå¾€åŸŸæ ¹çš„æœ€é‚»è¿‘çš„ä¸Šæ¸¸æ¡¥ã€‚å¦‚æœæœ¬æ¡¥å°±æ˜¯æ€»æ ¹æˆ–åŸŸæ ¹ï¼Œåˆ™æŒ‡å®šäº¤æ¢è®¾å¤‡ä¸ºè‡ªå·±ã€‚æŒ‡å®šç«¯å£IDï¼šæŒ‡å®šäº¤æ¢è®¾å¤‡ä¸ŠåŒæœ¬è®¾å¤‡ä¸Šæ ¹ç«¯å£ç›¸è¿çš„ç«¯å£ã€‚Port ID &#x3D; Priority(4 bit) + ç«¯å£å·ï¼ˆ12 bitï¼‰ã€‚ç«¯å£ä¼˜å…ˆçº§å¿…é¡»æ˜¯16çš„æ•´æ•°å€ã€‚æ¥æ”¶ç«¯å£IDï¼šæ¥æ”¶åˆ°BPDUæŠ¥æ–‡çš„ç«¯å£ã€‚Port ID &#x3D; Priority(4 bit) + ç«¯å£å·ï¼ˆ12 bitï¼‰ã€‚ ç«¯å£ä¼˜å…ˆçº§å¿…é¡»æ˜¯16çš„æ•´æ•°å€ã€‚ ä¼˜å…ˆçº§å‘é‡æ¯”è¾ƒåŸåˆ™ï¼šåŒä¸€å‘é‡æ¯”è¾ƒï¼Œå€¼æœ€å°çš„å‘é‡å…·æœ‰æœ€é«˜ä¼˜å…ˆçº§ã€‚ä¼˜å…ˆçº§å‘é‡æ¯”è¾ƒåŸåˆ™å¦‚ä¸‹é¦–å…ˆï¼Œæ¯”è¾ƒæ ¹äº¤æ¢è®¾å¤‡IDã€‚å¦‚æœæ ¹äº¤æ¢è®¾å¤‡IDç›¸åŒï¼Œå†æ¯”è¾ƒå¤–éƒ¨è·¯å¾„å¼€é”€ã€‚å¦‚æœå¤–éƒ¨è·¯å¾„å¼€é”€ç›¸åŒï¼Œå†æ¯”è¾ƒåŸŸæ ¹IDã€‚å¦‚æœåŸŸæ ¹IDä»ç„¶ç›¸åŒï¼Œå†æ¯”è¾ƒå†…éƒ¨è·¯å¾„å¼€é”€ã€‚å¦‚æœå†…éƒ¨è·¯å¾„ä»ç„¶ç›¸åŒï¼Œå†æ¯”è¾ƒæŒ‡å®šäº¤æ¢è®¾å¤‡IDã€‚å¦‚æœæŒ‡å®šäº¤æ¢è®¾å¤‡IDä»ç„¶ç›¸åŒï¼Œå†æ¯”è¾ƒæŒ‡å®šç«¯å£IDã€‚å¦‚æœæŒ‡å®šç«¯å£IDè¿˜ç›¸åŒï¼Œå†æ¯”è¾ƒæ¥æ”¶ç«¯å£IDã€‚å¦‚æœç«¯å£æ¥æ”¶åˆ°çš„BPDUå†…åŒ…å«çš„é…ç½®æ¶ˆæ¯ä¼˜äºç«¯å£ä¸Šä¿å­˜çš„é…ç½®æ¶ˆæ¯ï¼Œåˆ™ç«¯å£ä¸ŠåŸæ¥ä¿å­˜çš„é…ç½®æ¶ˆæ¯è¢«æ–°æ”¶åˆ°çš„é…ç½®æ¶ˆæ¯æ›¿ä»£ã€‚ç«¯å£åŒæ—¶æ›´æ–°äº¤æ¢è®¾å¤‡ä¿å­˜çš„å…¨å±€é…ç½®æ¶ˆæ¯ã€‚åä¹‹ï¼Œæ–°æ”¶åˆ°çš„BPDUè¢«ä¸¢å¼ƒã€‚ é…ç½® å¼€å¯STPï¼Œä¿®æ”¹STPæ¨¡å¼ä¸ºRSTPã€‚ æ‰‹åŠ¨æŒ‡å®šS1ä¸ºRSTPæ ¹æ¡¥ã€S2ä¸ºRSTPå¤‡ä»½æ ¹æ¡¥ã€‚ é€šè¿‡ä¿®æ”¹æ¥å£å¼€é”€å€¼ï¼Œä½¿å¾—S4çš„GE0&#x2F;0&#x2F;1æ¥å£æˆä¸ºæ ¹ç«¯å£ã€‚ é€šè¿‡ä¿®æ”¹S1çš„GE0&#x2F;0&#x2F;11æ¥å£ä¼˜å…ˆçº§ï¼Œä½¿å¾—S2çš„GE0&#x2F;0&#x2F;11æ¥å£æˆä¸ºæ ¹ç«¯å£ã€‚ ä¿®æ”¹STPæ¨¡å¼ä¸ºMSTPï¼Œåˆ›å»ºInstance1ã€2ï¼ŒæŒ‡å®šSW1ä¸ºMSTI1çš„æ ¹æ¡¥ã€MSTI2çš„å¤‡ä»½æ ¹æ¡¥ï¼ŒæŒ‡å®šSW2ä¸ºMSTI2çš„æ ¹æ¡¥ã€MSTI1çš„å¤‡ä»½æ ¹æ¡¥ã€‚ RSTPåŸºç¡€é…ç½®#S1-s4 ä¸Šéƒ½é…ç½® stp enable stp mode rstp #æŸ¥çœ‹STPçš„çŠ¶æ€å’Œç»Ÿè®¡ä¿¡æ¯æ‘˜è¦ dis stp brief æ¥å£éƒ½ä¸ºæŒ‡å®šç«¯å£çš„æ˜¯æ ¹æ¡¥ï¼Œæœ¬å®éªŒä¸­s4æ˜¯æ ¹æ¡¥ æ ¹æ¡¥é€‰ä¸¾æ§åˆ¶ #æ‰‹åŠ¨è°ƒæ•´STPä¼˜å…ˆçº§ï¼ŒæŒ‡å®šS1ä¸ºä¸»æ ¹æ¡¥ã€S2ä¸ºå¤‡ä»½æ ¹æ¡¥ [S1]stp priority 4096 [S2]stp priority 8192 åœ¨å¦å¤–ä¸¤å°äº¤æ¢æœºä¿æŒé»˜è®¤æ¡¥ä¼˜å…ˆçº§ï¼ˆ32768ï¼‰çš„æƒ…å†µä¸‹ï¼ŒS1æ‹¥æœ‰æœ€å°çš„æ¡¥ä¼˜å…ˆçº§ï¼ŒS2æ¬¡ä¹‹ã€‚ æ­¤æ—¶s1å˜ä¸ºæ ¹æ¡¥ï¼Œs2å¤‡ä»½æ ¹æ¡¥ dis stpå¯ä»¥çœ‹åˆ°ä¼˜å…ˆçº§å·²ç»æ”¹å˜ #å–æ¶ˆS1ã€S2ä¸Šæ‰‹åŠ¨è°ƒæ•´æ¡¥ä¼˜å…ˆçº§çš„é…ç½®ï¼Œä½¿ç”¨stp rootå‘½ä»¤æŒ‡å®šæ ¹æ¡¥ã€å¤‡ä»½æ ¹æ¡¥ [S1]undo stp priority [S1]stp root primary [S2]undo stp priority [S2]stp root secondary #S1ã€S2ä¸ŠæŸ¥çœ‹STPçš„çŠ¶æ€å’Œç»Ÿè®¡ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹å†…å®¹ s1ï¼š s2: S1çš„æ¡¥ä¼˜å…ˆçº§ä¸º0ï¼Œè€ŒS2çš„æ¡¥ä¼˜å…ˆçº§ä¸º4096ï¼Œæ­¤æ—¶S1ä¸ºæ ¹æ¡¥ï¼ŒS2ä¸ºå¤‡ä»½æ ¹æ¡¥ã€‚ ä¿®æ”¹æ¥å£å¼€é”€å€¼æ§åˆ¶æ ¹ç«¯å£é€‰ä¸¾ #åœ¨S4ä¸ŠæŸ¥çœ‹STPçš„çŠ¶æ€å’Œç»Ÿè®¡ä¿¡æ¯æ‘˜è¦ S4ä¸ŠGE0&#x2F;0&#x2F;2æ‹¥æœ‰æ›´å°çš„RPCï¼ˆæ ¹è·¯å¾„å¼€é”€ï¼‰ï¼Œä»è€Œæˆä¸ºæ ¹ç«¯å£ã€‚ #åœ¨S4ä¸ŠæŸ¥çœ‹GE0&#x2F;0&#x2F;2æ¥å£çš„STPçš„çŠ¶æ€å’Œç»Ÿè®¡ä¿¡æ¯ æ­¤æ—¶è·¯å¾„å¼€é”€è®¡ç®—æ–¹æ³•ä¸ºDot1tï¼Œæ¥å£çš„STP costå€¼ä¸º20000ã€‚ #ä¿®æ”¹S4çš„GE0&#x2F;0&#x2F;2æ¥å£çš„STP costå€¼ä¸º40001 [S4]interface GigabitEthernet 0&#x2F;0&#x2F;2 [S4-GigabitEthernet0&#x2F;0&#x2F;2] stp cost 40001 #å†æ¬¡åœ¨S4ä¸ŠæŸ¥çœ‹STPçš„çŠ¶æ€å’Œç»Ÿè®¡ä¿¡æ¯æ‘˜è¦ æ­¤æ—¶GE0&#x2F;0&#x2F;1æ¥å£çš„RPCä¸º20000ï¼Œå°äºGE0&#x2F;0&#x2F;2æ¥å£çš„RPC 40001ï¼ŒS4çš„GE0&#x2F;0&#x2F;1æ¥å£æˆä¸ºæ ¹ç«¯å£ã€‚ ä¿®æ”¹æ¥å£ä¼˜å…ˆçº§æ§åˆ¶æ ¹ç«¯å£é€‰ä¸¾ #åœ¨S2ä¸ŠæŸ¥çœ‹STPçš„çŠ¶æ€å’Œç»Ÿè®¡ä¿¡æ¯æ‘˜è¦ S2ä¸ŠGE0&#x2F;0&#x2F;10ã€GE0&#x2F;0&#x2F;11æ¥å£æ”¶åˆ°çš„BPDUæ‹¥æœ‰ç›¸åŒçš„RPCã€ä¸Šè¡Œäº¤æ¢æœºBIDï¼Œæ­¤æ—¶æ¯”è¾ƒä¸Šè¡Œäº¤æ¢æœºPIDï¼ˆä¼˜å…ˆçº§+æ¥å£idï¼‰ï¼Œæ¥å£ä¼˜å…ˆçº§ä¸€æ ·ï¼Œæ¥å£idå°çš„ä¼˜ï¼Œæ‰€ä»¥g0&#x2F;0&#x2F;10å°ï¼Œæ‰€ä»¥æ˜¯æ ¹ç«¯å£ #åœ¨S1ä¸Šä¿®æ”¹GE0&#x2F;0&#x2F;11çš„STPæ¥å£ä¼˜å…ˆçº§ï¼Œä½¿å…¶å‘é€çš„BPDUä¼˜äº GE0&#x2F;0&#x2F;10å‘é€çš„BPDU ï¼ˆä¿®æ”¹ä¸Šè¡Œäº¤æ¢æœºçš„PIDï¼‰ [S1]interface GigabitEthernet 0&#x2F;0&#x2F;11 [S1-GigabitEthernet0&#x2F;0&#x2F;11] stp port priority 64 ç«¯å£ID&#x3D; ç«¯å£ä¼˜å…ˆçº§ï¼ˆPort Priorityï¼‰4 bit+ ç«¯å£ç¼–å·12 bit æ„æˆï¼› ç¼ºçœæƒ…å†µä¸‹ï¼Œç«¯å£ä¼˜å…ˆçº§æ˜¯128ï¼›ç«¯å£ä¼˜å…ˆçº§å–å€¼èŒƒå›´æ˜¯0åˆ°240ï¼Œå–å€¼å¿…é¡»ä¸º16çš„æ•´æ•°å€ã€‚ #å†æ¬¡æŸ¥çœ‹S2ä¸Šçš„STPçŠ¶æ€å’Œç»Ÿè®¡ä¿¡æ¯æ‘˜è¦ æ­¤æ—¶S2çš„GE0&#x2F;0&#x2F;1æ¥å£æˆä¸ºæ ¹ç«¯å£ã€‚ MSTPåŸºç¡€é…ç½®åœ¨æ‰€æœ‰äº¤æ¢æœºä¸Šåˆ›å»ºVLAN10ã€20ã€30ã€40ã€50ã€60ã€70ã€80ï¼Œé…ç½®MSTPåŸŸhcipï¼Œå¹¶åˆ›å»ºä¸¤ä¸ªæ–°çš„å®ä¾‹ï¼šInstance 1ã€Instance 2ï¼Œå°†VLAN10ã€30ã€50ã€70æ˜ å°„åˆ°Instance 1ï¼Œå°†VLAN20ã€40ã€60ã€80æ˜ å°„åˆ°Instance 2ï¼ŒåŒæ—¶å°†SW1è§„åˆ’ä¸ºMSTI1çš„ä¸»æ ¹æ¡¥ã€MSTI2çš„å¤‡ä»½æ ¹æ¡¥ï¼Œå°†SW2è§„åˆ’ä¸ºMSTI2çš„ä¸»æ ¹æ¡¥ã€MSTI1çš„å¤‡ä»½æ ¹æ¡¥ã€‚ #åˆ›å»ºVLAN [S1]vlan batch 10 20 30 40 50 60 70 80 [S2]vlan batch 10 20 30 40 50 60 70 80 [S3]vlan batch 10 20 30 40 50 60 70 80 [S4]vlan batch 10 20 30 40 50 60 70 80 #å°†æ‰€æœ‰äº’è”æ¥å£é…ç½®ä¸ºTrunkæ¥å£ï¼Œæ”¾é€šæ‰€æœ‰VLAN ç•¥ #ä¿®æ”¹STPæ¨¡å¼ä¸ºMSTP [S1]stp mode mstp [S2]stp mode mstp [S3]stp mode mstp [S4]stp mode mstp #é…ç½®MSTP [S1]stp region-configuration [S1-mst-region] region-name hcip &#x2F;&#x2F;åŸŸåä¸ºhcip [S1-mst-region] revision-level 1 &#x2F;&#x2F;ç‰ˆæœ¬1 [S1-mst-region] instance 1 vlan 10 30 50 70 å®ä¾‹1æ˜ å°„vlan 10 30 50 70 [S1-mst-region] instance 2 vlan 20 40 60 80 [S1-mst-region] active region-configuration &#x2F;&#x2F;ç”Ÿæ•ˆ Info: This operation may take a few seconds. Please wait for a momentâ€¦done. [S1-mst-region] quit ï¼ˆs2ï¼Œs3ï¼Œs4åŒç†é…ç½®ï¼‰ #åœ¨S1æ£€æŸ¥MSTPå®ä¾‹å’ŒVLANçš„æ˜ å°„å…³ç³» [S1]display stp region-configuration #é…ç½®SW1ä¸ºMSTI1çš„æ ¹æ¡¥ã€MSTI2çš„å¤‡ä»½æ ¹æ¡¥ [S1]stp instance 1 root primary [S1]stp instance 2 root secondary #é…ç½®SW2ä¸ºMSTI2çš„æ ¹æ¡¥ã€MSTI1çš„å¤‡ä»½æ ¹æ¡¥ [S2]stp instance 1 root secondary [S2]stp instance 2 root primary #åœ¨S1ä¸ŠæŸ¥çœ‹MSTI1çš„çŠ¶æ€å’Œç»Ÿè®¡ä¿¡æ¯æ‘˜è¦ [S1]display stp instance 1 brief MSTID Port Role STP State Protection 1 GigabitEthernet0&#x2F;0&#x2F;10 DESI FORWARDING NONE 1 GigabitEthernet0&#x2F;0&#x2F;11 DESI FORWARDING NONE 1 GigabitEthernet0&#x2F;0&#x2F;12 DESI FORWARDING NONE 1 GigabitEthernet0&#x2F;0&#x2F;13 DESI FORWARDING NONE S1ä¸Šæ‰€æœ‰æ¥å£éƒ½æ˜¯æŒ‡å®šæ¥å£ï¼ŒS1ä¸ºMSTI1çš„æ ¹æ¡¥ã€‚ #åœ¨S2ä¸ŠæŸ¥çœ‹MSTI2çš„çŠ¶æ€å’Œç»Ÿè®¡ä¿¡æ¯æ‘˜è¦ [S2]display stp instance 2 brief MSTID Port Role STP State Protection 2 GigabitEthernet0&#x2F;0&#x2F;10 DESI FORWARDING NONE 2 GigabitEthernet0&#x2F;0&#x2F;11 DESI FORWARDING NONE 2 GigabitEthernet0&#x2F;0&#x2F;12 DESI FORWARDING NONE 2 GigabitEthernet0&#x2F;0&#x2F;13 DESI FORWARDING NONE S2ä¸Šæ‰€æœ‰æ¥å£éƒ½æ˜¯æŒ‡å®šæ¥å£ï¼ŒS2ä¸ºMSTI2çš„æ ¹æ¡¥ã€‚","categories":[{"name":"ipå®éªŒ","slug":"ipå®éªŒ","permalink":"http://example.com/categories/ip%E5%AE%9E%E9%AA%8C/"}],"tags":[{"name":"rstp","slug":"rstp","permalink":"http://example.com/tags/rstp/"},{"name":"mstp","slug":"mstp","permalink":"http://example.com/tags/mstp/"}]},{"title":"é“¾è·¯èšåˆ","slug":"é“¾è·¯èšåˆ","date":"2023-12-07T07:56:27.000Z","updated":"2024-07-12T02:06:01.313Z","comments":true,"path":"2023/12/07/é“¾è·¯èšåˆ/","permalink":"http://example.com/2023/12/07/%E9%93%BE%E8%B7%AF%E8%81%9A%E5%90%88/","excerpt":"","text":"æ¦‚å¿µä»€ä¹ˆæ˜¯é“¾è·¯èšåˆåœ¨ç°ç½‘ä¸­ï¼Œè®¾å¤‡é—´å¦‚æœé€šè¿‡ä¸€æ¡é“¾è·¯è¿æ¥ï¼Œå¦‚æœè¿™æ¡é“¾è·¯æ•…éšœäº†ï¼Œé‚£ä¹ˆè®¾å¤‡ä¸¤ç«¯çš„ç»ˆç«¯å°±ä¸èƒ½å¤Ÿé€šä¿¡äº†ã€‚æœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥è§£å†³è¯¥é—®é¢˜å‘¢ï¼Ÿç­”æ¡ˆæ˜¯â€”â€”é“¾è·¯èšåˆã€‚ ä»ç«¯å£çš„è§’åº¦å®šä¹‰ï¼š é“¾è·¯èšåˆï¼ˆLink Aggregationï¼‰æ˜¯æŒ‡å°†å¤šä¸ªç‰©ç†ç«¯å£æ±‡èšåœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ªé€»è¾‘ç«¯å£ï¼Œä»¥å®ç°å‡º&#x2F;å…¥æµé‡ååé‡åœ¨å„æˆå‘˜ç«¯å£çš„è´Ÿè·åˆ†æ‹…ï¼Œäº¤æ¢æœºæ ¹æ®ç”¨æˆ·é…ç½®çš„ç«¯å£è´Ÿè½½åˆ†æ‹…æ–¹å¼å†³å®šæ•°æ®åŒ…ä»å“ªä¸ªæˆå‘˜ç«¯å£å‘é€åˆ°å¯¹ç«¯çš„äº¤æ¢æœºã€‚ ä»é“¾è·¯çš„è§’åº¦å®šä¹‰ï¼š é“¾è·¯èšåˆï¼ˆLink Aggregationï¼‰æ˜¯æŠŠä¸¤å°è®¾å¤‡ä¹‹é—´çš„å¤šæ¡ç‰©ç†é“¾è·¯èšåˆåœ¨ä¸€èµ·ï¼Œå½“åšä¸€æ¡é€»è¾‘é“¾è·¯æ¥ä½¿ç”¨ã€‚è¿™ä¸¤å°è®¾å¤‡å¯ä»¥æ˜¯ä¸€å¯¹è·¯ç”±å™¨ï¼Œä¸€å¯¹äº¤æ¢æœºï¼Œæˆ–è€…æ˜¯ä¸€å°è·¯ç”±å™¨å’Œä¸€å°äº¤æ¢æœºã€‚ä¸€æ¡èšåˆé“¾è·¯å¯ä»¥åŒ…å«å¤šæ¡æˆå‘˜é“¾è·¯ï¼Œé»˜è®¤æœ€å¤šä¸º8æ¡ã€‚ é“¾è·¯èšåˆçš„ä½œç”¨ é“¾è·¯èšåˆèƒ½å¤Ÿæé«˜é“¾è·¯å¸¦å®½ã€‚ç†è®ºä¸Šï¼Œé€šè¿‡èšåˆå‡ æ¡é“¾è·¯ï¼Œä¸€ä¸ªèšåˆå£çš„å¸¦å®½å¯ä»¥æ‰©å±•ä¸ºæ‰€æœ‰æˆå‘˜å£å¸¦å®½çš„æ€»å’Œï¼Œè¿™æ ·å°±æœ‰æ•ˆåœ°å¢åŠ äº†é€»è¾‘é“¾è·¯çš„å¸¦å®½ã€‚ é“¾è·¯èšåˆä¸ºç½‘ç»œæä¾›äº†é«˜å¯é æ€§ã€‚é…ç½®äº†é“¾è·¯èšåˆä¹‹åï¼Œå¦‚æœä¸€ä¸ªæˆå‘˜æ¥å£å‘ç”Ÿæ•…éšœï¼Œè¯¥æˆå‘˜å£çš„ç‰©ç†é“¾è·¯ä¼šæŠŠæµé‡åˆ‡æ¢åˆ°å¦ä¸€æ¡æˆå‘˜é“¾è·¯ä¸Šã€‚ é“¾è·¯èšåˆåœ¨ä¸€ä¸ªèšåˆå£ä¸Šå®ç°è´Ÿè½½å‡è¡¡ã€‚ä¸€ä¸ªèšåˆå£å¯ä»¥æŠŠæµé‡åˆ†æ•£åˆ°å¤šä¸ªä¸åŒçš„æˆå‘˜å£ä¸Šï¼Œé€šè¿‡æˆå‘˜é“¾è·¯æŠŠæµé‡å‘é€åˆ°åŒä¸€ä¸ªç›®çš„åœ°ï¼Œå°†ç½‘ç»œäº§ç”Ÿæ‹¥å¡çš„å¯èƒ½æ€§é™åˆ°æœ€ä½ã€‚ ä¸‰. é“¾è·¯èšåˆçš„å·¥ä½œåŸç†ï¼šåº”ç”¨åœºæ™¯ï¼š é“¾è·¯èšåˆä¸€èˆ¬éƒ¨ç½²åœ¨æ ¸å¿ƒç»“ç‚¹ï¼Œä»¥ä¾¿æå‡æ•´ä¸ªç½‘ç»œçš„æ•°æ®ååé‡ã€‚ é“¾è·¯èšåˆèƒ½å¤Ÿæé«˜é“¾è·¯å¸¦å®½ï¼Œå¢å¼ºç½‘ç»œå¯é ã€å¯ç”¨æ€§ï¼Œæ”¯æŒè´Ÿè½½åˆ†æ‹…ã€‚ é“¾è·¯èšåˆæ¨¡å¼: é“¾è·¯èšåˆåŒ…å«ä¸¤ç§æ¨¡å¼ï¼šæ‰‹åŠ¨è´Ÿè½½å‡è¡¡æ¨¡å¼å’Œé™æ€LACPï¼ˆLink Aggregation Control Protocolï¼‰æ¨¡å¼ã€‚ æ‰‹å·¥è´Ÿè½½åˆ†æ‹…æ¨¡å¼ï¼š æ‰‹å·¥è´Ÿè½½åˆ†æ‹…æ¨¡å¼ä¸‹ï¼ŒEth-Trunkçš„å»ºç«‹ã€æˆå‘˜æ¥å£çš„åŠ å…¥ç”±æ‰‹å·¥é…ç½®ï¼Œæ²¡æœ‰é“¾è·¯èšåˆæ§åˆ¶åè®®çš„å‚ä¸ã€‚ è¯¥æ¨¡å¼ä¸‹æ‰€æœ‰æ´»åŠ¨é“¾è·¯éƒ½å‚ä¸æ•°æ®çš„è½¬å‘ï¼Œå¹³å‡åˆ†æ‹…æµé‡ï¼Œå› æ­¤ç§°ä¸ºè´Ÿè½½åˆ†æ‹…æ¨¡å¼ã€‚å¦‚æœæŸæ¡æ´»åŠ¨é“¾è·¯æ•…éšœï¼Œé“¾è·¯èšåˆç»„è‡ªåŠ¨åœ¨å‰©ä½™çš„æ´»åŠ¨é“¾è·¯ä¸­å¹³å‡åˆ†æ‹…æµé‡ã€‚ ä½¿ç”¨åœºæ™¯ï¼š å½“éœ€è¦åœ¨ä¸¤ä¸ªç›´è¿è®¾å¤‡é—´æä¾›ä¸€ä¸ªè¾ƒå¤§çš„é“¾è·¯å¸¦å®½è€Œè®¾å¤‡åˆä¸æ”¯æŒLACPåè®®æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ‰‹å·¥è´Ÿè½½åˆ†æ‹…æ¨¡å¼ã€‚ 2. é™æ€LACPæ¨¡å¼ï¼š åœ¨é™æ€LACPæ¨¡å¼ä¸­ï¼Œé“¾è·¯ä¸¤ç«¯çš„è®¾å¤‡ç›¸äº’å‘é€LACPæŠ¥æ–‡ï¼Œåå•†èšåˆå‚æ•°ã€‚åå•†å®Œæˆåï¼Œä¸¤å°è®¾å¤‡ç¡®å®šæ´»åŠ¨æ¥å£å’Œéæ´»åŠ¨æ¥å£ã€‚ åœ¨é™æ€LACPæ¨¡å¼ä¸­ï¼Œéœ€è¦æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªEth-Trunkå£ï¼Œå¹¶æ·»åŠ æˆå‘˜å£ã€‚ é™æ€LACPæ¨¡å¼ä¹Ÿå«M:Næ¨¡å¼ã€‚Mä»£è¡¨æ´»åŠ¨æˆå‘˜é“¾è·¯ï¼Œç”¨äºåœ¨è´Ÿè½½å‡è¡¡æ¨¡å¼ä¸­è½¬å‘æ•°æ®ã€‚Nä»£è¡¨éæ´»åŠ¨é“¾è·¯ï¼Œç”¨äºå†—ä½™å¤‡ä»½ã€‚ å¦‚æœä¸€æ¡æ´»åŠ¨é“¾è·¯å‘ç”Ÿæ•…éšœï¼Œè¯¥é“¾è·¯ä¼ è¾“çš„æ•°æ®è¢«åˆ‡æ¢åˆ°ä¸€æ¡ä¼˜å…ˆçº§æœ€é«˜çš„å¤‡ä»½é“¾è·¯ä¸Šï¼Œè¿™æ¡å¤‡ä»½é“¾è·¯è½¬å˜ä¸ºæ´»åŠ¨çŠ¶æ€ã€‚ ä¸¤ç§é“¾è·¯èšåˆæ¨¡å¼çš„ä¸»è¦åŒºåˆ«ï¼š åœ¨é™æ€LACPæ¨¡å¼ä¸­ï¼Œä¸€äº›é“¾è·¯å……å½“å¤‡ä»½é“¾è·¯ã€‚ åœ¨æ‰‹åŠ¨è´Ÿè½½å‡è¡¡æ¨¡å¼ä¸­ï¼Œæ‰€æœ‰çš„æˆå‘˜å£éƒ½å¤„äºè½¬å‘çŠ¶æ€ã€‚ ç»´åº¦ æ‰‹å·¥æ¨¡å¼ LACPæ¨¡å¼ Eth-Trunkçš„å»ºç«‹æ–¹å¼ Eth-Trunkæ¥å£çš„åˆ›å»ºã€æˆå‘˜æ¥å£çš„åŠ å…¥ç”±æ‰‹å·¥é…ç½®ï¼Œæ²¡æœ‰é“¾è·¯èšåˆæ§åˆ¶åè®®çš„å‚ä¸ã€‚ Eth-Trunkæ¥å£çš„åˆ›å»ºã€æˆå‘˜æ¥å£çš„åŠ å…¥ç”±æ‰‹å·¥é…ç½®ï¼ŒLACPåè®®å‚ä¸é“¾è·¯åŠ¨æ€è°ƒæ•´ï¼Œè´Ÿè´£é“¾è·¯çŠ¶æ€ç»´æŠ¤ã€‚åœ¨èšåˆæ¡ä»¶å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè‡ªåŠ¨è°ƒæ•´æˆ–è§£æ•£é“¾è·¯èšåˆã€‚ è®¾å¤‡æ˜¯å¦éœ€è¦æ”¯æŒLACPåè®® ä¸éœ€è¦ éœ€è¦ æ•°æ®è½¬å‘ æ­£å¸¸æƒ…å†µä¸‹ï¼Œæ‰€æœ‰é“¾è·¯éƒ½æ˜¯æ´»åŠ¨é“¾è·¯ã€‚æ‰€æœ‰æ´»åŠ¨é“¾è·¯å‡å‚ä¸æ•°æ®è½¬å‘ã€‚å¦‚æœæŸæ¡æ´»åŠ¨é“¾è·¯æ•…éšœï¼Œé“¾è·¯èšåˆç»„è‡ªåŠ¨åœ¨å‰©ä½™çš„æ´»åŠ¨é“¾è·¯ä¸­åˆ†æ‹…æµé‡ã€‚ æ­£å¸¸æƒ…å†µä¸‹ï¼Œéƒ¨åˆ†é“¾è·¯æ˜¯æ´»åŠ¨é“¾è·¯ã€‚æ‰€æœ‰æ´»åŠ¨é“¾è·¯å‡å‚ä¸æ•°æ®è½¬å‘ã€‚å¦‚æœæŸæ¡æ´»åŠ¨é“¾è·¯æ•…éšœï¼Œé“¾è·¯èšåˆç»„è‡ªåŠ¨åœ¨éæ´»åŠ¨é“¾è·¯ä¸­é€‰æ‹©ä¸€æ¡é“¾è·¯ä½œä¸ºæ´»åŠ¨é“¾è·¯ï¼Œå‚ä¸æ•°æ®è½¬å‘çš„é“¾è·¯æ•°ç›®ä¸å˜ã€‚ æ£€æµ‹æ•…éšœ åªèƒ½æ£€æµ‹åˆ°åŒä¸€èšåˆç»„å†…çš„æˆå‘˜é“¾è·¯æœ‰æ–­è·¯ç­‰æ•…éšœï¼Œæ— æ³•æ£€æµ‹åˆ°é“¾è·¯æ–­è¿ã€é”™è¿ç­‰æ•…éšœã€‚ ä¸ä»…èƒ½å¤Ÿæ£€æµ‹åˆ°åŒä¸€èšåˆç»„å†…çš„æˆå‘˜é“¾è·¯æœ‰æ–­è·¯ç­‰æ•…éšœï¼Œè¿˜å¯ä»¥æ£€æµ‹åˆ°é“¾è·¯æ•…éšœã€é“¾è·¯é”™è¿ç­‰æ•…éšœã€‚ æ•°æ®æµæ§åˆ¶: Eth-trunké“¾è·¯ä¸¤ç«¯ç›¸è¿çš„ç‰©ç†æ¥å£çš„æ•°é‡ã€é€Ÿç‡ã€åŒå·¥æ–¹å¼ã€æµæ§æ–¹å¼å¿…é¡»ä¸€è‡´ã€‚ ä¼˜å…ˆçº§ç³»ç»Ÿä¼˜å…ˆçº§ï¼š 0-65535 é»˜è®¤32768 å°çš„ä¼˜å…ˆ ä¼˜å…ˆçº§ä¸€æ ·ï¼Œçœ‹macï¼Œmacå°çš„ä¼˜å…ˆ æ¥å£ä¼˜å…ˆçº§ï¼š ä¹Ÿæ˜¯0-65535 å°çš„ä¼˜ é»˜è®¤32768 LACPDUæŠ¥æ–‡åŸºäºIEEE802.3adæ ‡å‡†çš„LACPæ˜¯ä¸€ç§å®ç°é“¾è·¯åŠ¨æ€èšåˆä¸è§£èšåˆçš„åè®®ã€‚LACPé€šè¿‡é“¾è·¯èšåˆæ§åˆ¶åè®®æ•°æ®å•å…ƒLACPDUï¼ˆLink Aggregation Control Protocol Data Unitï¼‰ä¸å¯¹ç«¯äº¤äº’ä¿¡æ¯ã€‚ åœ¨LACPæ¨¡å¼çš„Eth-Trunkä¸­åŠ å…¥æˆå‘˜æ¥å£åï¼Œè¿™äº›æ¥å£å°†é€šè¿‡å‘é€LACPDUå‘å¯¹ç«¯é€šå‘Šè‡ªå·±çš„ç³»ç»Ÿä¼˜å…ˆçº§ã€MACåœ°å€ã€æ¥å£ä¼˜å…ˆçº§ã€æ¥å£å·å’Œæ“ä½œKeyç­‰ä¿¡æ¯ã€‚å¯¹ç«¯æ¥æ”¶åˆ°è¿™äº›ä¿¡æ¯åï¼Œå°†è¿™äº›ä¿¡æ¯ä¸è‡ªèº«æ¥å£æ‰€ä¿å­˜çš„ä¿¡æ¯æ¯”è¾ƒï¼Œç”¨ä»¥é€‰æ‹©èƒ½å¤Ÿèšåˆçš„æ¥å£ï¼ŒåŒæ–¹å¯¹å“ªäº›æ¥å£èƒ½å¤Ÿæˆä¸ºæ´»åŠ¨æ¥å£è¾¾æˆä¸€è‡´ï¼Œç¡®å®šæ´»åŠ¨é“¾è·¯ã€‚ LACPDU å¸§åŸºäº IEEE 802.3ad æ ‡å‡†ï¼Œæ˜¯ä¸€ç§æ…¢åè®®ï¼ˆå¹³å‡æ¯ç§’å‘é€çš„åè®®æŠ¥æ–‡ä¸è¶…è¿‡ 5 ä¸ªï¼‰ï¼Œå…¶ç›®çš„ MAC åœ°å€æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç»„æ’­åœ°å€ 0x01-80-c2-00-00-02ã€‚ å¦‚æœæ¥å£æ¿æ”¶åˆ°æŠ¥æ–‡çš„ç›®çš„ MAC æ˜¯è¯¥ç»„æ’­åœ°å€ï¼Œä¸”äºŒå±‚åè®®ç±»å‹å­—æ®µä¸º 0x8809ã€åè®®å­ç±»å‹ä¸º 0x01ï¼Œåˆ™è¯´æ˜æ­¤æ•°æ®æŠ¥æ–‡ä¸º LACPDU å¸§ã€‚ æŠ¥æ–‡æ ¼å¼ï¼š LACPDUï¼ˆLink Aggregation Control Protocol Data Unitï¼Œé“¾è·¯èšåˆæ§åˆ¶åè®®æ•°æ®å•å…ƒï¼‰çš„æŠ¥æ–‡æ ¼å¼å¦‚ä¸‹ï¼š å­—æ®µ é•¿åº¦ï¼ˆå­—èŠ‚ï¼‰ è¯´æ˜ Destination Addressï¼ˆç›®çš„MACåœ°å€ï¼‰ 6 æ˜¯ä¸€ä¸ªç»„æ’­åœ°å€ï¼Œå›ºå®šä¸º01-80-c2-00-00-02 Source Addressï¼ˆæºMACåœ°å€ï¼‰ 6 å‘é€ç«¯å£çš„MACåœ°å€ Length&#x2F;Typeï¼ˆé•¿åº¦&#x2F;ç±»å‹ï¼‰ 2 åè®®ç±»å‹ï¼š0x8809 Subtypeï¼ˆæŠ¥æ–‡å­ç±»å‹ï¼‰ 1 å–å€¼ä¸º0x01ï¼Œä»£è¡¨æ˜¯LACPæŠ¥æ–‡ Version Numberï¼ˆåè®®ç‰ˆæœ¬å·ï¼‰ 1 å›ºå®šä¸º0x01 TLV_Type&#x3D;Actor Informationï¼ˆTLVç±»å‹&#x3D;Actorä¿¡æ¯ï¼‰ 1 æ ‡è¯†TLVçš„ç±»å‹ï¼Œå€¼ä¸º0x01ä»£è¡¨Actorå­—æ®µ Actor_Information_Lengthï¼ˆActorä¿¡æ¯å­—æ®µé•¿åº¦ï¼‰ 1 å–å€¼ä¸º20ï¼ˆå³0x14ï¼‰ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½ Actor_System_Priorityï¼ˆæœ¬ç«¯ç³»ç»Ÿä¼˜å…ˆçº§ï¼‰ 2 å¯ä»¥è®¾ç½®ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸º32768ï¼ˆå³0x8000ï¼‰ Actor_Systemï¼ˆæœ¬ç«¯ç³»ç»ŸIDï¼‰ 6 æœ¬ç«¯ç³»ç»Ÿçš„MACåœ°å€ Actor_Keyï¼ˆç«¯å£Keyå€¼ï¼‰ 2 ç³»ç»Ÿæ ¹æ®ç«¯å£çš„é…ç½®ç”Ÿæˆï¼Œæ˜¯ç«¯å£èƒ½å¦æˆä¸ºèšåˆç»„æˆå‘˜çš„å…³é”®å› ç´ ï¼Œå½±å“Keyå€¼çš„å› ç´ æœ‰Trunk IDã€æ¥å£çš„é€Ÿç‡å’ŒåŒå·¥æ¨¡å¼ Actor_Port_Priorityï¼ˆæœ¬ç«¯æ¥å£ä¼˜å…ˆçº§ï¼‰ 2 å¯ä»¥é…ç½®ï¼Œé»˜è®¤ä¸º0x8000 Actor_Portï¼ˆæœ¬ç«¯ç«¯å£å·ï¼‰ 2 ç”±æ¥å£æ‰€åœ¨çš„æ§½ä½å·ã€å­å¡å·å’Œç«¯å£å·å†³å®š Actor_Stateï¼ˆæœ¬ç«¯çŠ¶æ€ä¿¡æ¯ï¼‰ 1 8ä½æ¯”ç‰¹çš„å«ä¹‰åˆ†åˆ«ä¸ºï¼š Bit0ï¼šlacp_activityï¼Œä»£è¡¨é“¾è·¯æ‰€åœ¨çš„èšåˆç»„å‚ä¸LACPåå•†çš„æ–¹å¼ã€‚ä¸»åŠ¨çš„LACPè¢«ç¼–ç ä¸º1ï¼Œå³ä¸»åŠ¨æ–¹å¼ä¸‹ä¼šä¸»åŠ¨å‘é€LACPDUæŠ¥æ–‡ç»™å¯¹æ–¹ï¼Œè¢«åŠ¨æ–¹å¼ä¸ä¼šä¸»åŠ¨å‘é€åå•†æŠ¥æ–‡ï¼Œé™¤éæ”¶åˆ°åå•†æŠ¥æ–‡æ‰ä¼šå‚ä¸ï¼› Bit1ï¼šlacp_timeoutï¼Œä»£è¡¨é“¾è·¯æ¥æ”¶LACPDUæŠ¥æ–‡çš„å‘¨æœŸï¼Œæœ‰ä¸¤ç§ï¼Œå¿«å‘¨æœŸ1ç§’å’Œæ…¢å‘¨æœŸ30ç§’ï¼Œè¶…æ—¶æ—¶é—´ä¸ºå‘¨æœŸçš„3å€ã€‚çŸ­è¶…æ—¶è¢«ç¼–ç ä¸º1ï¼Œé•¿è¶…æ—¶è¢«ç¼–ç ä¸º0ï¼› Bit2ï¼šaggregationï¼Œæ ‡è¯†è¯¥é“¾è·¯èƒ½å¦è¢«èšåˆç»„èšåˆã€‚å¦‚æœç¼–ç ä¸º0ï¼Œè¯¥é“¾è·¯è¢«è®¤ä¸ºæ˜¯ç‹¬ç«‹çš„ï¼Œä¸èƒ½è¢«èšåˆï¼Œå³è¿™ä¸ªé“¾è·¯åªèƒ½ä½œä¸ºä¸€ä¸ªä¸ªä½“é“¾è·¯è¿è¡Œï¼› Bit3ï¼šsynchronizationï¼Œä»£è¡¨è¯¥é“¾è·¯æ˜¯å¦å·²è¢«åˆ†é…åˆ°ä¸€ä¸ªæ­£ç¡®çš„é“¾è·¯èšåˆç»„ï¼Œå¦‚æœè¯¥é“¾è·¯å·²ç»å…³è”äº†ä¸€ä¸ªå…¼å®¹çš„èšåˆå™¨ï¼Œé‚£ä¹ˆè¯¥é“¾è·¯èšåˆç»„çš„è¯†åˆ«ä¸ç³»ç»ŸIDå’Œè¢«å‘é€çš„è¿è¡ŒKeyä¿¡æ¯æ˜¯ä¸€è‡´çš„ã€‚ç¼–ç ä¸º0ï¼Œä»£è¡¨é“¾è·¯å½“å‰ä¸åœ¨æ­£ç¡®çš„èšåˆé‡Œï¼› Bit4ï¼šcollectingï¼Œå¸§çš„æ”¶é›†ä½¿èƒ½ä½ï¼Œå‡å¦‚ç¼–ç ä¸º1ï¼Œè¡¨ç¤ºåœ¨è¿™ä¸ªé“¾è·¯ä¸Šè¿›æ¥çš„å¸§çš„æ”¶é›†æ˜¯æ˜ç¡®ä½¿èƒ½çš„ï¼Œå³æ”¶é›†å½“å‰è¢«ä½¿èƒ½ï¼Œå¹¶ä¸”ä¸æœŸæœ›åœ¨æ²¡æœ‰ç®¡ç†å˜åŒ–æˆ–æ¥æ”¶åè®®ä¿¡æ¯å˜åŒ–çš„æƒ…å†µä¸‹è¢«ç¦æ­¢ã€‚å…¶å®ƒæƒ…å†µä¸‹è¿™ä¸ªå€¼ç¼–ç ä¸º0ï¼› Bit5ï¼šdistributingï¼Œå¸§çš„åˆ†é…ä½¿èƒ½ä½ï¼Œå‡å¦‚ç¼–ç ä¸º0ï¼Œæ„å‘³ç€åœ¨è¿™ä¸ªé“¾è·¯ä¸Šçš„å¤–å‡ºå¸§çš„åˆ†é…è¢«æ˜ç¡®ç¦æ­¢ï¼Œå¹¶ä¸”ä¸æœŸæœ›åœ¨æ²¡æœ‰ç®¡ç†å˜åŒ–æˆ–æ¥æ”¶åè®®ä¿¡æ¯å˜åŒ–çš„æƒ…å†µä¸‹è¢«ä½¿èƒ½ã€‚å…¶å®ƒæƒ…å†µä¸‹è¿™ä¸ªå€¼ç¼–ç ä¸º1ï¼› Bit6-7ï¼šdefaultå’Œexpiredï¼Œç”¨äºè¯Šæ–­è°ƒè¯•ï¼Œdefaultç¼–ç ä¸º1ä»£è¡¨æ¥æ”¶åˆ°çš„å¯¹ç«¯çš„ä¿¡æ¯æ˜¯ç®¡ç†é…ç½®çš„ã€‚å‡å¦‚ç¼–ç ä¸º0ï¼Œæ­£åœ¨ä½¿ç”¨çš„è¿è¡Œä¼™ä¼´ä¿¡æ¯åœ¨æ¥æ”¶åˆ°çš„LACPDUé‡Œã€‚expiredç¼–ç ä¸º1ä»£è¡¨æœ¬ç«¯çš„æ¥æ”¶æœºæ˜¯å¤„äºexpiredè¶…æ—¶çŠ¶æ€ï¼›å‡å¦‚ç¼–ç ä¸º0ï¼Œæœ¬ç«¯æ¥æ”¶çŠ¶æ€æœºå¤„äºæ­£å¸¸çŠ¶æ€ã€‚è¿™ä¸¤å€¼ä¸è¢«æ­£å¸¸LACPåè®®ä½¿ç”¨ï¼Œä»…ç”¨äºè¯Šæ–­åè®®é—®é¢˜ Reservedï¼ˆä¿ç•™å­—æ®µï¼‰ 3 å¯ç”¨äºåŠŸèƒ½è°ƒè¯•ä»¥åŠæ‰©å±• TLV_Type&#x3D;Partner Informationï¼ˆTLVç±»å‹&#x3D;Partnerä¿¡æ¯ï¼‰ 1 æ ‡è¯†TLVçš„ç±»å‹ï¼Œå€¼ä¸º0x02ä»£è¡¨Partnerå­—æ®µ Partner_Information_Lengthï¼ˆPartnerä¿¡æ¯å­—æ®µé•¿åº¦ï¼‰ 1 å–å€¼ä¸º20ï¼ˆå³0x14ï¼‰ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½ Partner_System_Priorityï¼ˆå¯¹ç«¯ç³»ç»Ÿä¼˜å…ˆçº§ï¼‰ 2 å¯¹ç«¯ç³»ç»Ÿä¼˜å…ˆçº§ Partner_Systemï¼ˆå¯¹ç«¯ç³»ç»ŸIDï¼‰ 6 å¯¹ç«¯ç³»ç»Ÿçš„MACåœ°å€ Partner_Keyï¼ˆå¯¹ç«¯ç«¯å£Keyå€¼ï¼‰ 2 å¯¹ç«¯ç«¯å£Keyå€¼ Partner_Port_Priorityï¼ˆå¯¹ç«¯æ¥å£ä¼˜å…ˆçº§ï¼‰ 2 å¯¹ç«¯æ¥å£ä¼˜å…ˆçº§ Partner_Portï¼ˆå¯¹ç«¯ç«¯å£å·ï¼‰ 2 å¯¹ç«¯ç«¯å£å· Partner_Stateï¼ˆå¯¹ç«¯çŠ¶æ€ä¿¡æ¯ï¼‰ 2 å¯¹ç«¯çŠ¶æ€ä¿¡æ¯ï¼Œä¸Actor_Stateå­—æ®µå«ä¹‰ä¸€è‡´ Reservedï¼ˆä¿ç•™å­—æ®µï¼‰ 3 å¯ç”¨äºåŠŸèƒ½è°ƒè¯•ä»¥åŠæ‰©å±• TLV_Type&#x3D;Collector Informationï¼ˆTLVç±»å‹&#x3D;Collectorä¿¡æ¯ï¼‰ 1 æ ‡è¯†TLVçš„ç±»å‹ï¼Œå€¼ä¸º0x03ä»£è¡¨Collectorå­—æ®µ Collector_Information_Lengthï¼ˆCollectorä¿¡æ¯å­—æ®µé•¿åº¦ï¼‰ 1 å–å€¼ä¸º16ï¼ˆå³0x10ï¼‰ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½ CollectorMaxDelayï¼ˆæœ€å¤§å»¶æ—¶ï¼‰ 2 ä»¥10å¾®ç§’ä¸ºå•ä½ Reservedï¼ˆä¿ç•™å­—æ®µï¼‰ 12 å¯ç”¨äºåŠŸèƒ½è°ƒè¯•ä»¥åŠæ‰©å±• TLV_Type&#x3D;Terminator Informationï¼ˆTLVç±»å‹&#x3D;Terminatorä¿¡æ¯ï¼‰ 1 æ ‡è¯†TLVçš„ç±»å‹ï¼Œå€¼ä¸º0x00ä»£è¡¨Terminatorå­—æ®µ Terminator_Lengthï¼ˆTerminatorä¿¡æ¯å­—æ®µé•¿åº¦ï¼‰ 1 å–å€¼ä¸º0ï¼ˆå³0x00ï¼‰ Reservedï¼ˆä¿ç•™å­—æ®µï¼‰ 50 å…¨ç½®0ï¼Œæ¥æ”¶ç«¯å¿½ç•¥æ­¤å­—æ®µ FCSï¼ˆå¸§æ ¡éªŒåºåˆ—ï¼‰ 4 ç”¨äºå¸§å†…åç»­å­—èŠ‚å·®é”™çš„å¾ªç¯ 1.ä¸¤ç«¯äº’ç›¸å‘é€LACPDUæŠ¥æ–‡ åœ¨DeviceAå’ŒDeviceBä¸Šåˆ›å»ºEth-Trunkå¹¶é…ç½®ä¸ºLACPæ¨¡å¼ï¼Œç„¶åå‘Eth-Trunkä¸­æ‰‹å·¥åŠ å…¥æˆå‘˜æ¥å£ã€‚æ­¤æ—¶æˆå‘˜æ¥å£ä¸Šä¾¿å¯ç”¨äº†LACPåè®®ï¼Œä¸¤ç«¯äº’å‘LACPDUæŠ¥æ–‡ã€‚ ä»¥DeviceBä¸ºä¾‹ï¼Œå½“DeviceBæ”¶åˆ°DeviceAå‘é€çš„æŠ¥æ–‡æ—¶ï¼ŒDeviceBä¼šæŸ¥çœ‹å¹¶è®°å½•å¯¹ç«¯ä¿¡æ¯ï¼Œç„¶åæ¯”è¾ƒç³»ç»Ÿä¼˜å…ˆçº§å­—æ®µï¼Œå¦‚æœDeviceAçš„ç³»ç»Ÿä¼˜å…ˆçº§é«˜äºæœ¬ç«¯çš„ç³»ç»Ÿä¼˜å…ˆçº§ï¼Œåˆ™ç¡®å®šDeviceAä¸ºLACPä¸»åŠ¨ç«¯ã€‚å¦‚æœDeviceAå’ŒDeviceBçš„ç³»ç»Ÿä¼˜å…ˆçº§ç›¸åŒï¼Œæ¯”è¾ƒä¸¤ç«¯è®¾å¤‡çš„MACåœ°å€ï¼Œç¡®å®šMACåœ°å€å°çš„ä¸€ç«¯ä¸ºLACPä¸»åŠ¨ç«¯ã€‚ é€‰å‡ºä¸»åŠ¨ç«¯åï¼Œä¸¤ç«¯éƒ½ä¼šä»¥ä¸»åŠ¨ç«¯çš„æ¥å£ä¼˜å…ˆçº§æ¥é€‰æ‹©æ´»åŠ¨æ¥å£ï¼Œä¸¤ç«¯è®¾å¤‡é€‰æ‹©äº†ä¸€è‡´çš„æ´»åŠ¨æ¥å£ï¼Œæ´»åŠ¨é“¾è·¯ç»„ä¾¿å¯ä»¥å»ºç«‹èµ·æ¥ï¼Œä»è¿™äº›æ´»åŠ¨é“¾è·¯ä¸­ä»¥è´Ÿè½½åˆ†æ‹…çš„æ–¹å¼è½¬å‘æ•°æ®ã€‚ 2.ç¡®å®šä¸»åŠ¨ç«¯(åŸºäºç³»ç»Ÿä¼˜å…ˆçº§å’ŒMAC)å’Œæ´»åŠ¨é“¾è·¯ï¼ˆåŸºäºæ¥å£ä¼˜å…ˆçº§ï¼‰ ä¸¤ç«¯è®¾å¤‡å‡ä¼šæ”¶åˆ°å¯¹ç«¯å‘æ¥çš„LACPDUæŠ¥æ–‡ã€‚ä»¥DeviceBä¸ºä¾‹ï¼Œå½“DeviceBæ”¶åˆ°DeviceAå‘é€çš„æŠ¥æ–‡æ—¶ï¼ŒDeviceBä¼šæŸ¥çœ‹å¹¶è®°å½•å¯¹ç«¯ä¿¡æ¯ï¼Œç„¶åæ¯”è¾ƒç³»ç»Ÿä¼˜å…ˆçº§å­—æ®µï¼Œå¦‚æœDeviceAçš„ç³»ç»Ÿä¼˜å…ˆçº§é«˜äºæœ¬ç«¯çš„ç³»ç»Ÿä¼˜å…ˆçº§ï¼Œåˆ™ç¡®å®šDeviceAä¸ºLACPä¸»åŠ¨ç«¯ã€‚å¦‚æœDeviceAå’ŒDeviceBçš„ç³»ç»Ÿä¼˜å…ˆçº§ç›¸åŒï¼Œæ¯”è¾ƒä¸¤ç«¯è®¾å¤‡çš„MACåœ°å€ï¼Œç¡®å®šMACåœ°å€å°çš„ä¸€ç«¯ä¸ºLACPä¸»åŠ¨ç«¯ã€‚ é€‰å‡ºä¸»åŠ¨ç«¯åï¼Œä¸¤ç«¯éƒ½ä¼šä»¥ä¸»åŠ¨ç«¯çš„æ¥å£ä¼˜å…ˆçº§æ¥é€‰æ‹©æ´»åŠ¨æ¥å£ï¼Œä¸¤ç«¯è®¾å¤‡é€‰æ‹©äº†ä¸€è‡´çš„æ´»åŠ¨æ¥å£ï¼Œæ´»åŠ¨é“¾è·¯ç»„ä¾¿å¯ä»¥å»ºç«‹èµ·æ¥ï¼Œä»è¿™äº›æ´»åŠ¨é“¾è·¯ä¸­ä»¥è´Ÿè½½åˆ†æ‹…çš„æ–¹å¼è½¬å‘æ•°æ®ã€‚ 3.LACPæŠ¢å ï¼ˆç¼ºçœä¸æŠ¢å ï¼‰ ä½¿èƒ½LACPæŠ¢å åŠŸèƒ½åï¼Œèšåˆç»„ä¼šå§‹ç»ˆä¿æŒé«˜ä¼˜å…ˆçº§çš„æ¥å£ä½œä¸ºæ´»åŠ¨æ¥å£çš„çŠ¶æ€ã€‚ æ¥å£Port1ã€Port2å’ŒPort3ä¸ºEth-Trunkçš„æˆå‘˜æ¥å£ï¼ŒDeviceAä¸ºä¸»åŠ¨ç«¯ï¼Œæ´»åŠ¨æ¥å£æ•°ä¸Šé™é˜ˆå€¼ä¸º2ï¼Œä¸‰ä¸ªæ¥å£çš„LACPä¼˜å…ˆçº§åˆ†åˆ«ä¸º10ã€20ã€30ã€‚å½“é€šè¿‡LACPåè®®åå•†å®Œæ¯•åï¼Œæ¥å£Port1å’ŒPort2å› ä¸ºä¼˜å…ˆçº§è¾ƒé«˜è¢«é€‰ä½œæ´»åŠ¨æ¥å£ï¼ŒPort3æˆä¸ºå¤‡ä»½æ¥å£ã€‚ ä»¥ä¸‹ä¸¤ç§æƒ…å†µéœ€è¦ä½¿èƒ½LACPçš„æŠ¢å åŠŸèƒ½ã€‚ Port1æ¥å£å‡ºç°æ•…éšœè€Œååˆæ¢å¤äº†æ­£å¸¸ã€‚å½“æ¥å£Port1å‡ºç°æ•…éšœæ—¶è¢«Port3æ‰€å–ä»£ï¼Œå¦‚æœåœ¨Eth-Trunkæ¥å£ä¸‹æœªä½¿èƒ½LACPæŠ¢å åŠŸèƒ½ï¼Œåˆ™æ•…éšœæ¢å¤æ—¶Port1å°†å¤„äºå¤‡ä»½çŠ¶æ€ï¼›å¦‚æœä½¿èƒ½äº†LACPæŠ¢å åŠŸèƒ½ï¼Œå½“Port1æ•…éšœæ¢å¤æ—¶ï¼Œç”±äºæ¥å£ä¼˜å…ˆçº§æ¯”Port3é«˜ï¼Œå°†é‡æ–°æˆä¸ºæ´»åŠ¨æ¥å£ï¼ŒPort3å†æ¬¡æˆä¸ºå¤‡ä»½æ¥å£ã€‚ å¦‚æœå¸Œæœ›Port3æ¥å£æ›¿æ¢Port1ã€Port2ä¸­çš„ä¸€ä¸ªæ¥å£æˆä¸ºæ´»åŠ¨æ¥å£ï¼Œå¯ä»¥ä½¿èƒ½äº†LACPæŠ¢å åŠŸèƒ½ï¼Œå¹¶é…ç½®Port3çš„æ¥å£LACPä¼˜å…ˆçº§è¾ƒé«˜ã€‚å¦‚æœæ²¡æœ‰ä½¿èƒ½LACPæŠ¢å åŠŸèƒ½ï¼Œå³ä½¿å°†å¤‡ä»½æ¥å£çš„ä¼˜å…ˆçº§è°ƒæ•´ä¸ºé«˜äºå½“å‰æ´»åŠ¨æ¥å£çš„ä¼˜å…ˆçº§ï¼Œç³»ç»Ÿä¹Ÿä¸ä¼šè¿›è¡Œé‡æ–°é€‰æ‹©æ´»åŠ¨æ¥å£çš„è¿‡ç¨‹ï¼Œä¸åˆ‡æ¢æ´»åŠ¨æ¥å£ã€‚ LACPæŠ¢å å»¶æ—¶ï¼ˆé»˜è®¤30sï¼Œ10-180ï¼‰ æŠ¢å å»¶æ—¶æ˜¯LACPæŠ¢å å‘ç”Ÿæ—¶ï¼Œå¤„äºå¤‡ç”¨çŠ¶æ€çš„é“¾è·¯å°†ä¼šç­‰å¾…ä¸€æ®µæ—¶é—´åå†åˆ‡æ¢åˆ°è½¬å‘çŠ¶æ€ã€‚é…ç½®æŠ¢å å»¶æ—¶æ˜¯ä¸ºäº†é¿å…ç”±äºæŸäº›é“¾è·¯çŠ¶æ€é¢‘ç¹å˜åŒ–è€Œå¯¼è‡´Eth-Trunkæ•°æ®ä¼ è¾“ä¸ç¨³å®šçš„æƒ…å†µã€‚ Port1ç”±äºé“¾è·¯æ•…éšœåˆ‡æ¢ä¸ºéæ´»åŠ¨æ¥å£ï¼Œæ­¤åè¯¥é“¾è·¯åˆæ¢å¤äº†æ­£å¸¸ã€‚è‹¥ç³»ç»Ÿä½¿èƒ½äº†LACPæŠ¢å åŠŸèƒ½å¹¶é…ç½®äº†æŠ¢å å»¶æ—¶ï¼ŒPort1é‡æ–°åˆ‡æ¢å›æ´»åŠ¨çŠ¶æ€å°±éœ€è¦ç»è¿‡æŠ¢å å»¶æ—¶çš„æ—¶é—´ã€‚ LACP æŠ¢å å»¶æ—¶çš„å–å€¼èŒƒå›´é€šå¸¸æ˜¯10ï½180ç§’ã€‚ LACP æŠ¢å å»¶æ—¶æ˜¯æŒ‡åœ¨å¯ç”¨ LACP æŠ¢å åŠŸèƒ½åï¼Œå½“é«˜ä¼˜å…ˆçº§çš„é“¾è·¯æ¢å¤æ­£å¸¸ï¼Œä¸”å½“å‰æ´»åŠ¨é“¾è·¯æ•°å·²è¾¾åˆ°ä¸Šé™é˜ˆå€¼æ—¶ï¼Œç­‰å¾…å¤šä¹…åé«˜ä¼˜å…ˆçº§é“¾è·¯æ‰ä¼šå–ä»£ä½ä¼˜å…ˆçº§é“¾è·¯æˆä¸ºæ´»åŠ¨é“¾è·¯ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒLACP æŠ¢å ç­‰å¾…æ—¶é—´é€šå¸¸ä¸º30ç§’ã€‚ä½†è¿™ä¸ªæ—¶é—´å¯ä»¥æ ¹æ®å…·ä½“éœ€æ±‚è¿›è¡Œé…ç½®ï¼Œé€šè¿‡åœ¨Eth-Trunkæ¥å£è§†å›¾ä¸‹ä½¿ç”¨â€œlacp preempt delay delay-timeâ€å‘½ä»¤æ¥è®¾ç½®ï¼Œå…¶ä¸­â€œdelay-timeâ€ä¸ºå…·ä½“çš„æ—¶é—´å€¼ï¼Œå•ä½æ˜¯ç§’ã€‚ é…ç½®æŠ¢å å»¶æ—¶åŠŸèƒ½å¯ä»¥é¿å…ç”±äºé“¾è·¯çŠ¶æ€é¢‘ç¹å˜åŒ–è€Œå¯¼è‡´çš„æ•°æ®ä¼ è¾“ä¸ç¨³å®šã€‚ä½†éœ€æ³¨æ„ï¼Œé…ç½®æŠ¢å å»¶æ—¶éœ€è¦ç¡®ä¿å½“å‰çš„Eth-Trunkå·¥ä½œæ¨¡å¼ä¸ºLACPæ¨¡å¼ï¼Œå¹¶ä¸”å·²ç»ä½¿èƒ½äº†ä¼˜å…ˆçº§æŠ¢å ï¼Œå¦åˆ™é…ç½®ä¸ç”Ÿæ•ˆã€‚è¦ä½¿èƒ½ä¼˜å…ˆçº§æŠ¢å ï¼Œå¯åœ¨Eth-Trunkæ¥å£è§†å›¾ä¸‹æ‰§è¡Œâ€œlacp preempt enableâ€å‘½ä»¤ã€‚ æ´»åŠ¨é“¾è·¯ä¸éæ´»åŠ¨é“¾è·¯åˆ‡æ¢ LACPæ¨¡å¼é“¾è·¯èšåˆç»„ä¸¤ç«¯è®¾å¤‡ä¸­ä»»ä½•ä¸€ç«¯æ£€æµ‹åˆ°ä»¥ä¸‹äº‹ä»¶ï¼Œéƒ½ä¼šè§¦å‘èšåˆç»„çš„é“¾è·¯åˆ‡æ¢ï¼š é“¾è·¯Downäº‹ä»¶ã€‚ ä»¥å¤ªç½‘OAMæ£€æµ‹åˆ°é“¾è·¯å¤±æ•ˆã€‚ LACPåè®®å‘ç°é“¾è·¯æ•…éšœã€‚ æ¥å£ä¸å¯ç”¨ã€‚ åœ¨ä½¿èƒ½äº†LACPæŠ¢å åŠŸèƒ½çš„å‰æä¸‹ï¼Œæ›´æ”¹å¤‡ä»½æ¥å£çš„ä¼˜å…ˆçº§é«˜äºå½“å‰æ´»åŠ¨æ¥å£çš„ä¼˜å…ˆçº§ã€‚ å½“æ»¡è¶³ä¸Šè¿°åˆ‡æ¢æ¡ä»¶å…¶ä¸­ä¹‹ä¸€æ—¶ï¼ŒæŒ‰ç…§å¦‚ä¸‹æ­¥éª¤è¿›è¡Œåˆ‡æ¢ï¼š å…³é—­æ•…éšœé“¾è·¯ã€‚ ä»Næ¡å¤‡ä»½é“¾è·¯ä¸­é€‰æ‹©ä¼˜å…ˆçº§æœ€é«˜çš„é“¾è·¯æ¥æ›¿æ´»åŠ¨é“¾è·¯ä¸­çš„æ•…éšœé“¾è·¯ã€‚ ä¼˜å…ˆçº§æœ€é«˜çš„å¤‡ä»½é“¾è·¯è½¬ä¸ºæ´»åŠ¨çŠ¶æ€å¹¶è½¬å‘æ•°æ®ï¼Œå®Œæˆåˆ‡æ¢ã€‚ é…ç½® é…ç½®æ‰‹å·¥é“¾è·¯èšåˆ# åˆ›å»ºEth-Trunkæ¥å£ [S1]interface Eth-Trunk 1 interface eth-trunkå‘½ä»¤ç”¨æ¥è¿›å…¥å·²ç»å­˜åœ¨çš„Eth-Trunkæ¥å£ï¼Œæˆ–åˆ›å»ºå¹¶è¿›å…¥Eth-Trunkæ¥å£ã€‚æ•°å­—â€œ1â€ä»£è¡¨æ¥å£ç¼–å·ï¼Œç¼–å·èŒƒå›´æ ¹æ®è®¾å¤‡æƒ…å†µæœ‰æ‰€ä¸åŒã€‚ [S2]interface Eth-Trunk 1 # è®¾ç½®Eth-Trunkæ¥å£çš„èšåˆæ¨¡å¼ [S1-Eth-Trunk1]mode manual load-balance modeå‘½ä»¤ç”¨æ¥é…ç½®Eth-Trunkçš„å·¥ä½œæ¨¡å¼ï¼Œæœ‰LACPæ¨¡å¼å’Œæ‰‹å·¥è´Ÿè½½åˆ†æ‹…æ¨¡å¼ï¼ˆæ‰‹å·¥æ¨¡å¼ï¼‰ä¸¤ç§ï¼Œç¼ºçœæƒ…å†µä¸‹ï¼ŒEth-Trunkçš„å·¥ä½œæ¨¡å¼ä¸ºæ‰‹å·¥è´Ÿè½½åˆ†æ‹…æ¨¡å¼ã€‚æ­¤å¤„S1ä¸Šçš„æ¨¡å¼é…ç½®ä»…ä¸ºç¤ºèŒƒç›®çš„ï¼Œå®é™…æ“ä½œæ—¶ä¸éœ€è¦ã€‚ # å°†æˆå‘˜æ¥å£åŠ å…¥èšåˆç»„ [S1]interface GigabitEthernet 0&#x2F;0&#x2F;10 [S1-GigabitEthernet0&#x2F;0&#x2F;10]eth-trunk 1 Info: This operation may take a few seconds. Please wait for a momentâ€¦done. [S1-GigabitEthernet0&#x2F;0&#x2F;10]quit [S1]interface GigabitEthernet 0&#x2F;0&#x2F;11 [S1-GigabitEthernet0&#x2F;0&#x2F;11]eth-trunk 1 Info: This operation may take a few seconds. Please wait for a momentâ€¦done. [S1-GigabitEthernet0&#x2F;0&#x2F;11]quit [S1]interface GigabitEthernet 0&#x2F;0&#x2F;12 [S1-GigabitEthernet0&#x2F;0&#x2F;12]eth-trunk 1 Info: This operation may take a few seconds. Please wait for a momentâ€¦done. [S1-GigabitEthernet0&#x2F;0&#x2F;12]quit å¯è¿›å…¥åˆ°æˆå‘˜æ¥å£çš„æ¥å£è§†å›¾ä¸‹ï¼Œé€ä¸€æ·»åŠ åˆ°Eth-Trunkæ¥å£ã€‚ä¹Ÿå¯ä»¥åœ¨Eth-Trunkæ¥å£è§†å›¾ä¸‹é€šè¿‡trunkportå‘½ä»¤æ‰¹é‡æ·»åŠ æ¥å£ã€‚ [S2]interface Eth-Trunk 1 [S2-Eth-Trunk1]trunkport GigabitEthernet 0&#x2F;0&#x2F;10 to 0&#x2F;0&#x2F;12 Info: This operation may take a few seconds. Please wait for a momentâ€¦done. å°†æˆå‘˜æ¥å£åŠ å…¥Eth-Trunkæ—¶ï¼Œéœ€è¦æ³¨æ„ä»¥ä¸‹é—®é¢˜ï¼š â€¢ æ¯ä¸ªEth-Trunkæ¥å£ä¸‹æœ€å¤šå¯ä»¥åŒ…å«8ä¸ªæˆå‘˜æ¥å£ã€‚ â€¢ Eth-Trunkæ¥å£ä¸èƒ½åµŒå¥—ï¼Œå³Eth-Trunkæ¥å£çš„æˆå‘˜æ¥å£ä¸èƒ½æ˜¯Eth-Trunkæ¥å£ã€‚ â€¢ ä¸€ä¸ªä»¥å¤ªç½‘æ¥å£åªèƒ½åŠ å…¥åˆ°ä¸€ä¸ªEth-Trunkæ¥å£ï¼Œå¦‚æœéœ€è¦åŠ å…¥å…¶å®ƒEth-Trunkæ¥å£ï¼Œå¿…é¡»å…ˆé€€å‡ºåŸæ¥çš„Eth-Trunkæ¥å£ã€‚ â€¢ å¦‚æœæœ¬åœ°è®¾å¤‡ä½¿ç”¨äº†Eth-Trunkï¼Œä¸æˆå‘˜æ¥å£ç›´è¿çš„å¯¹ç«¯æ¥å£ä¹Ÿå¿…é¡»æ†ç»‘ä¸ºEth-Trunkæ¥å£ï¼Œä¸¤ç«¯æ‰èƒ½æ­£å¸¸é€šä¿¡ã€‚ Eth-Trunké“¾è·¯ä¸¤ç«¯ç›¸è¿çš„ç‰©ç†æ¥å£çš„æ•°é‡ã€é€Ÿç‡ã€åŒå·¥æ–¹å¼ç­‰å¿…é¡»ä¸€è‡´ã€‚ #æŸ¥çœ‹Eth-Trunkæ¥å£çŠ¶æ€ dis eth-trunk 1 é…ç½®LACPæ¨¡å¼# åˆ é™¤ç°æœ‰Eth-Trunkæ¥å£ä¸‹çš„æˆå‘˜æ¥å£ [S1]interface Eth-Trunk 1 [S1-Eth-Trunk1]undo trunkport GigabitEthernet 0&#x2F;0&#x2F;10 to 0&#x2F;0&#x2F;12 [S2]interface Eth-Trunk 1 [S2-Eth-Trunk1]undo trunkport GigabitEthernet 0&#x2F;0&#x2F;10 to 0&#x2F;0&#x2F;12 åœ¨ä¿®æ”¹Eth-Trunkæ¥å£çš„èšåˆæ¨¡å¼ä¹‹å‰ï¼Œéœ€è¦ç¡®ä¿Eth-Trunkä¸­æ²¡æœ‰ä»»ä½•æˆå‘˜æ¥å£ã€‚ # ä¿®æ”¹èšåˆæ¨¡å¼ [S1]interface Eth-Trunk 1 [S1-Eth-Trunk1]mode lacp mode lacp æŒ‡å®šEth-Trunkå·¥ä½œæ¨¡å¼ä¸ºLACPæ¨¡å¼ã€‚ æ³¨ï¼šéƒ¨åˆ†ç‰ˆæœ¬çš„è®¾å¤‡å‘½ä»¤ä¸º mode lacp-static [S2]interface Eth-Trunk 1 [S2-Eth-Trunk1]mode lacp # å°†æˆå‘˜æ¥å£åŠ å…¥èšåˆç»„ [S1]interface Eth-Trunk 1 [S1-Eth-Trunk1]trunkport GigabitEthernet 0&#x2F;0&#x2F;10 to 0&#x2F;0&#x2F;12 [S2]interface Eth-Trunk 1 [S2-Eth-Trunk1]trunkport GigabitEthernet 0&#x2F;0&#x2F;10 to 0&#x2F;0&#x2F;12 æŸ¥çœ‹ æ³¨æ„æ­¤æ—¶ä¸‰ä¸ªæ¥å£éƒ½æ˜¯Selectçš„çŠ¶æ€ é€‰æ‹©æ¥å£â€‹ è€ƒè™‘åˆ°ç½‘ç»œæµé‡æƒ…å†µï¼Œå½“ç½‘ç»œæ­£å¸¸æ—¶ï¼Œåªéœ€è¦GigabitEthernet0&#x2F;0&#x2F;11å’ŒGigabitEthernet0&#x2F;0&#x2F;12æ¥å£å¤„äºè½¬å‘çŠ¶æ€ï¼ŒGigabitEthernet0&#x2F;0&#x2F;10æ¥å£ä½œä¸ºå¤‡ä»½ã€‚ä½†å½“æ´»åŠ¨æ¥å£æ•°é‡å°‘äº2æ—¶ï¼Œç›´æ¥å…³é—­æ•´ä¸ªEth-Trunkæ¥å£ã€‚ å…¨å±€é…ç½®ä¼˜å…ˆçº§é€‰ä¸¾ä¸»åŠ¨æ–¹ï¼Œä¸»åŠ¨æ–¹è®¾å¤‡çš„ç«¯å£ä¸Šé…ç½®æ¥å£ä¼˜å…ˆçº§é€‰ä¸¾æ´»åŠ¨ç«¯å£ # é…ç½®è®¾å¤‡S1çš„LACPä¼˜å…ˆçº§ï¼Œä½¿å…¶æˆä¸ºä¸»åŠ¨ç«¯è®¾å¤‡ [S1]lacp priority 100 # é…ç½®æ¥å£ä¼˜å…ˆçº§ï¼Œä¼˜é€‰GigabitEthernet0&#x2F;0&#x2F;11å’ŒGigabitEthernet0&#x2F;0&#x2F;12æ¥å£ [S1]interface GigabitEthernet 0&#x2F;0&#x2F;10 [S1-GigabitEthernet0&#x2F;0&#x2F;10]lacp priority 40000 # é…ç½®æ¥å£ä¼˜å…ˆçº§ï¼Œä¼˜é€‰GigabitEthernet0&#x2F;0&#x2F;11å’ŒGigabitEthernet0&#x2F;0&#x2F;12æ¥å£ [S1]interface GigabitEthernet 0&#x2F;0&#x2F;10 [S1-GigabitEthernet0&#x2F;0&#x2F;10]lacp priority 40000 g0&#x2F;0&#x2F;10é…ç½®äº†å¤§äº32768çš„ä¼˜å…ˆçº§4000ï¼Œæ‰€ä»¥å˜ä¸ºå¤‡ä»½ç«¯å£ ä¹‹åï¼Œg0&#x2F;0&#x2F;11å’Œg0&#x2F;0&#x2F;12ä¸ºæ´»åŠ¨ç«¯å£ ä½¿èƒ½äº†LACPæ¨¡å¼é“¾è·¯èšåˆçš„ä¸¤ç«¯è®¾å¤‡å‡ä¼šæ”¶å‘çš„LACPDUæŠ¥æ–‡ã€‚ é¦–å…ˆé€‰ä¸¾ä¸»åŠ¨ç«¯è®¾å¤‡ï¼š æ¯”è¾ƒç³»ç»Ÿä¼˜å…ˆçº§å­—æ®µï¼Œå¦‚æœå¯¹ç«¯çš„ç³»ç»Ÿä¼˜å…ˆçº§é«˜äºæœ¬ç«¯çš„ç³»ç»Ÿä¼˜å…ˆçº§ï¼ˆé»˜è®¤ä¸º32768ï¼Œè¶Šå°è¶Šä¼˜ï¼‰ï¼Œåˆ™ç¡®å®šå¯¹ç«¯ä¸ºLACPä¸»åŠ¨ç«¯ã€‚ å¦‚æœç³»ç»Ÿä¼˜å…ˆçº§ç›¸åŒï¼Œæ¯”è¾ƒä¸¤ç«¯è®¾å¤‡çš„MACåœ°å€ï¼ŒMACåœ°å€å°çš„ä¸€ç«¯ä¸ºLACPä¸»åŠ¨ç«¯ã€‚ é€‰å‡ºä¸»åŠ¨ç«¯åï¼Œä¸¤ç«¯éƒ½ä¼šä»¥ä¸»åŠ¨ç«¯çš„æ¥å£ä¼˜å…ˆçº§æ¥é€‰æ‹©æ´»åŠ¨æ¥å£ï¼Œæ¥å£ä¼˜å…ˆçº§è¶Šå°è¶Šä¼˜ï¼Œé»˜è®¤ä¸º32768ã€‚ # é…ç½®Eth-trunkæ´»åŠ¨æ¥å£æ•°ä¸Šé™é˜ˆå€¼å’Œä¸‹é™é˜ˆå€¼ [S1]interface Eth-Trunk 1 [S1-Eth-Trunk1]max active-linknumber 2 [S1-Eth-Trunk1]least active-linknumber 2 åœ¨ä¸€ä¸ªEth-Trunkæ¥å£å†…ï¼Œæ´»åŠ¨æ¥å£æ•°å¯ä»¥å½±å“åˆ°Eth-Trunkæ¥å£çš„çŠ¶æ€å’Œå¸¦å®½ã€‚Eth-Trunkæ¥å£çš„å¸¦å®½æ˜¯æ‰€æœ‰å¤„äºUpçŠ¶æ€çš„æˆå‘˜å£å¸¦å®½ä¹‹å’Œã€‚ä¸ºä¿è¯Eth-Trunkæ¥å£çš„çŠ¶æ€å’Œå¸¦å®½ï¼Œå¯ä»¥è®¾ç½®ä»¥ä¸‹ä¸¤ä¸ªé˜ˆå€¼ï¼Œä»¥å‡å°æˆå‘˜é“¾è·¯çŠ¶æ€çš„å˜åŒ–å¸¦æ¥çš„å½±å“ã€‚ â€¢ æ´»åŠ¨æ¥å£æ•°ä¸‹é™é˜ˆå€¼ï¼šå½“æ´»åŠ¨æ¥å£æ•°å°äºé…ç½®çš„ä¸‹é™é˜ˆå€¼æ—¶ï¼ŒEth-Trunkæ¥å£çš„çŠ¶æ€è½¬ä¸ºDownã€‚è®¾ç½®æ´»åŠ¨æ¥å£æ•°ä¸‹é™é˜ˆå€¼çš„ç›®çš„æ˜¯ä¸ºäº†ä¿è¯æœ€å°å¸¦å®½ã€‚least active-linknumberå‘½ä»¤ç”¨æ¥é…ç½®é“¾è·¯èšåˆç»„æ´»åŠ¨æ¥å£æ•°ç›®çš„ä¸‹é™é˜ˆå€¼ã€‚ â€¢ æ´»åŠ¨æ¥å£æ•°ä¸Šé™é˜ˆå€¼ï¼šå½“æ´»åŠ¨æ¥å£æ•°è¾¾åˆ°ä¸Šé™é˜ˆå€¼åï¼Œä¹‹åå†å‘ç”Ÿæˆå‘˜é“¾è·¯çŠ¶æ€å˜ä¸ºUpéƒ½ä¸ä¼šä½¿Eth-Trunkæ¥å£çš„å¸¦å®½å¢åŠ ã€‚è®¾ç½®æ´»åŠ¨æ¥å£æ•°ä¸Šé™é˜ˆå€¼çš„ç›®çš„æ˜¯åœ¨ä¿è¯äº†å¸¦å®½çš„æƒ…å†µä¸‹æé«˜ç½‘ç»œçš„å¯é æ€§ã€‚max active-linknumberå‘½ä»¤ç”¨æ¥é…ç½®é“¾è·¯èšåˆç»„æ´»åŠ¨æ¥å£æ•°ç›®çš„ä¸Šé™é˜ˆå€¼ã€‚ # å¼€å¯æŠ¢å åŠŸèƒ½ [S1]interface Eth-Trunk 1 [S1-Eth-Trunk1]lacp preempt enable åœ¨LACPæ¨¡å¼ä¸‹ï¼Œå½“æ´»åŠ¨é“¾è·¯ä¸­å‡ºç°æ•…éšœé“¾è·¯æ—¶ï¼Œç³»ç»Ÿä¼šä»å¤‡ç”¨é“¾è·¯ä¸­é€‰æ‹©ä¼˜å…ˆçº§æœ€é«˜çš„é“¾è·¯æ›¿ä»£æ•…éšœé“¾è·¯ï¼›å¦‚æœè¢«æ›¿ä»£çš„æ•…éšœé“¾è·¯æ¢å¤äº†æ­£å¸¸ï¼Œè€Œä¸”è¯¥é“¾è·¯çš„ä¼˜å…ˆçº§åˆé«˜äºæ›¿ä»£è‡ªå·±çš„é“¾è·¯ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœä½¿èƒ½äº†LACPä¼˜å…ˆçº§æŠ¢å åŠŸèƒ½ï¼Œé«˜ä¼˜å…ˆçº§é“¾è·¯ä¼šæŠ¢å ä½ä¼˜å…ˆçº§é“¾è·¯ï¼Œå›åˆ‡åˆ°æ´»åŠ¨çŠ¶æ€ã€‚lacp preempt enableå‘½ä»¤ç”¨æ¥ä½¿èƒ½LACPæ¨¡å¼ä¸‹LACPä¼˜å…ˆçº§æŠ¢å çš„åŠŸèƒ½ï¼Œç¼ºçœæƒ…å†µä¸‹ï¼Œä¼˜å…ˆçº§æŠ¢å å¤„äºç¦æ­¢çŠ¶æ€ã€‚ # æŸ¥çœ‹å½“å‰ Eth-Trunkæ¥å£çŠ¶æ€ shutdownæ¥å£g0&#x2F;0&#x2F;11å’Œg0&#x2F;0&#x2F;12 æŸ¥çœ‹çŠ¶æ€ï¼Œå‘ç°éƒ½å˜ä¸ºunselectçŠ¶æ€ ç”±äºè®¾ç½®äº†Eth-Trunkçš„æ´»åŠ¨é“¾è·¯ä¸‹é™é˜ˆå€¼ä¸º2ï¼Œæ‰€ä»¥èšåˆç»„ä¸­å¯ç”¨æ´»åŠ¨æ¥å£æ•°é‡å°‘äº2æ—¶ï¼Œæ•´ä¸ªèšåˆç»„å¯¹åº”çš„æ¥å£å°†ä¼šè¢«å…³é—­ã€‚å°½ç®¡æ­¤æ—¶GigabitEthernet0&#x2F;0&#x2F;10å¤„äºUPçŠ¶æ€ï¼Œä½†æ˜¯ä»å¤„äºUnselectçŠ¶æ€ã€‚ ä¿®æ”¹è´Ÿè½½åˆ†æ‹…æ¨¡å¼# å¼€å¯ä¸Šä¸€æ­¥ä¸­å…³é—­çš„æ¥å£ [S1]inter GigabitEthernet 0&#x2F;0&#x2F;11 [S1-GigabitEthernet0&#x2F;0&#x2F;11]undo shutdown [S1-GigabitEthernet0&#x2F;0&#x2F;11]quit [S1]inter GigabitEthernet 0&#x2F;0&#x2F;12 [S1-GigabitEthernet0&#x2F;0&#x2F;12]undo shutdown # å¤§çº¦30ç§’åï¼ŒæŸ¥çœ‹å½“å‰Eth-Trunk1çš„æ¥å£çŠ¶æ€ ç”±äºä½¿èƒ½äº†Eth-Trunkæ¥å£çš„æŠ¢å åŠŸèƒ½ï¼Œæ‰€ä»¥å½“GigabitEthernet0&#x2F;0&#x2F;11å’ŒGigabitEthernet0&#x2F;0&#x2F;12æ¥å£è¿›å…¥UPçŠ¶æ€ä¹‹åï¼Œè¿™ä¸¤ä¸ªæ¥å£çš„æ¥å£çš„ä¼˜å…ˆçº§é«˜äºGigabitEthernet0&#x2F;0&#x2F;10ï¼Œæ‰€ä»¥GigabitEthernet0&#x2F;0&#x2F;10ä¼šè¿›å…¥unselectçŠ¶æ€ã€‚åŒæ—¶å› ä¸ºç³»ç»Ÿä¸ºäº†ä¿è¯é“¾è·¯çš„ç¨³å®šæ€§ï¼Œé»˜è®¤çš„æŠ¢å å»¶æ—¶ä¸º30ç§’ï¼Œæ‰€ä»¥è¦åœ¨30ç§’åæ‰ä¼šå‘ç”ŸæŠ¢å ã€‚ # ä¿®æ”¹Eth-Trunkæ¥å£çš„è´Ÿè½½åˆ†æ‹…æ¨¡å¼ä¸ºåŸºäºç›®çš„IPåœ°å€ [S1]interface Eth-Trunk 1 [S1-Eth-Trunk1]load-balance dst-ip å½“éœ€è¦å°†Eth-Trunkæ¥å£çš„æµé‡åˆ†æ•£åˆ°ä¸åŒçš„é“¾è·¯ä¸Šï¼Œæœ€åèƒ½åˆ°è¾¾ç»Ÿä¸€ç›®çš„åœ°æ—¶ï¼Œä½¿ç”¨load-balanceå‘½ä»¤é…ç½®Eth-Trunkæ¥å£è´Ÿè½½åˆ†æ‹…æ¨¡å¼ï¼Œä»¥ç¡®ä¿å‡ºæ–¹å‘çš„æµé‡åœ¨å„ç‰©ç†é“¾è·¯é—´è¿›è¡Œåˆç†çš„è´Ÿè½½åˆ†æ‹…ï¼Œé¿å…é“¾è·¯é˜»å¡ã€‚ç”±äºè´Ÿè½½åˆ†æ‹…åªå¯¹å‡ºæ–¹å‘çš„æµé‡æœ‰æ•ˆï¼Œå› æ­¤é“¾è·¯ä¸¤ç«¯æ¥å£çš„è´Ÿè½½åˆ†æ‹…æ¨¡å¼å¯ä»¥ä¸ä¸€è‡´ï¼Œä¸¤ç«¯äº’ä¸å½±å“","categories":[{"name":"ipå®éªŒ","slug":"ipå®éªŒ","permalink":"http://example.com/categories/ip%E5%AE%9E%E9%AA%8C/"}],"tags":[{"name":"é“¾è·¯èšåˆ","slug":"é“¾è·¯èšåˆ","permalink":"http://example.com/tags/%E9%93%BE%E8%B7%AF%E8%81%9A%E5%90%88/"},{"name":"lacp","slug":"lacp","permalink":"http://example.com/tags/lacp/"},{"name":"eth-trunk","slug":"eth-trunk","permalink":"http://example.com/tags/eth-trunk/"}]},{"title":"mplså®éªŒ","slug":"mplså®éªŒ","date":"2023-12-05T09:53:41.000Z","updated":"2023-12-05T10:56:53.373Z","comments":true,"path":"2023/12/05/mplså®éªŒ/","permalink":"http://example.com/2023/12/05/mpls%E5%AE%9E%E9%AA%8C/","excerpt":"","text":"æ¦‚å¿µMPLSï¼ˆMultiprotocol Label Switchingï¼‰å¤šåè®®æ ‡ç­¾è½¬å‘å¤ä¹ æ€»ç»“é¦–å…ˆæˆ‘ä»¬è¦å…ˆçŸ¥é“MPLSæ˜¯ä¸ºä½•å‡ºç°çš„ï¼ŸMPLSæ˜¯åŸºäºä¼ ç»ŸIPç½‘ç»œï¼ˆRIPï¼ŒOSPFç­‰ï¼‰çš„ç¼ºé™·ç”±IETFç¡®å®šçš„ é¡ºä¾¿å…ˆå¤ä¹ ä¸€ä¸‹è·¯ç”±å™¨æŸ¥è·¯ç”±è¡¨ è½¬å‘çš„è¿‡ç¨‹ï¼š ä¼ ç»Ÿçš„IPè½¬å‘ä¸­ï¼Œç‰©ç†å±‚ä»äº¤æ¢æœºçš„ä¸€ä¸ªç«¯å£æ”¶åˆ°ä¸€ä¸ªæŠ¥æ–‡ï¼Œä¸Šé€åˆ°æ•°æ®é“¾è·¯å±‚ã€‚æ•°æ®é“¾è·¯å±‚å»æ‰é“¾è·¯å±‚å°è£…ï¼Œæ ¹æ®æŠ¥æ–‡çš„åè®®åŸŸä¸Šé€ç»™ç›¸åº”çš„ç½‘ç»œå±‚ã€‚ç½‘ç»œå±‚é¦–å…ˆçœ‹æŠ¥æ–‡æ˜¯å¦æ˜¯é€ç»™æœ¬æœºçš„ï¼Œè‹¥æ˜¯ï¼Œå»æ‰ç½‘ç»œå±‚å°è£…ï¼Œä¸Šé€ç»™å®ƒçš„ä¸Šå±‚åè®®ã€‚è‹¥ä¸æ˜¯ï¼Œåˆ™æ ¹æ®æŠ¥æ–‡çš„ç›®çš„åœ°å€æŸ¥æ‰¾è·¯ç”±è¡¨ï¼Œè‹¥æ‰¾åˆ°è·¯ç”±ï¼Œå°†æŠ¥æ–‡é€ç»™ç›¸åº”ç«¯å£çš„æ•°æ®é“¾è·¯å±‚ï¼Œæ•°æ®é“¾è·¯å±‚å°è£…åï¼Œå‘é€æŠ¥æ–‡ã€‚è‹¥æ‰¾ä¸åˆ°è·¯ç”±ï¼Œå°†æŠ¥æ–‡ä¸¢å¼ƒã€‚ä¼ ç»Ÿçš„IPè½¬å‘é‡‡ç”¨çš„æ˜¯é€è·³è½¬å‘ï¼Œæ•°æ®æŠ¥æ–‡ç»è¿‡æ¯ä¸€å°äº¤æ¢æœºï¼Œéƒ½è¦æ‰§è¡Œä¸Šè¿°è¿‡ç¨‹ï¼ˆå¦‚å›¾ä¸­SWAæ”¶åˆ°ç›®çš„åœ°å€ä¸º10.2.0.1çš„æ•°æ®åŒ…ï¼ŒSWAä¼šä¾æ¬¡æŸ¥æ‰¾è·¯ç”±è¡¨ï¼Œæ ¹æ®åŒ¹é…çš„è·¯ç”±è¡¨é¡¹çš„è¿›è¡Œè½¬å‘ï¼ŒSWBã€SWCã€SWDéƒ½ä¼šè¿›è¡Œç±»ä¼¼çš„å¤„ç†ï¼‰ï¼Œæ‰€ä»¥é€Ÿåº¦ç¼“æ…¢ã€‚å¹¶ä¸”æ‰€æœ‰çš„äº¤æ¢æœºéœ€è¦çŸ¥é“å…¨ç½‘çš„è·¯ç”±æˆ–è€…é»˜è®¤è·¯ç”±ã€‚å¦å¤–ï¼Œç”±äºä¼ ç»ŸIPè½¬å‘æ˜¯é¢å‘æ— è¿æ¥çš„ï¼Œæ‰€ä»¥æ— æ³•æä¾›å¥½çš„Qosä¿è¯ã€‚ ä¼ ç»ŸIPç½‘ç»œåŸºäºIGP Metricè®¡ç®—æœ€ä¼˜è·¯å¾„ï¼Œè¿™æ˜¯è¿œè¿œä¸å¤Ÿçš„ï¼Œå¾€å¾€åœ¨ç°å®ç½‘ç»œä¸­è¿˜éœ€è€ƒè™‘å¸¦å®½ã€é“¾è·¯å±æ€§ç­‰å…¶ä»–å› ç´ ï¼›åŸºäºIPçš„æµé‡å·¥ç¨‹æ˜¯åŸºäºIGPé¢å‘ç›®çš„åœ°å€çš„è½¬å‘ï¼Œæ˜¯hop-by-hopï¼ˆé€è·³ï¼‰çš„è½¬å‘ï¼Œæ— æ³•å®ç°æ ¹æ®æ¥æºæ¥æ§åˆ¶æµé‡è½¬å‘ï¼›å¦å¤–åŸºäºIPçš„æµé‡å·¥ç¨‹æ˜¯é¢å‘æ— è¿æ¥çš„ï¼Œä¸èƒ½å®ç°æ˜¾å¼è·¯å¾„ï¼ˆExplicit Routingï¼‰ã€‚ä¸Šå›¾ä¸­ï¼ŒSWBå’ŒSWDä¹‹é—´å­˜åœ¨ä¸¤æ¡è·¯å¾„ã€‚ä¼ ç»Ÿçš„IPè½¬å‘ä¸­IGPæ ¹æ®Metricé€‰æ‹©æœ€ä¼˜çš„è·¯ç”±SWB-SWC-SWDè½¬å‘æ‰€æœ‰ä»Network Aå’ŒNetwork Båˆ°Network Cçš„IPæŠ¥æ–‡ï¼Œè€ŒSWB-SWG-SWH-SWDé“¾è·¯åˆ™é—²ç½®ï¼Œå½“ç½‘ç»œä¸­æµé‡è¿‡å¤§ï¼Œæœ‰å¯èƒ½å¯¼è‡´æœ€ä¼˜è·¯å¾„æ‹¥å¡ï¼Œä½†æ¬¡ä¼˜è·¯å¾„å´ç©ºè½½æ²¡æœ‰è¢«å……åˆ†åˆ©ç”¨ã€‚ MPLSçš„å‡ºç°ä»Aåˆ°èµ°åˆ°Bæœ‰ä¸‰ç§æ–¹æ³•ï¼š1.å¹¿æ’­ï¼ˆå¦‚ä»¥å¤ªç½‘ï¼‰ï¼šç›´æ¥æŠŠæ•°æ®å‘ç»™æ¯ä¸€ä¸ªåœ°æ–¹2.é€è·³å¯»å¾„ï¼šèµ°åˆ°ä¸€ä¸ªåœ°æ–¹ï¼Œé—®ä¸€ä¸‹è·¯æ¥ä¸‹æ¥è¯¥æ€ä¹ˆèµ°ï¼ˆä¹Ÿå°±æ˜¯ä¸Šé¢è¯´çš„æ ¹æ®è·¯ç”±åè®®ï¼ŒæŸ¥è·¯ç”±è¡¨ï¼‰3.æºè·¯ç”±ï¼šæå‰è§„åˆ’å¥½è·¯çº¿ï¼Œåˆ°å“ªé‡Œæ€ä¹ˆèµ°ï¼Œä¸å¸¸ç”¨ã€‚ è€ŒMPLSæ˜¯ç¬¬å››ç§èµ°æ³•ï¼šè·Ÿåœ¨â€œå‘å¯¼â€åé¢èµ°ï¼Œå‘å¯¼åœ¨èµ°è¿‡çš„è·¯ä¸Šåšå¥½æ ‡è®°ï¼Œä½ åªè¦æ²¿ç€æ ‡è®°çš„æŒ‡ç¤ºèµ°å°±å¯ä»¥äº†ã€‚è¿™ä¹Ÿå°±æ˜¯â€œæ ‡ç­¾äº¤æ¢â€ MPLSç»“åˆäº†ä¸‰å±‚è·¯ç”±æŠ€æœ¯ä¸äºŒå±‚äº¤æ¢æŠ€æœ¯ï¼Œæ‰€ä»¥å¯ä»¥æŠŠå®ƒçœ‹æˆâ€œ2.5å±‚â€çš„å…¶ä¸­çš„MPå¤šåè®®æŒ‡çš„æ˜¯æ”¯æŒå¤šç§ç½‘ç»œåè®®ï¼Œå¦‚ipv4ï¼Œipv6ï¼ŒCLNPï¼ŒIPXç­‰ MPLSæ˜¯ä¸€ç§æ ‡ç­¾è½¬å‘æŠ€æœ¯ï¼Œå®ƒé‡‡ç”¨æ— è¿æ¥çš„æ§åˆ¶å¹³é¢å’Œé¢å‘è¿æ¥çš„æ•°æ®å¹³é¢ï¼ˆå…·ä½“çš„MPLSæ¶æ„ä¸‹é¢è¿˜æœ‰ä»‹ç»ï¼‰ï¼Œæ— è¿æ¥çš„æ§åˆ¶å¹³é¢å®ç°è·¯ç”±ä¿¡æ¯çš„ä¼ é€’å’Œæ ‡ç­¾çš„åˆ†å‘ï¼Œé¢å‘è¿æ¥çš„æ•°æ®å¹³é¢å®ç°æŠ¥æ–‡åœ¨å»ºç«‹çš„æ ‡ç­¾è½¬å‘è·¯å¾„ä¸Šä¼ é€ã€‚MPLSåŸŸå†…ï¼Œäº¤æ¢æœºä¸éœ€è¦æŸ¥çœ‹æ¯ä¸ªæŠ¥æ–‡çš„ç›®çš„IPåœ°å€ï¼Œåªéœ€è¦æ ¹æ®å°è£…åœ¨IPå¤´å¤–é¢çš„æ ‡ç­¾è¿›è¡Œè½¬å‘å³å¯ï¼Œè¿™æ ·å¯ä»¥å¤§å¤§æé«˜æ•ˆç‡ MPLSè½¬å‘ä¸IPé€è·³è½¬å‘çš„å…³ç³»MPLSæ˜¯IPçš„æ‰¿è½½å±‚ï¼šMPLSè½¬å‘ä¸IPè½¬å‘ä¸å†²çªï¼Œå®ƒä»¬çš„å…³ç³»æ˜¯å¦‚æœèƒ½å¤Ÿä½¿ç”¨MPLSè½¬å‘ï¼Œé‚£ä¹ˆIPåŒ…ä¼šå…ˆå°è£…æˆMPLSæ•°æ®å¸§æ¥è½¬å‘ã€‚å¦‚æœä¸èƒ½MPLSè½¬å‘ï¼Œå°±è¿˜æ˜¯åŸæ¥çš„ipé€è·³è½¬å‘ã€‚ï¼ˆä¹Ÿå°±æ˜¯å°½é‡ä¼˜å…ˆMPLSï¼Œå› ä¸ºå®ƒä¼šæ›´å¿«ï¼‰ çœ‹ä¸Šé¢çš„å›¾ï¼Œæˆ‘ä»¬éœ€è¦ç†è§£ï¼šæ•´ä¸ªMPLSåŸŸï¼ˆå¯ä»¥è¿›è¡ŒMPLSè½¬å‘çš„åŒºåŸŸï¼‰æ˜¯åµŒåœ¨IPåŸŸä¸Šçš„ï¼Œä¹Ÿå°±æ˜¯MPLSåŸŸå¤–éƒ¨æ˜¯IPåŸŸï¼Œå®ƒæœ¬èº«ä¹Ÿè¿è¡ŒIPåŸŸã€‚ MPLSä¸­ä¸€äº›åŸºæœ¬æ¦‚å¿µï¼Œåè¯æ ‡ç­¾ï¼ˆLabelï¼‰ï¼šæ˜¯ä¸€ä¸ªå®šé•¿çš„ï¼Œæ¯”è¾ƒçŸ­çš„ï¼Œåªå…·æœ‰æœ¬åœ°æ„ä¹‰çš„æ ‡è¯†ã€‚FECï¼ˆè½¬å‘ç­‰ä»·ç±»ï¼‰ï¼šä¸€ç»„æˆ–ä¸€ç±»æ•°æ®ï¼Œè¿™ç»„æ•°æ®åˆ†é…çš„æ ‡ç­¾ç›¸åŒLSPï¼ˆæ ‡ç­¾äº¤æ¢é€šé“ï¼‰ï¼šä¸€ä¸ªFECçš„æ•°æ®æµï¼Œåœ¨ä¸åŒçš„èŠ‚ç‚¹è¢«èµ‹äºˆç¡®å®šçš„æ ‡ç­¾,æ•°æ®è½¬å‘æŒ‰ç…§è¿™äº›æ ‡ç­¾è¿›è¡Œã€‚æ•°æ®æµæ‰€èµ°çš„è·¯å¾„å°±æ˜¯LSPã€‚LSRï¼ˆLabel Switching Routerï¼‰ï¼š LSRæ˜¯MPLSçš„ç½‘ç»œçš„æ ¸å¿ƒäº¤æ¢æœºï¼Œå®ƒæä¾›æ ‡ç­¾äº¤æ¢å’Œæ ‡ç­¾åˆ†å‘åŠŸèƒ½ã€‚LERï¼ˆLabel Switching Edge Routerï¼‰ï¼šåœ¨MPLSçš„ç½‘ç»œè¾¹ç¼˜ï¼Œè¿›å…¥åˆ°MPLSç½‘ç»œçš„æµé‡ç”±LERåˆ†ä¸ºä¸åŒçš„FECï¼Œå¹¶ä¸ºè¿™äº›FECè¯·æ±‚ç›¸åº”çš„æ ‡ç­¾ã€‚å®ƒæä¾›æµé‡åˆ†ç±»å’Œæ ‡ç­¾çš„æ˜ å°„ã€æ ‡ç­¾çš„ç§»é™¤åŠŸèƒ½ã€‚ ä»IPåŸŸè¿›å…¥MPLSåŸŸçš„æ—¶å€™ï¼ŒLERï¼ˆæ ‡è®°è¾¹ç¼˜è·¯ç”±å™¨ï¼‰è¦åšä¸€ä¸ªå‹å…¥ï¼ˆpushï¼‰ï¼Œå‡ºMPLSåŸŸçš„æ—¶å€™åšä¸€ä¸ªå¼¹å‡ºï¼ˆpopï¼‰ï¼Œè€ŒLSRï¼ˆæ ‡è®°äº¤æ¢è·¯ç”±å™¨ï¼‰è´Ÿè´£è½¬å‘ã€‚æ‰€ä»¥LERå®é™…å·¥ä½œé‡æ¯”LSRå¤§å¾ˆå¤šã€‚LSPï¼ˆæ ‡è®°äº¤æ¢è·¯å¾„ï¼‰å°±æ˜¯ä»è¿›å…¥åˆ°ç¦»å¼€ èµ°çš„è·¯å¾„ã€‚è¿™æ¡è·¯å¾„æ˜¯åœ¨è½¬å‘æŠ¥æ–‡ä¹‹å‰å°±å·²ç»é€šè¿‡å„ç§åè®®ç¡®å®šå¹¶å»ºç«‹çš„ï¼ŒæŠ¥æ–‡ä¼šåœ¨ç‰¹å®šçš„LSPä¸Šä¼ é€’ã€‚ï¼ˆä¹Ÿå¯ä»¥æŠŠLSPçœ‹æˆä¸€ä¸ªéš§é“ï¼‰ æ ‡ç­¾æŠ¥æ–‡æ ¼å¼ï¼š MPLS Headeré•¿åº¦ä¸º32bitsï¼ŒåŒ…æ‹¬é•¿åº¦ä¸º20bitsçš„æ ‡ç­¾ï¼ˆLabelï¼‰ï¼Œè¯¥æ ‡ç­¾ç”¨äºæŠ¥æ–‡è½¬å‘ï¼›é•¿åº¦ä¸º3bitsçš„EXPé€šå¸¸ç”¨æ¥æ‰¿è½½IPæŠ¥æ–‡ä¸­çš„ä¼˜å…ˆçº§ï¼›é•¿åº¦ä¸º1bitçš„æ ˆåº•æ ‡å¿—Sç”¨æ¥è¡¨æ˜æ˜¯å¦æ˜¯æœ€åä¸€ä¸ªæ ‡ç­¾ï¼ˆMPLSæ ‡ç­¾å¯ä»¥å¤šå±‚åµŒå¥—ï¼‰ï¼›é•¿åº¦ä¸º8bitsçš„TTLï¼Œä½œç”¨ç±»ä¼¼IPå¤´éƒ¨çš„TTLï¼Œç”¨æ¥é˜²æ­¢æŠ¥æ–‡ç¯è·¯ç­‰ã€‚ äº‹å®ä¸ŠMPLSå°è£…æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸Šé¢è¯´çš„æ˜¯å¸§æ¨¡å¼ï¼ŒEthernetå’ŒPPPéƒ½æ˜¯å¸§æ¨¡å¼å°è£…ï¼›è¿˜æœ‰ä¸€ä¸ªä¿¡å…ƒå°è£…æ¨¡å¼ï¼ˆATMé‡‡ç”¨ï¼‰ã€‚MPLSçš„ LSP ä¸æ ‡ç­¾è½¬å‘è¡¨ MPLSè½¬å‘è¿‡ç¨‹ 1.Pushï¼šé¦–å…ˆä»IPæ•°æ®åŒ…ä»ipåŸŸè¿›å…¥MPLSåŸŸï¼Œå…¥å£LERåš push æ“ä½œï¼Œåˆ†æè½¬å‘ç­‰ä»·ç±»ï¼Œä¸ºæ•°æ®åŒ…â€œæ‰“ä¸Šæ ‡ç­¾â€ï¼Œç»‘å®šLSPé€šé“ï¼›å›¾ä¸­Açš„æ ‡ç­¾è½¬å‘è¡¨å†…å®¹å¤§æ¦‚å¦‚ä¸‹ï¼š 2.Swapï¼šBï¼ŒCä¸¤ä¸ªLSRæ ¹æ®æ ‡ç­¾è½¬å‘è¡¨ï¼Œç”¨ä¸‹ä¸€è·³åˆ†é…çš„æ ‡ç­¾ï¼Œæ›¿æ¢MPLSæŠ¥æ–‡çš„æ ‡ç­¾å¹¶è½¬å‘ 3.Popï¼šè½¬å‘åˆ°å‡ºå£LER Dæ—¶ï¼Œè¿›è¡Œpopå¼¹å‡ºæ“ä½œï¼Œå»æ‰æ ‡ç­¾ MPLSè½¬å‘çš„è¿‡ç¨‹åˆ°è¿™é‡Œç»“æŸã€‚ PHPï¼ˆå€’æ•°ç¬¬äºŒè·³å¼¹å‡ºã€‚Penultimate Hop Popping ï¼Œå’Œwebå¼€å‘çš„phpå¯æ²¡å…³ç³»ï¼‰ï¼šä¸Šé¢çš„è¿‡ç¨‹æˆ‘ä»¬å¯ä»¥å‘ç°ï¼ŒCåœ¨å‘ç»™Dæ—¶ï¼Œå…¶å®å¸¦æ ‡ç­¾çš„æ•°æ®å·²ç»æ²¡æœ‰æ„ä¹‰ï¼Œå› ä¸ºä¸‹ä¸€è·³å°±è¦å¼¹å‡ºæ ‡ç­¾äº†ï¼Œæ‰€ä»¥å®Œå…¨å¯ä»¥åœ¨Cå°±æŠŠæ ‡ç­¾å¼¹å‡ºï¼Œç„¶åä»¥ipæŠ¥æ–‡å½¢å¼è½¬å‘ç»™Dã€‚è¿™æ ·å¯ä»¥å¤§å¤§é™ä½æœ€åçš„å‡ºå£LERçš„å·¥ä½œé‡ï¼Œæ˜¯ç°åœ¨MPLSæ™®éé‡‡ç”¨çš„æ–¹æ³•ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè®¾å¤‡æ”¯æŒPHPç‰¹æ€§ï¼Œæ”¯æŒPHPçš„EgressèŠ‚ç‚¹å³å‡ºå£LER åˆ†é…ç»™å€’æ•°ç¬¬äºŒè·³èŠ‚ç‚¹çš„æ ‡ç­¾å€¼ä¸º3ã€‚ MPLSæ ‡ç­¾è½¬å‘è¡¨ä¸LDP æˆ‘ä»¬çŸ¥é“ï¼Œäº¤æ¢æœºä¸­çš„MACåœ°å€è¡¨æ˜¯é€šè¿‡é€†å‘å­¦ä¹ æ³•äº§ç”Ÿçš„ï¼›è·¯ç”±å™¨ä¸­çš„è·¯ç”±è¡¨æ˜¯é€šè¿‡è·¯ç”±åè®®å­¦ä¹ æˆ–è‡ªå·±é…ç½®é™æ€è·¯ç”±äº§ç”Ÿçš„ã€‚é‚£ä¹ˆMPLSä¸­æ ‡ç­¾è½¬å‘è¡¨æ˜¯æ€ä¹ˆäº§ç”Ÿçš„å‘¢ï¼Ÿ ç­”æ¡ˆæ˜¯ä¹Ÿä¼šæœ‰ä¸€ä¸ªç±»ä¼¼çš„è·¯ç”±å™¨å­¦ä¹ çš„åè®®ï¼Œè¿™ä¸ªåè®®å«åšLDPï¼ˆLabel Distribution Protocol æ ‡ç­¾åˆ†å‘åè®®ï¼‰ï¼Œè¿™ä¸ªä¹Ÿæ˜¯MPLSæŠ€æœ¯çš„æ ¸å¿ƒåè®®ä¹‹ä¸€ã€‚LDPæ¥å®Œæˆæ ‡ç­¾çš„åˆ†é…æ§åˆ¶å’Œä¿æŒ ä»æ•´ä¸ªMPLSæ¶æ„çœ‹è¿™ä¸ªåè®®çš„ä½ç½®ï¼š ä»¥ä¸Šæ˜¯MPLSæ¶æ„å›¾MPLSåŒ…æ‹¬ä¸¤ä¸ªå¹³é¢ï¼šæ§åˆ¶å¹³é¢å’Œæ•°æ®å¹³é¢ã€‚æ§åˆ¶å¹³é¢è´Ÿè´£äº§ç”Ÿå’Œç»´æŠ¤è·¯ç”±ä¿¡æ¯ä»¥åŠæ ‡ç­¾ä¿¡æ¯ã€‚æ•°æ®å¹³é¢è´Ÿè´£æ™®é€šIPæŠ¥æ–‡çš„è½¬å‘ä»¥åŠå¸¦MPLSæ ‡ç­¾æŠ¥æ–‡çš„è½¬å‘ã€‚æ§åˆ¶å¹³é¢ä¸­è·¯ç”±åè®®æ¨¡å—ï¼ˆRouting Protocolï¼‰ç”¨æ¥ä¼ é€’è·¯ç”±ä¿¡æ¯ï¼Œç”Ÿæˆè·¯ç”±ä¿¡æ¯è¡¨ï¼›æ ‡ç­¾åˆ†å‘åè®®æ¨¡å—ï¼ˆLabel Distribution Protocolï¼‰ç”¨æ¥å®Œæˆæ ‡ç­¾ä¿¡æ¯çš„äº¤æ¢ï¼Œå»ºç«‹æ ‡ç­¾è½¬å‘è·¯å¾„ã€‚æ•°æ®å¹³é¢åŒ…æ‹¬IPè½¬å‘è¡¨å’Œæ ‡ç­¾è½¬å‘è¡¨ï¼Œå½“æ”¶åˆ°æ™®é€šIPæŠ¥æ–‡æ—¶ï¼ˆIncoming IP Packetsï¼‰ï¼Œå¦‚æœæ˜¯æ™®é€šIPè½¬å‘ï¼Œåˆ™æŸ¥æ‰¾IPè·¯ç”±è¡¨è½¬å‘ï¼Œå¦‚æœéœ€è¦æ ‡ç­¾è½¬å‘ï¼Œåˆ™æŒ‰ç…§æ ‡ç­¾è½¬å‘è¡¨è½¬å‘ï¼›å½“æ”¶åˆ°å¸¦æœ‰æ ‡ç­¾çš„æŠ¥æ–‡æ—¶ï¼ˆIncoming Labeled Packetsï¼‰æ—¶ï¼Œå¦‚æœéœ€è¦æŒ‰ç…§æ ‡ç­¾è½¬å‘ï¼Œæ ¹æ®æ ‡ç­¾è½¬å‘è¡¨è½¬å‘ï¼Œå¦‚æœéœ€è¦è½¬å‘åˆ°IPç½‘ç»œï¼Œåˆ™å»æ‰æ ‡ç­¾åæ ¹æ®IPè½¬å‘è¡¨è½¬å‘ã€‚ LDPçš„æ ‡ç­¾ç®¡ç†ä¸ä¿ç•™æ–¹å¼ä¸»è¦å†…å®¹æœ‰ä¸‹é¢ä¸‰éƒ¨åˆ† æ ‡ç­¾åˆ†é…æ¨¡å¼ DoDï¼šä¸‹æ¸¸æŒ‰éœ€æ ‡è®°åˆ†å‘DUï¼šä¸‹æ¸¸è‡ªä¸»æ ‡è®°åˆ†å‘2. æ ‡ç­¾æ§åˆ¶æ¨¡å¼ æœ‰åºæ–¹å¼ç‹¬ç«‹æ–¹å¼ æ ‡ç­¾ä¿æŒæ¨¡å¼ ä¿å®ˆæ¨¡å¼è‡ªç”±æ¨¡å¼æœ€å¸¸ç”¨çš„ç»„åˆæ˜¯ ä¸‹æ¸¸è‡ªä¸»ï¼ˆDUï¼‰ + æœ‰åº + è‡ªç”± ä¸‹é¢æ¥å…·ä½“ä»‹ç»ä»€ä¹ˆæ„æ€ è¿™é‡Œå…ˆè¦ç†è§£ä¸Šæ¸¸ï¼Œä¸‹æ¸¸çš„æ¦‚å¿µï¼ŒMPLSå…¥å£å‡ºä¸ºæœ€ä¸Šæ¸¸ï¼›å‡ºå£å¤„ä¸ºæœ€ä¸‹æ¸¸ã€‚æ ‡ç­¾çš„äº§ç”Ÿå¯ä»¥ç†è§£ä¸ºæ˜¯ä¸‹æ¸¸ä¸ºä¸Šæ¸¸äº§ç”Ÿçš„ï¼Œä¸‹æ¸¸äº§ç”Ÿçš„INæ ‡ç­¾ä½œä¸ºä¸Šæ¸¸çš„OUTæ ‡ç­¾ï¼ˆæ¯”å¦‚å›¾ä¸­R3å·¦è¾¹è¦æ¥æ”¶çš„INæ ‡ç­¾ä¸º100ï¼Œé‚£ä¹ˆR2å‘å³çš„OUTæ ‡ç­¾å°±è¦æ˜¯100ï¼Œå› ä¸ºR3åªè¦ä¸º100çš„æ ‡ç­¾ï¼‰ ç„¶åå…·ä½“ä»‹ç»ä¸Šé¢çš„ä¸‰ä¸ªéƒ¨åˆ†ï¼šâ… .æ ‡ç­¾çš„æ§åˆ¶æ¨¡å¼ï¼ˆå³æ ‡ç­¾æ˜¯æ€ä¹ˆäº§ç”Ÿçš„ï¼‰ï¼šæœ‰åºï¼ˆå¸¸ç”¨ï¼‰ï¼šåªæœ‰æœ€ä¸‹æ¸¸è·¯ç”±å™¨æ‰èƒ½äº§ç”Ÿæ ‡ç­¾ï¼Œæœ€ä¸‹æ¸¸çš„ä¸Šæ¸¸æ”¶åˆ°æœ€ä¸‹æ¸¸çš„æ ‡ç­¾æ˜ å°„æ¶ˆæ¯åï¼Œç„¶åæ‰èƒ½å†å¾€è‡ªå·±çš„ä¸Šæ¸¸å‘é€æ ‡ç­¾æ˜ å°„å…³ç³»ã€‚ç‹¬ç«‹ï¼šä¸­é—´çš„è·¯ç”±å™¨ä¹Ÿå¯ä»¥ç›´æ¥äº§ç”Ÿæ ‡ç­¾ â…¡.æ ‡ç­¾çš„åˆ†å‘æ¨¡å¼ï¼šä¸‹æ¸¸æŒ‰éœ€ ï¼šéœ€è¦çš„æ—¶å€™ä¸Šæ¸¸å†å‘ä¸‹æ¸¸è¯¢é—®æ ‡ç­¾ä¿¡æ¯ï¼›ä¸‹æ¸¸è‡ªä¸»ï¼šä¸ç®¡æœ‰æ²¡æœ‰é—®ï¼Œä¸‹æ¸¸è·¯ç”±å™¨éƒ½è‡ªä¸»çš„å‘ä¸Šæ¸¸å‘é€æ ‡ç­¾æ˜ å°„ä¿¡æ¯ï¼ˆä¸»åŠ¨å‘ä¸Šæ±‡æŠ¥ï¼‰â…¢.æ ‡ç­¾çš„ä¿ç•™æ¨¡å¼ï¼šå¦‚æœæœ‰ä¸¤æ¡è·¯å¾„ï¼Œä¹Ÿå°±ä¼šæœ‰ä¸¤ä¸ªæ ‡ç­¾ï¼Œé‚£ä¹ˆè·¯ç”±å™¨ä¿ç•™å“ªä¸ªã€‚ä¿å®ˆï¼šåªä¿ç•™è·¯ç”±è¡¨ä¸­çš„â€æœ€ä½³è·¯å¾„â€œï¼Œè·³æ•°æ¯”è¾ƒå°‘çš„ï¼›è‡ªç”±ï¼šä¿ç•™æ‰€æœ‰çš„æ ‡ç­¾ï¼Œè™½ç„¶å ç”¨äº†æ›´å¤šçš„æ ‡ç­¾ç©ºé—´ï¼Œä½†æ˜¯æ”¶æ•›ä¼šå¿« åŸºç¡€å®éªŒ é…ç½®æ­¥éª¤ï¼š å®Œæˆipå’Œospfé…ç½®ï¼š R1çš„é…ç½®å¦‚ä¸‹ï¼š [R1] interface GigabitEthernet0&#x2F;0&#x2F;0 [R1-GigabitEthernet0&#x2F;0&#x2F;0] ip address 12.1.1.1 24 [R1] interface loopback0 [R1-Loopback0] ip address 1.1.1.1 32 [R1] ospf 1 router-id 1.1.1.1 [R1-ospf-1] area 0 [R1-ospf-1-0.0.0.0] network 12.1.1.0 0.0.0.255 [R1-ospf-1-0.0.0.0] network 1.1.1.1 0.0.0.0 R2çš„é…ç½®å¦‚ä¸‹ï¼š [R2] interface GigabitEthernet0&#x2F;0&#x2F;0 [R2-GigabitEthernet0&#x2F;0&#x2F;0] ip address 12.1.1.2 24 [R2] interface GigabitEthernet0&#x2F;0&#x2F;1 [R2-GigabitEthernet0&#x2F;0&#x2F;1] ip address 23.1.1.2 24 [R2] interface loopback0 [R2-Loopback0] ip address 2.2.2.2 32 [R2] ospf 1 router-id 2.2.2.2 [R2-ospf-1] area 0 [R2-ospf-1-0.0.0.0] network 12.1.1.0 0.0.0.255 [R2-ospf-1-0.0.0.0] network 23.1.1.0 0.0.0.255 [R2-ospf-1-0.0.0.0] network 2.2.2.2 0.0.0.0 R3çš„é…ç½®å¦‚ä¸‹ï¼š [R3] interface GigabitEthernet0&#x2F;0&#x2F;0 [R3-GigabitEthernet0&#x2F;0&#x2F;0] ip address 23.1.1.3 24 [R3] interface GigabitEthernet0&#x2F;0&#x2F;1 [R3-GigabitEthernet0&#x2F;0&#x2F;1] ip address 34.1.1.3 24 [R3] interface loopback0 [R3-Loopback0] ip address 3.3.3.3 32 [R3] ospf 1 router-id 3.3.3.3 [R3-ospf-1] area 0 [R3-ospf-1-0.0.0.0] network 23.1.1.0 0.0.0.255 [R3-ospf-1-0.0.0.0] network 34.1.1.0 0.0.0.255 [R3-ospf-1-0.0.0.0] network 1.1.1.1 0.0.0.0 R4çš„é…ç½®å¦‚ä¸‹ï¼š [R4] interface GigabitEthernet0&#x2F;0&#x2F;0 [R4-GigabitEthernet0&#x2F;0&#x2F;0] ip address 34.1.1.4 24 [R4] interface loopback0 [R4-Loopback0] ip address 4.4.4.4 32 [R4] ospf 1 router-id 4.4.4.4 [R4-ospf-1] area 0 [R4-ospf-1-0.0.0.0] network 34.1.1.0 0.0.0.255 [R4-ospf-1-0.0.0.0] network 4.4.4.4 0.0.0.0 æ¿€æ´»mplså¹¶æ¿€æ´»ldp ï¼ˆå…¨å±€å’Œæ¥å£ä¸‹éƒ½éœ€è¦æ¿€æ´»ï¼‰ R1çš„é…ç½®å¦‚ä¸‹ï¼š [R1] mpls lsr-id 1.1.1.1 #é…ç½®MPLS LSR ID [R1] mpls #å…¨å±€æ¿€æ´»MPLS [R1-mpls] quit [R1] mpls ldp #å…¨å±€æ¿€æ´»LDP [R1-mpls-ldp] quit [R1] Interface GigabitEthernet 0&#x2F;0&#x2F;0 [R1-GigabitEthernet0&#x2F;0&#x2F;0] mpls #åœ¨æ¥å£ä¸Šæ¿€æ´»MPLS [R1-GigabitEthernet0&#x2F;0&#x2F;0] mpls ldp #åœ¨æ¥å£ä¸Šæ¿€æ´»LDP R2çš„é…ç½®å¦‚ä¸‹ï¼š [R2] mpls lsr-id 2.2.2.2 [R2] mpls [R2-mpls] quit [R2] mpls ldp [R2-mpls-ldp] quit [R2] Interface GigabitEthernet 0&#x2F;0&#x2F;0 [R2-GigabitEthernet0&#x2F;0&#x2F;0] mpls [R2-GigabitEthernet0&#x2F;0&#x2F;0] mpls ldp [R2] Interface GigabitEthernet 0&#x2F;0&#x2F;1 [R2-GigabitEthernet0&#x2F;0&#x2F;1] mpls [R2-GigabitEthernet0&#x2F;0&#x2F;1] mpls ldp R3çš„é…ç½®å¦‚ä¸‹ï¼š [R3] mpls lsr-id 3.3.3.3 [R3] mpls [R3-mpls] quit [R3] mpls ldp [R3-mpls-ldp] quit [R3] Interface GigabitEthernet 0&#x2F;0&#x2F;0 [R3-GigabitEthernet0&#x2F;0&#x2F;0] mpls [R3-GigabitEthernet0&#x2F;0&#x2F;0] mpls ldp [R3] Interface GigabitEthernet 0&#x2F;0&#x2F;1 [R3-GigabitEthernet0&#x2F;0&#x2F;1] mpls [R3-GigabitEthernet0&#x2F;0&#x2F;1] mpls ldp R4çš„é…ç½®å¦‚ä¸‹ï¼š [R4] mpls lsr-id 4.4.4.4 [R4] mpls [R4-mpls] quit [R4] mpls ldp [R4-mpls-ldp] quit [R4] Interface GigabitEthernet 0&#x2F;0&#x2F;0 [R4-GigabitEthernet0&#x2F;0&#x2F;0] mpls [R4-GigabitEthernet0&#x2F;0&#x2F;0] mpls ldp éªŒè¯ï¼š display mpls ldp peer LDP Peer Information in Public network A â€˜*â€™ before a peer means the peer is being deleted. -â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“ PeerID TransportAddress DiscoverySource -â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“ 2.2.2.2:0 2.2.2.2 GigabitEthernet0&#x2F;0&#x2F;0 -â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“ TOTAL: 1 Peer(s) Found. ä»¥ä¸Šè¾“å‡ºçš„æ˜¯R1çš„LDPé‚»å±…è¡¨ï¼Œä»è¡¨ä¸­å¯ä»¥çœ‹å‡ºR1å·²ç»å‘ç°äº†ä¸€ä¸ªLDPé‚»å±…ï¼Œé‚£å°±æ˜¯R2ã€‚ disp mpls ldp session verbose LDP Session(s) in Public Network -â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“ Peer LDP ID : 2.2.2.2:0 Local LDP ID : 1.1.1.1:0 TCP Connection : 1.1.1.1 &lt;- 2.2.2.2 Session State : Operational Session Role : Passive Session FT Flag : Off MD5 Flag : Off Reconnect Timer : â€” Recovery Timer : â€” Keychain Name : â€” Negotiated Keepalive Hold Timer : 45 Sec Configured Keepalive Send Timer : â€” Keepalive Message Sent&#x2F;Rcvd : 153&#x2F;153 (Message Count) Label Advertisement Mode : Downstream Unsolicited Label Resource Status(Peer&#x2F;Local) : Available&#x2F;Available Session Age : 0000:00:38 (DDDD:HH:MM) Session Deletion Status : No Capability: Capability-Announcement : Off P2MP Capability : Off Outbound&amp;Inbound Policies applied : NULL Addresses received from peer: (Count: 3) 2.2.2.2 12.1.1.2 23.1.1.2 -â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“ ä»¥ä¸Šè¾“å‡ºçš„æ˜¯LDPä¼šè¯çš„è¯¦ç»†ä¿¡æ¯ï¼Œé‚»å±…çš„çŠ¶æ€å¿…é¡»ä¸ºOperationalæ‰æ˜¯æœ€ç»ˆçš„ç¨³æ€ï¼Œå¦å¤–ä»TCPè¿æ¥1.1.1.1 &lt; 2.2.2.2å¯ä»¥éªŒè¯ä¸€ç‚¹ï¼ŒLDPçš„ä¼šè¯å»ºç«‹æ˜¯ç”±ä¼ è¾“åœ°å€å¤§çš„ä¸€æ–¹å‘èµ·çš„ã€‚ display mpls ldp lsp LDP LSP Information -â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” DestAddress&#x2F;Mask In&#x2F;OutLabel UpstreamPeer NextHop OutInterface -â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” 1.1.1.1&#x2F;32 3&#x2F;NULL 2.2.2.2 127.0.0.1 InLoop0 *1.1.1.1&#x2F;32 Liberal&#x2F;1026 DS&#x2F;2.2.2.2 2.2.2.2&#x2F;32 NULL&#x2F;3 - 12.1.1.2 GE0&#x2F;0&#x2F;0 2.2.2.2&#x2F;32 1026&#x2F;3 2.2.2.2 12.1.1.2 GE0&#x2F;0&#x2F;0 3.3.3.3&#x2F;32 NULL&#x2F;1024 - 12.1.1.2 GE0&#x2F;0&#x2F;0 3.3.3.3&#x2F;32 1024&#x2F;1024 2.2.2.2 12.1.1.2 GE0&#x2F;0&#x2F;0 4.4.4.4&#x2F;32 NULL&#x2F;1025 - 12.1.1.2 GE0&#x2F;0&#x2F;0 4.4.4.4&#x2F;32 1025&#x2F;1025 2.2.2.2 12.1.1.2 GE0&#x2F;0&#x2F;0 -â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” TOTAL: 7 Normal LSP(s) Found. TOTAL: 1 Liberal LSP(s) Found. TOTAL: 0 Frr LSP(s) Found. A â€˜*â€™ before an LSP means the LSP is not established A â€˜*â€™ before a Label means the USCB or DSCB is stale A â€˜*â€™ before a UpstreamPeer means the session is stale A â€˜*â€™ before a DS means the session is stale A â€˜*â€™ before a NextHop means the LSP is FRR LSP ä»¥ä¸Šè¾“å‡ºçš„æ˜¯R1çš„LFIBï¼ˆæ ‡ç­¾è½¬å‘ä¿¡æ¯åº“ï¼‰ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»å»ºç«‹å¥½çš„LSPã€‚ å®é™…ä¸Šï¼Œå½“æˆ‘ä»¬å†R1ã€R2ã€R3ã€R4ä¸Šè¿è¡ŒOSPFåï¼Œå…¨ç½‘çš„è·¯ç”±å·²ç»è¢«æ‰“é€šï¼Œä¹Ÿå°±æ˜¯æ¯å°è·¯ç”±å™¨éƒ½æ‹¥æœ‰å…¨ç½‘çš„è·¯ç”±ï¼Œå…¶ä¸­åŒ…æ‹¬äº’è”ç½‘æ®µçš„è·¯ç”±ï¼Œä»¥åŠå„è®¾å¤‡çš„Loopbackè·¯ç”±ã€‚éšåæˆ‘ä»¬æ¿€æ´»å„è®¾å¤‡çš„MPLSå’ŒLDPï¼Œæ¯å°è®¾å¤‡ä¼šåŸºäºè‡ªå·±çš„è·¯ç”±è¡¨ä¸­çš„è·¯ç”±å‰ç¼€è¿›è¡Œæ ‡ç­¾æ†ç»‘ï¼Œå¹¶ä¸”å°†ä¸ºè·¯ç”±å‰ç¼€ï¼ˆFECï¼‰æ‰€æ†ç»‘çš„æ ‡ç­¾åˆ†å‘ç»™è‡ªå·±çš„LDPé‚»å±…ã€‚é»˜è®¤æƒ…å†µä¸‹åœ¨æˆ‘å¸çš„è®¾å¤‡ä¸Šï¼Œä»…ä¸º&#x2F;32çš„ä¸»æœºè·¯ç”±åˆ†å‘æ ‡ç­¾ï¼Œå¹¶ä¸”é»˜è®¤æ°´å¹³åˆ†å‰²è§„åˆ™å¹¶æœªæ‰“å¼€ã€‚ ç°åœ¨ï¼Œæ¥æµ‹è¯•ä¸€ä¸‹ï¼Œä»R1å»tracert 4.4.4.4ï¼š tracert lsp ip 4.4.4.4 32 LSP Trace Route FEC: IPV4 PREFIX 4.4.4.4&#x2F;32 , press CTRL_C to break. TTL Replier Time Type Downstream 0 Ingress 12.1.1.2&#x2F;[1025 ] 1 12.1.1.2 20 ms Transit 23.1.1.3&#x2F;[1024 ] 2 23.1.1.3 20 ms Transit 34.1.1.4&#x2F;[3 ] 3 4.4.4.4 20 ms Egress ä»tracertçš„ç»“æœæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ•°æ®åŒ…è¡Œèµ°çš„è·¯å¾„ï¼Œä»¥åŠè¢«å‹å…¥çš„æ ‡ç­¾ã€‚","categories":[{"name":"ipå®éªŒ","slug":"ipå®éªŒ","permalink":"http://example.com/categories/ip%E5%AE%9E%E9%AA%8C/"}],"tags":[{"name":"mpls","slug":"mpls","permalink":"http://example.com/tags/mpls/"}]},{"title":"Hybridæ¥å£","slug":"Hybridæ¥å£","date":"2023-12-05T05:30:11.000Z","updated":"2023-12-05T05:40:22.635Z","comments":true,"path":"2023/12/05/Hybridæ¥å£/","permalink":"http://example.com/2023/12/05/Hybrid%E6%8E%A5%E5%8F%A3/","excerpt":"","text":"æ¥å£å±æ€§â€‹ äº¤æ¢æœºæ¥å£çš„ç±»å‹ï¼Œå¯ä»¥æ˜¯Accessã€Trunkå’ŒHybridã€‚Accessç±»å‹çš„æ¥å£ä»…å±äºä¸€ä¸ªVLAN,,,,åªèƒ½æ¥æ”¶ã€è½¬å‘ç›¸åº”VLANçš„å¸§ï¼›è€ŒTrunkç±»å‹æ¥å£åˆ™é»˜è®¤å±äºæ‰€æœ‰VLANä»»ä½•Taggedå¸§éƒ½èƒ½ç»è¿‡Trunkæ¥æ”¶å’Œè½¬å‘ï¼› Hybridç±»å‹æ¥å£åˆ™ä»‹äºäºŒè€…ä¹‹é—´ï¼Œå¯è‡ªä¸»å®šä¹‰ç«¯å£ä¸Šèƒ½æ¥æ”¶å’Œè½¬å‘é‚£äº›VLAN Tagå¸§ï¼Œå¹¶å¯å†³å®šVLAN Tagæ˜¯å¦ç»§ç»­æºå¸¦æˆ–è€…å‰¥ç¦»ã€‚ã€‚Accesså’ŒTrunkç±»å‹æ¥å£æ˜¯Hybridç±»å‹æ¥å£çš„ä¸¤ä¸ªç‰¹ä¾‹ï¼Œï¼Œï¼Œä¸€ä¸ªä»…æ”¯æŒä¸€ä¸ªVLANä¼ é€’ï¼Œï¼Œä¸€ä¸ªé»˜è®¤æ”¯æŒæ‰€æœ‰VLANçš„ä¼ é€’ï¼Œè€ŒAccessç±»å‹å’ŒTrunkç±»å‹çš„æ¥å£èƒ½åšåˆ°çš„ï¼ŒHybridæ¥å£éƒ½èƒ½åšåˆ°ã€‚ â€‹ hybridå±æ€§å…·æœ‰trunkå’Œaccessä¸¤ç§ç«¯å£å±æ€§çš„ç‰¹ç‚¹ï¼Œtagç±»ä¼¼trunkï¼Œuntagç±»ä¼¼accessï¼Œä½†æ˜¯åˆä¸åŒï¼Œå› ä¸ºhybridç«¯å£å¯ä»¥æ¥æ”¶æŸä¸ªæˆ–è€…å¤šä¸ªvlançš„æ•°æ®ã€‚ åœ¨å¼€å§‹ç ”ç©¶ä¹‹å‰å¼ºè°ƒå‡ ç‚¹ï¼š 1ã€åœ¨hybridç«¯å£ä¸­ï¼Œæ‰€æœ‰ç«¯å£éƒ½é»˜è®¤å±äºvlan1ï¼Œé™¤éé…ç½®undo port hybrid vlan 1 æ‰èƒ½å°†è¯¥hybridå‰”é™¤å‡ºvlan1ï¼Œå¯ä»¥ä½¿ç”¨display vlan æŸ¥çœ‹ç«¯å£æ‰€å±çš„vlan 2ã€åœ¨hybridç«¯å£ä¸­ï¼Œæ— è®ºæ˜¯tagè¿˜æ˜¯untagåé¢é…ç½®çš„vlan-idå°±æ˜¯è¯¥hybridç«¯å£æ‰€èƒ½å¤Ÿæ”¶åˆ°vlanæ•°æ®çš„vlan-idï¼Œæ¢å¥è¯è¯´å°±æ˜¯è¿™äº›vlanä¸­å‘å‡ºçš„æ•°æ®è¯¥ç«¯å£éƒ½èƒ½æ”¶åˆ°ï¼Œå¯ä»¥ä½¿ç”¨display vlanæŸ¥çœ‹ï¼ˆè¿™é‡Œæ³¨æ„è™½ç„¶å¯ä»¥æ”¶åˆ°è¿™äº›vlançš„æ•°æ®ä½†æ˜¯ä¸¥æ ¼æ„ä¹‰ä¸Šè®²hybridç«¯å£å¹¶ä¸å±äºä»»ä½•ä¸€ä¸ªvlanï¼‰ 3ã€æ‰€æœ‰ç±»å‹ç«¯å£çš„é»˜è®¤pvidéƒ½æ˜¯vlan1ï¼Œè€Œpvidè¿™ä¸ªå±æ€§åªï¼é’ˆå¯¹ï¼è¿›å…¥ï¼è¯¥ç«¯å£çš„ï¼æ²¡æœ‰æ ‡ç­¾çš„ï¼æ™®é€šæ•°æ®åŒ…æœ‰æ•ˆï¼Œä½œç”¨æ˜¯å°†æ²¡æœ‰æ ‡ç­¾çš„æ™®é€šæ•°æ®åŒ…æ‰“ä¸Špvidä¸­é…ç½®çš„æ ‡ç­¾å· 4ã€hybridå±æ€§ä¸­ï¼Œtagæ˜¯é’ˆå¯¹äºç«¯å£çš„æ¥æ”¶æ–¹å‘çš„ï¼ˆä»è¯¥ç«¯å£è¿›æ¥çš„æµé‡å…è®¸å¸¦æœ‰è¿™äº›vlanæ ‡ç­¾çš„é€šè¿‡ï¼‰ï¼Œuntagæ˜¯é’ˆå¯¹ç«¯å£çš„å‘é€æ–¹å‘çš„ï¼ˆä»è¯¥ç«¯å£å‡ºå»çš„æµé‡å»é™¤è¿™äº›vlanæ ‡ç­¾ï¼‰ 5ã€åŠ å…¥ä¸€ä¸ªhybridç«¯å£é…ç½®tag vlan 2 3å’Œuntag vlan 4 5 ï¼Œé‚£ä¹ˆé»˜è®¤æƒ…å†µä¸‹è¿™ä¸ªhybridå±äºvlan1ã€2ã€3ã€4ã€5ï¼Œåœ¨display vlanä¸­å¯ä»¥æŸ¥çœ‹åˆ°ï¼Œåªæœ‰ç«¯å£å±äºäº†æŸä¸ªvlanï¼Œé‚£ä¹ˆè¯¥ç«¯å£æ‰èƒ½æ”¶åˆ°æŸä¸ªvlançš„æ•°æ®åŒ…ï¼Œè¿™ä¸€ç‚¹æ˜¯ç†è§£ä¸‹åˆ—ä¸¤ç§é…ç½®å’Œhybridç«¯å£å±æ€§çš„å…³é”®ï¼ï¼ï¼ æ”¶å‘è¿‡ç¨‹åœ¨æ•°æ®å‘é€æ—¶untagåˆ—è¡¨çš„åŸç†ï¼Œå¦‚ä¸‹å›¾1.å¸¦æœ‰vlan 3æ ‡ç­¾çš„æ•°æ®ä»F0&#x2F;0æ¥å£å‡ºå»ï¼Œé€šè¿‡æ—¶æŸ¥çœ‹untagåˆ—è¡¨ï¼Œå‘ç°æœ‰å¯¹åº”çš„æ ‡ç­¾ï¼Œå°†æ ‡ç­¾è„±æ‰å‘é€å‡ºå»2.å¸¦æœ‰vlan 8æ ‡ç­¾çš„æ•°æ®ä»F0&#x2F;1æ¥å£å‡ºå»ï¼Œé€šè¿‡æ—¶æŸ¥çœ‹untagåˆ—è¡¨ï¼Œå‘ç°æ²¡æœ‰å¯¹åº”çš„æ ‡ç­¾ï¼Œç»§ç»­æŸ¥çœ‹tagè¡¨ï¼Œå‘ç°æœ‰å¯¹åº”æ ‡ç­¾ï¼Œæ‰€ä»¥ç›´æ¥å¸¦æœ‰vlan 8æ ‡ç­¾çš„æ•°æ®å‘é€å‡ºå»3.å¸¦æœ‰vlan 5æ ‡ç­¾çš„æ•°æ®ä»F0&#x2F;2æ¥å£å‡ºå»ï¼Œé€šè¿‡æ—¶æŸ¥çœ‹untagåˆ—è¡¨ï¼Œå‘ç°æ²¡æœ‰å¯¹åº”çš„æ ‡ç­¾ ï¼Œç»§ç»­æŸ¥çœ‹tagåˆ—è¡¨ï¼Œå‘ç°ä¹Ÿæ²¡æœ‰å¯¹åº”çš„æ ‡ç­¾ï¼Œæ‰€ä»¥æ•°æ®ç›´æ¥è¢«ä¸¢å¼ƒ tagåˆ—è¡¨å¤„ç†æ•°æ®å¸§çš„æ¥æ”¶å’Œå‘é€çš„åŸç†ï¼Œå¦‚ä¸‹å›¾1.æ²¡æœ‰æ ‡ç­¾çš„æ•°æ®è¿›å…¥F0&#x2F;0æ¥å£ï¼Œæ¥å£æŸ¥çœ‹åˆ°æ•°æ®æ²¡æœ‰æ ‡ç­¾ï¼Œæ ¹æ®æ¥å£PVID&#x3D;3ï¼Œå°†vlan 3æ ‡ç­¾æ‰“å…¥æ•°æ®2.å¸¦æœ‰vlan 9æ ‡ç­¾çš„æ•°æ®è¿›å…¥æ¥å£F0&#x2F;1ï¼Œæ¥å£æŸ¥çœ‹åˆ°æ•°æ®å¸¦æœ‰æ ‡ç­¾ï¼Œæ¥ç€æŸ¥çœ‹tagåˆ—è¡¨ï¼Œå‘ç°åˆ—è¡¨ä¸­å­˜åœ¨å¯¹åº”æ ‡ç­¾ï¼Œæ”¾é€šæ•°æ®3.å¸¦æœ‰vlan 5æ ‡ç­¾çš„æ•°æ®ä»æ¥å£F0&#x2F;2å‡ºå»ï¼Œæ¥å£æŸ¥çœ‹åˆ°æ•°æ®å¸¦æœ‰æ ‡ç­¾ï¼ŒæŸ¥çœ‹untagåˆ—è¡¨ï¼Œå‘ç°åˆ—è¡¨ä¸­æ²¡æœ‰å¯¹åº”vlan 5æ ‡ç­¾ï¼Œç»§ç»­æŸ¥çœ‹tagåˆ—è¡¨ï¼Œå‘ç°åˆ—è¡¨ä¸­å­˜åœ¨å¯¹åº”æ ‡ç­¾vlan 5ï¼Œæ”¾é€šæ•°æ®å‡ºå»4.å¸¦æœ‰vlan 3æ ‡ç­¾çš„æ•°æ®ä»F0&#x2F;2æ¥å£å‡ºå»ï¼ŒæŸ¥çœ‹untagåˆ—è¡¨ï¼Œå‘ç°åˆ—è¡¨ä¸­å­˜åœ¨å¯¹åº”vlan 3æ ‡ç­¾ï¼Œå°†æ ‡ç­¾è„±æ‰ï¼Œæ”¾é€šæ•°æ®å‡ºå»5.å¸¦æœ‰vlan 9æ ‡ç­¾çš„æ•°æ®ä»F0&#x2F;2æ¥å£å‡ºå»ï¼ŒæŸ¥çœ‹untagè¡¨ï¼Œå‘ç°åˆ—è¡¨ä¸­ä¸å­˜åœ¨å¯¹åº”vlan 9æ ‡ç­¾ï¼Œç»§ç»­æŸ¥çœ‹tagåˆ—è¡¨ï¼Œå‘ç°åˆ—è¡¨ä¸­ä¸å­˜åœ¨vlan 9æ ‡ç­¾ï¼Œå°†æ•°æ®ä¸¢å¼ƒ å®ä¾‹åˆ†æ 1ã€ä¸ºäº†è®©æˆ‘ä»¬æ›´åŠ ç®€æ´çš„ç†è§£hydridçš„å±æ€§ï¼Œé¦–å…ˆåœ¨æ‰€æœ‰çš„ç«¯å£ä¸Šç§»é™¤äº†vlan1è¿™ä¸ªé»˜è®¤æœ‰çš„vlanï¼Œå‡è®¾ä¸ºæ‰€æœ‰ç«¯å£åˆå§‹ä¸å±äºä»»ä½•vlanï¼Œéƒ½ä¸èƒ½ç›¸äº’ä¹‹é—´é€šä¿¡ 2ã€pvidæ˜¯å½“æ™®é€šçš„ä¸»æœºæ•°æ®å¸§è¿›å…¥äº¤æ¢æœºç«¯å£åè¢«æ‰“ä¸Šçš„vlan-tagçš„å±æ€§ï¼Œåœ¨é€”ä¸­å¯ä»¥çœ‹å‡ºPC1ã€PC2ã€PC3çš„æµé‡åœ¨è¿›å…¥äº¤æ¢æœºçš„æ—¶å€™åˆ†åˆ«ä¼šè¢«æ‰“ä¸Švlan2ã€vlan3ã€vlan99çš„vlanæ ‡ç­¾ 3ã€untagåé¢çš„vlanå°±æ˜¯è¯¥ç«¯å£å±äºçš„vlanï¼Œé‚£ä¹ˆä¸éš¾çœ‹å‡ºLSW1çš„G0&#x2F;0&#x2F;1å±äºvlan2ã€3ï¼ŒG0&#x2F;0&#x2F;2å±äºvlan2ã€10ï¼ŒG0&#x2F;0&#x2F;3å±äºvlan3ã€10ï¼Œè€Œuntagçš„åŠ¨ä½œæ˜¯åœ¨æµé‡å‡ºç«¯å£å»å¾€ä¸»æœºçš„æ—¶å€™æŠŠvlan-tagå…¨éƒ¨å»é™¤ï¼Œé‚£ä¹ˆä¸éš¾çœ‹å‡ºLSW1çš„G0&#x2F;0&#x2F;1å°†å»é™¤vlan2ã€3çš„æ ‡ç­¾ï¼ŒG0&#x2F;0&#x2F;2å»é™¤vlan2ã€10çš„æ ‡ç­¾ï¼ŒG0&#x2F;0&#x2F;3å»é™¤vlan3ã€10çš„æ ‡ç­¾ï¼ˆè¿˜åŸæˆæ™®é€šå¸§ï¼‰ LSW2çš„G0&#x2F;0&#x2F;1å±äºvlan99ï¼ŒG0&#x2F;0&#x2F;2å±äºvlan99ï¼Œåœ¨æµé‡å‡ºç«¯å£çš„æ—¶å€™ä¼šå»é™¤vlan99çš„æ ‡ç­¾ï¼ˆè¿˜åŸæˆæ™®é€šå¸§ï¼‰ é‚£ä¹ˆPC1ä¸PC2çš„é€šä¿¡ç°åœ¨åˆ†æå¦‚ä¸‹ï¼šå½“PC1å‘é€arpå»è¯·æ±‚PC2çš„MACåœ°å€çš„æ—¶å€™ï¼ŒPC1ä¼šå°†æ•°æ®åŒ…å¹¿æ’­å‘å¾€LSW1çš„G0&#x2F;0&#x2F;2æ¥å£ï¼ŒLSW1æ”¶åˆ°åå‘ç°æ˜¯ä¸ªæ™®é€šçš„ä¸å¸¦æ ‡ç­¾çš„æ•°æ®å¸§ï¼Œäºæ˜¯æ ¹æ®æ¥å£çš„pvidç»™è¯¥å¸§æ‰“ä¸Švlan2çš„tagï¼Œç„¶åå¾€vlan2ä¸­è¿›è¡Œæ³›çº¢ï¼Œæ— å¥ˆG0&#x2F;0&#x2F;3ç«¯å£åªå±äºvlan3ã€10æ‰€ä»¥æ— æ³•æ”¶åˆ°vlan2ä¸­çš„æ³›çº¢ï¼Œæ•…PC1ä¸PC2é€šä¿¡å¤±è´¥ã€‚ ä¸‹é¢å†æ¥åˆ†æPC1ä¸PC3é€šä¿¡ï¼šå‰é¢å·²ç»åˆ†æäº†PC1è¦å»è¯·æ±‚PC3çš„MACï¼Œè¢«LSW1çš„G0&#x2F;0&#x2F;2æ”¶åˆ°ï¼Œå¹¶ä¸”æ‰“ä¸Švlan2çš„tagï¼Œç„¶ååœ¨vlan2ä¸­æ³›çº¢ï¼Œé‚£ä¹ˆåœ¨vlan2ä¸­çš„ç«¯å£å°±éƒ½èƒ½æ”¶åˆ°è¯¥æ³›çº¢äº†ï¼Œæ‰€ä»¥åœ¨é…ç½®äº†untag vlan 2 3çš„G0&#x2F;0&#x2F;1ç«¯å£è‡ªç„¶ä¹Ÿèƒ½æ”¶åˆ°vlan2å’Œvlan3çš„æ³›çº¢å¹¶è½¬å‘å‡ºå»ï¼Œä½†æ˜¯LSW1å‘ç°G0&#x2F;0&#x2F;1é…ç½®untag vlan2 3ï¼Œæ‰€ä»¥å°†ä»è¯¥ç«¯å£å‘é€å‡ºå»çš„æ‰€æœ‰å¸¦æœ‰vlan2å’Œvlan3çš„æ•°æ®åŒ…çš„tagå…¨éƒ¨å»é™¤ï¼ˆè¿˜åŸæˆæ™®é€šå¸§ï¼‰ï¼Œç„¶åè¿™ä¸ªæ™®é€šçš„å¸§å°±ä¼šå‘å¾€LSW2è¢«G0&#x2F;0&#x2F;1ç«¯å£æ¥æ”¶åˆ°ï¼ŒLSW2å‘ç°äº†ä¸€ä¸ªæ™®é€šçš„å¸§ï¼Œé‚£ä¹ˆå°±ä¼šç”¨åˆ°pvidäº†ä¸æ˜¯ï¼Œæ‰€ä»¥LSW2æ”¶åˆ°è¿™ä¸ªå¸§åæ‰“ä¸Švlan99çš„tagè¿›è¡Œæ³›çº¢ï¼Œé‚£ä¹ˆPC3æ‰€åœ¨çš„hybridå› ä¸ºé…ç½®æœ‰untag vlan99å¿…ç„¶èƒ½å¤Ÿæ”¶åˆ°vlan99çš„æ•°æ®åŒ…äº†ï¼Œç„¶ååœ¨G0&#x2F;0&#x2F;2å‘ç»™PC3çš„æ—¶å€™å°†vlan99çš„tagå»é™¤æ‰ï¼ŒPC3æ”¶åˆ°çš„å°±æ˜¯ä¸€ä¸ªä¸å¸¦ä»»ä½•tagçš„æ™®é€šåŒ…ï¼ˆPC3å®Œå…¨ä¸çŸ¥é“åœ¨å®ƒä¸ªPC1ä¹‹é—´è¿˜æœ‰SWè¿™ç§ä¸œè¥¿å­˜åœ¨ï¼‰ï¼Œå¥½äº†PC3æ”¶åˆ°äº†PC1å‘æ¥çš„arpè¯·æ±‚ï¼Œé‚£ä¹ˆä½œä¸ºæœ‰ç¤¼è²Œçš„äººåº”è¯¥å›å¤è‡ªå·±çš„MACåœ°å€äº†ï¼Œä¸å›ä¸€ä¸ªarpå“åº”ç»™PC1ï¼Œ ä¸‹é¢PC3çš„å›åŒ…åˆ†æï¼šPC3ä½¿ç”¨PC1çš„MACå’Œipå°è£…å¥½æ•°æ®åŒ…åä»ç½‘å¡å‘é€å‡ºå»ï¼ŒLSW2çš„G0&#x2F;0&#x2F;2ç«¯å£æ”¶åˆ°äº†ï¼Œå‘ç°æ˜¯ä¸€ä¸ªæ™®é€šå¸§ï¼ŒOKæ¥pvidæ‰“ä¸Švlan99çš„tagï¼Œç„¶åæŸ¥çœ‹macåœ°å€è¡¨å‘ç°PC1çš„MACåœ°å€åœ¨G0&#x2F;0&#x2F;1å£ï¼Œåœ¨æŸ¥çœ‹vlanä¿¡æ¯ï¼Œå‘ç°G0&#x2F;0&#x2F;1å£å¯ä»¥æ¥æ”¶vlan99çš„æ•°æ®ï¼ˆuntag vlan99ï¼‰ï¼Œä¸¤ä¸ªè½¬å‘æ¡ä»¶éƒ½æ»¡è¶³äº†ï¼Œé‚£ä¹ˆä¹…æŠŠæ•°æ®åŒ…å‘ç»™G0&#x2F;0&#x2F;1è½¬å‘ï¼ŒG0&#x2F;0&#x2F;1è½¬å‘çš„æ—¶å€™æ ¹æ®untag vlan99æŠŠæ•°æ®åŒ…vlan-idå»é™¤è¿˜åŸæˆæ™®é€šå¸§ï¼Œè¢«LSW1çš„G0&#x2F;0&#x2F;1æ”¶åˆ°ï¼ŒæŒ‰ç…§pvidçš„æƒ¯ä¾‹ï¼Œæ™®é€šå¸§è¢«æ‰“ä¸Šäº†pvid vlan10çš„tagï¼ˆç”¨vlan10ä¸¾ä¾‹ï¼Œä¹Ÿå¯ä»¥æ˜¯ä»»æ„vlanï¼‰ï¼Œç„¶åLSW1æ ¹æ®MACåœ°å€è¡¨æ‰¾åˆ°PC1åœ¨è‡ªå·±çš„G0&#x2F;0&#x2F;2å£ï¼Œå†æŸ¥çœ‹vlanä¿¡æ¯å‘ç°G0&#x2F;0&#x2F;2æ¥å£é…ç½®äº†untag vlan2 10ï¼Œå¯ä»¥æ¥æ”¶vlan10çš„æ•°æ®åŒ…ï¼Œäºæ˜¯å°±æŠŠè¿™ä¸ªè¢«æ‰“ä¸Švlan10çš„PC3å‘æ¥çš„arpå“åº”é€šè¿‡G0&#x2F;0&#x2F;2å‘é€ç»™äº†PC1ï¼Œå½“ç„¶åœ¨ä»G0&#x2F;0&#x2F;2æ¥å£å‡ºå»çš„æ—¶å€™æ ¹æ®untag vlan2 10çš„é…ç½®å°†vlan10çš„tagå»é™¤è¿˜åŸæˆä¸€ä¸ªæ™®é€šçš„å¸§ï¼ŒPC1æ”¶åˆ°çš„æ˜¯ä¸€ä¸ªæ™®é€šçš„å¸§ï¼Œå®Œå…¨ä¸çŸ¥é“å®ƒå’ŒPC3ä¹‹é—´è¿˜æœ‰äº¤æ¢æœºè¿™ä¸ªä¸œè¥¿ã€‚å¥½äº†ï¼Œè¿™å°±æ˜¯ä¸€æ¬¡é€šä¿¡è¿‡ç¨‹ï¼ŒPC2ä¸PC3çš„é€šä¿¡åŸç†ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œäºæ˜¯å°±å®ç°äº†PC3ä¸PC1ã€PC2äº’é€šï¼ŒPC1ä¸PC2ä¹‹é—´ä¸é€šçš„æ•ˆæœã€‚","categories":[{"name":"ipå®éªŒ","slug":"ipå®éªŒ","permalink":"http://example.com/categories/ip%E5%AE%9E%E9%AA%8C/"}],"tags":[{"name":"hybrid","slug":"hybrid","permalink":"http://example.com/tags/hybrid/"},{"name":"tag","slug":"tag","permalink":"http://example.com/tags/tag/"}]},{"title":"telnet","slug":"telnet","date":"2023-12-02T09:19:24.000Z","updated":"2023-12-02T09:35:21.015Z","comments":true,"path":"2023/12/02/telnet/","permalink":"http://example.com/2023/12/02/telnet/","excerpt":"","text":"ä¸¤ç§é…ç½®æ–¹æ³•1.ä»…å¯†ç ç™»å½•éªŒè¯ä»£ç å¦‚ä¸‹ï¼ˆç¤ºä¾‹ï¼‰ï¼šsystem-view â€”â€“è¿›å…¥é…ç½®æ¨¡å¼[Quidway]interface vlan 1 â€”â€“è¿›å…¥ç®¡ç†vlan[Quidway-Vlanif1]ip address 192.168.28.49 255.255.255.0 â€”â€“é…ç½®ç®¡ç†ipåœ°å€[Quidway-Vlanif1]quit â€”â€“é€€å‡º[Quidway]telnet server enable â€”â€“æ‰“å¼€telnetæœåŠ¡ ï¼ˆä¸€èˆ¬é»˜è®¤å¼€å¯ï¼‰[Quidway]user-interface vty 0 4 â€”â€“ç”¨æˆ·æŒ‡å®šè™šæ‹Ÿç”¨æˆ·ç»ˆç«¯æ¥å£[Quidway-ui-vty0-4]authentication-mode password â€”â€“é…ç½®ç”¨æˆ·ç»ˆç«¯æ¥å£è®¤è¯æ–¹å¼ å¯†ç éªŒè¯[Quidway-ui-vty0-4]set authentication password cipher huawei123 â€”â€“è®¾ç½®æ¥å£éªŒè¯å¯†ç ,å¯†ç ä¸ºhuawei123[Quidway-ui-vty0-4]user privilege level 15 â€”â€“è®¾ç½®ç”¨æˆ·ä¼˜å…ˆçº§ ï¼ˆå¯é€‰ï¼‰[Quidway-ui-vty0-4]idle-timeout 1 â€”â€“è®¾ç½®ç™»é™†è¶…æ—¶ä¸ºä¸€åˆ†é’Ÿ ï¼ˆå¯é€‰ï¼‰[Quidway-ui-vty0-4]return â€”â€“è¿”å›ç”¨æˆ·è§†å›¾save â€”â€“ä¿å­˜ 2.é…ç½®AAAç™»å½•ä»£ç å¦‚ä¸‹ï¼ˆç¤ºä¾‹ï¼‰ï¼šsystem-view â€”â€“è¿›å…¥é…ç½®æ¨¡å¼[Quidway]interface vlan 1 â€”â€“è¿›å…¥ç®¡ç†vlan[Quidway-Vlanif1]ip address 192.168.28.49 255.255.255.0 â€”â€“é…ç½®ç®¡ç†ipåœ°å€[Quidway-Vlanif1]quit â€”â€“é€€å‡º[Quidway]telnet server enable â€”â€“æ‰“å¼€telnetæœåŠ¡ ï¼ˆä¸€èˆ¬é»˜è®¤å¼€å¯ï¼‰[Quidway]user-interface vty 0 4 â€”â€“ç”¨æˆ·æŒ‡å®šè™šæ‹Ÿç”¨æˆ·ç»ˆç«¯æ¥å£[Quidway-ui-vty0-4]authentication-mode aaa â€”â€“é…ç½®ç”¨æˆ·ç»ˆç«¯æ¥å£è®¤è¯æ–¹å¼ aaaéªŒè¯[Quidway-ui-vty0-4]user privilege level 15 â€”â€“è®¾ç½®ç”¨æˆ·ä¼˜å…ˆçº§[Quidway-ui-vty0-4]idle-timeout 1 â€”â€“è®¾ç½®ç™»é™†è¶…æ—¶ä¸ºä¸€åˆ†é’Ÿ[Quidway-ui-vty0-4]quit â€”â€“é€€å‡º[Quidway]aaa â€”â€“è¿›å…¥aaa[Quidway-aaa]local-user huawei password cipher huawei123 â€”â€“åˆ›å»ºç”¨æˆ·åhuawei å¯†ç huawei123[Quidway-aaa]local-user huawei privilege level 15 â€”â€“è®¾ç½®ç”¨æˆ·ä¼˜å…ˆçº§[Quidway-aaa]local-user huawei service-type telnet â€”â€“æˆæƒç”¨æˆ·ä½¿ç”¨telnet[Quidway-ui-vty0-4]return â€”â€“è¿”å›ç”¨æˆ·è§†å›¾save â€”â€“ä¿å­˜ user-interface vty 0 4 è¯¦è§£Quidway]user-interface vty 0 4 ï¼›è¿›å…¥è™šæ‹Ÿç»ˆç«¯[S3026-ui-vty0-4]authentication-mode password ï¼›è®¾ç½®å£ä»¤æ¨¡å¼[S3026-ui-vty0-4]set authentication-mode password simple 222 ï¼›è®¾ç½®å£ä»¤[S3026-ui-vty0-4]user privilege level 3 ä¸€ã€ç¬¬ä¸€å¥çš„æ„æ€æ˜¯ï¼šè¿›å…¥åˆ°vty ç»ˆç«¯ï¼Œåœ¨åä¸ºçš„äº¤æ¢æœºé‡Œï¼Œvtyå°±æ˜¯äººå®¶ç”¨telnetè¿œç¨‹è¿›å…¥åˆ°ä½ äº¤æ¢æœºçš„ç•Œé¢ï¼Œæœ€å¤šæœ‰äº”ä¸ªï¼Œæ‰€ä»¥è¯´ä½ å¯ä»¥vty 0 vty 1 vtyâ€¦ vty 4äº¤æ¢æœºæœ€å¤šå¯ä»¥å…è®¸äº”ä¸ªäººåŒæ—¶åœ¨çº¿è¿›åˆ°äº¤æ¢æœºé‡Œå»é…ç½®å‘½ä»¤çš„ã€‚vty0 4 å°±æ˜¯è¯´æŠŠè¿™äº”ä¸ªç•Œé¢ä¸€èµ·é…ç½®äº†ï¼Œè¿™äº”ä¸ªç•Œé¢è¿›å»çš„è¯ï¼Œéƒ½æ˜¯ä½¿ç”¨ä»¥ä¸‹çš„é…ç½®ã€‚äºŒã€ç”¨çš„è®¤è¯æ¨¡å¼æ˜¯å¯†ç è®¤è¯ï¼Œå¯ä»¥ä½¿ç”¨schemeæ¨¡å¼æ¥ï¼Œä¹Ÿå¯ä»¥ç”¨passwordæ¥ï¼Œç”¨passwordçš„è¯ï¼Œæ˜¯è¦å¯†ç çš„ï¼Œå°±æ˜¯è¯´ä½ telnetçš„è¯ï¼Œè¦è¾“å…¥å¯†ç æ‰èƒ½ç™»é™†åˆ°åŒ…äº¤æ¢æœºé‡Œå»çš„ã€‚äºŒã€è®¾ç½®å¯†ç ä¸ºæ˜æ–‡å¯†ç ï¼Œå¯†ç æ˜¯123 ï¼Œå¦‚æœæ˜¯å¯†æ–‡çš„è¯ï¼Œå°±æ˜¯cipherå››ã€ç”¨æˆ·ç­‰çº§ä¸º3ï¼Œä¹Ÿå°±æ˜¯æœ€é«˜çš„ï¼Œåä¸ºçš„å‘½ä»¤çº§åˆ«å¾ˆå¤šï¼Œåˆ†ä¸ºå››çº§ï¼Œ0 1 2 3 ï¼Œ0æ˜¯å‚è§‚çº§ï¼Œåªèƒ½çœ‹ï¼Œ1æ¯”0è¦é«˜ï¼Œå¯ä»¥ä½¿ç”¨ä¸€äº›å‘½ä»¤ï¼Œ2 æ˜¯å¯ä»¥é…ç½®äº†ï¼Œ3å¯ä»¥å¤‡ä»½ä¸åˆ é™¤IOSå•¦ï¼Œå‘µå‘µï¼Œè¿™ä¸ªå‘½ä»¤å°±æ˜¯è¯´ç”¨è¿™ä¸ª123å¯†ç ï¼Œè¿›æ¥å°±æ˜¯æœ€é«˜çº§åˆ«çš„ï¼Œä¸ç”¨æ¢çº§åˆ«ã€‚","categories":[{"name":"ipå®éªŒ","slug":"ipå®éªŒ","permalink":"http://example.com/categories/ip%E5%AE%9E%E9%AA%8C/"}],"tags":[{"name":"telnet","slug":"telnet","permalink":"http://example.com/tags/telnet/"},{"name":"aaa","slug":"aaa","permalink":"http://example.com/tags/aaa/"}]},{"title":"FTPå®éªŒ","slug":"FTPå®éªŒ","date":"2023-11-30T10:10:45.000Z","updated":"2023-11-30T10:55:14.400Z","comments":true,"path":"2023/11/30/FTPå®éªŒ/","permalink":"http://example.com/2023/11/30/FTP%E5%AE%9E%E9%AA%8C/","excerpt":"","text":"File Transfer Protocol æ–‡ä»¶ä¼ è¾“åè®®FTPæœåŠ¡å™¨å¼€å¯21å·ç«¯å£è¿›è¡Œæ§åˆ¶è¿æ¥ï¼Œ20å·ç«¯å£ä¸å®¢æˆ·ç«¯å»ºç«‹æ•°æ®è¿æ¥ ASCII ((American Standard Code for Information Interchange): ç¾å›½ä¿¡æ¯äº¤æ¢æ ‡å‡†ä»£ç ï¼‰æ˜¯åŸºäºæ‹‰ä¸å­—æ¯çš„ä¸€å¥—ç”µè„‘ç¼–ç ç³»ç»Ÿï¼Œä¸»è¦ç”¨äºæ˜¾ç¤ºç°ä»£è‹±è¯­å’Œå…¶ä»–è¥¿æ¬§è¯­è¨€ï¼Œå®ƒæ˜¯æœ€é€šç”¨çš„ä¿¡æ¯äº¤æ¢æ ‡å‡†ã€‚ FTPæ˜¯ç”¨æ¥ä¼ é€æ–‡ä»¶çš„åè®®ã€‚ä½¿ç”¨FTPå®ç°è¿œç¨‹æ–‡ä»¶ä¼ è¾“çš„åŒæ—¶ï¼Œè¿˜å¯ä»¥ä¿è¯æ•°æ®ä¼ è¾“çš„å¯é æ€§å’Œé«˜æ•ˆæ€§ã€‚ FTP æ˜¯åŸºäºå®¢æˆ·â€”â€”â€”æœåŠ¡å™¨ï¼ˆC&#x2F;Sï¼‰æ¨¡å‹è€Œè®¾è®¡çš„ï¼Œåœ¨å®¢æˆ·ç«¯ä¸ FTP æœåŠ¡å™¨ä¹‹é—´å»ºç«‹ä¸¤ä¸ªè¿æ¥ ä¼ è¾“æ–¹å¼FTPæ”¯æŒä¸¤ç§æ–¹å¼çš„ä¼ è¾“ï¼šæ–‡æœ¬ï¼ˆASCIIï¼‰æ–¹å¼å’ŒäºŒè¿›åˆ¶ï¼ˆBinaryï¼‰æ–¹å¼ã€‚é€šå¸¸æ–‡æœ¬æ–‡ä»¶çš„ä¼ è¾“é‡‡ç”¨ASCIIæ–¹å¼ï¼Œè€Œå›¾è±¡ã€å£°éŸ³æ–‡ä»¶ã€åŠ å¯†å’Œå‹ç¼©æ–‡ä»¶ç­‰éæ–‡æœ¬æ–‡ä»¶é‡‡ç”¨äºŒè¿›åˆ¶æ–¹å¼ä¼ è¾“ï¼Œå¦‚æœä¸ºäº†ä»ä¸€ä¸ªç³»ç»Ÿä¸Šä¼ è¾“æ–‡ä»¶è€Œä½¿ç”¨äº†ä¸æœ¬åœ°ç³»ç»Ÿä¸åŒçš„è®¡ç®—æœºå­—èŠ‚ä½æ•°ï¼Œé‚£ä¹ˆå°±å¿…é¡»ä½¿ç”¨Tenexæ¨¡å¼ã€‚FTPä»¥ASCIIæ–¹å¼ä½œä¸ºç¼ºçœçš„æ–‡ä»¶ä¼ è¾“æ–¹å¼ã€‚ ä¼ è¾“è¿‡ç¨‹ ä½¿ç”¨FTPè¿›è¡Œæ–‡ä»¶ä¼ è¾“æ—¶ï¼Œä¼šä½¿ç”¨ä¸¤ä¸ªTCPè¿æ¥ã€‚ç¬¬ä¸€ä¸ªè¿æ¥æ˜¯FTPå®¢æˆ·ç«¯å’ŒFTPæœåŠ¡å™¨é—´çš„æ§åˆ¶è¿æ¥ã€‚FTPæœåŠ¡å™¨å¼€å¯21å·ç«¯å£ï¼Œç­‰å¾…FTPå®¢æˆ·ç«¯å‘é€è¿æ¥è¯·æ±‚ã€‚FTPå®¢æˆ·ç«¯éšæœºå¼€å¯ç«¯å£ï¼Œå‘æœåŠ¡å™¨å‘é€å»ºç«‹è¿æ¥çš„è¯·æ±‚ã€‚æ§åˆ¶è¿æ¥ç”¨äºåœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´ä¼ è¾“æ§åˆ¶å‘½ä»¤ã€‚ ç¬¬äºŒä¸ªè¿æ¥æ˜¯FTPå®¢æˆ·ç«¯å’ŒFTPæœåŠ¡å™¨é—´çš„æ•°æ®è¿æ¥ã€‚æœåŠ¡å™¨ä½¿ç”¨TCPçš„20å·ç«¯å£ä¸å®¢æˆ·ç«¯å»ºç«‹æ•°æ®è¿æ¥ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨ä¸»åŠ¨å»ºç«‹æˆ–ä¸­æ–­æ•°æ®è¿æ¥ã€‚ FTPæœåŠ¡å™¨é…ç½®è·¯ç”±å™¨å’ŒX7ç³»åˆ—äº¤æ¢æœºå‡å¯æä¾›FTPåŠŸèƒ½ã€‚æ‰§è¡Œftp server enableå‘½ä»¤ä½¿èƒ½FTPåŠŸèƒ½ã€‚æ‰§è¡Œset default ftp-directoryå‘½ä»¤è®¾ç½®FTPç”¨æˆ·çš„é»˜è®¤å·¥ä½œç›®å½•ã€‚ åœ¨é…ç½®FTPæœåŠ¡å™¨æ—¶ï¼Œå¯ä»¥ä½¿ç”¨AAAä¸ºæ¯ä¸ªç”¨æˆ·åˆ†åˆ«é…ç½®ç™»å½•è´¦å·å’Œè®¿é—®æƒé™ã€‚ aaaå‘½ä»¤ç”¨æ¥è¿›å…¥AAAè§†å›¾ã€‚ local-user user-name { access-limit max-number | ftp-directory directory | idle-timeout minutes [ seconds ] | password cipher password [ opt ] | privilege level level | state {active | block } } *å‘½ä»¤ç”¨æ¥åˆ›å»ºæœ¬åœ°ç”¨æˆ·ï¼Œå¹¶é…ç½®æœ¬åœ°ç”¨æˆ·çš„å„é¡¹å‚æ•°ã€‚ user-nameæŒ‡å®šç”¨æˆ·åã€‚ local-user huawei service-type ftpå‘½ä»¤ç”¨æ¥é…ç½®æœ¬åœ°ç”¨æˆ·çš„æ¥å…¥ç±»å‹ä¸ºftpã€‚ ftp-directoryæŒ‡å®šFTPç”¨æˆ·å¯è®¿é—®çš„ç›®å½•ã€‚å¦‚æœä¸é…ç½®FTPç”¨æˆ·å¯è®¿é—®çš„ç›®å½•ï¼Œåˆ™FTPç”¨æˆ·æ— æ³•ç™»å½•è®¾å¤‡ã€‚ access-limitæŒ‡å®šç”¨æˆ·åå¯å»ºç«‹çš„æœ€å¤§è¿æ¥æ•°ç›®ã€‚ idle-timeoutæŒ‡å®šç”¨æˆ·çš„é—²ç½®è¶…æ—¶æ—¶é—´ã€‚ privilege levelæŒ‡å®šç”¨æˆ·çš„ä¼˜å…ˆçº§ã€‚ å‘½ä»¤è¯¦è§£idle-timeoutidle-timeoutå‘½ä»¤ç”¨æ¥è®¾ç½®ç”¨æˆ·è¿æ¥çš„è¶…æ—¶æ—¶é—´ã€‚ undo idle-timeoutå‘½ä»¤ç”¨æ¥æ¢å¤è¶…æ—¶æ—¶é—´çš„ç¼ºçœå€¼ã€‚ ç¼ºçœæƒ…å†µä¸‹ï¼Œç”¨æˆ·è¿æ¥çš„è¶…æ—¶æ—¶é—´æ˜¯5åˆ†é’Ÿã€‚ å‘½ä»¤æ ¼å¼ idle-timeout minutes [ seconds ] undo idle-timeout minutes æŒ‡å®šç”¨æˆ·ç•Œé¢æ–­è¿çš„è¶…æ—¶æ—¶é—´çš„åˆ†é’Ÿæ•°ã€‚ æ•´æ•°å½¢å¼ï¼Œå–å€¼èŒƒå›´æ˜¯0ï½35791ï¼Œå•ä½æ˜¯åˆ†é’Ÿã€‚ seconds æŒ‡å®šç”¨æˆ·ç•Œé¢æ–­è¿çš„è¶…æ—¶æ—¶é—´çš„ç§’æ•°ã€‚ æ•´æ•°å½¢å¼ï¼Œå–å€¼èŒƒå›´æ˜¯0ï½59ï¼Œå•ä½æ˜¯ç§’ ç¼ºçœçº§åˆ« 3ï¼šç®¡ç†çº§ è®¾ç½®æ‰§è¡Œå‘½ä»¤idle-timeout 0 0å³å…³é—­ç”¨æˆ·ç•Œé¢çš„è¶…æ—¶æ–­è¿åŠŸèƒ½ã€‚ å¦‚æœç”¨æˆ·ç•Œé¢æ²¡æœ‰è®¾ç½®é—²ç½®æ–­è¿åŠŸèƒ½ï¼Œåˆ™ä¼šå¯¼è‡´å·²ç™»å½•çš„ç”¨æˆ·å§‹ç»ˆå¤„äºè¿æ¥çŠ¶æ€ï¼Œç»™è®¾å¤‡å¸¦æ¥å®‰å…¨é£é™©ï¼ŒåŒæ—¶è¿˜æœ‰å¯èƒ½å¯¼è‡´å…¶ä»–ç”¨æˆ·æ— æ³•è·å¾—è¿æ¥ã€‚ é€šå¸¸æƒ…å†µä¸‹ï¼Œæ¨èè®¾ç½®ç”¨æˆ·ç•Œé¢æ–­è¿çš„è¶…æ—¶æ—¶é—´åœ¨10ï½15åˆ†é’Ÿä¹‹é—´ã€‚ # è®¾ç½®è¶…æ—¶ä¸º1åˆ†é’Ÿ30ç§’ã€‚ 1idle-timeout 1 30 local-user privilege levelå¿…é¡»é…ç½®åœ¨3ä»¥ä¸Šï¼Œå¦åˆ™ftpè¿æ¥æ— æ³•æˆåŠŸ local-user privilege levelå‘½ä»¤ç”¨æ¥é…ç½®æœ¬åœ°ç”¨æˆ·çš„ä¼˜å…ˆçº§ã€‚ undo local-user privilege levelå‘½ä»¤ç”¨æ¥å°†æœ¬åœ°ç”¨æˆ·çš„ä¼˜å…ˆçº§æ¢å¤ä¸ºç¼ºçœé…ç½®ã€‚ ç¼ºçœæƒ…å†µä¸‹ï¼Œæœ¬åœ°ç”¨æˆ·ï¼ˆå¦‚Telnetç”¨æˆ·ã€SSHç”¨æˆ·ï¼‰çš„ä¼˜å…ˆçº§ç”±ç®¡ç†æ¨¡å—æ¥å†³å®šã€‚ å‘½ä»¤æ ¼å¼ local-user user-name privilege level level undo local-user user-name privilege level user-name ç”¨æˆ·åã€‚ å­—ç¬¦ä¸²å½¢å¼ï¼Œä¸æ”¯æŒç©ºæ ¼ï¼Œä¸åŒºåˆ†å¤§å°å†™ï¼Œé•¿åº¦èŒƒå›´æ˜¯1~64ã€‚ level ç”¨æˆ·çš„ä¼˜å…ˆçº§ã€‚ æ•´æ•°å½¢å¼ï¼Œå–å€¼èŒƒå›´æ˜¯0~15ï¼Œå–å€¼è¶Šå¤§ï¼Œç”¨æˆ·çš„ä¼˜å…ˆçº§è¶Šé«˜ã€‚ç¼ºçœçº§åˆ«æ˜¯0çº§ã€‚ä¸åŒçº§åˆ«çš„ç”¨æˆ·ç™»å½•åï¼Œåªèƒ½ä½¿ç”¨ç­‰äºæˆ–ä½äºè‡ªå·±çº§åˆ«çš„å‘½ä»¤ ç¼ºçœæƒ…å†µä¸‹ï¼Œå‘½ä»¤çº§åˆ«åˆ†ä¸º0~3çº§ï¼š çº§åˆ«0å³å‚è§‚çº§ï¼Œç½‘ç»œè¯Šæ–­å·¥å…·å‘½ä»¤ï¼ˆpingã€tracertï¼‰ã€ä»æœ¬è®¾å¤‡å‡ºå‘è®¿é—®å¤–éƒ¨è®¾å¤‡çš„å‘½ä»¤ï¼ˆåŒ…æ‹¬ï¼šTelnet å®¢æˆ·ç«¯ã€SSHï¼‰ç­‰ã€‚è¯¥çº§åˆ«å‘½ä»¤ä¸å…è®¸è¿›è¡Œé…ç½®æ–‡ä»¶ä¿å­˜çš„æ“ä½œã€‚ çº§åˆ«1å³ç›‘æ§çº§ï¼Œç”¨äºç³»ç»Ÿç»´æŠ¤ï¼ŒåŒ…æ‹¬displayå‘½ä»¤ã€‚è¯¥çº§åˆ«å‘½ä»¤ä¸å…è®¸è¿›è¡Œé…ç½®æ–‡ä»¶ä¿å­˜çš„æ“ä½œã€‚ çº§åˆ«2å³é…ç½®çº§ï¼Œå¯ä»¥ä½¿ç”¨ä¸šåŠ¡é…ç½®å‘½ä»¤ï¼ŒåŒ…æ‹¬è·¯ç”±ã€å„ä¸ªç½‘ç»œå±‚æ¬¡çš„å‘½ä»¤ï¼Œå‘ç”¨æˆ·æä¾›ç›´æ¥ç½‘ç»œæœåŠ¡ã€‚ çº§åˆ«3å³ç®¡ç†çº§ï¼Œç”¨äºç³»ç»ŸåŸºæœ¬è¿è¡Œçš„å‘½ä»¤ï¼Œå¯¹ä¸šåŠ¡æä¾›æ”¯æ’‘ä½œç”¨ï¼ŒåŒ…æ‹¬æ–‡ä»¶ç³»ç»Ÿã€FTPã€TFTPã€é…ç½®æ–‡ä»¶åˆ‡æ¢å‘½ä»¤ã€å¤‡æ¿æ§åˆ¶å‘½ä»¤ã€ç”¨æˆ·ç®¡ç†å‘½ä»¤ã€å‘½ä»¤çº§åˆ«è®¾ç½®å‘½ä»¤ã€ç³»ç»Ÿå†…éƒ¨å‚æ•°è®¾ç½®å‘½ä»¤ï¼›ç”¨äºä¸šåŠ¡æ•…éšœè¯Šæ–­çš„debuggingå‘½ä»¤ã€‚ access-limitaccess-limitå‘½ä»¤ç”¨æ¥é…ç½®å½“å‰åŸŸå…è®¸æ¥å…¥çš„ç”¨æˆ·æ•°ã€‚ undo access-limitå‘½ä»¤ç”¨æ¥æ¢å¤ç¼ºçœé…ç½®ã€‚ ç¼ºçœæƒ…å†µä¸‹ï¼Œä¸é™åˆ¶æ¥å…¥çš„ç”¨æˆ·æ•°ç›®ã€‚ å‘½ä»¤æ ¼å¼ access-limit max-number undo access-limit max-number æŒ‡å®šå…è®¸æ¥å…¥çš„ç”¨æˆ·æ•°ã€‚ æ•´æ•°å½¢å¼ï¼Œå–å€¼èŒƒå›´æ˜¯0ï½283648ã€‚ ä¸ºäº†æ›´æ–¹ä¾¿åœ°ç®¡ç†ç”¨æˆ·è®¿é—®è®¾å¤‡ï¼Œå¯ä»¥é™åˆ¶åŸŸä¸‹ç”¨æˆ·çš„åœ¨çº¿æ•°é‡ã€‚ æ³¨æ„äº‹é¡¹ æ‰§è¡Œè¿™æ¡é…ç½®å‘½ä»¤åï¼Œå½“æ¥å…¥ç”¨æˆ·æ•°å¤§äºå…è®¸çš„ç”¨æˆ·æ•°æ—¶ï¼Œç³»ç»Ÿä¸å†å…è®¸ç”¨æˆ·æ¥å…¥ç³»ç»Ÿï¼Œæç¤ºç”¨æˆ·è®¤è¯å¤±è´¥ã€‚ access-limitå‘½ä»¤å¯¹ä¸€ä¸ªåŸŸä¸‹æ‰€èƒ½æ¥å…¥çš„ç”¨æˆ·æ€»æ•°è¿›è¡Œé™åˆ¶ï¼Œä¸åŒºåˆ†æ¥å…¥ç”¨æˆ·çš„ç±»å‹ã€‚ # è®¾ç½®å½“å‰åŸŸæœ€å¤šå…è®¸æ¥å…¥100ä¸ªç”¨æˆ·ã€‚ 1access-limit 100 local-user ftp-directorylocal-user ftp-directoryå‘½ä»¤ç”¨æ¥é…ç½®æœ¬åœ°ç”¨æˆ·çš„FTPç›®å½•ã€‚ undo local-user ftp-directoryå‘½ä»¤ç”¨æ¥å°†æœ¬åœ°ç”¨æˆ·çš„FTPç›®å½•æ¢å¤ä¸ºç¼ºçœé…ç½®ã€‚ ç¼ºçœæƒ…å†µä¸‹ï¼Œæœ¬åœ°ç”¨æˆ·çš„FTPç›®å½•ä¸ºç©ºã€‚ å½“éœ€è¦å°†è®¾å¤‡é…ç½®ä¸ºFTPæœåŠ¡å™¨ï¼Œä»è€Œä¾¿äºæœ¬åœ°ç”¨æˆ·ä»¥FTPæ–¹å¼ç™»å½•è®¾å¤‡ï¼Œå¯¹è®¾å¤‡ä¸Šçš„æ–‡ä»¶è¿›è¡Œå¢åŠ ã€åˆ é™¤ã€ä¿®æ”¹ç­‰æ“ä½œæ—¶ï¼Œå¯ä»¥é€šè¿‡æœ¬å‘½ä»¤é…ç½®æœ¬åœ°ç”¨æˆ·ä»¥FTPæ–¹å¼ç™»å½•è®¾å¤‡åæ‰€å¤„çš„ç›®å½•ã€‚ ä¸æŒ‡å®šè¯¥ç›®å½•æ—¶ï¼Œæœ¬åœ°ç”¨æˆ·æ— æ³•ä»¥FTPæ–¹å¼ç™»å½•è®¾å¤‡ã€‚ é…ç½®æœ¬åœ°ç”¨æˆ·çš„FTPç›®å½•æ—¶ï¼Œè¯¥ç”¨æˆ·å¿…é¡»å·²ç”±local-user passwordå‘½ä»¤å»ºç«‹ã€‚ local-user passwordlocal-user passwordå‘½ä»¤ç”¨æ¥åˆ›å»ºä¸€ä¸ªæœ¬åœ°ç”¨æˆ·å¹¶é…ç½®è¯¥ç”¨æˆ·çš„ç™»å½•å¯†ç ï¼Œæˆ–è€…ä¿®æ”¹å·²åˆ›å»ºç”¨æˆ·çš„ç™»å½•å¯†ç ã€‚ undo local-userå‘½ä»¤ç”¨æ¥åˆ é™¤ä¸€ä¸ªæœ¬åœ°ç”¨æˆ·ã€‚ ç¼ºçœæƒ…å†µä¸‹ï¼Œç³»ç»Ÿæ²¡æœ‰æœ¬åœ°ç”¨æˆ·ã€‚ local-user user-name password [ cipher password | irreversible-cipher irreversible-cipher-password ] undo local-user user-name cipher password æŒ‡å®šå¯†æ–‡å¯†é’¥ã€‚å¯†é’¥ä»¥æ˜æ–‡æˆ–å¯†æ–‡å½¢å¼è¾“å…¥ï¼Œä½†é…ç½®æ–‡ä»¶ä¸­ä¿å­˜ä¸ºå¯†æ–‡å½¢å¼ã€‚ irreversible-cipher irreversible-cipher-password æŒ‡å®šä¸å¯é€†å¯†æ–‡å¯†é’¥ã€‚å¯†é’¥ä»¥æ˜æ–‡æˆ–ä¸å¯é€†å¯†æ–‡å½¢å¼è¾“å…¥ï¼Œä½†é…ç½®æ–‡ä»¶ä¸­ä¿å­˜ä¸ºå¯†æ–‡å½¢å¼ã€‚ æ€»ç»“1.FTPæœåŠ¡å™¨éœ€è¦å¼€å¯TCPçš„21å·ç«¯å£æ¥å»ºç«‹æ§åˆ¶è¿æ¥ï¼Œ20å·ç«¯å£æ¥å»ºç«‹æ•°æ®è¿æ¥ã€‚ 2.å¦‚æœç”¨æˆ·æ— æƒè®¿é—®ä»»ä½•å·¥ä½œç›®å½•ï¼Œåˆ™éœ€è¦å®šä¹‰ä¸€ä¸ªé»˜è®¤çš„FTPç›®å½•ã€‚æ‰§è¡Œset default ftp-directory å‘½ä»¤å»ºç«‹é»˜è®¤ç›®å½•ã€‚ FTPå®éªŒR1 åšä¸ºFTP Server è¿›è¡Œé…ç½®R2 åšä¸ºClient æµ‹è¯• R1ï¼šundo ter mosyssysname R1int g0&#x2F;0&#x2F;0ip add 192.168.1.1 24 R2ï¼šundo ter mosyssysname R2int g0&#x2F;0&#x2F;0ip add 192.168.1.2 24 R1:ftp server enableset default ftp-directory flash:&#x2F; ï¼ˆè®¾ç½®é»˜è®¤ç›®å½•ä¸ºflash:&#x2F;ï¼‰ ftp server enableå‘½ä»¤ç”¨æ¥å¼€å¯è®¾å¤‡çš„FTPæœåŠ¡å™¨åŠŸèƒ½ï¼Œå…è®¸FTPç”¨æˆ·ç™»å½•ã€‚ç¼ºçœæƒ…å†µä¸‹ï¼ŒFTPæœåŠ¡å™¨åŠŸèƒ½å¤„äºå…³é—­çŠ¶æ€ã€‚ å…¶ä»–å¯é€‰çš„é…ç½®å‚æ•°è¿˜åŒ…æ‹¬ï¼šæŒ‡å®šFTPæœåŠ¡å™¨ç«¯å£å·ã€æŒ‡å®šFTPæœåŠ¡å™¨çš„æºåœ°å€å’Œé…ç½®FTPè¿æ¥ç©ºé—²æ—¶é—´ç­‰ã€‚ R1ï¼š é€šè¿‡åœ¨AAAä¸­è®¾ç½®ç”¨æˆ·åå’Œå¯†ç ï¼ˆå‡ä¸ºhuaweiï¼‰aaalocal-user huawei password cipher huaweilocal-user huawei service-type ftplocal-user huawei ftp-directory flash:&#x2F;local-user huawei access-limit 200local-user huawei idle-timeout 0 0local-user huawei privilege level 3 æŸ¥çœ‹ftp serveré…ç½®ä¿¡æ¯ R2ç™»å½•FTPæœåŠ¡å™¨ åœ¨R1å’ŒR2ä¸Šåˆ†åˆ«ä¿å­˜æ–‡ä»¶text1.cfgå’Œtext2.cfgï¼Œç”¨äºåç»­æµ‹è¯• R1ï¼šsave text1.cfg R2ï¼šsave text2.cfg R2ä¸Šé€šè¿‡dirå‘½ä»¤æŸ¥çœ‹æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ R2ä»æœåŠ¡å™¨ä¸Šä¸‹è½½text1.cfgæ–‡ä»¶ï¼Œå¹¶æ”¹åä¸ºnewtext1.cfg R2æœ¬åœ°æŸ¥çœ‹dir putæŠŠæœ¬åœ°æ–‡ä»¶text2.cfgä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œå¹¶æ”¹åä¸ºnewtext2.cfg æŸ¥çœ‹æ˜¯å¦ä¸Šä¼ æˆåŠŸ å…³é—­ftpè¿æ¥ï¼šbye","categories":[{"name":"ipå®éªŒ","slug":"ipå®éªŒ","permalink":"http://example.com/categories/ip%E5%AE%9E%E9%AA%8C/"}],"tags":[{"name":"FTP","slug":"FTP","permalink":"http://example.com/tags/FTP/"}]},{"title":"VRRPåŸºç¡€å®éªŒ","slug":"VRRPåŸºç¡€å®éªŒ","date":"2023-11-29T13:01:52.000Z","updated":"2023-11-29T13:33:55.792Z","comments":true,"path":"2023/11/29/VRRPåŸºç¡€å®éªŒ/","permalink":"http://example.com/2023/11/29/VRRP%E5%9F%BA%E7%A1%80%E5%AE%9E%E9%AA%8C/","excerpt":"","text":"è®¾å¤‡è¿æ¥æ–¹å¼å¦‚å›¾æ‰€ç¤ºï¼Œç½‘ç»œä¸­å­˜åœ¨VLAN10ã€20ï¼Œæ¯ä¸ªVLANä¸­éƒ¨ç½²ä¸€ç»„VRRPï¼Œä½¿ç”¨ä¸VLAN IDç›¸åŒçš„æ•°å€¼ä½œä¸ºVRIDï¼Œå°†S1é…ç½®ä¸ºVLAN10çš„VRRP Masterï¼Œå°†S2é…ç½®ä¸ºVLAN20çš„VRRP Masterã€‚ åŒæ—¶åœ¨S1ã€S2ã€S3ä¸Šéƒ¨ç½²MSTPï¼Œåˆ›å»ºInstance 1ã€2ï¼Œå°†VLAN10æ˜ å°„åˆ°MSTI 1ã€VLAN20æ˜ å°„åˆ°MSTI 2ï¼Œå°†S1é…ç½®ä¸ºMSTI 1çš„ä¸»æ ¹æ¡¥ã€MSTI 2çš„å¤‡ä»½æ ¹æ¡¥ï¼Œè€Œå°†S2é…ç½®ä¸ºMSTI 1çš„å¤‡ä»½æ ¹æ¡¥ã€MSTI 2çš„ä¸»æ ¹æ¡¥ã€‚ VLANIFæ¥å£åœ°å€ä½¿ç”¨10.0.x.y&#x2F;24ï¼Œå…¶ä¸­xä¸ºVRIDç»„å·ï¼Œyä¸ºè®¾å¤‡ç¼–å·ï¼ŒVRIPä½¿ç”¨10.0.x.254&#x2F;24ã€‚ #åˆ›å»ºVLAN [S1]vlan batch 10 20 [S2]vlan batch 10 20 [S3]vlan batch 10 20 [S4]vlan batch 10 20 #å°†æ‰€æœ‰äº’è”æ¥å£é…ç½®ä¸ºTrunkæ¥å£ï¼Œæ”¾é€šå¯¹åº”VLAN ç•¥ #ä¿®æ”¹STPæ¨¡å¼ä¸ºMSTP [S1]stp mode mstp [S2]stp mode mstp [S3]stp mode mstp #é…ç½®MSTP [S1]stp region-configuration [S1-mst-region] region-name hcip [S1-mst-region] revision-level 1 [S1-mst-region] instance 1 vlan 10 [S1-mst-region] instance 2 vlan 20 [S1-mst-region] active region-configuration Info: This operation may take a few seconds. Please wait for a momentâ€¦done. [S1-mst-region] quit [S2]stp region-configuration [S2-mst-region] region-name hcip [S2-mst-region] revision-level 1 [S2-mst-region] instance 1 vlan 10 [S2-mst-region] instance 2 vlan 20 [S2-mst-region] active region-configuration Info: This operation may take a few seconds. Please wait for a momentâ€¦done. [S2-mst-region] quit [S3]stp region-configuration [S3-mst-region] region-name hcip [S3-mst-region] revision-level 1 [S3-mst-region] instance 1 vlan 10 [S3-mst-region] instance 2 vlan 20 [S3-mst-region] active region-configuration Info: This operation may take a few seconds. Please wait for a momentâ€¦done. [S3-mst-region] quit #é…ç½®SW1ä¸ºMSTI1çš„æ ¹æ¡¥ã€MSTI2çš„å¤‡ä»½æ ¹æ¡¥ [S1]stp instance 1 root primary [S1]stp instance 2 root secondary #é…ç½®SW2ä¸ºMSTI2çš„æ ¹æ¡¥ã€MSTI1çš„å¤‡ä»½æ ¹æ¡¥ [S2]stp instance 1 root secondary [S2]stp instance 2 root primary #åœ¨S1ä¸ŠæŸ¥çœ‹MSTI1çš„çŠ¶æ€å’Œç»Ÿè®¡ä¿¡æ¯æ‘˜è¦ S1ä¸Šæ‰€æœ‰æ¥å£éƒ½æ˜¯æŒ‡å®šæ¥å£ï¼ŒS1ä¸ºMSTI1çš„æ ¹æ¡¥ã€‚ #åœ¨S2ä¸ŠæŸ¥çœ‹MSTI2çš„çŠ¶æ€å’Œç»Ÿè®¡ä¿¡æ¯æ‘˜è¦ S2ä¸Šæ‰€æœ‰æ¥å£éƒ½æ˜¯æŒ‡å®šæ¥å£ï¼ŒS2ä¸ºMSTI1çš„æ ¹æ¡¥ã€‚ VRRPåŸºç¡€é…ç½®åœ¨S1ã€S2å‡åˆ›å»ºVLANIF 10ã€20ï¼Œåˆ†åˆ«åŠ å…¥VRRPç»„10ã€20ï¼Œæ‰‹åŠ¨é…ç½®VRRPä¼˜å…ˆçº§ï¼Œä½¿å¾—S1çš„VLAN10æˆä¸ºVRRP Masterã€S2çš„VLAN20æˆä¸ºVRRP Masterã€‚ #åˆ›å»ºVLANIF [S1]interface Vlanif10 [S1-Vlanif10] ip address 10.0.10.1 255.255.255.0 [S1-Vlanif10] quit [S1]interface Vlanif20 [S1-Vlanif20] ip address 10.0.20.1 255.255.255.0 [S1-Vlanif20] quit [S2]interface Vlanif10 [S2-Vlanif10] ip address 10.0.10.2 255.255.255.0 [S2-Vlanif10] quit [S2]interface Vlanif20 [S2-Vlanif20] ip address 10.0.20.2 255.255.255.0 [S2-Vlanif20] quit #S1ä¸Šé…ç½®VRRP [S1]interface Vlanif 10 [S1-Vlanif10] vrrp vrid 10 virtual-ip 10.0.10.254 [S1-Vlanif10] vrrp vrid 10 priority 120 [S1-Vlanif10] quit [S1]interface Vlanif 20 [S1-Vlanif20] vrrp vrid 20 virtual-ip 10.0.20.254 [S1-Vlanif20] quit é…ç½®VLAN10çš„VRRPä¼˜å…ˆçº§ä¸º120ï¼ŒVLAN20ä¿æŒé»˜è®¤çš„100ã€‚ #S2ä¸Šé…ç½®VRRP [S2]interface Vlanif10 [S2-Vlanif10] vrrp vrid 10 virtual-ip 10.0.10.254 [S2-Vlanif10] quit [S2]interface Vlanif20 [S2-Vlanif20] vrrp vrid 20 virtual-ip 10.0.20.254 [S2-Vlanif20] vrrp vrid 20 priority 120 [S2-Vlanif20] quit é…ç½®VLAN20çš„VRRPä¼˜å…ˆçº§ä¸º120ï¼ŒVLAN10ä¿æŒé»˜è®¤çš„100ã€‚ #æŸ¥çœ‹VRRPç»„çŠ¶æ€ é…ç½®VRRPä¸BFDè”åŠ¨è¿›è¡Œå¿«é€Ÿåˆ‡æ¢åœ¨S1ã€S2ä¸Šé…ç½®BFDå•è·³æ£€æµ‹ï¼Œæ£€æµ‹VLANIFæ¥å£ä¹‹é—´çš„è¿é€šæ€§ï¼Œå°†VRRPä¸BFDè”åŠ¨ï¼Œå½“BFDä¼šè¯çŠ¶æ€Downæ—¶ï¼Œå¢åŠ VRRP Backupè®¾å¤‡çš„ä¼˜å…ˆçº§ã€‚ #åœ¨S1ä¸Šé…ç½®BFDä¼šè¯ [S1]bfd [S1-bfd] quit [S1]bfd vlanif10 bind peer-ip 10.0.10.2 interface Vlanif10 [S1-bfd-session-vlanif10] discriminator local 1 [S1-bfd-session-vlanif10] discriminator remote 2 [S1-bfd-session-vlanif10] min-tx-interval 100 [S1-bfd-session-vlanif10] min-rx-interval 100 [S1-bfd-session-vlanif10] commit [S1-bfd-session-vlanif10] quit [S1]bfd vlanif20 bind peer-ip 10.0.20.2 interface Vlanif20 [S1-bfd-session-vlanif20] discriminator local 11 [S1-bfd-session-vlanif20] discriminator remote 22 [S1-bfd-session-vlanif20] min-tx-interval 100 [S1-bfd-session-vlanif20] min-rx-interval 100 [S1-bfd-session-vlanif20] commit [S1-bfd-session-vlanif20] quit #åœ¨S2ä¸Šé…ç½®BFDä¼šè¯ [S2]bfd [S2-bfd] quit [S2]bfd vlanif10 bind peer-ip 10.0.10.1 interface Vlanif10 [S2-bfd-session-vlanif10] discriminator local 2 [S2-bfd-session-vlanif10] discriminator remote 1 [S2-bfd-session-vlanif10] min-tx-interval 100 [S2-bfd-session-vlanif10] min-rx-interval 100 [S2-bfd-session-vlanif10] commit [S2-bfd-session-vlanif10] quit [S2]bfd vlanif20 bind peer-ip 10.0.20.1 interface Vlanif20 [S2-bfd-session-vlanif20] discriminator local 22 [S2-bfd-session-vlanif20] discriminator remote 11 [S2-bfd-session-vlanif20] min-tx-interval 100 [S2-bfd-session-vlanif20] min-rx-interval 100 [S2-bfd-session-vlanif20] commit [S2-bfd-session-vlanif20] quit #æ£€æŸ¥BFDä¼šè¯çŠ¶æ€ æ­¤æ—¶S1ã€S2ä¸ŠBFDä¼šè¯çŠ¶æ€éƒ½ä¸ºUpã€‚ #é…ç½®VRRPä¸BFDè”åŠ¨ [S1]interface Vlanif20 [S1-Vlanif20] vrrp vrid 20 track bfd-session 11 increased 30 [S1-Vlanif20] quit [S2]interface Vlanif10 [S2-Vlanif10] vrrp vrid 10 track bfd-session 2 increased 30 [S2-Vlanif10] quit æ³¨æ„ï¼Œæ­¤å¤„çš„bfd-sessionå·ä¸ºæœ¬åœ°çš„BFD discriminatorï¼Œåªéœ€è¦åœ¨BackupçŠ¶æ€çš„æ¥å£ä¸Šé…ç½®è”åŠ¨ï¼ŒBFDä¼šè¯Downæ—¶å¢åŠ æœ¬åœ°çš„VRRPä¼˜å…ˆçº§ã€‚ #å…³é—­S1ä¸Šæ‰€æœ‰æ¥å£ï¼Œæ¨¡æ‹Ÿé“¾è·¯æ•…éšœ [S1]interface GigabitEthernet0&#x2F;0&#x2F;10 [S1-GigabitEthernet0&#x2F;0&#x2F;10] shutdown [S1-GigabitEthernet0&#x2F;0&#x2F;10] quit [S1]interface GigabitEthernet0&#x2F;0&#x2F;11 [S1-GigabitEthernet0&#x2F;0&#x2F;11] shutdown [S1-GigabitEthernet0&#x2F;0&#x2F;11] quit [S1]interface GigabitEthernet0&#x2F;0&#x2F;12 [S1-GigabitEthernet0&#x2F;0&#x2F;12] shutdown [S1-GigabitEthernet0&#x2F;0&#x2F;12] quit #åœ¨S2ä¸ŠæŸ¥çœ‹BFDä¼šè¯çŠ¶æ€ æ­¤æ—¶ä¸¤ä¸ªBFDä¼šè¯çŠ¶æ€ç«‹é©¬å˜ä¸ºDownã€‚ #åœ¨S2ä¸ŠæŸ¥çœ‹VRRPç»„çŠ¶æ€ VRRPç»„10ã€20çš„Masteræ­¤æ—¶éƒ½æ˜¯S2ã€‚ #åœ¨S2ä¸ŠæŸ¥çœ‹VRRPç»„çš„çŠ¶æ€å’Œé…ç½®å‚æ•°ä¿¡æ¯","categories":[],"tags":[{"name":"VRRP","slug":"VRRP","permalink":"http://example.com/tags/VRRP/"},{"name":"BFD","slug":"BFD","permalink":"http://example.com/tags/BFD/"}]},{"title":"BGPè·¯ç”±ä¼˜é€‰","slug":"BGPè·¯ç”±ä¼˜é€‰","date":"2023-11-28T10:19:34.000Z","updated":"2023-11-28T11:52:29.140Z","comments":true,"path":"2023/11/28/BGPè·¯ç”±ä¼˜é€‰/","permalink":"http://example.com/2023/11/28/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/","excerpt":"BGPè·¯ç”±ä¼˜é€‰å®éªŒèƒŒæ™¯ä½ æ˜¯å…¬å¸çš„ç½‘ç»œç®¡ç†å‘˜ã€‚å…¬å¸çš„ç½‘ç»œé‡‡ç”¨äº†BGPåè®®æ¥å…¥äº†ä¸¤ä¸ªæœåŠ¡è¿è¥å•†ã€‚å…¬å¸è‡ªå·±é‡‡ç”¨äº†ç§æœ‰çš„ASå·64512ï¼ŒISP1çš„ASå·ä¸º100ï¼ŒISP2çš„ASå·ä¸º200ã€‚é€šè¿‡AS100ã€AS200éƒ½å¯ä»¥åˆ°è¾¾ç›¸åŒçš„ç½‘ç»œï¼Œä½ é€šè¿‡æ”¹å˜BGPçš„å„ç§å±æ€§è¾¾åˆ°äº†è°ƒæ•´è·¯ç”±èµ°å‘çš„ç›®çš„ã€‚","text":"BGPè·¯ç”±ä¼˜é€‰å®éªŒèƒŒæ™¯ä½ æ˜¯å…¬å¸çš„ç½‘ç»œç®¡ç†å‘˜ã€‚å…¬å¸çš„ç½‘ç»œé‡‡ç”¨äº†BGPåè®®æ¥å…¥äº†ä¸¤ä¸ªæœåŠ¡è¿è¥å•†ã€‚å…¬å¸è‡ªå·±é‡‡ç”¨äº†ç§æœ‰çš„ASå·64512ï¼ŒISP1çš„ASå·ä¸º100ï¼ŒISP2çš„ASå·ä¸º200ã€‚é€šè¿‡AS100ã€AS200éƒ½å¯ä»¥åˆ°è¾¾ç›¸åŒçš„ç½‘ç»œï¼Œä½ é€šè¿‡æ”¹å˜BGPçš„å„ç§å±æ€§è¾¾åˆ°äº†è°ƒæ•´è·¯ç”±èµ°å‘çš„ç›®çš„ã€‚ å®éªŒä»‹ç»ï¼š è®¾å¤‡äº’è”æ–¹å¼ã€äº’è”æ¥å£åœ°å€å¦‚å›¾æ‰€ç¤ºï¼Œæ‰€æœ‰è®¾å¤‡å‡åˆ›å»ºLoopback0æ¥å£ï¼ŒIPåœ°å€ä¸º10.0.x.x&#x2F;32ï¼Œå…¶ä¸­xä¸ºè®¾å¤‡ç¼–å·ï¼Œæ‰€æœ‰è®¾å¤‡éƒ½ä½¿ç”¨Loopback0åœ°å€ä½œä¸ºBGP Router IDã€‚ R1åœ¨AS100ï¼ŒR5åœ¨AS200ï¼ŒR2ã€R3ã€R4åœ¨AS64512ã€‚AS64512å†…è¿è¡ŒOSPFï¼Œåœ¨äº’è”æ¥å£ï¼ˆä¸åŒ…æ‹¬è¿æ¥å¤–éƒ¨ASçš„æ¥å£ï¼‰ã€Loopback0æ¥å£ä¸Šæ¿€æ´»OSPFã€‚ EBGPå¯¹ç­‰ä½“å…³ç³»åŸºäºç›´è¿æ¥å£å»ºç«‹ï¼ŒIBGPå¯¹ç­‰ä½“å…³ç³»åŸºäºLoopback0æ¥å£å»ºç«‹ã€‚ R1ã€R5ä¸Šå­˜åœ¨ç›¸åŒçš„ç½‘æ®µ172.16.1.0&#x2F;24ã€172.16.2.0&#x2F;24ã€172.16.3.0&#x2F;24ã€172.16.4.0&#x2F;24ï¼Œåœ¨R1ã€R5ä¸Šå°†å…¶å‘å¸ƒåˆ°BGPï¼Œä»¥ç”¨äºBGPè·¯ç”±ä¼˜é€‰ã€‚ é…ç½®ipï¼Œé…ç½®bgpï¼šç•¥ #åœ¨R1ã€R5ä¸Šå°†Loopback1ã€Loopback2ã€Loopback3ã€Loopback4æ¥å£è·¯ç”±å‘å¸ƒåˆ°BGPä¸­ [R1]bgp 100 [R1-bgp] network 172.16.1.0 24 [R1-bgp] network 172.16.2.0 24 [R1-bgp] network 172.16.3.0 24 [R1-bgp] network 172.16.4.0 24 [R5]bgp 200 [R5-bgp] network 172.16.1.0 24 [R5-bgp] network 172.16.2.0 24 [R5-bgp] network 172.16.3.0 24 [R5-bgp] network 172.16.4.0 24 #åœ¨R3ä¸ŠæŸ¥çœ‹BGPè·¯ç”±è¡¨ï¼Œæ£€æŸ¥BGPè·¯ç”±æ˜¯å¦æˆåŠŸå­¦ä¹  R3å·²ç»æˆåŠŸå­¦ä¹ R1ã€R5å‘å¸ƒçš„è·¯ç”±ï¼Œæ­¤æ—¶æ‰€æœ‰è·¯ç”±éƒ½ä¼˜é€‰ç”±R2é€šå‘Šçš„ã€‚ ä¿®æ”¹AS_Pathå±æ€§åœ¨R1ä¸Šé€šè¿‡è·¯ç”±ç­–ç•¥ä¿®æ”¹BGPè·¯ç”±172.16.1.0&#x2F;24çš„ AS_Pathå±æ€§å€¼ï¼Œä½¿å¾—R3ä¼˜é€‰R5å‘å¸ƒçš„BGPè·¯ç”±172.16.1.0&#x2F;24ã€‚ #åˆ›å»ºIPå‰ç¼€åˆ—è¡¨1ï¼ŒåŒ¹é…Loopback1æ¥å£è·¯ç”± [R1]ip ip-prefix 1 permit 172.16.1.0 24 greater-equal 24 less-equal 24 #åˆ›å»ºRoute-Policy hcipï¼Œå¹¶åˆ›å»ºèŠ‚ç‚¹10ï¼Œåœ¨å…¶ä¸­è°ƒç”¨IPå‰ç¼€åˆ—è¡¨1ï¼Œä¿®æ”¹AS_Pathå±æ€§å€¼ [R1]route-policy hcip permit node 10 [R1-route-policy] if-match ip-prefix 1 [R1-route-policy] apply as-path 300 400 additive [R1-route-policy] quit [R1]route-policy hcip permit node 20 æ³¨æ„åˆ›å»ºä¸€ä¸ªç©ºèŠ‚ç‚¹ï¼Œå¯¹äºå¦å¤–3æ¡BGPè·¯ç”±ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚ #å¯¹å‘BGPå¯¹ç­‰ä½“R2é€šå‘Šçš„BGPè·¯ç”±åº”ç”¨Route-Policy [R1]bgp 100 [R1-bgp] peer 10.0.12.2 route-policy hcip export #åœ¨R1ä¸Šè§¦å‘å‡ºæ–¹å‘çš„è½¯å¤ä½ï¼Œåˆ·æ–°å¯¹å¤–é€šå‘Šçš„BGPè·¯ç”± refresh bgp all export #åœ¨R3ä¸ŠæŸ¥çœ‹BGPè·¯ç”±172.16.1.0&#x2F;24çš„æ˜ç»†ä¿¡æ¯ æ­¤æ—¶R3ä¼˜é€‰R4é€šå‘Šçš„BGPè·¯ç”±172.16.1.0&#x2F;24ï¼ŒR2é€šå‘Šçš„æœªè¢«ä¼˜é€‰çš„åŸå› æ˜¯AS_Pathé•¿åº¦ã€‚ ä¿®æ”¹Local_Preferenceå±æ€§local_Preferenceï¼šé»˜è®¤100ï¼Œè¶Šå¤§è¶Šä¼˜å…ˆï¼Œåªèƒ½åœ¨ibgpå¯¹ç­‰ä½“ä¹‹é—´ä¼ é€’ åœ¨R4ä¸Šé€šè¿‡è·¯ç”±ç­–ç•¥ä¿®æ”¹BGPè·¯ç”±172.16.2.0&#x2F;24çš„Local_Preferenceå±æ€§å€¼ï¼Œä½¿å¾—R3ä¼˜é€‰R4é€šå‘Šçš„BGPè·¯ç”±172.16.2.0&#x2F;24ã€‚ #åˆ›å»ºIPå‰ç¼€åˆ—è¡¨1ï¼ŒåŒ¹é…BGPè·¯ç”±172.16.2.0&#x2F;24 [R4]ip ip-prefix 1 permit 172.16.2.0 24 greater-equal 24 less-equal 24 #åˆ›å»ºRoute-Policy hcipï¼Œå¹¶åˆ›å»ºèŠ‚ç‚¹10ï¼Œåœ¨å…¶ä¸­è°ƒç”¨IPå‰ç¼€åˆ—è¡¨1ï¼Œä¿®æ”¹Local_Preferenceå±æ€§å€¼ [R4]route-policy hcip permit node 10 [R4-route-policy] if-match ip-prefix 1 [R4-route-policy] apply local-preference 200 [R4-route-policy] quit [R4]route-policy hcip permit node 20 æ³¨æ„åˆ›å»ºä¸€ä¸ªç©ºèŠ‚ç‚¹ï¼Œå¯¹äºå¦å¤–3æ¡BGPè·¯ç”±ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚ #å¯¹å‘BGPå¯¹ç­‰ä½“R3é€šå‘Šçš„BGPè·¯ç”±åº”ç”¨Route-Policy [R4]bgp 64512 [R4-bgp] peer 10.0.3.3 route-policy hcip export #åœ¨R4ä¸Šè§¦å‘å‡ºæ–¹å‘çš„è½¯å¤ä½ï¼Œåˆ·æ–°å¯¹å¤–é€šå‘Šçš„BGPè·¯ç”± refresh bgp all export #åœ¨R3ä¸ŠæŸ¥çœ‹BGPè·¯ç”±172.16.2.0&#x2F;24çš„æ˜ç»†ä¿¡æ¯ æ­¤æ—¶R3ä¼˜é€‰R4é€šå‘Šçš„BGPè·¯ç”±172.16.2.0&#x2F;24ï¼ŒR2é€šå‘Šçš„BGPè·¯ç”±å…¶Local_Preferenceå€¼ä¸º100ï¼Œå°äºR3é€šå‘Šçš„BGPè·¯ç”±Local_Preferenceå€¼200ï¼Œå› æ­¤R2é€šå‘Šçš„BGPè·¯ç”±æœªè¢«ä¼˜é€‰ã€‚ ä¿®æ”¹MEDå±æ€§åœ¨R2ä¸Šé€šè¿‡è·¯ç”±ç­–ç•¥ä¿®æ”¹BGPè·¯ç”±172.16.3.0&#x2F;24çš„MEDå±æ€§å€¼ï¼Œä½¿å¾—R3ä¼˜é€‰R5å‘å¸ƒçš„BGPè·¯ç”±172.16.3.0&#x2F;24ã€‚ #åˆ›å»ºIPå‰ç¼€åˆ—è¡¨1ï¼ŒåŒ¹é…BGPè·¯ç”±172.16.3.0&#x2F;24 [R2]ip ip-prefix 1 permit 172.16.3.0 24 greater-equal 24 less-equal 24 #åˆ›å»ºRoute-Policy hcipï¼Œå¹¶åˆ›å»ºèŠ‚ç‚¹10ï¼Œåœ¨å…¶ä¸­è°ƒç”¨IPå‰ç¼€åˆ—è¡¨1ï¼Œä¿®æ”¹MEDå±æ€§å€¼ [R2]route-policy hcip permit node 10 [R2-route-policy] if-match ip-prefix 1 [R2-route-policy] apply cost 200 [R2-route-policy] quit [R2]route-policy hcip permit node 20 æ³¨æ„åˆ›å»ºä¸€ä¸ªç©ºèŠ‚ç‚¹ï¼Œå¯¹äºå¦å¤–3æ¡BGPè·¯ç”±ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚ #å¯¹æ¥è‡ªBGPå¯¹ç­‰ä½“R1çš„BGPè·¯ç”±åº”ç”¨Route-Policy [R2]bgp 64512 [R2-bgp] peer 10.0.12.1 route-policy hcip import #åœ¨R2ä¸Šè§¦å‘å…¥æ–¹å‘çš„è½¯å¤ä½ï¼Œåˆ·æ–°æ¥æ”¶åˆ°çš„BGPè·¯ç”± refresh bgp all import #åœ¨R3ä¸Šé…ç½®å…è®¸æ¯”è¾ƒæ¥è‡ªä¸åŒASçš„BGPè·¯ç”±çš„MEDå€¼ [R3]bgp 64512 [R3-bgp] compare-different-as-med ç¼ºçœæƒ…å†µä¸‹ï¼Œä¸æ¯”è¾ƒæ¥è‡ªä¸åŒASé‚»å±…çš„BGPçš„MEDå±æ€§å€¼ã€‚ #åœ¨R3ä¸ŠæŸ¥çœ‹BGPè·¯ç”±172.16.3.0&#x2F;24çš„æ˜ç»†ä¿¡æ¯ R2é€šå‘Šçš„BGPè·¯ç”±172.16.3.0&#x2F;24å…¶MEDå€¼ä¸º200ï¼Œè€ŒR4é€šå‘ŠBGPè·¯ç”±MEDå€¼ä¸º0ï¼ŒR3ä¼˜é€‰MEDå€¼è¾ƒå°çš„BGPè·¯ç”±ï¼Œå› æ­¤R2é€šå‘Šçš„BGPè·¯ç”±æœªè¢«ä¼˜é€‰ã€‚ ä¿®æ”¹preferred-valueå±æ€§preferred-valueï¼šåä¸ºç‰¹æœ‰çš„å±æ€§å€¼ï¼Œä»…åœ¨æœ¬åœ°æœ‰æ•ˆï¼Œå½“bgpå­˜åœ¨åˆ°ç›¸åŒçš„è·¯ç”±æ—¶ï¼Œå°†ä¼˜é€‰prefeerred-valueå¤§çš„è·¯ç”±ã€‚åªèƒ½åœ¨è·¯ç”±å™¨æœ¬åœ°é…ç½®ï¼Œåªå½±å“æœ¬è®¾å¤‡çš„è·¯ç”±ä¼˜é€‰ï¼Œä¸ä¼šä¼ é€’ç»™ä»»ä½•bgpå¯¹ç­‰ä½“ã€‚ åœ¨R3ä¸Šé€šè¿‡è·¯ç”±ç­–ç•¥ä¿®æ”¹BGPè·¯ç”±172.16.4.0&#x2F;24çš„preferred-valueå±æ€§å€¼ï¼Œä½¿å¾—R3ä¼˜é€‰R4é€šå‘Šçš„BGPè·¯ç”±172.16.4.0&#x2F;24ã€‚ #åˆ›å»ºIPå‰ç¼€åˆ—è¡¨1ï¼ŒåŒ¹é…BGPè·¯ç”±172.16.4.0&#x2F;24 [R3]ip ip-prefix 1 permit 172.16.4.0 24 greater-equal 24 less-equal 24 #åˆ›å»ºRoute-Policy hcipï¼Œå¹¶åˆ›å»ºèŠ‚ç‚¹10ï¼Œåœ¨å…¶ä¸­è°ƒç”¨IPå‰ç¼€åˆ—è¡¨1ï¼Œä¿®æ”¹preferred-valueå±æ€§å€¼ [R3]route-policy hcip permit node 10 [R3-route-policy] if-match ip-prefix 1 [R3-route-policy] apply preferred-value 300 [R3-route-policy] quit [R3]route-policy hcip permit node 20 æ³¨æ„åˆ›å»ºä¸€ä¸ªç©ºèŠ‚ç‚¹ï¼Œå¯¹äºå¦å¤–3æ¡BGPè·¯ç”±ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚ #å¯¹æ¥è‡ªBGPå¯¹ç­‰ä½“R4çš„BGPè·¯ç”±åº”ç”¨Route-Policy [R3]bgp 64512 [R3-bgp] peer 10.0.4.4 route-policy hcip import #åœ¨R3ä¸Šè§¦å‘å…¥æ–¹å‘çš„è½¯å¤ä½ï¼Œåˆ·æ–°æ”¶åˆ°çš„BGPè·¯ç”± refresh bgp all import #åœ¨R3ä¸ŠæŸ¥çœ‹BGPè·¯ç”±172.16.4.0&#x2F;24çš„æ˜ç»†ä¿¡æ¯ R4é€šå‘Šçš„BGPè·¯ç”±172.16.3.0&#x2F;24å…¶preferred-valueå€¼ä¸º300ï¼Œè€ŒR2é€šå‘Šçš„preferred-valueå€¼ä¸º0ï¼ŒR3ä¼˜é€‰preferred-valueå€¼è¾ƒå¤§çš„BGPè·¯ç”±ï¼Œå› æ­¤R3ä¼˜é€‰R4é€šå‘Šçš„BGPè·¯ç”±ã€‚","categories":[{"name":"ipå®éªŒ","slug":"ipå®éªŒ","permalink":"http://example.com/categories/ip%E5%AE%9E%E9%AA%8C/"}],"tags":[{"name":"BGPè·¯ç”±ä¼˜é€‰","slug":"BGPè·¯ç”±ä¼˜é€‰","permalink":"http://example.com/tags/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/"}]},{"title":"BGPè·¯ç”±åå°„å™¨","slug":"BGPè·¯ç”±åå°„å™¨","date":"2023-11-28T08:48:20.000Z","updated":"2023-11-28T10:16:01.185Z","comments":true,"path":"2023/11/28/BGPè·¯ç”±åå°„å™¨/","permalink":"http://example.com/2023/11/28/BGP%E8%B7%AF%E7%94%B1%E5%8F%8D%E5%B0%84%E5%99%A8/","excerpt":"BGPè·¯ç”±åå°„å™¨ç”±äºæ°´å¹³åˆ†å‰²çš„åŸå› ï¼Œä¸ºäº†ä¿è¯ASå†…æ‰€æœ‰çš„BGPè·¯ç”±å™¨éƒ½èƒ½å­¦ä¹ åˆ°å®Œæ•´çš„BGPè·¯ç”±ï¼Œå°±å¿…é¡»åœ¨ASå†…å®ç°IBGPå…¨äº’è”ã€‚ ç„¶è€Œå®ç°IBGPå…¨äº’è”å­˜åœ¨è¯¸å¤šçŸ­æ¿ï¼š è·¯ç”±å™¨éœ€ç»´æŠ¤å¤§é‡çš„TCPåŠBGPè¿æ¥ï¼Œå°¤å…¶åœ¨è·¯ç”±å™¨æ•°é‡è¾ƒå¤šæ—¶ã€‚ ASå†…BGPç½‘ç»œçš„å¯æ‰©å±•æ€§è¾ƒå·®ï¼Œå› ä¸ºé€šè¿‡çº¯æ‰‹å·¥é…ç½®å‘½ä»¤ã€‚ ä¸ºäº†è§£å†³è¯¥é—®é¢˜ï¼Œå¯åº”ç”¨åˆ°RRè·¯ç”±åå°„å™¨æŠ€æœ¯ã€‚ 1ã€Clientï¼šRRå®¢æˆ·ç«¯ï¼Œåœ¨RRè®¾å¤‡ä¸Šé€šè¿‡æ‰‹åŠ¨æŒ‡å®šã€‚ æŒ‡å®šå‘½ä»¤ï¼špeer é‚»å±… reflect-client 2ã€é™¤äº†æŒ‡å®šçš„è®¾å¤‡ä¸ºå®¢æˆ·ç«¯ï¼Œå…¶å®ƒè®¾å¤‡å‡ä¸ºéå®¢æˆ·ç«¯ã€‚ å®éªŒï¼š R1ã€R2ã€R3ã€R4éƒ½å±äºAS64511ï¼Œå…¶è¿æ¥æ–¹å¼ã€äº’è”æ¥å£åœ°å€å¦‚å›¾æ‰€ç¤ºã€‚æ¯å°è®¾å¤‡å‡åˆ›å»ºLoopback0æ¥å£ï¼ŒIPåœ°å€ä¸º10.0.x.x&#x2F;32ï¼Œå…¶ä¸­xä¸ºè®¾å¤‡ç¼–å·ã€‚R1ã€R2ä¸Šçš„Loopback1åœ°å€åˆ†åˆ«ä¸º10.1.1.1&#x2F;24ã€10.2.2.2&#x2F;24ï¼Œç”¨äºæ¨¡æ‹Ÿç”¨æˆ·ç½‘æ®µã€‚","text":"BGPè·¯ç”±åå°„å™¨ç”±äºæ°´å¹³åˆ†å‰²çš„åŸå› ï¼Œä¸ºäº†ä¿è¯ASå†…æ‰€æœ‰çš„BGPè·¯ç”±å™¨éƒ½èƒ½å­¦ä¹ åˆ°å®Œæ•´çš„BGPè·¯ç”±ï¼Œå°±å¿…é¡»åœ¨ASå†…å®ç°IBGPå…¨äº’è”ã€‚ ç„¶è€Œå®ç°IBGPå…¨äº’è”å­˜åœ¨è¯¸å¤šçŸ­æ¿ï¼š è·¯ç”±å™¨éœ€ç»´æŠ¤å¤§é‡çš„TCPåŠBGPè¿æ¥ï¼Œå°¤å…¶åœ¨è·¯ç”±å™¨æ•°é‡è¾ƒå¤šæ—¶ã€‚ ASå†…BGPç½‘ç»œçš„å¯æ‰©å±•æ€§è¾ƒå·®ï¼Œå› ä¸ºé€šè¿‡çº¯æ‰‹å·¥é…ç½®å‘½ä»¤ã€‚ ä¸ºäº†è§£å†³è¯¥é—®é¢˜ï¼Œå¯åº”ç”¨åˆ°RRè·¯ç”±åå°„å™¨æŠ€æœ¯ã€‚ 1ã€Clientï¼šRRå®¢æˆ·ç«¯ï¼Œåœ¨RRè®¾å¤‡ä¸Šé€šè¿‡æ‰‹åŠ¨æŒ‡å®šã€‚ æŒ‡å®šå‘½ä»¤ï¼špeer é‚»å±… reflect-client 2ã€é™¤äº†æŒ‡å®šçš„è®¾å¤‡ä¸ºå®¢æˆ·ç«¯ï¼Œå…¶å®ƒè®¾å¤‡å‡ä¸ºéå®¢æˆ·ç«¯ã€‚ å®éªŒï¼š R1ã€R2ã€R3ã€R4éƒ½å±äºAS64511ï¼Œå…¶è¿æ¥æ–¹å¼ã€äº’è”æ¥å£åœ°å€å¦‚å›¾æ‰€ç¤ºã€‚æ¯å°è®¾å¤‡å‡åˆ›å»ºLoopback0æ¥å£ï¼ŒIPåœ°å€ä¸º10.0.x.x&#x2F;32ï¼Œå…¶ä¸­xä¸ºè®¾å¤‡ç¼–å·ã€‚R1ã€R2ä¸Šçš„Loopback1åœ°å€åˆ†åˆ«ä¸º10.1.1.1&#x2F;24ã€10.2.2.2&#x2F;24ï¼Œç”¨äºæ¨¡æ‹Ÿç”¨æˆ·ç½‘æ®µã€‚ æ‰€æœ‰è®¾å¤‡éƒ½ä½¿ç”¨Loopback0åœ°å€ä½œä¸ºBGP Router IDï¼ŒR1ä¸R2ã€R2ä¸R3ã€R3ä¸R4ã€R4ä¸R2ä¹‹é—´åŸºäºç›´è¿æ¥å£å»ºç«‹IBGPå¯¹ç­‰ä½“å…³ç³»ï¼Œå…¶ä¸­R1ä¸ºR2çš„è·¯ç”±åå°„å™¨å®¢æˆ·ç«¯ï¼ŒR2ä¸ºR3çš„è·¯ç”±åå°„å™¨å®¢æˆ·ç«¯ï¼ŒR3ä¸ºR4çš„è·¯ç”±åå°„å™¨å®¢æˆ·ç«¯ã€‚ é…ç½®ipåœ°å€ï¼šç•¥ å»ºç«‹ibgpå¯¹ç­‰ä½“ï¼šç•¥ é…ç½®è·¯ç”±åå°„å™¨#R2ä¸Šå°†R1é…ç½®ä¸ºè·¯ç”±åå°„å™¨å®¢æˆ·ç«¯ [R2]bgp 64511 [R2-bgp] peer 10.0.1.1 reflect-client #R3ä¸Šå°†R2é…ç½®ä¸ºè·¯ç”±åå°„å™¨å®¢æˆ·ç«¯ [R3]bgp 64511 [R3-bgp] peer 10.0.2.2 reflect-client #R4ä¸Šå°†R3é…ç½®ä¸ºè·¯ç”±åå°„å™¨å®¢æˆ·ç«¯ [R4]bgp 64511 [R4-bgp] peer 10.0.3.3 reflect-client éªŒè¯Orginator_IDå®ç°è·¯ç”±é˜²ç¯åœ¨æœ¬æ­¥éª¤ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨R2ä¸Šå‘å¸ƒBGPè·¯ç”±10.2.2.0&#x2F;24ï¼Œå¹¶è§‚å¯Ÿè¯¥è·¯ç”±ä¾æ¬¡ç»è·¯ç”±åå°„å™¨R3ã€R4åå°„åï¼Œè¢«é€šå‘Šå›R2ä»è€Œå¼•å‘æ½œåœ¨è·¯ç”±ç¯è·¯é£é™©çš„æƒ…å†µã€‚ ç¼ºçœæƒ…å†µä¸‹ï¼ŒR2å‘å¸ƒBGPè·¯ç”±åï¼Œè¯¥è·¯ç”±å°†è¢«R2ç›´æ¥é€šå‘Šç»™R4ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿä¼šé€šè¿‡R3åå°„ç»™R4ï¼Œæ­¤æ—¶R4å°†ä¼˜é€‰R2ç›´æ¥é€šå‘Šè¿‡æ¥çš„è·¯ç”±ï¼Œä»è€Œä¸ä¼šå†å°†R3åå°„è¿‡æ¥çš„è·¯ç”±å†åå°„å›ç»™R2ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦åœ¨R2ä¸Šéƒ¨ç½²è·¯ç”±ç­–ç•¥ï¼Œä½¿R2ä¸ç›´æ¥å‘R4é€šå‘Š10.2.2.0&#x2F;24è·¯ç”±ã€‚ #é…ç½®è·¯ç”±ç­–ç•¥ [R2]acl number 2000 [R2-acl-basic-2000] rule 5 permit [R2-acl-basic-2000] quit [R2]route-policy bgp deny node 10 [R2-route-policy] if-match acl 2000 #åœ¨BGPä¸­è°ƒç”¨è·¯ç”±ç­–ç•¥ [R2]bgp 64511 [R2-bgp] peer 10.0.24.4 route-policy bgp export #åœ¨R2ä¸Šå‘å¸ƒè·¯ç”± [R2]bgp 64511 [R2-bgp] network 10.2.2.0 24 #R2ä¸ŠæŸ¥çœ‹BGPè·¯ç”±10.2.2.0&#x2F;24çš„æ˜ç»†ä¿¡æ¯ R2å°†è¯¥æ¡è·¯ç”±é€šå‘Šç»™äº†R3ã€R1ï¼Œä½†æ˜¯å¹¶æœªé€šå‘Šç»™R4ã€‚ #R3ä¸ŠæŸ¥çœ‹BGPè·¯ç”±10.2.2.0&#x2F;24çš„æ˜ç»†ä¿¡æ¯ R3å°†æ¥è‡ªåå°„å™¨å®¢æˆ·ç«¯çš„BGPè·¯ç”±10.2.2.0&#x2F;24åå°„ç»™äº†10.0.34.4ï¼ˆR4ï¼‰ã€‚åŒæ—¶è¯¥BGPè·¯ç”±çš„nexthopä¸º10.0.23.2ã€‚ # R4ä¸ŠæŸ¥çœ‹BGPè·¯ç”±10.2.2.0&#x2F;24çš„æ˜ç»†ä¿¡æ¯ è¯¥æ¡è·¯ç”±æ¥è‡ªåå°„å™¨å®¢æˆ·ç«¯R3ï¼ŒåŸå§‹è·¯ç”±ç»ç”±R3åå°„ï¼Œè·¯ç”±çš„nexthopåœ°å€å¹¶æœªæ”¹å˜ï¼ŒåŒæ—¶R3ä¸ºå…¶æ·»åŠ äº†Orginator_IDå±æ€§ï¼Œå€¼ä¸º10.0.2.2ã€‚åŒæ—¶R4å°†è¯¥æ¡è·¯ç”±åå°„ç»™äº†R2ã€‚ #å†æ¬¡åœ¨R2ä¸ŠæŸ¥çœ‹BGPè·¯ç”±10.2.2.0&#x2F;24çš„æ˜ç»†ä¿¡æ¯ ä¾æ—§åªå­˜åœ¨æœ¬åœ°é€šå‘Šçš„BGPè·¯ç”±ï¼Œæ²¡æœ‰R4é€šå‘Šçš„BGPè·¯ç”±ã€‚ #åœ¨R2ä¸ŠæŸ¥çœ‹BGPå¯¹ç­‰ä½“10.0.4.4çš„è¯¦ç»†ä¿¡æ¯ display bgp peer 10.0.4.4 verbose ä»è¾“å‡ºä¿¡æ¯å¯ä»¥çœ‹åˆ°R2ä»R4æ”¶åˆ°äº†1ä¸ªUpdateæŠ¥æ–‡ï¼Œæœªå‘R4å‘é€UpdateæŠ¥æ–‡ï¼ˆè·¯ç”±ç­–ç•¥é™åˆ¶ï¼‰ï¼Œä½†æ˜¯æœ¬åœ°BGPè·¯ç”±è¡¨ä¸­ä¸å­˜åœ¨ç”±R4é€šå‘Šçš„BGPè·¯ç”±10.2.2.0&#x2F;24ã€‚ R4é€šå‘Šçš„BGPè·¯ç”±Orginator_IDå±æ€§å€¼ä¸æœ¬åœ°çš„Router IDä¸€è‡´ï¼ŒR2å¿½ç•¥äº†è¯¥è·¯ç”±é€šå‘Šã€‚ éªŒè¯Cluster_Listå®ç°è·¯ç”±é˜²ç¯ä¸ºäº†æ–¹ä¾¿è§‚å¯Ÿç°è±¡ï¼Œå–æ¶ˆR2ä¸Šçš„BGPè·¯ç”±å‘å¸ƒï¼Œåœ¨R1ä¸Šå°†Loopback1æ¥å£è·¯ç”±å‘å¸ƒåˆ°BGPï¼Œè§‚å¯ŸCluster_Listå¦‚ä½•é˜²æ­¢ç¯è·¯ã€‚ #å–æ¶ˆR2ä¸Šçš„BGPè·¯ç”±å‘å¸ƒ [R2]bgp 64511 [R2-bgp] undo network 10.2.2.0 255.255.255.0 #åœ¨R1ä¸Šå°†Loopback1æ¥å£è·¯ç”±å‘å¸ƒåˆ°BGP [R1]bgp 64511 [R1-bgp] network 10.1.1.0 24 #ä¾æ¬¡åœ¨R1ã€R2ã€R3ã€R4ä¸ŠæŸ¥çœ‹BGPè·¯ç”±10.1.1.0 &#x2F;24çš„æ˜ç»†ä¿¡æ¯ R1ä¸ºBGPè·¯ç”±10.1.1.0&#x2F;24çš„å§‹å‘è€…ï¼ŒR1å°†è·¯ç”±é€šå‘Šç»™äº†R2 æ¥è‡ªè·¯ç”±åå°„å™¨å®¢æˆ·ç«¯R1çš„BGPè·¯ç”±10.1.1.0&#x2F;24ï¼ŒR2å°†å…¶åå°„ç»™äº†R3 æ¥è‡ªè·¯ç”±åå°„å™¨å®¢æˆ·ç«¯R2çš„BGPè·¯ç”±10.1.1.0&#x2F;24ï¼ŒR2åå°„æ—¶æ·»åŠ äº†Cluster_Listå±æ€§ï¼Œå€¼ä¸º10.0.2.2ï¼ŒR3å°†è¯¥æ¡è·¯ç”±åå°„ç»™äº†R4 æ¥è‡ªè·¯ç”±åå°„å™¨å®¢æˆ·ç«¯R3çš„BGPè·¯ç”±10.1.1.0&#x2F;24ï¼ŒR3åå°„æ—¶æ·»åŠ äº†Cluster_Listå±æ€§çš„å€¼ï¼Œå½“å‰å€¼ä¸º10.0.3.3ï¼Œ10.0.2.2ï¼ŒR4å°†è¯¥æ¡è·¯ç”±åå°„ç»™äº†R2 #å†æ¬¡æŸ¥çœ‹R2çš„BGPè·¯ç”±è¡¨ R2çš„BGPè·¯ç”±è¡¨ä¸­ä¾æ—§åªæœ‰ä¸€æ¡æ¥è‡ªr1çš„BGPè·¯ç”±10.1.1.0&#x2F;24ã€‚ 4é€šå‘Šçš„BGPè·¯ç”±å…¶Cluster_Listå±æ€§å€¼ä¸­åŒ…å«äº†R2çš„Cluster-IDï¼ŒR2å¿½ç•¥äº†è¯¥è·¯ç”±é€šå‘Šã€‚","categories":[{"name":"ipå®éªŒ","slug":"ipå®éªŒ","permalink":"http://example.com/categories/ip%E5%AE%9E%E9%AA%8C/"}],"tags":[{"name":"BGPè·¯ç”±åå°„å™¨","slug":"BGPè·¯ç”±åå°„å™¨","permalink":"http://example.com/tags/BGP%E8%B7%AF%E7%94%B1%E5%8F%8D%E5%B0%84%E5%99%A8/"}]},{"title":"BGPå®éªŒ","slug":"BGPå®éªŒ","date":"2023-11-28T02:58:58.000Z","updated":"2023-11-28T07:45:03.915Z","comments":true,"path":"2023/11/28/BGPå®éªŒ/","permalink":"http://example.com/2023/11/28/BGP%E5%AE%9E%E9%AA%8C/","excerpt":"BGPåŸºç¡€å®éªŒè®¾å¤‡è¿æ¥æ–¹å¼ã€IPåœ°å€è§„åˆ’ã€BGP ASå·å¦‚å›¾æ‰€ç¤ºï¼Œæ‰€æœ‰è®¾å¤‡å‡åˆ›å»ºLoopback0æ¥å£ï¼ŒIPåœ°å€ä¸º10.0.x.x&#x2F;32ï¼Œå…¶ä¸­xä¸ºè®¾å¤‡ç¼–å·ï¼Œæ‰€æœ‰è®¾å¤‡éƒ½ä½¿ç”¨Loopback0æ¥å£IPåœ°å€ä½œä¸ºBGP Router IDã€‚R1ã€R5ä¸Šå­˜åœ¨Loopback1æ¨¡æ‹Ÿç”¨æˆ·ç½‘æ®µã€‚ R2ã€R3ã€R4ä¹‹é—´è¿è¡ŒOSPFï¼Œåœ¨R2ã€R3ã€R4çš„äº’è”æ¥å£ã€Loopback0æ¥å£ä¸Šæ¿€æ´»OSPFã€‚!","text":"BGPåŸºç¡€å®éªŒè®¾å¤‡è¿æ¥æ–¹å¼ã€IPåœ°å€è§„åˆ’ã€BGP ASå·å¦‚å›¾æ‰€ç¤ºï¼Œæ‰€æœ‰è®¾å¤‡å‡åˆ›å»ºLoopback0æ¥å£ï¼ŒIPåœ°å€ä¸º10.0.x.x&#x2F;32ï¼Œå…¶ä¸­xä¸ºè®¾å¤‡ç¼–å·ï¼Œæ‰€æœ‰è®¾å¤‡éƒ½ä½¿ç”¨Loopback0æ¥å£IPåœ°å€ä½œä¸ºBGP Router IDã€‚R1ã€R5ä¸Šå­˜åœ¨Loopback1æ¨¡æ‹Ÿç”¨æˆ·ç½‘æ®µã€‚ R2ã€R3ã€R4ä¹‹é—´è¿è¡ŒOSPFï¼Œåœ¨R2ã€R3ã€R4çš„äº’è”æ¥å£ã€Loopback0æ¥å£ä¸Šæ¿€æ´»OSPFã€‚! å®éªŒèƒŒæ™¯ä½ æ˜¯å…¬å¸çš„ç½‘ç»œç®¡ç†å‘˜ã€‚å…¬å¸çš„ç½‘ç»œé‡‡ç”¨äº†BGPåè®®ä½œä¸ºè·¯ç”±åè®®ã€‚å…¬å¸çš„ç½‘ç»œç”±å¤šä¸ªè‡ªæ²»ç³»ç»Ÿç»„æˆï¼Œä¸åŒçš„åˆ†æ”¯æœºæ„ä½¿ç”¨äº†ä¸åŒçš„ASå·ï¼Œç°åœ¨ä½ éœ€è¦å®Œæˆå…¬å¸ç½‘ç»œçš„æ­å»ºå·¥ä½œã€‚åœ¨å…¬å¸æ€»éƒ¨ä½¿ç”¨äº†OSPFä½œä¸ºIGPï¼Œå…¬å¸å†…éƒ¨ä¸åŒåˆ†æ”¯æœºæ„ä½¿ç”¨çš„æ˜¯ç§æœ‰çš„BGP ASå·ã€‚ 1.é…ç½®ipå¦‚æ‹“æ‰‘å›¾é…ç½®å„ä¸ªæ¥å£ipï¼Œå’Œloopback 0 ï¼š10.0.x.x r1 loopback 1 ï¼š10.1.1.1 24 r5 loopback 1 ï¼š10.1.5.5 24 r2 r3 r4é…ç½®ospfï¼šç•¥ 2.é…ç½®IBGPå¯¹ç­‰ä½“åœ¨R2ã€R3ã€R4ä¹‹é—´åŸºäºLoopback0æ¥å£å»ºç«‹å…¨äº’è”çš„IBGPå¯¹ç­‰ä½“å…³ç³»ã€‚ #R2ä¸Šé…ç½®BGP [R2]bgp 64512 [R2-bgp] router-id 10.0.2.2 [R2-bgp] peer 10.0.3.3 as-number 64512 [R2-bgp] peer 10.0.3.3 connect-interface LoopBack0 [R2-bgp] peer 10.0.4.4 as-number 64512 [R2-bgp] peer 10.0.4.4 connect-interface LoopBack0 #R3ä¸Šé…ç½®BGP [R3]bgp 64512 [R3-bgp] router-id 10.0.3.3 [R3-bgp] peer 10.0.2.2 as-number 64512 [R3-bgp] peer 10.0.2.2 connect-interface LoopBack0 [R3-bgp] peer 10.0.4.4 as-number 64512 [R3-bgp] peer 10.0.4.4 connect-interface LoopBack0 #R4ä¸Šé…ç½®BGP [R4]bgp 64512 [R4-bgp] peer 10.0.2.2 as-number 64512 [R4-bgp] peer 10.0.2.2 connect-interface LoopBack0 [R4-bgp] peer 10.0.3.3 as-number 64512 [R4-bgp] peer 10.0.3.3 connect-interface LoopBack0 #åˆ†åˆ«åœ¨R2ã€R3ã€R4ä¸Šæ£€æŸ¥BGPå¯¹ç­‰ä½“çŠ¶æ€ 3.é…ç½®EBGPå¯¹ç­‰ä½“ï¼ˆä¸€èˆ¬æƒ…å†µä½¿ç”¨ç›´è¿æ¥å£å»ºç«‹EBGpï¼‰ åœ¨R1ä¸R2ã€R4ä¸R5ä¹‹é—´åŸºäºLoopback0æ¥å£å»ºç«‹EBGPå¯¹ç­‰ä½“å…³ç³»ï¼Œä¸ºä¿è¯èƒ½å¤Ÿæ­£å¸¸å»ºç«‹ï¼Œåœ¨R1ã€R2ä¸Šé…ç½®é™æ€è·¯ç”±ä½¿Loopback0ä¹‹é—´è·¯ç”±å¯è¾¾ï¼ˆR4ã€R5åŒæ ·æ“ä½œï¼‰ã€‚ #åœ¨R1ã€R2ä¸Šé…ç½®é™æ€è·¯ç”± [R1]ip route-static 10.0.2.2 32 10.0.12.2 [R2]ip route-static 10.0.1.1 32 10.0.12.1 #åœ¨R4ã€R5ä¸Šé…ç½®é™æ€è·¯ç”± [R4]ip route-static 10.0.5.5 32 10.0.45.5 [R5]ip route-static 10.0.4.4 32 10.0.45.4 è¿™é‡Œé…ç½®é™æ€è·¯ç”±ï¼Œå› ä¸ºè¦å»ºç«‹TCPä¼šè¯çš„å‰æï¼Œéœ€è¦åœ¨æ•°æ®å±‚é¢ä¸¤è·¯ç”±å™¨ç›¸é€šï¼Œæ‰€ä»¥éœ€è¦éœ€è¦æ‰‹å·¥é…ç½®é™æ€è·¯ç”±ï¼Œå®ç°loopback 0 ä¹‹é—´äº’é€š #é…ç½®R1ã€R2ä¹‹é—´çš„EBGPå¯¹ç­‰ä½“ [R1]bgp 64513 [R1-bgp] router-id 10.0.1.1 [R1-bgp] peer 10.0.2.2 as-number 64512 [R1-bgp] peer 10.0.2.2 ebgp-max-hop 2 [R1-bgp] peer 10.0.2.2 connect-interface LoopBack0 [R2]bgp 64512 [R2-bgp] peer 10.0.1.1 as-number 64513 [R2-bgp] peer 10.0.1.1 ebgp-max-hop 2 [R2-bgp] peer 10.0.1.1 connect-interface LoopBack0 é»˜è®¤æƒ…å†µä¸‹ï¼ŒEBGPè¿æ¥å…è®¸çš„æœ€å¤§è·³æ•°ä¸º1ï¼Œè¿™å¯¼è‡´EBGPå¯¹ç­‰ä½“ä¹‹é—´åªèƒ½ä½¿ç”¨ç›´è¿é“¾è·¯å»ºç«‹EBGPå¯¹ç­‰ä½“å…³ç³»ï¼Œä¸ºä½¿ç”¨ç¯å›å£ä½œä¸ºæ›´æ–°æºéœ€è¦æ‰‹åŠ¨ä¿®æ”¹EBGPè¿æ¥å…è®¸çš„æœ€å¤§è·³æ•°ã€‚ #é…ç½®R4ã€R5ä¹‹é—´çš„EBGPå¯¹ç­‰ä½“ [R4]bgp 64512 [R4-bgp] peer 10.0.5.5 as-number 64514 [R4-bgp] peer 10.0.5.5 ebgp-max-hop 2 [R4-bgp] peer 10.0.5.5 connect-interface LoopBack0 [R5]bgp 64514 [R5-bgp] router-id 10.0.5.5 [R5-bgp] peer 10.0.4.4 as-number 64512 [R5-bgp] peer 10.0.4.4 ebgp-max-hop 2 [R5-bgp] peer 10.0.4.4 connect-interface LoopBack0 #åœ¨R1ã€R5ä¸Šæ£€æŸ¥EBGPå¯¹ç­‰ä½“çŠ¶æ€ 4.åœ¨BGPä¸­å‘å¸ƒè·¯ç”±åœ¨R1ã€R5ä¸Šå°†Loopback1æ¥å£è·¯ç”±å‘å¸ƒåˆ°BGP #åœ¨R1ã€R5ä¸Šé€šè¿‡networkå‘½ä»¤å‘å¸ƒè·¯ç”± [R1]bgp 64513 [R1-bgp] network 10.1.1.1 24 [R5]bgp 64514 [R5-bgp] network 10.1.5.5 24 åœ¨R3ä¸ŠæŸ¥çœ‹BGPè·¯ç”±è¡¨ å¯ä»¥çœ‹åˆ°æ­¤æ—¶R3ä¸Šå·²ç»å­¦ä¹ åˆ°R1ã€R5ä¸Šå‘å¸ƒçš„BGPè·¯ç”±ï¼Œä½†æ˜¯éƒ½æ˜¯éæœ‰æ•ˆè·¯ç”±ï¼Œè¿™æ˜¯å› ä¸ºå®ƒä»¬çš„ä¸‹ä¸€è·³åœ¨R3ä¸Šéƒ½ä¸å¯è¾¾ï¼Œä¸ºæ­¤å¯ä»¥åœ¨R2ã€R4ä¸Šé€šè¿‡next-hop-localå‘½ä»¤ä¿®æ”¹ä¸‹ä¸€è·³åœ°å€ä¸ºR2ã€R4çš„æ›´æ–°æºåœ°å€ã€‚ åŸå› ï¼šebgpå¯¹ç­‰ä½“åœ¨å‘é€æ•°æ®æ—¶ï¼Œä¸‹ä¸€è·³åœ°å€ä¸ºè‡ªèº«æ›´æ–°æºåœ°å€ï¼Œibgpæ”¶åˆ°ebgpå‘é€çš„æ•°æ®ï¼Œä¸‹ä¸€è·³ä¸å˜ #åœ¨R2ã€R4ä¸Šå°†è·¯ç”±çš„ä¸‹ä¸€è·³åœ°å€ä¿®æ”¹ä¸ºè‡ªèº« [R2]bgp 64512 [R2-bgp] peer 10.0.3.3 next-hop-local [R2-bgp] peer 10.0.4.4 next-hop-local [R4]bgp 64512 [R4-bgp] peer 10.0.2.2 next-hop-local [R4-bgp] peer 10.0.3.3 next-hop-local peer next-hop-localå‘½ä»¤ä¸€èˆ¬åœ¨ASBRä¸Šé…ç½®ã€‚å½“è®¾å¤‡é€šè¿‡EBGPé‚»å±…å­¦åˆ°è·¯ç”±å†è½¬å‘ç»™å…¶ä»–IBGPé‚»å±…æ—¶ï¼Œé»˜è®¤ä¸ä¿®æ”¹ä¸‹ä¸€è·³ï¼Œä½†å…¶EBGPé‚»å±…å‘æ¥çš„è·¯ç”±çš„ä¸‹ä¸€è·³éƒ½æ˜¯å…¶EBGPé‚»å±…çš„Peeråœ°å€ï¼Œæœ¬ç«¯å¯¹ç­‰ä½“æ‰€å±ASåŸŸå†…çš„IBGPé‚»å±…æ”¶åˆ°è¿™æ ·çš„è·¯ç”±åï¼Œç”±äºä¸‹ä¸€è·³ä¸å¯è¾¾å¯¼è‡´è·¯ç”±æ— æ³•æ´»è·ƒã€‚å› æ­¤ï¼Œéœ€è¦åœ¨ASBRä¸Šå¯¹IBGPé‚»å±…é…ç½®peer next-hop-localå‘½ä»¤ï¼Œä½¿å¾—å‘ç»™IBGPé‚»å±…çš„è·¯ç”±çš„ä¸‹ä¸€è·³æ˜¯å…¶è‡ªèº«çš„åœ°å€ï¼ŒIBGPé‚»å±…æ”¶åˆ°è¿™æ ·çš„è·¯ç”±åï¼ˆç”±äºåŸŸå†…éƒ½é…ç½®äº†IGPï¼‰å‘ç°ä¸‹ä¸€è·³å¯è¾¾ï¼Œè·¯ç”±å³ä¸ºæ´»è·ƒè·¯ç”±ã€‚ æ­¤å‘½ä»¤ä¸ºè¦†ç›–å¼å‘½ä»¤ã€‚ æ‰§è¡Œpeer next-hop-localå‘½ä»¤åï¼Œè®¾å¤‡å‘IBGPå¯¹ç­‰ä½“&#x2F;å¯¹ç­‰ä½“ç»„é€šå‘Šè·¯ç”±æ—¶ï¼ŒæŠŠä¸‹ä¸€è·³å±æ€§è®¾ä¸ºè‡ªèº«çš„IPåœ°å€ã€‚ peer next-hop-localå‘½ä»¤ä»…åº”ç”¨äºIBGPå¯¹ç­‰ä½“é—´ã€‚ å†æ¬¡r3ä¸ŠæŸ¥çœ‹bgpè·¯ç”±è¡¨ æ­¤æ—¶ä¸¤æ¡BGPè·¯ç”±éƒ½å˜æˆäº†æœ‰æ•ˆã€æœ€ä¼˜çš„çŠ¶æ€ã€‚ #åœ¨R1ã€R5ä¸ŠæŸ¥çœ‹BGPè·¯ç”±è¡¨ R1ã€R5ä¹‹é—´ç›¸äº’å­¦ä¹ åˆ°äº†å¯¹ç«¯Loopback1æ¥å£è·¯ç”±ã€‚ BGPè·¯ç”±æ±‡æ€»å®éªŒ BGP ASå·ã€äº’è”åœ°å€å¦‚å›¾æ‰€ç¤ºï¼Œæ‰€æœ‰è®¾å¤‡å‡åˆ›å»ºLoopback0æ¥å£ï¼ŒIPåœ°å€ä¸º10.0.x.x&#x2F;32ï¼Œå…¶ä¸­xä¸ºè®¾å¤‡ç¼–å·ã€‚ R1ã€R2ã€R3ä½¿ç”¨Loopback0åœ°å€ä½œä¸ºBGP Router IDï¼ŒåŸºäºç›´è¿æ¥å£å»ºç«‹EBGPå¯¹ç­‰ä½“å…³ç³»ã€‚ R1ã€R3ä¸Šå­˜åœ¨Loopback1ã€Loopback2æ¥å£ï¼Œç”¨äºæ¨¡æ‹Ÿç”¨æˆ·ç½‘æ®µã€‚ 1.é…ç½®ipç•¥ 2.é…ç½®EBGPdå¯¹ç­‰ä½“#é…ç½®R1 [R1]bgp 64511 [R1-bgp] router-id 10.0.1.1 [R1-bgp] peer 10.0.12.2 as-number 64512 #é…ç½®R2 #é…ç½®R3 [R3]bgp 64513 [R3-bgp] router-id 10.0.3.3 [R3-bgp] peer 10.0.23.2 as-number 64512 3.BGPè·¯ç”±è‡ªåŠ¨æ±‡æ€»åœ¨R1ä¸Šå¼€å¯BGPè·¯ç”±è‡ªåŠ¨æ±‡æ€»ï¼Œå°†Loopback1ã€Loopback2æ¥å£è·¯ç”±å‘å¸ƒåˆ°BGPä¸­ï¼Œå¹¶è¿›è¡Œè‡ªåŠ¨æ±‡æ€»ã€‚ #åˆ›å»ºIPå‰ç¼€åˆ—è¡¨1ï¼ŒåŒ¹é…Loopback1ã€Loopback2æ¥å£è·¯ç”± [R1]ip ip-prefix 1 permit 172.16.0.0 16 greater-equal 24 less-equal 24 #åˆ›å»ºRoute-Policy hcipï¼Œå¹¶åˆ›å»ºèŠ‚ç‚¹10ï¼Œåœ¨å…¶ä¸­è°ƒç”¨IPå‰ç¼€åˆ—è¡¨1 [R1]route-policy hcip permit node 10 [R1-route-policy] if-match ip-prefix 1 [R1-route-policy] quit [R1]bgp 64511 [R1-bgp] import-route direct route-policy hcip [R1-bgp] summary automatic Info: Automatic summarization is valid only for the routes imported through the import-route command. è‡ªåŠ¨æ±‡æ€»åªå¯¹é€šè¿‡import-routeå‘½ä»¤å¼•å…¥çš„è·¯ç”±ç”Ÿæ•ˆã€‚ #åœ¨R1ä¸ŠæŸ¥çœ‹BGPè·¯ç”±è¡¨ display bgp routing-table Loopback1ã€Loopback2æ¥å£è·¯ç”±å·²ç»å‘å¸ƒåˆ°BGPï¼Œç”±äºR1æ¿€æ´»äº†BGPè·¯ç”±è‡ªåŠ¨æ±‡æ€»ï¼Œå› æ­¤R1ä¼šå°†è¿™äº›è·¯ç”±æ±‡æ€»æˆ172.16.0.0&#x2F;16ï¼ŒåŒæ—¶æŠ‘åˆ¶æ‰€æœ‰çš„æ˜ç»†è·¯ç”±ï¼Œé€šè¿‡æ˜ç»†è·¯ç”±å‰çš„â€œsâ€æ ‡è®°å¯ä»¥çœ‹å‡ºï¼Œè¯¥æ ‡è®°çš„å«ä¹‰ä¸ºâ€œsuppressedâ€ï¼Œè¡¨ç¤ºè¢«æŠ‘åˆ¶ï¼Œæœ€ç»ˆR1åªå¯¹å¤–é€šå‘Šæ±‡æ€»è·¯ç”±172.16.0.0&#x2F;16ã€‚ #åœ¨R2ä¸ŠæŸ¥çœ‹BGPè·¯ç”±è¡¨ display bgp routing-table R2ä¸Šåªèƒ½çœ‹åˆ°ä¸€æ¡ä¸»ç±»è·¯ç”±172.16.0.0&#x2F;16ã€‚ #åœ¨R2ä¸ŠæŸ¥çœ‹BGPè·¯ç”±172.16.0.0çš„æ˜ç»†ä¿¡æ¯ display bgp routing-table 172.16.0.0 è¯¥è·¯ç”±çš„è·¯å¾„å±æ€§ä¸­å­˜åœ¨Aggregatorå±æ€§ï¼Œå…¶ä¸­æºå¸¦äº†æ±‡æ€»è·¯ç”±ç”Ÿæˆè®¾å¤‡æ‰€å±çš„ASå·ä»¥åŠå…¶Router ID 4.BGPè·¯ç”±æ‰‹åŠ¨æ±‡æ€»åœ¨R3ä¸Šå°†Loopback1ã€Loopback2æ¥å£è·¯ç”±å‘å¸ƒåˆ°BGPï¼Œåœ¨R2ä¸Šé€šè¿‡aggregateå‘½ä»¤æ‰§è¡Œæ‰‹åŠ¨æ±‡æ€»ï¼Œå¹¶æŠ‘åˆ¶æ˜ç»†è·¯ç”±çš„å¯¹å¤–å‘å¸ƒã€‚ #åˆ›å»ºIPå‰ç¼€åˆ—è¡¨1ï¼ŒåŒ¹é…Loopback1ã€Loopback2æ¥å£è·¯ç”± [R3]ip ip-prefix 1 permit 172.17.0.0 16 greater-equal 24 less-equal 24 #åˆ›å»ºRoute-Policy hcipï¼Œå¹¶åˆ›å»ºèŠ‚ç‚¹10ï¼Œåœ¨å…¶ä¸­è°ƒç”¨IPå‰ç¼€åˆ—è¡¨1 [R3]route-policy hcip permit node 10 [R3-route-policy] if-match ip-prefix 1 [R3-route-policy] quit #å°†Loopback1ã€Loopback2æ¥å£è·¯ç”±å‘å¸ƒåˆ°BGP [R3]bgp 64513 [R3-bgp] import-route direct route-policy hcip #æŸ¥çœ‹R2çš„BGPè·¯ç”±è¡¨ display bgp routing-table â€‹ åœ¨R2çš„BGPè·¯ç”±è¡¨ä¸­å·²ç»å­˜åœ¨R3é€šå‘Šçš„BGPè·¯ç”±172.17.1.0&#x2F;24ã€172.17.2.0&#x2F;24ã€‚ #R2ä¸Šæ‰§è¡Œæ‰‹åŠ¨è·¯ç”±æ±‡æ€»ï¼Œå°†172.17.1.0&#x2F;24ã€172.17.2.0&#x2F;24æ±‡æ€»æˆ172.17.0.0&#x2F;22ï¼Œå¹¶æŠ‘åˆ¶æ˜ç»†è·¯ç”±çš„å¯¹å¤–é€šå‘Š [R2]bgp 64512 [R2-bgp] aggregate 172.17.0.0 22 detail-suppressed #æŸ¥çœ‹R2çš„BGPè·¯ç”±è¡¨ display bgp routing-table â€‹ æ­¤æ—¶åœ¨R2çš„BGPè·¯ç”±è¡¨ä¸­å¯ä»¥çœ‹åˆ°æ±‡æ€»åçš„è·¯ç”±ã€‚ #åœ¨R2ä¸ŠæŸ¥çœ‹BGPè·¯ç”±172.16.0.0&#x2F;22çš„æ˜ç»†ä¿¡æ¯ display bgp routing-table 172.17.0.0 22 ä»è¾“å‡ºä¿¡æ¯å¯ä»¥çœ‹åˆ°AS_Pathå€¼ä¸ºNilï¼Œä»£è¡¨äº†AS_Pathå±æ€§å€¼ä¸ºç©ºï¼Œè¿™æ„å‘³ç€ä¸¢å¤±äº†æ˜ç»†çš„AS_Pathå±æ€§å€¼ï¼ŒBGPä¾èµ–AS_Pathå®ç°é˜²ç¯ï¼Œå› æ­¤AS_Pathå±æ€§çš„ä¸¢å¤±å¯èƒ½å¸¦æ¥è·¯ç”±ç¯è·¯ã€‚ä»è¯¥æ¡è·¯ç”±å¯¹å¤–é€šå‘Šçš„å¯¹ç­‰ä½“ä¸­å¯ä»¥çœ‹åˆ°10.0.23.3ï¼ˆR3)ã€‚ #æŸ¥çœ‹R3çš„BGPè·¯ç”±è¡¨ åœ¨R3çš„BGPè·¯ç”±è¡¨ä¸­å¯ä»¥çœ‹åˆ°æ±‡æ€»è·¯ç”±172.17.0.0&#x2F;22ã€‚ #ä¸ºé˜²æ­¢è·¯ç”±ç¯è·¯ï¼Œåœ¨R2ä¸Šæ‰§è¡Œæ‰‹åŠ¨æ±‡æ€»æ—¶å¢åŠ as-setå…³é”®å­— [R2]bgp 64512 [R2-bgp] aggregate 172.17.0.0 255.255.252.0 detail-suppressed as-set #å†æ¬¡åœ¨R2ä¸ŠæŸ¥çœ‹BGPè·¯ç”±172.17.0.0&#x2F;22çš„æ˜ç»†ä¿¡æ¯ å¯ä»¥çœ‹åˆ°æ­¤æ—¶AS_Pathå±æ€§å€¼ä¸º64513ï¼Œæ­¤æ—¶è¯¥æ¡è·¯ç”±ä¾æ—§å‘10.0.23.3ï¼ˆR3ï¼‰é€šå‘Šã€‚ R3æ”¶åˆ°å…³äº172.17.0.0&#x2F;22çš„é€šå‘Šä¹‹åï¼Œåœ¨AS_Pathä¸­å°†çœ‹åˆ°è‡ªèº«çš„ASå·ï¼ˆ64153ï¼‰ï¼Œå°†ä¼šå¿½ç•¥è¯¥è·¯ç”±é€šå‘Šã€‚æ­¤æ—¶R3çš„BGPè·¯ç”±è¡¨ä¸­æ— æ³•çœ‹åˆ°æ±‡æ€»è·¯ç”±172.17.0.0&#x2F;22ï¼Œå› æ­¤é€šè¿‡åœ¨æ‰‹åŠ¨è·¯ç”±æ±‡æ€»çš„é…ç½®ä¸­ä½¿ç”¨as-setå…³é”®å­—é¡ºåˆ©åœ°è§„é¿äº†è·¯ç”±ç¯è·¯çš„äº§ç”Ÿã€‚ BGPè·¯ç”±åå°„å™¨","categories":[{"name":"ipå®éªŒ","slug":"ipå®éªŒ","permalink":"http://example.com/categories/ip%E5%AE%9E%E9%AA%8C/"}],"tags":[{"name":"BGP","slug":"BGP","permalink":"http://example.com/tags/BGP/"}]},{"title":"è·¯ç”±ç­–ç•¥","slug":"è·¯ç”±ç­–ç•¥","date":"2023-11-26T12:36:59.000Z","updated":"2024-07-23T15:14:38.526Z","comments":true,"path":"2023/11/26/è·¯ç”±ç­–ç•¥/","permalink":"http://example.com/2023/11/26/%E8%B7%AF%E7%94%B1%E7%AD%96%E7%95%A5/","excerpt":"ACLè®¿é—®æ§åˆ¶åˆ—è¡¨ACLï¼ˆAccess Control Listï¼‰æ˜¯ç”±ä¸€æ¡æˆ–å¤šæ¡è§„åˆ™ç»„æˆçš„é›†åˆã€‚æ‰€è°“è§„åˆ™ï¼Œæ˜¯æŒ‡æè¿°æŠ¥æ–‡åŒ¹é…æ¡ä»¶çš„åˆ¤æ–­è¯­å¥ï¼Œè¿™äº›æ¡ä»¶å¯ä»¥æ˜¯æŠ¥æ–‡çš„æºåœ°å€ã€ç›®çš„åœ°å€ã€ç«¯å£å·ç­‰ã€‚ ACLæœ¬è´¨ä¸Šæ˜¯ä¸€ç§æŠ¥æ–‡è¿‡æ»¤å™¨ï¼Œè§„åˆ™æ˜¯è¿‡æ»¤å™¨çš„æ»¤èŠ¯ã€‚è®¾å¤‡åŸºäºè¿™äº›è§„åˆ™è¿›è¡ŒæŠ¥æ–‡åŒ¹é…ï¼Œå¯ä»¥è¿‡æ»¤å‡ºç‰¹å®šçš„æŠ¥æ–‡ï¼Œå¹¶æ ¹æ®åº”ç”¨ACLçš„ä¸šåŠ¡æ¨¡å—çš„å¤„ç†ç­–ç•¥æ¥å…è®¸æˆ–é˜»æ­¢è¯¥æŠ¥æ–‡é€šè¿‡ã€‚ ACLå¯ä»¥å®ç°å¯¹ç½‘ç»œä¸­æŠ¥æ–‡æµçš„ç²¾ç¡®è¯†åˆ«å’Œæ§åˆ¶ï¼Œè¾¾åˆ°æ§åˆ¶ç½‘ç»œè®¿é—®è¡Œä¸ºã€é˜²æ­¢ç½‘ç»œæ”»å‡»å’Œæé«˜ç½‘ç»œå¸¦å®½åˆ©ç”¨ç‡çš„ç›®çš„ï¼Œä»è€Œåˆ‡å®ä¿éšœç½‘ç»œç¯å¢ƒçš„å®‰å…¨æ€§å’Œç½‘ç»œæœåŠ¡è´¨é‡çš„å¯é æ€§ã€‚ ACLåŒ¹é…æœºåˆ¶è®¾å¤‡å°†æŠ¥æ–‡ä¸ACLè§„åˆ™è¿›è¡ŒåŒ¹é…æ—¶ï¼Œéµå¾ªâ€œä¸€æ—¦å‘½ä¸­å³åœæ­¢åŒ¹é…â€çš„æœºåˆ¶ï¼Œå½“æ‰¾åˆ°ä¸€æ¡ç¬¦åˆåŒ¹é…æ¡ä»¶çš„è§„åˆ™æ—¶ï¼Œç»“æŸæŸ¥æ‰¾ã€‚ æŠ¥æ–‡ä¸ACLè§„åˆ™åŒ¹é…åï¼Œä¼šäº§ç”Ÿä¸¤ç§ç»“æœï¼šâ€œå‘½ä¸­è§„åˆ™â€å’Œâ€œæœªå‘½ä¸­è§„åˆ™â€ã€‚ å‘½ä¸­è§„åˆ™ï¼šæŒ‡å­˜åœ¨ACLï¼Œä¸”åœ¨ACLä¸­æŸ¥æ‰¾åˆ°äº†ç¬¦åˆåŒ¹é…æ¡ä»¶çš„è§„åˆ™ æœªå‘½ä¸­è§„åˆ™ï¼šæŒ‡ä¸å­˜åœ¨ACLï¼Œæˆ–ACLä¸­æ— è§„åˆ™ï¼Œå†æˆ–è€…åœ¨ACLä¸­éå†äº†æ‰€æœ‰è§„åˆ™éƒ½æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆåŒ¹é…æ¡ä»¶çš„è§„åˆ™ã€‚ æŠ¥æ–‡æœ€ç»ˆæ˜¯è¢«å…è®¸é€šè¿‡è¿˜æ˜¯æ‹’ç»é€šè¿‡ï¼Œå®é™…æ˜¯ACLè§„åˆ™ä¸­çš„æŒ‡å®šåŠ¨ä½œå’Œåº”ç”¨ACLçš„å„ä¸ªä¸šåŠ¡æ¨¡å—æ¥å…±åŒå†³å®šã€‚ä¸åŒçš„ä¸šåŠ¡æ¨¡å—ï¼Œå¯¹å‘½ä¸­å’Œæœªå‘½ä¸­è§„åˆ™æŠ¥æ–‡çš„å¤„ç†æ–¹å¼ä¹Ÿå„ä¸ç›¸åŒã€‚ ç³»ç»ŸæŒ‰ç…§ACLè§„åˆ™ç¼–å·ä»å°åˆ°å¤§çš„é¡ºåºè¿›è¡ŒæŠ¥æ–‡åŒ¹é…ï¼Œè§„åˆ™ç¼–å·è¶Šå°è¶Šå®¹æ˜“è¢«åŒ¹é…ã€‚ å¦‚æœé…ç½®è§„åˆ™æ—¶æŒ‡å®šäº†è§„åˆ™ç¼–å·ï¼Œåˆ™è§„åˆ™ç¼–å·è¶Šå°ï¼Œè§„åˆ™æ’å…¥ä½ç½®è¶Šé å‰ï¼Œè¯¥è§„åˆ™è¶Šå…ˆè¢«åŒ¹é…ã€‚ å¦‚æœé…ç½®è§„åˆ™æ—¶æœªæŒ‡å®šè§„åˆ™ç¼–å·ï¼Œåˆ™ç”±ç³»ç»Ÿè‡ªåŠ¨ä¸ºå…¶åˆ†é…ä¸€ä¸ªç¼–å·ã€‚è¯¥ç¼–å·æ˜¯ä¸€ä¸ªå¤§äºå½“å‰ACLå†…æœ€å¤§è§„åˆ™ç¼–å·ä¸”æ˜¯æ­¥é•¿æ•´æ•°å€çš„æœ€å°æ•´æ•°ï¼Œå› æ­¤è¯¥è§„åˆ™ä¼šè¢«æœ€ååŒ¹é…ã€‚ IPå‰ç¼€åˆ—è¡¨IPå‰ç¼€åˆ—è¡¨ï¼ˆIP-Prefix Listï¼‰æ˜¯å°†è·¯ç”±æ¡ç›®çš„ç½‘ç»œåœ°å€ã€æ©ç é•¿åº¦ä½œä¸ºåŒ¹é…æ¡ä»¶çš„è¿‡æ»¤å™¨ï¼Œå¯åœ¨å„è·¯ç”±åè®®å‘å¸ƒå’Œæ¥æ”¶è·¯ç”±æ—¶ä½¿ç”¨ã€‚ ä¸åŒäºACLï¼ŒIP-Prefix Listèƒ½å¤ŸåŒæ—¶åŒ¹é…IPåœ°å€å‰ç¼€é•¿åº¦ä»¥åŠæ©ç é•¿åº¦ï¼Œå¢å¼ºäº†åŒ¹é…çš„ç²¾ç¡®åº¦ã€‚ åŒ¹é…æœºåˆ¶å’ŒACLä¸€æ · Filter-PolicyFilter-Policyï¼ˆè¿‡æ»¤-ç­–ç•¥ï¼‰æ˜¯ä¸€ä¸ªå¾ˆå¸¸ç”¨çš„è·¯ç”±ä¿¡æ¯è¿‡æ»¤å·¥å…·ï¼Œèƒ½å¤Ÿå¯¹æ¥æ”¶ã€å‘å¸ƒã€å¼•å…¥çš„è·¯ç”±è¿›è¡Œè¿‡æ»¤ï¼Œå¯åº”ç”¨äºIS-ISã€OSPFã€BGPç­‰åè®®ã€‚ filter-policyåœ¨è·ç¦»çŸ¢é‡è·¯ç”±åè®®ä¸­çš„åº”ç”¨ filter-policyåœ¨é“¾è·¯çŠ¶æ€è·¯ç”±åè®®ä¸­çš„åº”ç”¨ åœ¨é“¾è·¯çŠ¶æ€è·¯ç”±åè®®ä¸­ï¼Œå„è·¯ç”±è®¾å¤‡ä¹‹é—´ä¼ é€’çš„æ˜¯LSAä¿¡æ¯ï¼Œç„¶åè®¾å¤‡æ ¹æ®LSAæ±‡æ€»æˆçš„LSDBä¿¡æ¯è®¡ç®—å‡ºè·¯ç”±è¡¨ã€‚ä»¥OSPFä¸ºä¾‹ï¼Œfilter-policyç”Ÿæ•ˆè§„åˆ™å¦‚ä¸‹ï¼š filter-policy importå‘½ä»¤å®é™…ä¸Šæ˜¯å¯¹OSPFè®¡ç®—å‡ºæ¥çš„è·¯ç”±è¿›è¡Œè¿‡æ»¤ï¼Œä¸æ˜¯å¯¹å‘å¸ƒå’Œæ¥æ”¶çš„LSAè¿›è¡Œè¿‡æ»¤ã€‚filter-policy importå‘½ä»¤å¯¹æ¥æ”¶çš„è·¯ç”±è®¾ç½®è¿‡æ»¤ç­–ç•¥ï¼Œåªæœ‰é€šè¿‡è¿‡æ»¤ç­–ç•¥çš„è·¯ç”±æ‰è¢«æ·»åŠ åˆ°è·¯ç”±è¡¨ä¸­ï¼Œæ²¡æœ‰é€šè¿‡è¿‡æ»¤ç­–ç•¥çš„è·¯ç”±ä¸ä¼šè¢«æ·»åŠ è¿›è·¯ç”±è¡¨ï¼Œä½†ä¸å½±å“å¯¹å¤–å‘å¸ƒå‡ºå»ã€‚ï¼ˆåªå½±å“æœ¬åœ°å…¨å±€è·¯ç”±è¡¨ï¼‰ filter-policy exportå‘½ä»¤ç”¨æ¥å¯¹å¼•å…¥çš„è·¯ç”±åœ¨å‘å¸ƒæ—¶è¿›è¡Œè¿‡æ»¤ï¼Œåªå°†æ»¡è¶³æ¡ä»¶çš„å¤–éƒ¨è·¯ç”±è½¬æ¢ä¸ºType5 LSAï¼ˆAS-external-LSAï¼‰å¹¶å‘å¸ƒå‡ºå»ã€‚è¿™æ ·å¯ä»¥åœ¨å¼•å…¥å¤–éƒ¨è·¯ç”±æ—¶è¿›è¡Œç‰¹å®šçš„è¿‡æ»¤ï¼Œé˜²æ­¢å½¢æˆè·¯ç”±ç¯è·¯ã€‚ OSPFé€šè¿‡å‘½ä»¤import-routeå¼•å…¥å¤–éƒ¨è·¯ç”±åï¼Œä¸ºäº†é¿å…è·¯ç”±ç¯è·¯çš„äº§ç”Ÿï¼Œé€šè¿‡filter-policy exportå‘½ä»¤å¯¹å¼•å…¥çš„è·¯ç”±åœ¨å‘å¸ƒæ—¶è¿›è¡Œè¿‡æ»¤ï¼Œåªå°†æ»¡è¶³æ¡ä»¶çš„å¤–éƒ¨è·¯ç”±è½¬æ¢ä¸ºType5 LSAï¼ˆAS-external-LSAï¼‰å¹¶å‘å¸ƒå‡ºå»ã€‚ï¼ˆå½±å“åè¾¹çš„è·¯ç”±å™¨çš„ospfè·¯ç”±è¡¨å’Œå…¨å±€è·¯ç”±è¡¨ï¼‰ importç¤ºä¾‹ï¼š ï¼ˆ1ï¼‰é€šè¿‡filter-policyå¯¹OSPFæ¥æ”¶çš„è·¯ç”±è¿‡æ»¤ï¼ˆåŒºåŸŸå†…ï¼‰ç¤ºä¾‹ ä¸‰å°äº¤æ¢æœºåŒå±äºOSPF Area 0åŒºåŸŸï¼ŒSwitchAå‘å¸ƒæµ‹è¯•ç½‘æ®µ10.1.1.0&#x2F;24ï¼Œè¦æ±‚åœ¨SwitchBä¸Šéƒ¨ç½²filter-policy importï¼Œä½¿å¾—SwitchBçš„è·¯ç”±è¡¨ä¸­ä¸å…è®¸å‡ºç°10.1.1.0&#x2F;24è¿™æ¡è·¯ç”±ã€‚ é…ç½®æ–¹æ³• åœ¨SwitchBä¸Šå®šä¹‰ä¸€ä¸ªåœ°å€å‰ç¼€åˆ—è¡¨ï¼Œâ€œæŠ“å–â€ç¬¦åˆæ¡ä»¶çš„è·¯ç”±ã€‚ 12[SwitchB] ip ip-prefix huawei index 10 deny 10.1.1.0 24 //æ‹’ç»è¿™æ¡[SwitchB] ip ip-prefix huawei index 20 permit 0.0.0.0 0 less-equal 32 //å…è®¸æ‰€æœ‰ åœ¨SwitchBçš„OSPFè§†å›¾ä¸­ï¼Œéƒ¨ç½²filter-policy importã€‚ 12[SwitchB] ospf[SwitchB-ospf-1] filter-policy ip-prefix huawei import ç»“æœéªŒè¯ åšå®Œä¸Šè¿°é…ç½®ä»¥åï¼ŒæŸ¥çœ‹SwitchBå’ŒSwitchCçš„è·¯ç”±è¡¨å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031[SwitchB] display ip routing-tableRoute Flags: R - relay, D - download to fib-----------------------------------------------------------------------------Routing Tables: Public Destinations : 6 Routes : 6 Destination/Mask Proto Pre Cost Flags NextHop Interface 127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0 127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0 192.168.12.0/24 Direct 0 0 D 192.168.12.2 Vlanif12 192.168.12.2/32 Direct 0 0 D 127.0.0.1 Vlanif12 192.168.23.0/24 Direct 0 0 D 192.168.23.1 Vlanif23 192.168.23.1/32 Direct 0 0 D 127.0.0.1 Vlanif23ï¼ˆBçš„ipè·¯ç”±è¡¨ä¸­è¢«è¿‡æ»¤ï¼Œä½†ospfè·¯ç”±è¡¨åœ¨ä»ç„¶å­˜åœ¨ï¼‰[SwitchC] display ip routing-tableRoute Flags: R - relay, D - download to fib------------------------------------------------------------------------------Routing Tables: Public Destinations : 6 Routes : 6 Destination/Mask Proto Pre Cost Flags NextHop Interface 10.1.1.0/24 OSPF 10 3 D 192.168.23.1 Vlanif23 127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0 127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0 192.168.12.0/24 OSPF 10 2 D 192.168.23.1 Vlanif23 192.168.23.0/24 Direct 0 0 D 192.168.23.2 Vlanif23 192.168.23.2/32 Direct 0 0 D 127.0.0.1 Vlanif23 é€šè¿‡SwitchBå’ŒSwitchCçš„è·¯ç”±è¡¨å¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶åœ¨SwitchBä¸Š10.1.1.0&#x2F;24è¿™æ¡è·¯ç”±å·²ç»è¢«è¿‡æ»¤æ‰ï¼Œä½†æ˜¯LSAä¿¡æ¯ä¼šç»§ç»­ä¼ é€’ç»™SwitchCï¼Œæ‰€ä»¥SwitchCçš„è·¯ç”±è¡¨ä¸­ç»§ç»­å­˜åœ¨10.1.1.0&#x2F;24è¿™æ¡è·¯ç”±ã€‚è¿™æ ·çš„ç»“æœä¹ŸéªŒè¯äº†ä¸€å¼€å§‹åœ¨æ³¨æ„äº‹é¡¹ä¸­ç»™å‡ºçš„ç»“è®ºï¼šåœ¨é“¾è·¯çŠ¶æ€è·¯ç”±åè®®ä¸­ï¼Œfilter-policyåªèƒ½è¿‡æ»¤è·¯ç”±ä¿¡æ¯ï¼Œä¸èƒ½è¿‡æ»¤LSAä¿¡æ¯ã€‚ åŒæ—¶SwitchBå’ŒSwitchCçš„LSDBä¸­ä»ç„¶å­˜åœ¨æè¿°10.1.1.0&#x2F;24è¿™æ¡è·¯ç”±çš„LSAä¿¡æ¯ï¼Œæ­¤å¤„å¯ä»¥é€šè¿‡æŸ¥çœ‹SwitchBå’ŒSwitchCçš„LSAä¿¡æ¯è¿›è¡ŒéªŒè¯ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950[SwitchB] display ospf lsdb router OSPF Process 1 with Router ID 10.10.10.2 Area: 0.0.0.0 Link State Database â€¦â€¦â€¦ Type : Router Ls id : 10.10.10.1 Adv rtr : 10.10.10.1 Ls age : 139 Len : 48 Options : E seq# : 80000005 chksum : 0x41c4 Link count: 2 * Link ID: 10.1.1.0 Data : 255.255.255.0 Link Type: StubNet Metric : 1 Priority : Low * Link ID: 192.168.12.2 Data : 192.168.12.1 Link Type: TransNet Metric : 1[SwitchC] display ospf lsdb router OSPF Process 1 with Router ID 10.10.10.3 Area: 0.0.0.0 Link State Database â€¦â€¦â€¦â€¦ Type : Router Ls id : 10.10.10.1 Adv rtr : 10.10.10.1 Ls age : 81 Len : 48 Options : E seq# : 80000005 chksum : 0x41c4 Link count: 2 * Link ID: 10.1.1.0 Data : 255.255.255.0 Link Type: StubNet Metric : 1 Priority : Low * Link ID: 192.168.12.2 Data : 192.168.12.1 Link Type: TransNet Metric : 1 å¯ä»¥çœ‹åˆ°SwitchBå’ŒSwitchCçš„LSDBä¸­ä»ç„¶å­˜åœ¨æè¿°10.1.1.0&#x2F;24è¿™æ¡è·¯ç”±çš„LSAä¿¡æ¯ã€‚ ï¼ˆ2ï¼‰é€šè¿‡filter-policyå¯¹OSPFæ¥æ”¶çš„è·¯ç”±è¿‡æ»¤ï¼ˆåŒºåŸŸé—´ï¼‰ ç›¸å¯¹äºä¸Šä¸€ä¸ªåœºæ™¯ï¼Œè¿™ä¸ªåœºæ™¯çš„åŒºåˆ«ä¹‹å¤„æ˜¯åˆ’åˆ†äº†ä¸¤ä¸ªä¸åŒçš„åŒºåŸŸï¼ŒSwitchBå’ŒSwitchCä¹‹é—´ä¼ é€’çš„æ˜¯Type3 LSAï¼Œè¿™ä¸ªType3 LSAæ˜¯SwitchBä¸Šæ ¹æ®åŒºåŸŸé—´è·¯ç”±ç”Ÿæˆçš„ã€‚é…ç½®æ–¹æ³•è·Ÿä¸Šä¸€ä¸ªåœºæ™¯ä¸€æ ·ï¼Œæ­¤å¤„ä¸å†èµ˜è¿°ã€‚ åœ¨éƒ¨ç½²è·¯ç”±è¿‡æ»¤ç­–ç•¥ä¹‹å‰ï¼ŒSwitchBå’ŒSwitchCçš„è·¯ç”±è¡¨ä¸­éƒ½æœ‰10.1.1.0&#x2F;24è¿™æ¡è·¯ç”±ã€‚ åœ¨SwitchBä¸Šéƒ¨ç½²filter-policy importä»¥åï¼ŒæŸ¥çœ‹SwitchBå’ŒSwitchCçš„è·¯ç”±è¡¨ï¼Œç»“æœå¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829[SwitchB] display ip routing-tableRoute Flags: R - relay, D - download to fib-----------------------------------------------------------------------------Routing Tables: Public Destinations : 6 Routes : 6 Destination/Mask Proto Pre Cost Flags NextHop Interface 127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0 127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0 192.168.12.0/24 Direct 0 0 D 192.168.12.2 Vlanif12 192.168.12.2/32 Direct 0 0 D 127.0.0.1 Vlanif12 192.168.23.0/24 Direct 0 0 D 192.168.23.1 Vlanif23 192.168.23.1/32 Direct 0 0 D 127.0.0.1 Vlanif23[SwitchC] display ip routing-tableRoute Flags: R - relay, D - download to fib------------------------------------------------------------------------------Routing Tables: Public Destinations : 5 Routes : 5 Destination/Mask Proto Pre Cost Flags NextHop Interface 127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0 127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0 192.168.12.0/24 OSPF 10 2 D 192.168.23.1 Vlanif23 192.168.23.0/24 Direct 0 0 D 192.168.23.2 Vlanif23 192.168.23.2/32 Direct 0 0 D 127.0.0.1 Vlanif23 ç”±äºç°åœ¨åˆ’åˆ†ä¸åŒçš„åŒºåŸŸï¼ŒSwitchCä¸Šçš„10.1.1.0&#x2F;24è¿™æ¡è·¯ç”±æ˜¯ç”±SwitchBæ ¹æ®è‡ªèº«å­¦ä¹ çš„è·¯ç”±äº§ç”Ÿçš„Type3-LSAæè¿°çš„ï¼Œè€ŒSwitchBä¸Šçš„è¿™æ¡è·¯ç”±è¢«è¿‡æ»¤æ‰äº†ï¼Œå› æ­¤ä¸èƒ½å¤Ÿå†äº§ç”Ÿæè¿°åŒºåŸŸé—´è·¯ç”±çš„è¿™ä¸ªType3-LSAï¼Œå› æ­¤SwitchCä¸Šä¸ä¼šå†å­¦ä¹ åˆ°10.1.1.0&#x2F;24è¿™æ¡è·¯ç”±ã€‚ exportç¤ºä¾‹ï¼š åœ¨R1ä¸Šåˆ›å»ºå››ä¸ªç¯å›å£ï¼ŒIPåœ°å€åˆ†åˆ«ä¸º192.168.1.0&#x2F;24ï¼Œ192.168.2.0&#x2F;24ã€192.168.3.0&#x2F;24ã€192.168.4.0&#x2F;24ï¼Œå¹¶ä¸”å…¨éƒ¨å®£å‘Šè¿›OSPFã€‚ å¼•å…¥ç›´è¿ï¼Œä½†æ˜¯è¦ä¿è¯R2å’ŒR3ä¸Šåªèƒ½æ”¶åˆ°192.168.1.0è¿™æ¡è·¯ç”± é€šè¿‡Filter-policyè®©R2å’ŒR3åªèƒ½æ”¶åˆ°192.168.1.0è¿™æ¡è·¯ç”± [R1]ip ip-prefix ly permit 192.168.1.0 24 [R1]ospf [R1-ospf-1]filter-policy ip-prefix ly export ã€æŠ€æœ¯è¦ç‚¹ã€‘ OSPFé€šè¿‡å‘½ä»¤import-routeå¼•å…¥å¤–éƒ¨è·¯ç”±åï¼Œä¸ºäº†é¿å…è·¯ç”±ç¯è·¯çš„äº§ç”Ÿï¼Œé€šè¿‡filter-policy exportå‘½ä»¤å¯¹å¼•å…¥çš„è·¯ç”±åœ¨å‘å¸ƒæ—¶è¿›è¡Œè¿‡æ»¤ï¼Œåªå°†æ»¡è¶³æ¡ä»¶çš„å¤–éƒ¨è·¯ç”±è½¬æ¢ä¸ºType5 LSAï¼ˆAS-external-LSAï¼‰å¹¶å‘å¸ƒå‡ºå»ã€‚ å½“ç½‘ç»œä¸­åŒæ—¶éƒ¨ç½²äº†IS-ISå’Œå…¶ä»–è·¯ç”±åè®®æ—¶ï¼Œå¦‚æœå·²ç»åœ¨è¾¹ç•Œè®¾å¤‡ä¸Šå¼•å…¥å…¶ä»–è·¯ç”±åè®®çš„è·¯ç”±ï¼Œç¼ºçœæƒ…å†µä¸‹ï¼Œè¯¥è®¾å¤‡å°†æŠŠå¼•å…¥çš„å…¨éƒ¨å¤–éƒ¨è·¯ç”±å‘å¸ƒç»™IS-ISé‚»å±…ã€‚å¦‚æœåªå¸Œæœ›å°†å¼•å…¥çš„éƒ¨åˆ†å¤–éƒ¨è·¯ç”±å‘å¸ƒç»™é‚»å±…ï¼Œå¯ä»¥ä½¿ç”¨****filter-policy export****å‘½ä»¤å®ç°ã€‚ Route-PolicyRoute-Policyæ˜¯ä¸€ä¸ªç­–ç•¥å·¥å…·ï¼Œç”¨äºè¿‡æ»¤è·¯ç”±ä¿¡æ¯ï¼Œä»¥åŠä¸ºè¿‡æ»¤åçš„è·¯ç”±ä¿¡æ¯è®¾ç½®è·¯ç”±å±æ€§ã€‚ ä¸€ä¸ªRoute-Policyç”±ä¸€ä¸ªæˆ–å¤šä¸ªèŠ‚ç‚¹ï¼ˆNodeï¼‰æ„æˆï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥æ˜¯ä¸€ç³»åˆ—æ¡ä»¶è¯­å¥ï¼ˆåŒ¹é…æ¡ä»¶ï¼‰ä»¥åŠæ‰§è¡Œè¯­å¥ï¼ˆæ‰§è¡ŒåŠ¨ä½œï¼‰çš„é›†åˆï¼Œè¿™äº›é›†åˆæŒ‰ç…§ç¼–å·ä»å°åˆ°å¤§çš„é¡ºåºæ’åˆ—ã€‚ ç¤ºä¾‹ï¼š åŒç‚¹åŒå‘è·¯ç”±é‡å‘å¸ƒ è§£å†³æ¬¡ä¼˜è·¯å¾„ï¼š ç¯è·¯é—®é¢˜ï¼š è§£å†³ç¯è·¯ï¼š ç­–ç•¥è·¯ç”±è‹¥è®¾å¤‡éƒ¨ç½²äº†PBRï¼Œåˆ™è¢«åŒ¹é…çš„æŠ¥æ–‡ä¼˜å…ˆæ ¹æ®PBRçš„ç­–ç•¥è¿›è¡Œè½¬å‘ï¼Œå³PBRç­–ç•¥çš„ä¼˜å…ˆçº§é«˜äºä¼ ç»Ÿè·¯ç”±è¡¨ã€‚ ç­–ç•¥è·¯ç”±PBRï¼ˆPolicy-Based Routingï¼‰æ˜¯ä¸€ç§ä¾æ®ç”¨æˆ·åˆ¶å®šçš„ç­–ç•¥è¿›è¡Œè·¯ç”±é€‰æ‹©çš„æœºåˆ¶ï¼Œåˆ†ä¸ºæœ¬åœ°ç­–ç•¥è·¯ç”±ã€æ¥å£ç­–ç•¥è·¯ç”±å’Œæ™ºèƒ½ç­–ç•¥è·¯ç”±SPRï¼ˆSmart Policy Routingï¼‰ã€‚ ç­–ç•¥è·¯ç”±ä¸è·¯ç”±ç­–ç•¥ï¼ˆRouting Policyï¼‰å­˜åœ¨ä»¥ä¸‹ä¸åŒï¼š ç­–ç•¥è·¯ç”±çš„æ“ä½œå¯¹è±¡æ˜¯æ•°æ®åŒ…ï¼Œåœ¨è·¯ç”±è¡¨å·²ç»äº§ç”Ÿçš„æƒ…å†µä¸‹ï¼Œä¸æŒ‰ç…§è·¯ç”±è¡¨è¿›è¡Œè½¬å‘ï¼Œè€Œæ˜¯æ ¹æ®éœ€è¦ï¼Œä¾ç…§æŸç§ç­–ç•¥æ”¹å˜æ•°æ®åŒ…è½¬å‘è·¯å¾„ã€‚ è·¯ç”±ç­–ç•¥çš„æ“ä½œå¯¹è±¡æ˜¯è·¯ç”±ä¿¡æ¯ã€‚è·¯ç”±ç­–ç•¥ä¸»è¦å®ç°äº†è·¯ç”±è¿‡æ»¤å’Œè·¯ç”±å±æ€§è®¾ç½®ç­‰åŠŸèƒ½ï¼Œå®ƒé€šè¿‡æ”¹å˜è·¯ç”±å±æ€§ï¼ˆåŒ…æ‹¬å¯è¾¾æ€§ï¼‰æ¥æ”¹å˜ç½‘ç»œæµé‡æ‰€ç»è¿‡çš„è·¯å¾„ã€‚ è¯­æ³•ï¼š MQCMQCï¼ˆModular QoS Command-Line Interfaceï¼Œæ¨¡å—åŒ–QoSå‘½ä»¤è¡Œï¼‰æ˜¯æŒ‡é€šè¿‡å°†å…·æœ‰æŸç±»å…±åŒç‰¹å¾çš„æ•°æ®æµåˆ’åˆ†ä¸ºä¸€ç±»ï¼Œå¹¶ä¸ºåŒä¸€ç±»æ•°æ®æµæä¾›ç›¸åŒçš„æœåŠ¡ï¼Œä¹Ÿå¯ä»¥å¯¹ä¸åŒç±»çš„æ•°æ®æµæä¾›ä¸åŒçš„æœåŠ¡ã€‚ MQCåŒ…å«ä¸‰ä¸ªè¦ç´ ï¼šæµåˆ†ç±»ï¼ˆtraffic classifierï¼‰ã€æµè¡Œä¸ºï¼ˆtraffic behaviorï¼‰å’Œæµç­–ç•¥ï¼ˆtraffic policyï¼‰ã€‚MQCçš„æµè¡Œä¸ºæ”¯æŒé‡å®šå‘æŠ¥æ–‡ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨MQCå®ç°IPå•æ’­ç­–ç•¥è·¯ç”±ã€‚ æµåˆ†ç±»æµåˆ†ç±»ç”¨æ¥å®šä¹‰ä¸€ç»„æµé‡åŒ¹é…è§„åˆ™ï¼Œä»¥å¯¹æŠ¥æ–‡è¿›è¡Œåˆ†ç±»ã€‚æµåˆ†ç±»è§„åˆ™: æµåˆ†ç±»ä¸­å„è§„åˆ™ä¹‹é—´çš„å…³ç³»åˆ†ä¸ºï¼šandæˆ–orï¼Œç¼ºçœæƒ…å†µä¸‹çš„å…³ç³»ä¸ºorã€‚ andï¼šå½“æµåˆ†ç±»ä¸­åŒ…å«ACLè§„åˆ™æ—¶ï¼ŒæŠ¥æ–‡å¿…é¡»åŒ¹é…å…¶ä¸­ä¸€æ¡ACLè§„åˆ™ä»¥åŠæ‰€æœ‰éACLè§„åˆ™æ‰å±äºè¯¥ç±»ï¼›å½“æµåˆ†ç±»ä¸­æ²¡æœ‰ACLè§„åˆ™æ—¶ï¼ŒæŠ¥æ–‡å¿…é¡»åŒ¹é…æ‰€æœ‰éACLè§„åˆ™æ‰å±äºè¯¥ç±»ã€‚ orï¼šæŠ¥æ–‡åªè¦åŒ¹é…äº†æµåˆ†ç±»ä¸­çš„ä¸€ä¸ªè§„åˆ™ï¼Œè®¾å¤‡å°±è®¤ä¸ºæŠ¥æ–‡å±äºæ­¤ç±»ã€‚ æµè¡Œä¸º æµç­–ç•¥ç»‘å®šæµåˆ†ç±»ä¸æµè¡Œä¸º æ¡ˆä¾‹ Traffic-Filterä½¿ç”¨Traffic-Filterè¿‡æ»¤æµé‡å¯ä»¥çµæ´»åœ°é€‰æ‹©éƒ¨ç½²ä½ç½®ï¼Œåœ¨æµé‡è¿›å…¥è®¾å¤‡æˆ–è€…ç¦»å¼€è®¾å¤‡çš„æ¥å£ä¸Šæ‰§è¡Œè¿‡æ»¤åŠ¨ä½œï¼ŒåŒå‘è®¿é—®çš„ä¸šåŠ¡ç¦æ­¢å…¶ä¸­ä¸€ä¸ªæ–¹å‘å³å¯å®ç°é˜»æ–­ä¸šåŠ¡çš„éœ€æ±‚ã€‚ å®éªŒæ‰‹å†Œå®éªŒ è®¾å¤‡äº’è”æ–¹å¼ã€äº’è”åœ°å€å¦‚å›¾æ‰€ç¤ºï¼Œæ‰€æœ‰è®¾å¤‡å‡åˆ›å»ºLoopback0ï¼Œå…¶IPåœ°å€ä¸º10.0.x.x&#x2F;32ï¼Œå…¶ä¸­xä¸ºè®¾å¤‡ç¼–å·ï¼ŒR1ã€R2ã€R3åœ¨äº’è”æ¥å£ã€Loopback0æ¥å£ä¸Šæ¿€æ´»OSPFã€‚ R3ã€R4å±äºIS-IS Area 49.0001ï¼Œä¸¤è€…éƒ½æ˜¯Level-1è·¯ç”±å™¨ï¼ŒR3ã€R4çš„ç³»ç»ŸIDé‡‡ç”¨0000.0000.000xæ ¼å¼ï¼Œå…¶ä¸­xä¸ºè®¾å¤‡ç¼–å·ã€‚","text":"ACLè®¿é—®æ§åˆ¶åˆ—è¡¨ACLï¼ˆAccess Control Listï¼‰æ˜¯ç”±ä¸€æ¡æˆ–å¤šæ¡è§„åˆ™ç»„æˆçš„é›†åˆã€‚æ‰€è°“è§„åˆ™ï¼Œæ˜¯æŒ‡æè¿°æŠ¥æ–‡åŒ¹é…æ¡ä»¶çš„åˆ¤æ–­è¯­å¥ï¼Œè¿™äº›æ¡ä»¶å¯ä»¥æ˜¯æŠ¥æ–‡çš„æºåœ°å€ã€ç›®çš„åœ°å€ã€ç«¯å£å·ç­‰ã€‚ ACLæœ¬è´¨ä¸Šæ˜¯ä¸€ç§æŠ¥æ–‡è¿‡æ»¤å™¨ï¼Œè§„åˆ™æ˜¯è¿‡æ»¤å™¨çš„æ»¤èŠ¯ã€‚è®¾å¤‡åŸºäºè¿™äº›è§„åˆ™è¿›è¡ŒæŠ¥æ–‡åŒ¹é…ï¼Œå¯ä»¥è¿‡æ»¤å‡ºç‰¹å®šçš„æŠ¥æ–‡ï¼Œå¹¶æ ¹æ®åº”ç”¨ACLçš„ä¸šåŠ¡æ¨¡å—çš„å¤„ç†ç­–ç•¥æ¥å…è®¸æˆ–é˜»æ­¢è¯¥æŠ¥æ–‡é€šè¿‡ã€‚ ACLå¯ä»¥å®ç°å¯¹ç½‘ç»œä¸­æŠ¥æ–‡æµçš„ç²¾ç¡®è¯†åˆ«å’Œæ§åˆ¶ï¼Œè¾¾åˆ°æ§åˆ¶ç½‘ç»œè®¿é—®è¡Œä¸ºã€é˜²æ­¢ç½‘ç»œæ”»å‡»å’Œæé«˜ç½‘ç»œå¸¦å®½åˆ©ç”¨ç‡çš„ç›®çš„ï¼Œä»è€Œåˆ‡å®ä¿éšœç½‘ç»œç¯å¢ƒçš„å®‰å…¨æ€§å’Œç½‘ç»œæœåŠ¡è´¨é‡çš„å¯é æ€§ã€‚ ACLåŒ¹é…æœºåˆ¶è®¾å¤‡å°†æŠ¥æ–‡ä¸ACLè§„åˆ™è¿›è¡ŒåŒ¹é…æ—¶ï¼Œéµå¾ªâ€œä¸€æ—¦å‘½ä¸­å³åœæ­¢åŒ¹é…â€çš„æœºåˆ¶ï¼Œå½“æ‰¾åˆ°ä¸€æ¡ç¬¦åˆåŒ¹é…æ¡ä»¶çš„è§„åˆ™æ—¶ï¼Œç»“æŸæŸ¥æ‰¾ã€‚ æŠ¥æ–‡ä¸ACLè§„åˆ™åŒ¹é…åï¼Œä¼šäº§ç”Ÿä¸¤ç§ç»“æœï¼šâ€œå‘½ä¸­è§„åˆ™â€å’Œâ€œæœªå‘½ä¸­è§„åˆ™â€ã€‚ å‘½ä¸­è§„åˆ™ï¼šæŒ‡å­˜åœ¨ACLï¼Œä¸”åœ¨ACLä¸­æŸ¥æ‰¾åˆ°äº†ç¬¦åˆåŒ¹é…æ¡ä»¶çš„è§„åˆ™ æœªå‘½ä¸­è§„åˆ™ï¼šæŒ‡ä¸å­˜åœ¨ACLï¼Œæˆ–ACLä¸­æ— è§„åˆ™ï¼Œå†æˆ–è€…åœ¨ACLä¸­éå†äº†æ‰€æœ‰è§„åˆ™éƒ½æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆåŒ¹é…æ¡ä»¶çš„è§„åˆ™ã€‚ æŠ¥æ–‡æœ€ç»ˆæ˜¯è¢«å…è®¸é€šè¿‡è¿˜æ˜¯æ‹’ç»é€šè¿‡ï¼Œå®é™…æ˜¯ACLè§„åˆ™ä¸­çš„æŒ‡å®šåŠ¨ä½œå’Œåº”ç”¨ACLçš„å„ä¸ªä¸šåŠ¡æ¨¡å—æ¥å…±åŒå†³å®šã€‚ä¸åŒçš„ä¸šåŠ¡æ¨¡å—ï¼Œå¯¹å‘½ä¸­å’Œæœªå‘½ä¸­è§„åˆ™æŠ¥æ–‡çš„å¤„ç†æ–¹å¼ä¹Ÿå„ä¸ç›¸åŒã€‚ ç³»ç»ŸæŒ‰ç…§ACLè§„åˆ™ç¼–å·ä»å°åˆ°å¤§çš„é¡ºåºè¿›è¡ŒæŠ¥æ–‡åŒ¹é…ï¼Œè§„åˆ™ç¼–å·è¶Šå°è¶Šå®¹æ˜“è¢«åŒ¹é…ã€‚ å¦‚æœé…ç½®è§„åˆ™æ—¶æŒ‡å®šäº†è§„åˆ™ç¼–å·ï¼Œåˆ™è§„åˆ™ç¼–å·è¶Šå°ï¼Œè§„åˆ™æ’å…¥ä½ç½®è¶Šé å‰ï¼Œè¯¥è§„åˆ™è¶Šå…ˆè¢«åŒ¹é…ã€‚ å¦‚æœé…ç½®è§„åˆ™æ—¶æœªæŒ‡å®šè§„åˆ™ç¼–å·ï¼Œåˆ™ç”±ç³»ç»Ÿè‡ªåŠ¨ä¸ºå…¶åˆ†é…ä¸€ä¸ªç¼–å·ã€‚è¯¥ç¼–å·æ˜¯ä¸€ä¸ªå¤§äºå½“å‰ACLå†…æœ€å¤§è§„åˆ™ç¼–å·ä¸”æ˜¯æ­¥é•¿æ•´æ•°å€çš„æœ€å°æ•´æ•°ï¼Œå› æ­¤è¯¥è§„åˆ™ä¼šè¢«æœ€ååŒ¹é…ã€‚ IPå‰ç¼€åˆ—è¡¨IPå‰ç¼€åˆ—è¡¨ï¼ˆIP-Prefix Listï¼‰æ˜¯å°†è·¯ç”±æ¡ç›®çš„ç½‘ç»œåœ°å€ã€æ©ç é•¿åº¦ä½œä¸ºåŒ¹é…æ¡ä»¶çš„è¿‡æ»¤å™¨ï¼Œå¯åœ¨å„è·¯ç”±åè®®å‘å¸ƒå’Œæ¥æ”¶è·¯ç”±æ—¶ä½¿ç”¨ã€‚ ä¸åŒäºACLï¼ŒIP-Prefix Listèƒ½å¤ŸåŒæ—¶åŒ¹é…IPåœ°å€å‰ç¼€é•¿åº¦ä»¥åŠæ©ç é•¿åº¦ï¼Œå¢å¼ºäº†åŒ¹é…çš„ç²¾ç¡®åº¦ã€‚ åŒ¹é…æœºåˆ¶å’ŒACLä¸€æ · Filter-PolicyFilter-Policyï¼ˆè¿‡æ»¤-ç­–ç•¥ï¼‰æ˜¯ä¸€ä¸ªå¾ˆå¸¸ç”¨çš„è·¯ç”±ä¿¡æ¯è¿‡æ»¤å·¥å…·ï¼Œèƒ½å¤Ÿå¯¹æ¥æ”¶ã€å‘å¸ƒã€å¼•å…¥çš„è·¯ç”±è¿›è¡Œè¿‡æ»¤ï¼Œå¯åº”ç”¨äºIS-ISã€OSPFã€BGPç­‰åè®®ã€‚ filter-policyåœ¨è·ç¦»çŸ¢é‡è·¯ç”±åè®®ä¸­çš„åº”ç”¨ filter-policyåœ¨é“¾è·¯çŠ¶æ€è·¯ç”±åè®®ä¸­çš„åº”ç”¨ åœ¨é“¾è·¯çŠ¶æ€è·¯ç”±åè®®ä¸­ï¼Œå„è·¯ç”±è®¾å¤‡ä¹‹é—´ä¼ é€’çš„æ˜¯LSAä¿¡æ¯ï¼Œç„¶åè®¾å¤‡æ ¹æ®LSAæ±‡æ€»æˆçš„LSDBä¿¡æ¯è®¡ç®—å‡ºè·¯ç”±è¡¨ã€‚ä»¥OSPFä¸ºä¾‹ï¼Œfilter-policyç”Ÿæ•ˆè§„åˆ™å¦‚ä¸‹ï¼š filter-policy importå‘½ä»¤å®é™…ä¸Šæ˜¯å¯¹OSPFè®¡ç®—å‡ºæ¥çš„è·¯ç”±è¿›è¡Œè¿‡æ»¤ï¼Œä¸æ˜¯å¯¹å‘å¸ƒå’Œæ¥æ”¶çš„LSAè¿›è¡Œè¿‡æ»¤ã€‚filter-policy importå‘½ä»¤å¯¹æ¥æ”¶çš„è·¯ç”±è®¾ç½®è¿‡æ»¤ç­–ç•¥ï¼Œåªæœ‰é€šè¿‡è¿‡æ»¤ç­–ç•¥çš„è·¯ç”±æ‰è¢«æ·»åŠ åˆ°è·¯ç”±è¡¨ä¸­ï¼Œæ²¡æœ‰é€šè¿‡è¿‡æ»¤ç­–ç•¥çš„è·¯ç”±ä¸ä¼šè¢«æ·»åŠ è¿›è·¯ç”±è¡¨ï¼Œä½†ä¸å½±å“å¯¹å¤–å‘å¸ƒå‡ºå»ã€‚ï¼ˆåªå½±å“æœ¬åœ°å…¨å±€è·¯ç”±è¡¨ï¼‰ filter-policy exportå‘½ä»¤ç”¨æ¥å¯¹å¼•å…¥çš„è·¯ç”±åœ¨å‘å¸ƒæ—¶è¿›è¡Œè¿‡æ»¤ï¼Œåªå°†æ»¡è¶³æ¡ä»¶çš„å¤–éƒ¨è·¯ç”±è½¬æ¢ä¸ºType5 LSAï¼ˆAS-external-LSAï¼‰å¹¶å‘å¸ƒå‡ºå»ã€‚è¿™æ ·å¯ä»¥åœ¨å¼•å…¥å¤–éƒ¨è·¯ç”±æ—¶è¿›è¡Œç‰¹å®šçš„è¿‡æ»¤ï¼Œé˜²æ­¢å½¢æˆè·¯ç”±ç¯è·¯ã€‚ OSPFé€šè¿‡å‘½ä»¤import-routeå¼•å…¥å¤–éƒ¨è·¯ç”±åï¼Œä¸ºäº†é¿å…è·¯ç”±ç¯è·¯çš„äº§ç”Ÿï¼Œé€šè¿‡filter-policy exportå‘½ä»¤å¯¹å¼•å…¥çš„è·¯ç”±åœ¨å‘å¸ƒæ—¶è¿›è¡Œè¿‡æ»¤ï¼Œåªå°†æ»¡è¶³æ¡ä»¶çš„å¤–éƒ¨è·¯ç”±è½¬æ¢ä¸ºType5 LSAï¼ˆAS-external-LSAï¼‰å¹¶å‘å¸ƒå‡ºå»ã€‚ï¼ˆå½±å“åè¾¹çš„è·¯ç”±å™¨çš„ospfè·¯ç”±è¡¨å’Œå…¨å±€è·¯ç”±è¡¨ï¼‰ importç¤ºä¾‹ï¼š ï¼ˆ1ï¼‰é€šè¿‡filter-policyå¯¹OSPFæ¥æ”¶çš„è·¯ç”±è¿‡æ»¤ï¼ˆåŒºåŸŸå†…ï¼‰ç¤ºä¾‹ ä¸‰å°äº¤æ¢æœºåŒå±äºOSPF Area 0åŒºåŸŸï¼ŒSwitchAå‘å¸ƒæµ‹è¯•ç½‘æ®µ10.1.1.0&#x2F;24ï¼Œè¦æ±‚åœ¨SwitchBä¸Šéƒ¨ç½²filter-policy importï¼Œä½¿å¾—SwitchBçš„è·¯ç”±è¡¨ä¸­ä¸å…è®¸å‡ºç°10.1.1.0&#x2F;24è¿™æ¡è·¯ç”±ã€‚ é…ç½®æ–¹æ³• åœ¨SwitchBä¸Šå®šä¹‰ä¸€ä¸ªåœ°å€å‰ç¼€åˆ—è¡¨ï¼Œâ€œæŠ“å–â€ç¬¦åˆæ¡ä»¶çš„è·¯ç”±ã€‚ 12[SwitchB] ip ip-prefix huawei index 10 deny 10.1.1.0 24 //æ‹’ç»è¿™æ¡[SwitchB] ip ip-prefix huawei index 20 permit 0.0.0.0 0 less-equal 32 //å…è®¸æ‰€æœ‰ åœ¨SwitchBçš„OSPFè§†å›¾ä¸­ï¼Œéƒ¨ç½²filter-policy importã€‚ 12[SwitchB] ospf[SwitchB-ospf-1] filter-policy ip-prefix huawei import ç»“æœéªŒè¯ åšå®Œä¸Šè¿°é…ç½®ä»¥åï¼ŒæŸ¥çœ‹SwitchBå’ŒSwitchCçš„è·¯ç”±è¡¨å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031[SwitchB] display ip routing-tableRoute Flags: R - relay, D - download to fib-----------------------------------------------------------------------------Routing Tables: Public Destinations : 6 Routes : 6 Destination/Mask Proto Pre Cost Flags NextHop Interface 127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0 127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0 192.168.12.0/24 Direct 0 0 D 192.168.12.2 Vlanif12 192.168.12.2/32 Direct 0 0 D 127.0.0.1 Vlanif12 192.168.23.0/24 Direct 0 0 D 192.168.23.1 Vlanif23 192.168.23.1/32 Direct 0 0 D 127.0.0.1 Vlanif23ï¼ˆBçš„ipè·¯ç”±è¡¨ä¸­è¢«è¿‡æ»¤ï¼Œä½†ospfè·¯ç”±è¡¨åœ¨ä»ç„¶å­˜åœ¨ï¼‰[SwitchC] display ip routing-tableRoute Flags: R - relay, D - download to fib------------------------------------------------------------------------------Routing Tables: Public Destinations : 6 Routes : 6 Destination/Mask Proto Pre Cost Flags NextHop Interface 10.1.1.0/24 OSPF 10 3 D 192.168.23.1 Vlanif23 127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0 127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0 192.168.12.0/24 OSPF 10 2 D 192.168.23.1 Vlanif23 192.168.23.0/24 Direct 0 0 D 192.168.23.2 Vlanif23 192.168.23.2/32 Direct 0 0 D 127.0.0.1 Vlanif23 é€šè¿‡SwitchBå’ŒSwitchCçš„è·¯ç”±è¡¨å¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶åœ¨SwitchBä¸Š10.1.1.0&#x2F;24è¿™æ¡è·¯ç”±å·²ç»è¢«è¿‡æ»¤æ‰ï¼Œä½†æ˜¯LSAä¿¡æ¯ä¼šç»§ç»­ä¼ é€’ç»™SwitchCï¼Œæ‰€ä»¥SwitchCçš„è·¯ç”±è¡¨ä¸­ç»§ç»­å­˜åœ¨10.1.1.0&#x2F;24è¿™æ¡è·¯ç”±ã€‚è¿™æ ·çš„ç»“æœä¹ŸéªŒè¯äº†ä¸€å¼€å§‹åœ¨æ³¨æ„äº‹é¡¹ä¸­ç»™å‡ºçš„ç»“è®ºï¼šåœ¨é“¾è·¯çŠ¶æ€è·¯ç”±åè®®ä¸­ï¼Œfilter-policyåªèƒ½è¿‡æ»¤è·¯ç”±ä¿¡æ¯ï¼Œä¸èƒ½è¿‡æ»¤LSAä¿¡æ¯ã€‚ åŒæ—¶SwitchBå’ŒSwitchCçš„LSDBä¸­ä»ç„¶å­˜åœ¨æè¿°10.1.1.0&#x2F;24è¿™æ¡è·¯ç”±çš„LSAä¿¡æ¯ï¼Œæ­¤å¤„å¯ä»¥é€šè¿‡æŸ¥çœ‹SwitchBå’ŒSwitchCçš„LSAä¿¡æ¯è¿›è¡ŒéªŒè¯ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950[SwitchB] display ospf lsdb router OSPF Process 1 with Router ID 10.10.10.2 Area: 0.0.0.0 Link State Database â€¦â€¦â€¦ Type : Router Ls id : 10.10.10.1 Adv rtr : 10.10.10.1 Ls age : 139 Len : 48 Options : E seq# : 80000005 chksum : 0x41c4 Link count: 2 * Link ID: 10.1.1.0 Data : 255.255.255.0 Link Type: StubNet Metric : 1 Priority : Low * Link ID: 192.168.12.2 Data : 192.168.12.1 Link Type: TransNet Metric : 1[SwitchC] display ospf lsdb router OSPF Process 1 with Router ID 10.10.10.3 Area: 0.0.0.0 Link State Database â€¦â€¦â€¦â€¦ Type : Router Ls id : 10.10.10.1 Adv rtr : 10.10.10.1 Ls age : 81 Len : 48 Options : E seq# : 80000005 chksum : 0x41c4 Link count: 2 * Link ID: 10.1.1.0 Data : 255.255.255.0 Link Type: StubNet Metric : 1 Priority : Low * Link ID: 192.168.12.2 Data : 192.168.12.1 Link Type: TransNet Metric : 1 å¯ä»¥çœ‹åˆ°SwitchBå’ŒSwitchCçš„LSDBä¸­ä»ç„¶å­˜åœ¨æè¿°10.1.1.0&#x2F;24è¿™æ¡è·¯ç”±çš„LSAä¿¡æ¯ã€‚ ï¼ˆ2ï¼‰é€šè¿‡filter-policyå¯¹OSPFæ¥æ”¶çš„è·¯ç”±è¿‡æ»¤ï¼ˆåŒºåŸŸé—´ï¼‰ ç›¸å¯¹äºä¸Šä¸€ä¸ªåœºæ™¯ï¼Œè¿™ä¸ªåœºæ™¯çš„åŒºåˆ«ä¹‹å¤„æ˜¯åˆ’åˆ†äº†ä¸¤ä¸ªä¸åŒçš„åŒºåŸŸï¼ŒSwitchBå’ŒSwitchCä¹‹é—´ä¼ é€’çš„æ˜¯Type3 LSAï¼Œè¿™ä¸ªType3 LSAæ˜¯SwitchBä¸Šæ ¹æ®åŒºåŸŸé—´è·¯ç”±ç”Ÿæˆçš„ã€‚é…ç½®æ–¹æ³•è·Ÿä¸Šä¸€ä¸ªåœºæ™¯ä¸€æ ·ï¼Œæ­¤å¤„ä¸å†èµ˜è¿°ã€‚ åœ¨éƒ¨ç½²è·¯ç”±è¿‡æ»¤ç­–ç•¥ä¹‹å‰ï¼ŒSwitchBå’ŒSwitchCçš„è·¯ç”±è¡¨ä¸­éƒ½æœ‰10.1.1.0&#x2F;24è¿™æ¡è·¯ç”±ã€‚ åœ¨SwitchBä¸Šéƒ¨ç½²filter-policy importä»¥åï¼ŒæŸ¥çœ‹SwitchBå’ŒSwitchCçš„è·¯ç”±è¡¨ï¼Œç»“æœå¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829[SwitchB] display ip routing-tableRoute Flags: R - relay, D - download to fib-----------------------------------------------------------------------------Routing Tables: Public Destinations : 6 Routes : 6 Destination/Mask Proto Pre Cost Flags NextHop Interface 127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0 127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0 192.168.12.0/24 Direct 0 0 D 192.168.12.2 Vlanif12 192.168.12.2/32 Direct 0 0 D 127.0.0.1 Vlanif12 192.168.23.0/24 Direct 0 0 D 192.168.23.1 Vlanif23 192.168.23.1/32 Direct 0 0 D 127.0.0.1 Vlanif23[SwitchC] display ip routing-tableRoute Flags: R - relay, D - download to fib------------------------------------------------------------------------------Routing Tables: Public Destinations : 5 Routes : 5 Destination/Mask Proto Pre Cost Flags NextHop Interface 127.0.0.0/8 Direct 0 0 D 127.0.0.1 InLoopBack0 127.0.0.1/32 Direct 0 0 D 127.0.0.1 InLoopBack0 192.168.12.0/24 OSPF 10 2 D 192.168.23.1 Vlanif23 192.168.23.0/24 Direct 0 0 D 192.168.23.2 Vlanif23 192.168.23.2/32 Direct 0 0 D 127.0.0.1 Vlanif23 ç”±äºç°åœ¨åˆ’åˆ†ä¸åŒçš„åŒºåŸŸï¼ŒSwitchCä¸Šçš„10.1.1.0&#x2F;24è¿™æ¡è·¯ç”±æ˜¯ç”±SwitchBæ ¹æ®è‡ªèº«å­¦ä¹ çš„è·¯ç”±äº§ç”Ÿçš„Type3-LSAæè¿°çš„ï¼Œè€ŒSwitchBä¸Šçš„è¿™æ¡è·¯ç”±è¢«è¿‡æ»¤æ‰äº†ï¼Œå› æ­¤ä¸èƒ½å¤Ÿå†äº§ç”Ÿæè¿°åŒºåŸŸé—´è·¯ç”±çš„è¿™ä¸ªType3-LSAï¼Œå› æ­¤SwitchCä¸Šä¸ä¼šå†å­¦ä¹ åˆ°10.1.1.0&#x2F;24è¿™æ¡è·¯ç”±ã€‚ exportç¤ºä¾‹ï¼š åœ¨R1ä¸Šåˆ›å»ºå››ä¸ªç¯å›å£ï¼ŒIPåœ°å€åˆ†åˆ«ä¸º192.168.1.0&#x2F;24ï¼Œ192.168.2.0&#x2F;24ã€192.168.3.0&#x2F;24ã€192.168.4.0&#x2F;24ï¼Œå¹¶ä¸”å…¨éƒ¨å®£å‘Šè¿›OSPFã€‚ å¼•å…¥ç›´è¿ï¼Œä½†æ˜¯è¦ä¿è¯R2å’ŒR3ä¸Šåªèƒ½æ”¶åˆ°192.168.1.0è¿™æ¡è·¯ç”± é€šè¿‡Filter-policyè®©R2å’ŒR3åªèƒ½æ”¶åˆ°192.168.1.0è¿™æ¡è·¯ç”± [R1]ip ip-prefix ly permit 192.168.1.0 24 [R1]ospf [R1-ospf-1]filter-policy ip-prefix ly export ã€æŠ€æœ¯è¦ç‚¹ã€‘ OSPFé€šè¿‡å‘½ä»¤import-routeå¼•å…¥å¤–éƒ¨è·¯ç”±åï¼Œä¸ºäº†é¿å…è·¯ç”±ç¯è·¯çš„äº§ç”Ÿï¼Œé€šè¿‡filter-policy exportå‘½ä»¤å¯¹å¼•å…¥çš„è·¯ç”±åœ¨å‘å¸ƒæ—¶è¿›è¡Œè¿‡æ»¤ï¼Œåªå°†æ»¡è¶³æ¡ä»¶çš„å¤–éƒ¨è·¯ç”±è½¬æ¢ä¸ºType5 LSAï¼ˆAS-external-LSAï¼‰å¹¶å‘å¸ƒå‡ºå»ã€‚ å½“ç½‘ç»œä¸­åŒæ—¶éƒ¨ç½²äº†IS-ISå’Œå…¶ä»–è·¯ç”±åè®®æ—¶ï¼Œå¦‚æœå·²ç»åœ¨è¾¹ç•Œè®¾å¤‡ä¸Šå¼•å…¥å…¶ä»–è·¯ç”±åè®®çš„è·¯ç”±ï¼Œç¼ºçœæƒ…å†µä¸‹ï¼Œè¯¥è®¾å¤‡å°†æŠŠå¼•å…¥çš„å…¨éƒ¨å¤–éƒ¨è·¯ç”±å‘å¸ƒç»™IS-ISé‚»å±…ã€‚å¦‚æœåªå¸Œæœ›å°†å¼•å…¥çš„éƒ¨åˆ†å¤–éƒ¨è·¯ç”±å‘å¸ƒç»™é‚»å±…ï¼Œå¯ä»¥ä½¿ç”¨****filter-policy export****å‘½ä»¤å®ç°ã€‚ Route-PolicyRoute-Policyæ˜¯ä¸€ä¸ªç­–ç•¥å·¥å…·ï¼Œç”¨äºè¿‡æ»¤è·¯ç”±ä¿¡æ¯ï¼Œä»¥åŠä¸ºè¿‡æ»¤åçš„è·¯ç”±ä¿¡æ¯è®¾ç½®è·¯ç”±å±æ€§ã€‚ ä¸€ä¸ªRoute-Policyç”±ä¸€ä¸ªæˆ–å¤šä¸ªèŠ‚ç‚¹ï¼ˆNodeï¼‰æ„æˆï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥æ˜¯ä¸€ç³»åˆ—æ¡ä»¶è¯­å¥ï¼ˆåŒ¹é…æ¡ä»¶ï¼‰ä»¥åŠæ‰§è¡Œè¯­å¥ï¼ˆæ‰§è¡ŒåŠ¨ä½œï¼‰çš„é›†åˆï¼Œè¿™äº›é›†åˆæŒ‰ç…§ç¼–å·ä»å°åˆ°å¤§çš„é¡ºåºæ’åˆ—ã€‚ ç¤ºä¾‹ï¼š åŒç‚¹åŒå‘è·¯ç”±é‡å‘å¸ƒ è§£å†³æ¬¡ä¼˜è·¯å¾„ï¼š ç¯è·¯é—®é¢˜ï¼š è§£å†³ç¯è·¯ï¼š ç­–ç•¥è·¯ç”±è‹¥è®¾å¤‡éƒ¨ç½²äº†PBRï¼Œåˆ™è¢«åŒ¹é…çš„æŠ¥æ–‡ä¼˜å…ˆæ ¹æ®PBRçš„ç­–ç•¥è¿›è¡Œè½¬å‘ï¼Œå³PBRç­–ç•¥çš„ä¼˜å…ˆçº§é«˜äºä¼ ç»Ÿè·¯ç”±è¡¨ã€‚ ç­–ç•¥è·¯ç”±PBRï¼ˆPolicy-Based Routingï¼‰æ˜¯ä¸€ç§ä¾æ®ç”¨æˆ·åˆ¶å®šçš„ç­–ç•¥è¿›è¡Œè·¯ç”±é€‰æ‹©çš„æœºåˆ¶ï¼Œåˆ†ä¸ºæœ¬åœ°ç­–ç•¥è·¯ç”±ã€æ¥å£ç­–ç•¥è·¯ç”±å’Œæ™ºèƒ½ç­–ç•¥è·¯ç”±SPRï¼ˆSmart Policy Routingï¼‰ã€‚ ç­–ç•¥è·¯ç”±ä¸è·¯ç”±ç­–ç•¥ï¼ˆRouting Policyï¼‰å­˜åœ¨ä»¥ä¸‹ä¸åŒï¼š ç­–ç•¥è·¯ç”±çš„æ“ä½œå¯¹è±¡æ˜¯æ•°æ®åŒ…ï¼Œåœ¨è·¯ç”±è¡¨å·²ç»äº§ç”Ÿçš„æƒ…å†µä¸‹ï¼Œä¸æŒ‰ç…§è·¯ç”±è¡¨è¿›è¡Œè½¬å‘ï¼Œè€Œæ˜¯æ ¹æ®éœ€è¦ï¼Œä¾ç…§æŸç§ç­–ç•¥æ”¹å˜æ•°æ®åŒ…è½¬å‘è·¯å¾„ã€‚ è·¯ç”±ç­–ç•¥çš„æ“ä½œå¯¹è±¡æ˜¯è·¯ç”±ä¿¡æ¯ã€‚è·¯ç”±ç­–ç•¥ä¸»è¦å®ç°äº†è·¯ç”±è¿‡æ»¤å’Œè·¯ç”±å±æ€§è®¾ç½®ç­‰åŠŸèƒ½ï¼Œå®ƒé€šè¿‡æ”¹å˜è·¯ç”±å±æ€§ï¼ˆåŒ…æ‹¬å¯è¾¾æ€§ï¼‰æ¥æ”¹å˜ç½‘ç»œæµé‡æ‰€ç»è¿‡çš„è·¯å¾„ã€‚ è¯­æ³•ï¼š MQCMQCï¼ˆModular QoS Command-Line Interfaceï¼Œæ¨¡å—åŒ–QoSå‘½ä»¤è¡Œï¼‰æ˜¯æŒ‡é€šè¿‡å°†å…·æœ‰æŸç±»å…±åŒç‰¹å¾çš„æ•°æ®æµåˆ’åˆ†ä¸ºä¸€ç±»ï¼Œå¹¶ä¸ºåŒä¸€ç±»æ•°æ®æµæä¾›ç›¸åŒçš„æœåŠ¡ï¼Œä¹Ÿå¯ä»¥å¯¹ä¸åŒç±»çš„æ•°æ®æµæä¾›ä¸åŒçš„æœåŠ¡ã€‚ MQCåŒ…å«ä¸‰ä¸ªè¦ç´ ï¼šæµåˆ†ç±»ï¼ˆtraffic classifierï¼‰ã€æµè¡Œä¸ºï¼ˆtraffic behaviorï¼‰å’Œæµç­–ç•¥ï¼ˆtraffic policyï¼‰ã€‚MQCçš„æµè¡Œä¸ºæ”¯æŒé‡å®šå‘æŠ¥æ–‡ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨MQCå®ç°IPå•æ’­ç­–ç•¥è·¯ç”±ã€‚ æµåˆ†ç±»æµåˆ†ç±»ç”¨æ¥å®šä¹‰ä¸€ç»„æµé‡åŒ¹é…è§„åˆ™ï¼Œä»¥å¯¹æŠ¥æ–‡è¿›è¡Œåˆ†ç±»ã€‚æµåˆ†ç±»è§„åˆ™: æµåˆ†ç±»ä¸­å„è§„åˆ™ä¹‹é—´çš„å…³ç³»åˆ†ä¸ºï¼šandæˆ–orï¼Œç¼ºçœæƒ…å†µä¸‹çš„å…³ç³»ä¸ºorã€‚ andï¼šå½“æµåˆ†ç±»ä¸­åŒ…å«ACLè§„åˆ™æ—¶ï¼ŒæŠ¥æ–‡å¿…é¡»åŒ¹é…å…¶ä¸­ä¸€æ¡ACLè§„åˆ™ä»¥åŠæ‰€æœ‰éACLè§„åˆ™æ‰å±äºè¯¥ç±»ï¼›å½“æµåˆ†ç±»ä¸­æ²¡æœ‰ACLè§„åˆ™æ—¶ï¼ŒæŠ¥æ–‡å¿…é¡»åŒ¹é…æ‰€æœ‰éACLè§„åˆ™æ‰å±äºè¯¥ç±»ã€‚ orï¼šæŠ¥æ–‡åªè¦åŒ¹é…äº†æµåˆ†ç±»ä¸­çš„ä¸€ä¸ªè§„åˆ™ï¼Œè®¾å¤‡å°±è®¤ä¸ºæŠ¥æ–‡å±äºæ­¤ç±»ã€‚ æµè¡Œä¸º æµç­–ç•¥ç»‘å®šæµåˆ†ç±»ä¸æµè¡Œä¸º æ¡ˆä¾‹ Traffic-Filterä½¿ç”¨Traffic-Filterè¿‡æ»¤æµé‡å¯ä»¥çµæ´»åœ°é€‰æ‹©éƒ¨ç½²ä½ç½®ï¼Œåœ¨æµé‡è¿›å…¥è®¾å¤‡æˆ–è€…ç¦»å¼€è®¾å¤‡çš„æ¥å£ä¸Šæ‰§è¡Œè¿‡æ»¤åŠ¨ä½œï¼ŒåŒå‘è®¿é—®çš„ä¸šåŠ¡ç¦æ­¢å…¶ä¸­ä¸€ä¸ªæ–¹å‘å³å¯å®ç°é˜»æ–­ä¸šåŠ¡çš„éœ€æ±‚ã€‚ å®éªŒæ‰‹å†Œå®éªŒ è®¾å¤‡äº’è”æ–¹å¼ã€äº’è”åœ°å€å¦‚å›¾æ‰€ç¤ºï¼Œæ‰€æœ‰è®¾å¤‡å‡åˆ›å»ºLoopback0ï¼Œå…¶IPåœ°å€ä¸º10.0.x.x&#x2F;32ï¼Œå…¶ä¸­xä¸ºè®¾å¤‡ç¼–å·ï¼ŒR1ã€R2ã€R3åœ¨äº’è”æ¥å£ã€Loopback0æ¥å£ä¸Šæ¿€æ´»OSPFã€‚ R3ã€R4å±äºIS-IS Area 49.0001ï¼Œä¸¤è€…éƒ½æ˜¯Level-1è·¯ç”±å™¨ï¼ŒR3ã€R4çš„ç³»ç»ŸIDé‡‡ç”¨0000.0000.000xæ ¼å¼ï¼Œå…¶ä¸­xä¸ºè®¾å¤‡ç¼–å·ã€‚ R1ä¸Šå­˜åœ¨ä¸‰ä¸ªä¸šåŠ¡ç½‘æ®µAã€Bã€Cï¼ˆä½¿ç”¨Loopback1ã€2ã€3æ¥å£è·¯ç”±æ¨¡æ‹Ÿï¼‰ï¼Œåœ¨R1ä¸Šå°†ç›´è¿è·¯ç”±å¼•å…¥åˆ°OSPFï¼Œä½†æ˜¯OSPFåŸŸå†…çš„è·¯ç”±å™¨ä¸Šä¸éœ€è¦Cä¸šåŠ¡çš„è·¯ç”±ï¼Œä¸ºæ­¤åœ¨R1ä¸Šå¼•å…¥ç›´è¿è·¯ç”±æ—¶é€šè¿‡Route-Policyè¿‡æ»¤å¼•å…¥çš„è·¯ç”±ã€‚ R2ä¸Šä¸éœ€è¦Aä¸šåŠ¡ç½‘æ®µçš„è·¯ç”±ï¼Œä½†æ˜¯R3ä¸Šéœ€è¦Aã€Bä¸šåŠ¡ç½‘æ®µçš„è·¯ç”±ï¼Œä¸ºæ­¤åœ¨R2ä¸Šé…ç½®Filter-Policyå¯¹OSPFæ¥æ”¶çš„è·¯ç”±è¿›è¡Œè¿‡æ»¤ã€‚ IS-ISåŸŸå†…çš„è·¯ç”±å™¨éœ€è¦è®¿é—®Aä¸šåŠ¡ï¼Œå› æ­¤éœ€è¦åœ¨R3ä¸Šæ‰§è¡Œè·¯ç”±é‡åˆ†å‘ï¼Œå°†OSPFè·¯ç”±å¼•å…¥åˆ°IS-ISï¼Œä½†æ˜¯IS-ISåŸŸå†…çš„è·¯ç”±å™¨ä¸éœ€è¦è®¿é—®Bä¸šåŠ¡ï¼Œä¸ºæ­¤åœ¨R1ä¸Šå¼•å…¥ç›´è¿è·¯ç”±æ—¶ä¸ºAã€Bä¸šåŠ¡ç½‘æ®µè·¯ç”±æ‰“ä¸Šä¸åŒçš„è·¯ç”±æ ‡è®°ï¼ŒR3ä¸Šæ‰§è¡Œé‡åˆ†å‘æ—¶æ ¹æ®è·¯ç”±æ ‡è®°è¿‡æ»¤Bä¸šåŠ¡ç½‘æ®µè·¯ç”±ã€‚ ä»»åŠ¡æ€è·¯ è®¾å¤‡åŸºç¡€IPåœ°å€é…ç½®ã€‚ é…ç½®R1ã€R2ã€R3ä¹‹é—´çš„OSPFï¼Œåœ¨äº’è”æ¥å£ã€Loopback0æ¥å£ä¸Šæ¿€æ´»OSPFã€‚åœ¨R3ã€R4ä¹‹é—´é…ç½®IS-ISã€‚ åœ¨R1ä¸Šå°†ç›´è¿è·¯ç”±å¼•å…¥åˆ°OSPFä¸­ï¼ŒåŒæ—¶é…ç½®è·¯ç”±ç­–ç•¥ä¸å¼•å…¥Cä¸šåŠ¡ç½‘æ®µçš„è·¯ç”±ï¼Œå°†Aã€Bä¸šåŠ¡ç½‘æ®µè·¯ç”±åˆ†åˆ«æ‰“ä¸Šè·¯ç”±æ ‡è®°10ã€20ã€‚ åœ¨R2ä¸Šé…ç½®Filter-Policyå¯¹æ¥æ”¶çš„OSPFè·¯ç”±è¿›è¡Œè¿‡æ»¤ï¼Œåªæ¥æ”¶Bä¸šåŠ¡ç½‘æ®µçš„è·¯ç”±ã€‚ åœ¨R3ä¸Šå°†OSPFè·¯ç”±å¼•å…¥åˆ°IS-ISä¸­ï¼Œé€šè¿‡Route-PolicyåŒ¹é…è·¯ç”±æ ‡è®°ï¼Œåªå¼•å…¥Aä¸šåŠ¡ç½‘æ®µçš„OSPFå¤–éƒ¨è·¯ç”±ã€‚ 1.é…ç½®ip#é…ç½®R1çš„GE0&#x2F;0&#x2F;2ã€Loopback0æ¥å£IPåœ°å€ [R1]interface GigabitEthernet0&#x2F;0&#x2F;2 [R1-GigabitEthernet0&#x2F;0&#x2F;2] ip address 10.0.12.1 255.255.255.0 [R1-GigabitEthernet0&#x2F;0&#x2F;2] quit [R1]interface LoopBack0 [R1-LoopBack0] ip address 10.0.1.1 255.255.255.255 [R1-LoopBack0] quit #åœ¨R1ä¸Šåˆ›å»ºå¤šä¸ªç¯å›å£ï¼Œç”¨äºæ¨¡æ‹Ÿä¸šåŠ¡ç½‘æ®µAã€Bã€C [R1]interface LoopBack1 [R1-LoopBack1] ip address 172.16.1.1 255.255.255.0 [R1-LoopBack1] quit [R1]interface LoopBack2 [R1-LoopBack2] ip address 172.16.2.1 255.255.255.0 [R1-LoopBack2] quit [R1]interface LoopBack3 [R1-LoopBack3] ip address 172.16.3.1 255.255.255.0 [R1-LoopBack3] quit #é…ç½®R2çš„GE0&#x2F;0&#x2F;2ã€GE0&#x2F;0&#x2F;3ã€Loopback0æ¥å£IPåœ°å€ [R2]interface LoopBack0 [R2-LoopBack0] ip address 10.0.2.2 255.255.255.255 [R2-LoopBack0] quit [R2]interface GigabitEthernet0&#x2F;0&#x2F;2 [R2-GigabitEthernet0&#x2F;0&#x2F;2] ip address 10.0.23.2 255.255.255.0 [R2-GigabitEthernet0&#x2F;0&#x2F;2] quit [R2]interface GigabitEthernet0&#x2F;0&#x2F;3 [R2-GigabitEthernet0&#x2F;0&#x2F;3] ip address 10.0.12.2 255.255.255.0 [R2-GigabitEthernet0&#x2F;0&#x2F;3] quit #é…ç½®R3çš„GE0&#x2F;0&#x2F;2ã€GE0&#x2F;0&#x2F;3ã€Loopback0æ¥å£IPåœ°å€ [R3]interface LoopBack0 [R3-LoopBack0] ip address 10.0.3.3 255.255.255.255 [R3-LoopBack0] quit [R3]interface GigabitEthernet0&#x2F;0&#x2F;2 [R3-GigabitEthernet0&#x2F;0&#x2F;2] ip address 10.0.34.3 255.255.255.0 [R3-GigabitEthernet0&#x2F;0&#x2F;2] quit [R3]interface GigabitEthernet0&#x2F;0&#x2F;3 [R3-GigabitEthernet0&#x2F;0&#x2F;3] ip address 10.0.23.3 255.255.255.0 [R3-GigabitEthernet0&#x2F;0&#x2F;3] quit #é…ç½®R4çš„GE0&#x2F;0&#x2F;3ã€Loopback0æ¥å£IPåœ°å€ [R4]interface GigabitEthernet0&#x2F;0&#x2F;3 [R4-GigabitEthernet0&#x2F;0&#x2F;3] ip address 10.0.34.4 255.255.255.0 [R4-GigabitEthernet0&#x2F;0&#x2F;3] quit [R4]interface LoopBack0 [R4-LoopBack0] ip address 10.0.4.4 255.255.255.255 [R4-LoopBack0] quit #åœ¨R2ã€R4ä¸Šæ£€æŸ¥IPåœ°å€è¿é€šæ€§ é…ç½®ospfå’Œisis#é…ç½®R1 [R1]ospf 1 router-id 10.0.1.1 [R1-ospf-1] area 0 [R1-ospf-1-area-0.0.0.0] network 10.0.1.1 0.0.0.0 [R1-ospf-1-area-0.0.0.0] network 10.0.12.1 0.0.0.0 [R1-ospf-1-area-0.0.0.0] quit [R1-ospf-1] quit #é…ç½®R2 [R2]ospf 1 router-id 10.0.2.2 [R2-ospf-1] area 0.0.0.0 [R2-ospf-1-area-0.0.0.0] network 10.0.2.2 0.0.0.0 [R2-ospf-1-area-0.0.0.0] network 10.0.12.2 0.0.0.0 [R2-ospf-1-area-0.0.0.0] network 10.0.23.2 0.0.0.0 [R2-ospf-1-area-0.0.0.0] quit [R2-ospf-1] quit #é…ç½®R3 [R3]ospf 1 router-id 10.0.3.3 [R3-ospf-1] area 0.0.0.0 [R3-ospf-1-area-0.0.0.0] network 10.0.3.3 0.0.0.0 [R3-ospf-1-area-0.0.0.0] network 10.0.23.3 0.0.0.0 [R3-ospf-1-area-0.0.0.0] quit [R3-ospf-1] quit #åœ¨R2ä¸Šæ£€æŸ¥OSPFé‚»å±…çš„æ¦‚è¦ä¿¡æ¯ R3ã€R4ä¸Šé…ç½®IS-ISï¼ŒåŒºåŸŸä¸º49.0001ï¼Œç³»ç»ŸIDé‡‡ç”¨0000.0000.000xæ ¼å¼ï¼ˆxä¸ºè®¾å¤‡ç¼–å·ï¼‰ï¼Œä¸¤å°è®¾å¤‡éƒ½ä¸ºLevel-1è·¯ç”±å™¨ï¼Œåœ¨äº’è”æ¥å£ã€R4çš„Loopback0æ¥å£ä¸Šæ¿€æ´»IS-ISã€‚ #é…ç½®R3 [R3]isis 1 [R3-isis-1] is-level level-1 [R3-isis-1] network-entity 49.0001.0000.0000.0003.00 [R3-isis-1] quit [R3]interface GigabitEthernet0&#x2F;0&#x2F;2 [R3-GigabitEthernet0&#x2F;0&#x2F;2] isis enable 1 [R3-GigabitEthernet0&#x2F;0&#x2F;2] quit #é…ç½®R4 [R4]isis 1 [R4-isis-1] is-level level-1 [R4-isis-1] network-entity 49.0001.0000.0000.0004.00 [R4-isis-1] quit [R4]interface GigabitEthernet0&#x2F;0&#x2F;3 [R4-GigabitEthernet0&#x2F;0&#x2F;3] isis enable 1 [R4-GigabitEthernet0&#x2F;0&#x2F;3] quit [R4]interface LoopBack 0 [R4-LoopBack0] isis enable 1 [R4-LoopBack0] quit #åœ¨R3ä¸Šæ£€æŸ¥IS-ISé‚»å±…çŠ¶æ€ åœ¨R1ä¸Šå¼•å…¥ç›´è¿è·¯ç”±åœ¨R1ä¸Šå°†ç›´è¿è·¯ç”±å¼•å…¥åˆ°OSPFä¸­ï¼ŒåŒæ—¶é…ç½®è·¯ç”±ç­–ç•¥è¿‡æ»¤Cä¸šåŠ¡ç½‘æ®µï¼Œå°†Aã€Bä¸šåŠ¡ç½‘æ®µè·¯ç”±åˆ†åˆ«æ‰“ä¸Šè·¯ç”±æ ‡è®°10ã€20ã€‚ #åˆ›å»ºIPå‰ç¼€åˆ—è¡¨1ï¼ŒåŒ¹é…Loopback1æ¥å£è·¯ç”±ï¼ˆAä¸šåŠ¡ç½‘æ®µï¼‰ [R1]ip ip-prefix 1 index 10 permit 172.16.1.0 24 greater-equal 24 less-equal 24 #åˆ›å»ºIPå‰ç¼€åˆ—è¡¨2ï¼ŒåŒ¹é…Loopback2æ¥å£è·¯ç”±ï¼ˆBä¸šåŠ¡ç½‘æ®µï¼‰ [R1]ip ip-prefix 2 index 10 permit 172.16.2.0 24 greater-equal 24 less-equal 24 #åˆ›å»ºRoute-Policy hcipï¼Œå¹¶åˆ›å»ºèŠ‚ç‚¹10ã€20ï¼Œåˆ†åˆ«è°ƒç”¨IPå‰ç¼€åˆ—è¡¨1ã€2ï¼Œæ‰“ä¸Šè·¯ç”±æ ‡è®° [R1]route-policy hcip permit node 10 [R1-route-policy] if-match ip-prefix 1 [R1-route-policy] apply tag 10 [R1-route-policy] quit [R1]route-policy hcip permit node 20 [R1-route-policy] if-match ip-prefix 2 [R1-route-policy] apply tag 20 [R1-route-policy] quit #åœ¨R1çš„OSPFä¸­å¼•å…¥ç›´è¿è·¯ç”±ï¼Œè°ƒç”¨Route-Policy hcip [R1]ospf 1 [R1-ospf-1] import-route direct route-policy hcip r1ä¸ŠæŸ¥çœ‹ospf lsdbï¼ŒLoopback1ã€2æ¥å£è·¯ç”±å·²ç»è¢«æˆåŠŸå¼•å…¥OSPFä¸­ã€‚ #åœ¨R1ä¸ŠæŸ¥çœ‹OSPF LSDBä¸­AS-external LSA 172.16.1.0çš„ç›¸å…³ä¿¡æ¯ [R1]display ospf lsdb ase 172.16.1.0 â€‹ OSPF Process 1 with Router ID 10.0.1.1 â€‹ Link State Database Type : External Ls id : 172.16.1.0 Adv rtr : 10.0.1.1 Ls age : 165 Len : 36 Options : E seq# : 80000001 chksum : 0xa954 Net mask : 255.255.255.0 TOS 0 Metric: 1 E type : 2 Forwarding Address : 0.0.0.0 Tag : 10 Priority : Low å¤–éƒ¨è·¯ç”±172.16.1.0&#x2F;24å·²ç»è¢«æ‰“ä¸ŠTag 10ã€‚ #åœ¨R1ä¸ŠæŸ¥çœ‹OSPF LSDBä¸­AS-external LSA 172.16.2.0çš„ç›¸å…³ä¿¡æ¯ [R1]display ospf lsdb ase 172.16.2.0 â€‹ OSPF Process 1 with Router ID 10.0.1.1 â€‹ Link State Database Type : External Ls id : 172.16.2.0 Adv rtr : 10.0.1.1 Ls age : 355 Len : 36 Options : E seq# : 80000001 chksum : 0x539f Net mask : 255.255.255.0 TOS 0 Metric: 1 E type : 2 Forwarding Address : 0.0.0.0 Tag : 20 Priority : Low å¤–éƒ¨è·¯ç”±172.16.2.0&#x2F;24å·²ç»è¢«æ‰“ä¸ŠTag 20ã€‚ åœ¨R2ä¸Šé…ç½®è¿‡æ»¤ç­–ç•¥åœ¨R2ä¸Šé…ç½®Filter-Policyå¯¹æ¥æ”¶çš„OSPFè·¯ç”±è¿›è¡Œè¿‡æ»¤ï¼Œåªæ¥æ”¶Bä¸šåŠ¡ç½‘æ®µçš„è·¯ç”±ã€‚ #æŸ¥çœ‹é…ç½®Filter-Policyå‰çš„OSPFè·¯ç”±è¡¨ display ospf routing #æŸ¥çœ‹é…ç½®Filter-Policyå‰çš„IPè·¯ç”±è¡¨ä¸­çš„OSPFè·¯ç”± display ip routing-table protocol ospf åœ¨OSPFè·¯ç”±è¡¨ä»¥åŠIPè·¯ç”±è¡¨ä¸­éƒ½å¯ä»¥çœ‹åˆ°OSPFå¤–éƒ¨è·¯ç”±172.16.1.0&#x2F;24ã€172.16.2.0&#x2F;24ã€‚ #é…ç½®åŸºç¡€ACL [R2]acl number 2000 [R2-acl-basic-2000] rule 5 deny source 172.16.1.0 0.0.0.255 [R2-acl-basic-2000] rule 10 permit #åœ¨OSPFä¸­éƒ¨ç½²å…¥æ–¹å‘çš„Filter-Policyï¼Œè°ƒç”¨ACL 2000 [R2]ospf 1 [R2-ospf-1] filter-policy 2000 import #æŸ¥çœ‹é…ç½®Filter-Policyåçš„OSPFè·¯ç”±è¡¨ dis ospf routing å‘ç°ä¸¤æ¡å¤–éƒ¨è·¯ç”±éƒ½è¿˜å­˜åœ¨ #æŸ¥çœ‹é…ç½®Filter-Policyåçš„IPè·¯ç”±è¡¨ä¸­çš„OSPFè·¯ç”± display ip routing-table protocol ospf åœ¨IPè·¯ç”±è¡¨ä¸­è·¯ç”±172.16.2.0&#x2F;24å·²ç»ä¸å­˜åœ¨ï¼Œä½†æ˜¯åœ¨OSPFè·¯ç”±è¡¨ä¸­ä¾æ—§å­˜åœ¨ã€‚è¿™éªŒè¯äº†å¯¹äºOSPFï¼ŒFilter-Policyåªæ˜¯é™åˆ¶è·¯ç”±åŠ å…¥IPè·¯ç”±è¡¨ï¼Œä¸å½±å“æœ¬åœ°çš„LSDBä»¥åŠLSAçš„ä¼ é€’ã€‚ #åœ¨R3ä¸ŠæŸ¥çœ‹IPè·¯ç”±è¡¨ä¸­çš„OSPFè·¯ç”± display ip routing-table protocol ospf R3çš„IPè·¯ç”±è¡¨ä¸­OSPFå¤–éƒ¨è·¯ç”±172.16.1.0&#x2F;24ã€172.16.2.0&#x2F;24ä¾æ—§å­˜åœ¨ã€‚ åœ¨R3ä¸Šå°†OSPFè·¯ç”±å¼•å…¥åˆ°IS-ISåœ¨R3ä¸Šå°†OSPFè·¯ç”±å¼•å…¥åˆ°IS-ISä¸­ï¼Œé€šè¿‡Route-PolicyåŒ¹é…è·¯ç”±æ ‡è®°ï¼Œåªå¼•å…¥Aä¸šåŠ¡ç½‘æ®µçš„OSPFå¤–éƒ¨è·¯ç”±ã€‚ #åˆ›å»ºRoute-Policy hcip [R3]route-policy hcip permit node 10 [R3-route-policy] if-match tag 10 [R3-route-policy] quit #åœ¨IS-ISä¸­å¼•å…¥OSPFè·¯ç”±ï¼Œè°ƒç”¨Route-Policy hcipåªå¼•å…¥Aä¸šåŠ¡ç½‘æ®µçš„OSPFå¤–éƒ¨è·¯ç”± [R3]isis 1 [R3-isis-1] import-route ospf 1 level-1 route-policy hcip ï¼ˆæ³¨æ„æŒ‡å®šlevelï¼‰ #æŸ¥çœ‹R3çš„IS-ISè·¯ç”±è¡¨ display isis route Level-1çš„è·¯ç”±é‡åˆ†å‘è¡¨ä¸­åªæœ‰172.16.1.0&#x2F;24ã€‚","categories":[{"name":"ipå®éªŒ","slug":"ipå®éªŒ","permalink":"http://example.com/categories/ip%E5%AE%9E%E9%AA%8C/"}],"tags":[{"name":"è·¯ç”±ç­–ç•¥","slug":"è·¯ç”±ç­–ç•¥","permalink":"http://example.com/tags/%E8%B7%AF%E7%94%B1%E7%AD%96%E7%95%A5/"}]},{"title":"natå®éªŒ","slug":"natå®éªŒ","date":"2023-11-25T12:41:12.000Z","updated":"2023-11-25T13:54:42.229Z","comments":true,"path":"2023/11/25/natå®éªŒ/","permalink":"http://example.com/2023/11/25/nat%E5%AE%9E%E9%AA%8C/","excerpt":"é™æ€naté™æ€NATå®ç°äº†ç§æœ‰åœ°å€å’Œå…¬æœ‰åœ°å€çš„ä¸€å¯¹ä¸€æ˜ å°„ã€‚å¦‚æœå¸Œæœ›ä¸€å°ä¸»æœºä¼˜å…ˆä½¿ç”¨æŸä¸ªå…³è”åœ°å€ï¼Œæˆ–è€…æƒ³è¦å¤–éƒ¨ç½‘ç»œä½¿ç”¨ä¸€ä¸ªæŒ‡å®šçš„å…¬ç½‘åœ°å€è®¿é—®å†…éƒ¨æœåŠ¡å™¨æ—¶ï¼Œå¯ä»¥ä½¿ç”¨é™æ€NATã€‚ä½†æ˜¯åœ¨å¤§å‹ç½‘ç»œä¸­ï¼Œè¿™ç§ä¸€å¯¹ä¸€çš„IPåœ°å€æ˜ å°„æ— æ³•ç¼“è§£å…¬ç”¨åœ°å€çŸ­ç¼ºçš„é—®é¢˜ã€‚","text":"é™æ€naté™æ€NATå®ç°äº†ç§æœ‰åœ°å€å’Œå…¬æœ‰åœ°å€çš„ä¸€å¯¹ä¸€æ˜ å°„ã€‚å¦‚æœå¸Œæœ›ä¸€å°ä¸»æœºä¼˜å…ˆä½¿ç”¨æŸä¸ªå…³è”åœ°å€ï¼Œæˆ–è€…æƒ³è¦å¤–éƒ¨ç½‘ç»œä½¿ç”¨ä¸€ä¸ªæŒ‡å®šçš„å…¬ç½‘åœ°å€è®¿é—®å†…éƒ¨æœåŠ¡å™¨æ—¶ï¼Œå¯ä»¥ä½¿ç”¨é™æ€NATã€‚ä½†æ˜¯åœ¨å¤§å‹ç½‘ç»œä¸­ï¼Œè¿™ç§ä¸€å¯¹ä¸€çš„IPåœ°å€æ˜ å°„æ— æ³•ç¼“è§£å…¬ç”¨åœ°å€çŸ­ç¼ºçš„é—®é¢˜ã€‚ é™æ€NATå®ç°äº†ç§æœ‰åœ°å€å’Œå…±æœ‰åœ°å€ä¸€å¯¹ä¸€çš„æ˜ å°„ï¼ˆä¸€ä¸ªç§æœ‰åœ°å€å¯¹åº”ä¸€ä¸ªå…±æœ‰åœ°å€ï¼‰ï¼Œå¹¶æ²¡æœ‰åšåˆ°ç¼“è§£åœ°å€çŸ­ç¼ºçš„é—®é¢˜ï¼Œåªæ˜¯åšåˆ°äº†åœ°å€è½¬æ¢ã€‚ ä¸€ä¸ªå…¬ç½‘åœ°å€åªä¼šåˆ†é…ç»™å”¯ä¸€ä¸”å›ºå®šçš„å†…ç½‘åœ°å€ å¦‚å›¾é…ç½®ipåœ°å€å’Œç½‘å…³ r1ä¸Šé…ç½®é™æ€natï¼ˆæ³¨æ„æ˜¯åœ¨å…¬ç½‘çš„æ¥å£ä¸Šï¼Œå‡ºæ¥å£ï¼‰ æ³¨æ„é…ç½®ä¸€æ¡é™æ€è·¯ç”±ï¼Œä¸ç„¶æ²¡æœ‰è·¯ç”±çš„ä¸‹ä¸€è·³ä¼šè¢«ä¸¢å¼ƒ åœ¨r1ä¸ŠæŸ¥çœ‹natæ˜ å°„å…³ç³»ï¼šdis nat static éªŒè¯ä¸€ä¸‹ï¼š å‘ç°å»å¾€2.2.2.2çš„æºåœ°å€å˜ä¸º2.2.2.3ï¼Œè¯´æ˜natå®Œæˆè½¬æ¢ã€‚ é™æ€natä¸¤ç§é…ç½®æ–¹å¼ï¼š 1.æ¥å£ä¸‹ï¼ˆä¸Šè¿°å®éªŒé‡‡ç”¨è¿™ç§æ–¹å¼ï¼‰ï¼šè¿›å…¥åˆ°è¿æ¥å¤–ç½‘è·¯ç”±å™¨çš„å‡ºæ¥å£ä¸‹ï¼Œç„¶ååœ¨æ¥å£è§†å›¾ä¸‹é…ç½®natæ˜ å°„å…³ç³» 2.å…¨å±€ï¼šåœ¨å…¨å±€è§†å›¾ä¸‹ï¼Œé…ç½®å¥½natæ˜ å°„å…³ç³»ï¼Œå†è¿›å…¥åˆ°å‡ºæ¥å£ï¼Œæ‰§è¡Œï¼šnat static enable åŠ¨æ€natåŠ¨æ€NATé€šè¿‡ä½¿ç”¨åœ°å€æ± æ¥å®ç°ã€‚ å¦‚ä¸Šå›¾ï¼Œå½“å†…éƒ¨ä¸»æœºAå’Œä¸»æœºBéœ€è¦ä¸å…¬ç½‘ä¸­çš„ç›®çš„ä¸»æœºé€šä¿¡æ—¶ï¼Œç½‘å…³RTAä¼šä»é…ç½®çš„å…¬ç½‘åœ°å€æ± ä¸­é€‰æ‹©ä¸€ä¸ªæœªä½¿ç”¨çš„å…¬ç½‘åœ°å€ä¸ä¹‹åšæ˜ å°„ã€‚æ¯å°ä¸»æœºéƒ½ä¼šåˆ†é…åˆ°åœ°å€æ± ä¸­çš„ä¸€ä¸ªå”¯ä¸€åœ°å€ã€‚å½“ä¸éœ€è¦æ­¤è¿æ¥æ—¶ï¼Œå¯¹åº”çš„åœ°å€æ˜ å°„å°†ä¼šè¢«åˆ é™¤ï¼Œå…¬ç½‘åœ°å€ä¹Ÿä¼šè¢«æ¢å¤åˆ°åœ°å€æ± ä¸­å¾…ç”¨ã€‚å½“ç½‘å…³æ”¶åˆ°å›å¤æŠ¥æ–‡åï¼Œä¼šæ ¹æ®ä¹‹å‰çš„æ˜ å°„å†æ¬¡è¿›è¡Œè½¬æ¢ä¹‹åè½¬å‘ç»™å¯¹åº”ä¸»æœºã€‚ æ³¨æ„ï¼š åŠ¨æ€NATå®é™…ä¸Šå®ç°çš„è¿˜æ˜¯ç§æœ‰åœ°å€å’Œå…¬æœ‰åœ°å€ä¸€å¯¹ä¸€çš„å…³ç³»ï¼Œä½†æ˜¯å…±æœ‰åœ°å€ä¸å†ç»‘å®šç»™ç‰¹å®šçš„å†…ç½‘åœ°å€ã€‚å®ç°äº†ä¸€å®šç¨‹åº¦çš„ç¼“è§£åœ°å€çŸ­ç¼ºé—®é¢˜ã€‚åŠ¨æ€NATåœ°å€æ± ä¸­çš„åœ°å€ç”¨å°½ä»¥åï¼Œåªèƒ½ç­‰å¾…è¢«å ç”¨çš„å…¬ç”¨IPè¢«é‡Šæ”¾åï¼Œå…¶ä»–ä¸»æœºæ‰èƒ½ä½¿ç”¨å®ƒæ¥è®¿é—®å…¬ç½‘ã€‚ åŠ¨æ€NATè½¬æ¢æµç¨‹ï¼š1ï¼‰è·¯ç”±å™¨ä¸Šé…ç½®ä¸€ä¸ªå†…éƒ¨åœ°å€æ± ï¼ˆå…¬å¸å†…éƒ¨æ‰€æœ‰ä¸»æœºç”¨åˆ°çš„ç§æœ‰IPï¼‰åŠ¨æ€æ˜ å°„ä¸€ä¸ªå¤–éƒ¨åœ°å€æ± ï¼ˆæ‰€è´­ä¹°çš„å…¬æœ‰IPï¼‰ã€‚2ï¼‰å½“æœ‰ä¸€ä¸ªå†…ç½‘ä¸»æœºè®¿é—®å¤–ç½‘æ—¶ï¼Œè·¯ç”±å™¨é¦–å…ˆæŸ¥çœ‹NATåœ°å€è½¬æ¢è¡¨ï¼›3ï¼‰è‹¥æ— ï¼Œåˆ™å†æŸ¥çœ‹æ˜¯å¦é…ç½®äº†åŠ¨æ€NATæ˜ å°„ï¼Œè‹¥é…ç½®ï¼Œåˆ™å°†IPåŒ…å¤´ä¸­çš„æºIPä¸å†…éƒ¨åœ°å€æ± è¿›è¡ŒåŒ¹é…ï¼Œè‹¥æœ‰åŒ¹é…é¡¹ï¼Œåˆ™å°†è¯¥å†…ç½‘IPä»å†…éƒ¨åœ°å€æ± ä¸­å–å‡ºï¼ŒåŒæ—¶å–å‡ºå¤–éƒ¨åœ°å€æ± ä¸­çš„ä¸€ä¸ªIPåœ°å€ï¼ŒåŠ¨æ€å½¢æˆNATåœ°å€è½¬æ¢è¡¨ã€‚æ³¨æ„ï¼Œå¤–éƒ¨åœ°å€æ± çš„å…¬ç½‘IPåœ°å€å–å‡ºåï¼Œå¤–éƒ¨åœ°å€æ± ä¸­å°†æ²¡æœ‰è¯¥å…¬ç½‘IPäº†ã€‚4ï¼‰é»˜è®¤å½“è¯¥ä¸»æœº24å°æ—¶æ²¡æœ‰è”ç³»å¤–ç½‘æ—¶ï¼Œè¯¥åŠ¨æ€NATæ¡ç›®ä¼šè‡ªåŠ¨æ¶ˆå¤±ï¼Œæ‰€è¢«å–å‡ºçš„å…¬ç§æœ‰åœ°å€é‡æ–°å›åˆ°åœ°å€æ± ä¸­ã€‚ ipå¦‚å›¾ï¼Œpcçš„ç½‘å…³192.168.1.254 r1ä¸Šé…ç½®é»˜è®¤è·¯ç”±ï¼Œip route-static 0.0.0.0 0 172.16.1.2 r1ä¸Šé…ç½®åŠ¨æ€åœ°å€æ± ï¼š åœ°å€æ± éªŒè¯ï¼š é…ç½®aclç­–ç•¥ï¼š åœ¨r1çš„å¤–ç½‘å‡ºæ¥å£ä¸Šè°ƒç”¨ï¼š éªŒè¯ï¼š å…¶ä¸­æºIPä¸º3ã€4ã€5ä¸å®šï¼Œè¯´æ˜æ˜¯åœ¨åŠ¨æ€åˆ†é…å¤–ç½‘åœ°å€ã€‚åŠ¨æ€NATé…ç½®å®Œæˆã€‚ åœ¨åŠ¨æ€NATå®éªŒä¸­ï¼Œæœ€ååˆ©ç”¨PC1æµ‹è¯•è¿é€šæ€§æ—¶ï¼Œé—´æ­‡æ€§ä¼šä¸¢åŒ… å¯èƒ½çš„åŸå› ï¼špingçš„æ—¶å€™é»˜è®¤æŒ‰åœ°å€æ± ä¸­å¯ç”¨åœ°å€é¡ºåºä»1~254è¿›è¡Œåœ°å€è½¬æ¢ï¼Œæ”¾å¤§natåœ°å€æ± å¯è§£å†³ã€‚ NAPT å¦‚ä¸Šå›¾ï¼ŒRTAæ”¶åˆ°ä¸€ä¸ªç§ç½‘ä¸»æœºå‘é€çš„æŠ¥æ–‡ï¼ŒæºIPåœ°å€æ˜¯192.168.1.1ï¼Œæºç«¯å£å·æ˜¯1025ï¼Œç›®çš„IPåœ°å€æ˜¯100.1.1.1ï¼Œç›®çš„ç«¯å£æ˜¯80ã€‚RTAä¼šä»é…ç½®çš„å…¬ç½‘åœ°å€æ± ä¸­é€‰æ‹©ä¸€ä¸ªç©ºé—²çš„å…¬ç½‘IPåœ°å€å’Œç«¯å£å·ï¼Œå¹¶å»ºç«‹ç›¸åº”çš„NAPTè¡¨é¡¹ã€‚è¿™äº›NAPTè¡¨é¡¹æŒ‡å®šäº†æŠ¥æ–‡çš„ç§ç½‘IPåœ°å€å’Œç«¯å£å·ä¸å…¬ç½‘IPåœ°å€å’Œç«¯å£å·çš„æ˜ å°„å…³ç³»ã€‚ä¹‹åï¼ŒRTAå°†æŠ¥æ–‡çš„æºIPåœ°å€å’Œç«¯å£å·è½¬æ¢æˆå…¬ç½‘åœ°å€200.10.10.1å’Œç«¯å£å·2843ï¼Œå¹¶è½¬å‘æŠ¥æ–‡åˆ°å…¬ç½‘ã€‚å½“ç½‘å…³RTAæ”¶åˆ°å›å¤æŠ¥æ–‡åï¼Œä¼šæ ¹æ®ä¹‹å‰çš„æ˜ å°„è¡¨å†æ¬¡è¿›è¡Œè½¬æ¢ä¹‹åè½¬å‘ç»™ä¸»æœºAã€‚ä¸»æœºBåŒç†ã€‚ æ³¨æ„ï¼š NAPTæŠ€æœ¯å…è®¸å¤šä¸ªå†…éƒ¨åœ°å€æ˜ å°„åˆ°åŒä¸€ä¸ªå…¬æœ‰åœ°å€çš„ä¸åŒç«¯å£ã€‚NAPTå®ç°äº†ç§æœ‰åœ°å€å¯¹å…±æœ‰åœ°å€å¤šå¯¹ä¸€ ç›¸å½“äºä¸€ç§ç‰¹æ®Šçš„åŠ¨æ€nat 1ã€ç«¯å£NATå’ŒåŠ¨æ€NATçš„é…ç½®è¿‡ç¨‹åŸºæœ¬ä¸€è‡´ï¼Œåªæ˜¯åœ¨åº”ç”¨åˆ°æ¥å£æ—¶ï¼Œé…ç½®å‘½ä»¤å°‘no-pat2ã€ç«¯å£NATä¸€ä¸ªåœ°å€å¯ä»¥ç»™å¤šä¸ªæºåœ°å€è½¬æ¢ï¼Œä¸æ˜¯å•å¯¹å•çš„è½¬æ¢ï¼Œæ‰€ä»¥èŠ‚çœäº†natåœ°å€ï¼3ã€ç«¯å£NATå®é™…åº”ç”¨è¾ƒå¤šï¼Œé™æ€NATå’ŒåŠ¨æ€NATå› ä¸ºåœ°å€ä¸èƒ½èŠ‚çº¦ï¼Œæ‰€ä»¥å®é™…åº”ç”¨å°‘ Easy IP Easy IPæœ¬è´¨ä¸Šæ˜¯NAPTï¼ˆæ‰€ä»¥åŸç†ä¸NAPTå¤§è‡´ç›¸ä¼¼ï¼‰ç”±äºç½‘å…³è®¾å¤‡å‡ºæ¥å£IPåœ°å€ä¸ºå…¬ç½‘åœ°å€ï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨è¯¥å‡ºæ¥å£åœ°å€æ¥ä½œä¸ºåœ°å€è½¬æ¢çš„å…¬æœ‰åœ°å€ã€‚Easy IPé€‚ç”¨äºå°è§„æ¨¡å±€åŸŸç½‘ä¸­çš„ä¸»æœºè®¿é—®Internetçš„åœºæ™¯ã€‚å°è§„æ¨¡å±€åŸŸç½‘é€šå¸¸éƒ¨ç½²åœ¨å°å‹çš„ç½‘å§æˆ–è€…åŠå…¬å®¤ä¸­ï¼Œè¿™äº›åœ°æ–¹å†…éƒ¨ä¸»æœºä¸å¤šï¼Œå‡ºæ¥å£å¯ä»¥é€šè¿‡æ‹¨å·æ–¹å¼è·å–ä¸€ä¸ªä¸´æ—¶å…¬ç½‘IPåœ°å€ã€‚Easy IPå¯ä»¥å®ç°å†…éƒ¨ä¸»æœºä½¿ç”¨è¿™ä¸ªä¸´æ—¶å…¬ç½‘IPåœ°å€è®¿é—®Internetã€‚ Easy IPé€‚ç”¨äºå°è§„æ¨¡å±€åŸŸç½‘ä¸­çš„ä¸»æœºè®¿é—®Internetçš„åœºæ™¯ã€‚å°è§„æ¨¡å±€åŸŸç½‘é€šå¸¸éƒ¨ç½²åœ¨å°å‹çš„ç½‘å§æˆ–è€…åŠå…¬å®¤ä¸­ï¼Œè¿™äº›åœ°æ–¹å†…éƒ¨ä¸»æœºä¸å¤šï¼Œå‡ºæ¥å£å¯ä»¥é€šè¿‡æ‹¨å·æ–¹å¼è·å–ä¸€ä¸ªä¸´æ—¶å…¬ç½‘IPåœ°å€ã€‚Easy IPå¯ä»¥å®ç°å†…éƒ¨ä¸»æœºä½¿ç”¨è¿™ä¸ªä¸´æ—¶å…¬ç½‘IPåœ°å€è®¿é—®Internetã€‚ Easy IPçš„é…ç½®ï¼š1.åˆ›å»ºACLï¼šacl 2000 2.å…è®¸1.0çš„æ•°æ®è¿›è¡Œè½¬æ¢ï¼šrule 5 permit source 192.168.1.0 0 .0.0.255 3.è¿›å…¥å…¬ç½‘å‡ºæ¥å£ 4.åº”ç”¨aclï¼šnat outbound 2000 ï¼ˆç›¸è¾ƒäºnaptå°‘äº†åœ°å€æ± ï¼‰ éªŒè¯ï¼š æºåœ°å€ä¸ºå‡ºæ¥å£åœ°å€172.16.1.1ï¼Œåªæ˜¯ç«¯å£ä¸åŒ","categories":[{"name":"ipå®éªŒ","slug":"ipå®éªŒ","permalink":"http://example.com/categories/ip%E5%AE%9E%E9%AA%8C/"}],"tags":[{"name":"nat","slug":"nat","permalink":"http://example.com/tags/nat/"}]},{"title":"DHCPåŸºç¡€é…ç½®","slug":"DHCPåŸºç¡€é…ç½®","date":"2023-11-25T06:34:51.000Z","updated":"2023-12-03T13:57:57.899Z","comments":true,"path":"2023/11/25/DHCPåŸºç¡€é…ç½®/","permalink":"http://example.com/2023/11/25/DHCP%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE/","excerpt":"DHCPæ˜¯ä¸€ç§ç»ˆç«¯è‡ªåŠ¨é…ç½®åè®®ï¼Œå®¢æˆ·ç«¯é€šè¿‡DHCPåè®®å¯è·å–ä¸€ä¸ªåˆæ³•çš„åŠ¨æ€IPåœ°å€ã€‚","text":"DHCPæ˜¯ä¸€ç§ç»ˆç«¯è‡ªåŠ¨é…ç½®åè®®ï¼Œå®¢æˆ·ç«¯é€šè¿‡DHCPåè®®å¯è·å–ä¸€ä¸ªåˆæ³•çš„åŠ¨æ€IPåœ°å€ã€‚ æ¦‚è¿°éšç€ç½‘ç»œè§„æ¨¡çš„æ‰©å¤§å’Œç½‘ç»œå¤æ‚åº¦çš„æé«˜ï¼Œç½‘ç»œé…ç½®è¶Šæ¥è¶Šå¤æ‚ï¼Œç»å¸¸å‡ºç°è®¡ç®—æœºä½ç½®å˜åŒ–ï¼ˆå¦‚ä¾¿æºæœºæˆ–æ— çº¿ç½‘ç»œï¼‰å’Œè®¡ç®—æœºæ•°é‡è¶…è¿‡å¯åˆ†é…çš„IPåœ°å€çš„æƒ…å†µã€‚åŠ¨æ€ä¸»æœºé…ç½®åè®®DHCPï¼ˆDynamic Host Configuration Protocolï¼‰å°±æ˜¯ä¸ºæ»¡è¶³è¿™äº›éœ€æ±‚è€Œå‘å±•èµ·æ¥çš„ã€‚DHCPåè®®ä»¥æœåŠ¡å™¨&#x2F;å®¢æˆ·ç«¯ï¼ˆServer&#x2F;Clientï¼‰æ¨¡å¼å·¥ä½œï¼ŒDHCPå®¢æˆ·ç«¯å‘DHCPæœåŠ¡å™¨åŠ¨æ€åœ°è¯·æ±‚é…ç½®ä¿¡æ¯ï¼ŒDHCPæœåŠ¡å™¨å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ä¸ºå®¢æˆ·ç«¯åŠ¨æ€å‘é€é…ç½®ä¿¡æ¯ã€‚ DHCPæœåŠ¡å™¨DHCP Serverå³DHCPæœåŠ¡å™¨ï¼Œè´Ÿè´£å®¢æˆ·ç«¯IPåœ°å€çš„åˆ†é…ã€‚å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€é…ç½®ç”³è¯·æŠ¥æ–‡ï¼ˆåŒ…æ‹¬IPåœ°å€ã€å­ç½‘æ©ç ã€ç¼ºçœç½‘å…³ç­‰å‚æ•°ï¼‰ï¼ŒæœåŠ¡å™¨æ ¹æ®ç­–ç•¥è¿”å›æºå¸¦ç›¸åº”é…ç½®ä¿¡æ¯çš„æŠ¥æ–‡ï¼Œè¯·æ±‚æŠ¥æ–‡å’Œå›åº”æŠ¥æ–‡éƒ½é‡‡ç”¨UDPè¿›è¡Œå°è£…ã€‚ DHCPä¸­ç»§DHCP Relayå³DHCPä¸­ç»§ï¼Œå®ƒæ˜¯ä¸ºè§£å†³æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¸åœ¨åŒä¸€ä¸ªç½‘æ®µè€Œæå‡ºæ¥çš„ï¼Œå®ƒæä¾›äº†å¯¹DHCPå¹¿æ’­æŠ¥æ–‡çš„é€æ˜ä¼ è¾“åŠŸèƒ½ï¼Œèƒ½å¤ŸæŠŠDHCPå®¢æˆ·ç«¯çš„å¹¿æ’­æŠ¥æ–‡é€æ˜åœ°ä¼ é€åˆ°å…¶å®ƒç½‘æ®µçš„DHCPæœåŠ¡å™¨ä¸Šï¼ŒåŒæ ·èƒ½å¤ŸæŠŠDHCPæœåŠ¡å™¨ç«¯çš„å¹¿æ’­æŠ¥æ–‡é€æ˜åœ°ä¼ é€åˆ°å…¶å®ƒç½‘æ®µçš„DHCPå®¢æˆ·ç«¯ã€‚ åŸºæœ¬å‘½ä»¤åŸºæœ¬å‘½ä»¤pcï¼š ipconfig &#x2F;releaseâ€”é‡Šæ”¾ipåœ°å€ipconfig &#x2F;renewâ€”é‡æ–°è·å–ip å°†DHCPè½¬åŒ–ä¸ºå›ºå®šçš„åœ°å€ï¼š ip pool åå­—â€”è¿›å…¥åœ°å€æ± staic-bind ip-address è¦åˆ†é…çš„å›ºå®šip mac-address ç›®æ ‡çš„macåœ°å€â€”æ·»åŠ å›ºå®šåœ°å€åˆ°pcç«¯lease day &lt;0-999&gt;â€”ä¿®æ”¹ç§ŸæœŸï¼ˆä¸å»ºè®®ä¿®æ”¹ï¼‰ å°†éƒ¨åˆ†ipåœ°å€æ’é™¤åœ°å€æ± ï¼Œç”¨äºé™æ€è·¯ç”±é…ç½® ip pool åå­—â€”è¿›å…¥åœ°å€æ± excluded-ip-address 192.168.1.1 192.168.1.50â€”æŠŠ1.1åˆ°1.50çš„åœ°å€æ’é™¤å‡ºåœ°å€æ± ä¸ä½¿ç”¨ é‡ç½®ä¸æŸ¥çœ‹åœ°å€æ±  reset ip pool name åå­—â€”é‡ç½®ipé…ç½®dis ip pool name åå­—â€”æŸ¥çœ‹æŒ‡å®šåœ°å€æ± dis ip poolâ€”æŸ¥çœ‹åœ°å€æ± dis ip pool åå­— usedâ€”æŸ¥çœ‹ä½¿ç”¨æƒ…å†µ é…ç½®globalå…¨å±€æ¨¡å¼ å…ˆé…ç½®ç‰©ç†æ¥å£ interface æ¥å£å·â€”è¿›å…¥ç‰©ç†æ¥å£ip address ipåœ°å€â€”é…ç½®ç‰©ç†æ¥å£IP DHCP enableâ€”å¼€å¯DHCPåŠŸèƒ½ip pool åå­—â€”åˆ›å»ºä¸€ä¸ªipåœ°å€æ± ï¼ˆæœ‰å‡ ä¸ªç½‘æ®µå°±å»ºå‡ ä¸ªæ± ï¼‰network 192.168.1.0 mask 24â€”ç»™ipåœ°å€æ± æ·»åŠ ä¸€ä¸ªç½‘æ®µgateway-list 192.168.1.1â€”è®¾ç½®192.168.1.1è¿™ä¸ªipåœ°å€ä¸ºç½‘å…³dns-list 8.8.8.8 192.168.1.1â€”é…ç½®DNSä¸º8.8.8.8ï¼ˆå‰é¢çš„ä¼˜å…ˆï¼‰interface ipåœ°å€â€”è¿›å…¥ç‰©ç†æ¥å£dhcp select globalâ€”ç»™æ¥å£é…ç½®å…¨å±€æ¨¡å¼ å°†pcæ›´æ”¹ä¸ºDHCPè·å–IPæ–¹å¼ï¼Œå°±å¯ä»¥è‡ªåŠ¨åˆ†é…ipåœ°å€äº† interfaceé…ç½®æ–¹å¼åŸºäºæ¥å£çš„DHCPçš„é…ç½®æ–¹å¼ï¼šé…ç½®ç‰©ç†æ¥å£çš„ipç½‘å…³ï¼š interface æ¥å£å·â€”è¿›å…¥æ¥å£ip address IPç½‘å…³â€”é…ç½®ç½‘å…³ dhcp enableâ€”å¼€å¯æœåŠ¡dhcp select interfaceâ€”é€‰æ‹©interfaceè¿™ä¸ªé…ç½®æ–¹å¼dhcp server dns-list 8.8.8.8-â€“é…ç½®DNSæœåŠ¡ æ³¨æ„ï¼šè¿™ç§é…ç½®æ–¹å¼åˆ†é…çš„ipåœ°å€ç½‘æ®µï¼Œæ˜¯è¯¥æ¥å£æ‰€åœ¨çš„ç½‘æ®µçš„ipåœ°å€ï¼Œç½‘å…³å°±æ˜¯è¿™ä¸ªæ¥å£çš„ipåœ°å€ relayï¼ˆä¸­ç»§ï¼‰é…ç½®æ–¹å¼ ç”¨äºåœ¨æœåŠ¡å™¨ä¸Šåšé…ç½®ï¼Œè·¯ç”±å™¨è¿›è¡Œè½¬å‘ï¼Œå‡å°‘è´Ÿè½½é‡ï¼Œå¯ä»¥å¯¹æ•´ä¸ªç½‘ç»œä½“ç³»è¿›è¡Œé…ç½®é¦–å…ˆè¦å®ç°æœåŠ¡å™¨ä¸ä¸ªç½‘æ®µäº’é€šåœ¨æœåŠ¡å™¨çš„é…ç½®ï¼š æœåŠ¡å™¨ç‰©ç†æ¥å£é…ç½®ipip route-static 0.0.0.0 0 ä¸‹ä¸€è·³çš„ipâ€”æœåŠ¡å™¨é…ç½®ç¼ºçœè·¯ç”±ä¿è¯äº’é€šdhcp enableâ€”åœ¨æœåŠ¡å™¨å¼€å¯dhcpåŠŸèƒ½ip pool åå­—â€”åˆ›å»ºipåœ°å€æ± ï¼ˆéœ€è¦å‡ ä¸ªç½‘æ®µå°±åˆ›å»ºå‡ ä¸ªåœ°å€æ± ï¼‰network 192.168.1.0 mask 24â€”åˆ›å»ºç½‘æ®µgateway-list 192.168.1.1â€”åˆ›å»ºç½‘å…³dns-list 8.8.8.8â€”åˆ›å»ºdnsinterface ç‰©ç†æ¥å£â€”è¿›å…¥ç‰©ç†æ¥å£dhcp select globalâ€”é€‰æ‹©å…¨å±€é…ç½®æ¨¡å¼ åœ¨è·¯ç”±å™¨&#x2F;æ ¸å¿ƒäº¤æ¢æœºä¸Šçš„é…ç½® dhcp enableâ€”å¼€å¯dhcpåŠŸèƒ½interface æ¥å£å·â€”è¿›å…¥æ¥å£ ï¼ˆéœ€è¦å‡ ä¸ªç½‘æ®µå°±åˆ†åˆ«è¿›å…¥é…ç½®ï¼‰dhcp select relayâ€”å¼€å¯ä¸­ç»§æ¨¡å¼dhcp relay server-ip æœåŠ¡å™¨ç‰©ç†ipâ€”é€‰æ‹©ä¸­ç»§åˆ†é…çš„æ¥å£ åŸºæœ¬å®éªŒ R1å’ŒR3æ¨¡æ‹Ÿå®¢æˆ·ç«¯ï¼Œä½œä¸ºDHCP Clientã€‚ R2ä½œä¸ºDHCP Serverä¸ºR1å’ŒR3åˆ†é…IPåœ°å€ã€‚ åŠ¨æ€ä¸»æœºé…ç½®åè®®DHCPï¼ˆDynamic Host Configuration Protocolï¼‰æ˜¯ä¸€ç§ç”¨äºé›†ä¸­å¯¹ç”¨æˆ·IPåœ°å€è¿›è¡ŒåŠ¨æ€ç®¡ç†å’Œé…ç½®çš„æŠ€æœ¯ã€‚å³ä½¿è§„æ¨¡è¾ƒå°çš„ç½‘ç»œï¼Œé€šè¿‡DHCPä¹Ÿå¯ä»¥ä½¿åç»­å¢åŠ ç½‘ç»œè®¾å¤‡å˜å¾—ç®€å•å¿«æ·ã€‚ DHCPåè®®ç”±RFC 2131å®šä¹‰ï¼Œé‡‡ç”¨å®¢æˆ·ç«¯&#x2F;æœåŠ¡å™¨é€šä¿¡æ¨¡å¼ï¼Œç”±å®¢æˆ·ç«¯ï¼ˆDHCP Clientï¼‰å‘æœåŠ¡å™¨ï¼ˆDHCP Serverï¼‰æå‡ºé…ç½®ç”³è¯·ï¼ŒæœåŠ¡å™¨è¿”å›ä¸ºå®¢æˆ·ç«¯åˆ†é…çš„é…ç½®ä¿¡æ¯ã€‚ DHCPå¯ä»¥æä¾›ä¸¤ç§åœ°å€åˆ†é…æœºåˆ¶ï¼Œç½‘ç»œç®¡ç†å‘˜å¯ä»¥æ ¹æ®ç½‘ç»œéœ€æ±‚ä¸ºä¸åŒçš„ä¸»æœºé€‰æ‹©ä¸åŒçš„åˆ†é…ç­–ç•¥ã€‚ â€¢ åŠ¨æ€åˆ†é…æœºåˆ¶ï¼šé€šè¿‡DHCPä¸ºä¸»æœºåˆ†é…ä¸€ä¸ªæœ‰ä½¿ç”¨æœŸé™ï¼ˆè¿™ä¸ªä½¿ç”¨æœŸé™é€šå¸¸å«åšç§ŸæœŸï¼‰çš„IPåœ°å€ã€‚è¿™ç§åˆ†é…æœºåˆ¶é€‚ç”¨äºä¸»æœºéœ€è¦ä¸´æ—¶æ¥å…¥ç½‘ç»œæˆ–è€…ç©ºé—²åœ°å€æ•°å°äºç½‘ç»œä¸»æœºæ€»æ•°ä¸”ä¸»æœºä¸éœ€è¦æ°¸ä¹…è¿æ¥ç½‘ç»œçš„åœºæ™¯ã€‚ â€¢ é™æ€åˆ†é…æœºåˆ¶ï¼šç½‘ç»œç®¡ç†å‘˜é€šè¿‡DHCPä¸ºæŒ‡å®šçš„ä¸»æœºåˆ†é…å›ºå®šçš„IPåœ°å€ã€‚ç›¸æ¯”æ‰‹å·¥é™æ€é…ç½®IPåœ°å€ï¼Œé€šè¿‡DHCPæ–¹å¼é™æ€åˆ†é…æœºåˆ¶é¿å…äººå·¥é…ç½®å‘ç”Ÿé”™è¯¯ï¼Œæ–¹ä¾¿ç®¡ç†å‘˜ç»Ÿä¸€ç»´æŠ¤ç®¡ç†ã€‚ é…ç½®R2 ipï¼šç•¥ å¼€å¯DHCPåŠŸèƒ½[R1]dhcp enable Info: The operation may take a few seconds. Please wait for a moment.done. dhcp enableå‘½ä»¤æ˜¯DHCPç›¸å…³åŠŸèƒ½çš„æ€»å¼€å…³ï¼ŒDHCP Clientå’ŒDHCP Serverç­‰åŠŸèƒ½éƒ½è¦åœ¨æ‰§è¡Œdhcp enableå‘½ä»¤ä½¿èƒ½DHCPåŠŸèƒ½åæ‰ä¼šç”Ÿæ•ˆã€‚ [R2]dhcp enable Info: The operation may take a few seconds. Please wait for a moment.done. [R3]dhcp enable Info: The operation may take a few seconds. Please wait for a moment.done. é…ç½®åœ°å€æ± # é…ç½®R2çš„GigabitEthernet 0&#x2F;0&#x2F;0çš„æ¥å£åœ°å€æ± ï¼Œä¸ºR1åˆ†é…IPåœ°å€ [R2]interface GigabitEthernet 0&#x2F;0&#x2F;0 [R2-GigabitEthernet0&#x2F;0&#x2F;0]dhcp select interface dhcp select interfaceå‘½ä»¤ç”¨æ¥å¼€å¯æ¥å£é‡‡ç”¨æ¥å£åœ°å€æ± çš„DHCP ServeråŠŸèƒ½ã€‚è‹¥ä¸æ‰§è¡Œæ­¤å‘½ä»¤ï¼Œåˆ™æ— æ³•é…ç½®æ¥å£åœ°å€æ± çš„ç›¸å…³å‚æ•°ã€‚ [R2-GigabitEthernet0&#x2F;0&#x2F;0]dhcp server dns-list 10.0.12.2 dhcp server dns-listå‘½ä»¤ç”¨æ¥æŒ‡å®šæ¥å£åœ°å€æ± ä¸‹çš„DNSæœåŠ¡å™¨åœ°å€ã€‚æœ€å¤šå¯ä»¥é…ç½®8ä¸ªDNS Serverçš„IPåœ°å€ï¼Œç”¨ç©ºæ ¼åˆ†éš”ã€‚ # é…ç½®å…¨å±€åœ°å€æ±  [R2]ip pool GlobalPool Info: Itâ€™s successful to create an IP address pool. åˆ›å»ºåä¸ºG**lobalPoolçš„åœ°å€æ±  [R2-ip-pool-GlobalPool]network 10.0.23.0 mask 24 networkå‘½ä»¤ç”¨æ¥é…ç½®å…¨å±€åœ°å€æ± ä¸‹å¯åˆ†é…çš„ç½‘æ®µåœ°å€ã€‚ [R2-ip-pool-GlobalPool]dns-list 10.0.23.2 [R2-ip-pool-GlobalPool]gateway-list 10.0.23.2 gateway-listå‘½ä»¤ç”¨æ¥ä¸ºDHCP Clienté…ç½®å‡ºå£ç½‘å…³åœ°å€ã€‚R3åœ¨è·å–åœ°å€ä¹‹åï¼Œä¼šç”Ÿæˆä¸€æ¡é»˜è®¤è·¯ç”±ï¼Œä¸‹ä¸€è·³åœ°å€ä¸º10.0.23.2ã€‚ [R2-ip-pool-GlobalPool]lease day 2 hour 2 leaseå‘½ä»¤ç”¨æ¥é…ç½®åœ°å€æ± ä¸‹çš„åœ°å€ç§ŸæœŸã€‚å½“ç§Ÿçº¦è¢«è®¾ç½®ä¸ºunlimitedæ—¶ï¼Œä»£è¡¨ç§ŸæœŸæ— é™åˆ¶ã€‚ç¼ºçœæƒ…å†µä¸‹ï¼ŒIPåœ°å€ç§ŸæœŸæ˜¯1å¤©ã€‚ [R2-ip-pool-GlobalPool]static-bind ip-address 10.0.23.3 mac-address 00e0-fc6f-6d1f static-bindå‘½ä»¤ç”¨æ¥å°†DHCP Serverå…¨å±€åœ°å€æ± ä¸‹çš„IPåœ°å€ä¸MACåœ°å€è¿›è¡Œç»‘å®šã€‚00e0-fc6f-6d1fä¸ºå½“å‰å®éªŒç¯å¢ƒä¸‹R3çš„GigabitEthernet0&#x2F;0&#x2F;0æ¥å£çš„MACåœ°å€ï¼Œå¯ä»¥åœ¨R3ä¸Šé€šè¿‡å‘½ä»¤â€œdisplay interface GigabitEthernet0&#x2F;0&#x2F;0â€æ¥æŸ¥çœ‹æ¥å£çš„MACåœ°å€ã€‚é…ç½®å®Œè¿™æ¡å‘½ä»¤ä¹‹åï¼ŒR3ä¼šè·å¾—å›ºå®šçš„IPâ€“10.0.23.3ã€‚ [R2-ip-pool-GlobalPool]quit #å¼€å¯R2 GigabitEthernet 0&#x2F;0&#x2F;1æ¥å£çš„DHCP ServeråŠŸèƒ½ï¼Œä¸ºR3åˆ†é…IPåœ°å€ [R2]interface GigabitEthernet 0&#x2F;0&#x2F;1 [R2-GigabitEthernet0&#x2F;0&#x2F;1]dhcp select global dhcp select globalå‘½ä»¤ç”¨æ¥å¼€å¯æ¥å£é‡‡ç”¨å…¨å±€åœ°å€æ± çš„DHCP ServeråŠŸèƒ½ã€‚å½“æ¥å£æ”¶åˆ°DHCP Clientè¯·æ±‚ä¹‹åï¼Œä¼šåˆ°æ‰€æœ‰å…¨å±€åœ°å€æ± ä¸­æŸ¥æ‰¾å¯¹åº”çš„åœ°å€æ± ï¼Œç„¶ååˆ†é…å¯ç”¨çš„åœ°å€ç»™DHCP Clientã€‚ é…ç½®DHCP Client[R1]interface GigabitEthernet 0&#x2F;0&#x2F;0 [R1-GigabitEthernet0&#x2F;0&#x2F;0] ip address dhcp-alloc [R3]interface GigabitEthernet 0&#x2F;0&#x2F;0 [R3-GigabitEthernet0&#x2F;0&#x2F;0] ip address dhcp-alloc ç»“æœéªŒè¯æŸ¥çœ‹R1å’ŒR3çš„åœ°å€åŠè·¯ç”±ç­‰ä¿¡æ¯[R1]display ip interface brief Interface IP Address&#x2F;Mask Physical Protocol GigabitEthernet0&#x2F;0&#x2F;0 10.0.12.254&#x2F;24 up up ä»…ä¿ç•™å…³é”®ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°R1å·²ç»è·å–åˆ°äº†IPåœ°å€**ã€‚ [R1]display dns server Type: D:Dynamic S:Static No. Type IP Address 1 D 10.0.12.2 ä»…ä¿ç•™å…³é”®ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°R1å·²ç»è·å–åˆ°äº†DNSåœ°å€**ã€‚ [R1]display ip routing-table Destination&#x2F;Mask Proto Pre Cost Flags NextHop Interface 0.0.0.0&#x2F;0 Unr 60 0 D 10.0.12.2 GigabitEthernet0&#x2F;0&#x2F;0 ä»…ä¿ç•™å…³é”®ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°R1å·²ç»è·å–åˆ°äº†é»˜è®¤è·¯ç”±**ã€‚ [R3]display ip interface brief Interface IP Address&#x2F;Mask Physical Protocol GigabitEthernet0&#x2F;0&#x2F;0 10.0.23.3&#x2F;24 up up ä»…ä¿ç•™å…³é”®ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°R3å·²ç»è·å–åˆ°äº†å›ºå®šçš„IPåœ°å€**ã€‚ [R3]display dns server Type: D:Dynamic S:Static No. Type IP Address 1 D 2.23.0.10 ä»…ä¿ç•™å…³é”®ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°R3å·²ç»è·å–åˆ°äº†DNSåœ°å€**ã€‚ [R3]display ip routing-table Route Flags: R - relay, D - download to fib -â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“ Routing Tables: Public â€‹ Destinations : 8 Routes : 8 Destination&#x2F;Mask Proto Pre Cost Flags NextHop Interface 0.0.0.0&#x2F;0 Unr 60 0 D 10.0.23.2 GigabitEthernet0&#x2F;0&#x2F;0 ä»…ä¿ç•™å…³é”®ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°R3å·²ç»è·å–åˆ°äº†é»˜è®¤è·¯ç”±**ã€‚ 2ã€æŸ¥çœ‹R2ä¸Šçš„åœ°å€åˆ†é…æƒ…å†µ[R2]display ip pool name GlobalPool Pool-name : GlobalPool Pool-No : 1 Lease : 2 Days 2 Hours 0 Minutes Domain-name : - DNS-server0 : 10.0.23.2 NBNS-server0 : - Netbios-type : - Position : Local Status : Unlocked Gateway-0 : 10.0.23.2 Mask : 255.255.255.0 VPN instance : â€“ -â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”- â€‹ Start End Total Used Idle(Expired) Conflict Disable -â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”- â€‹ 10.0.23.1 10.0.23.254 253 1 252(0) 0 0 -â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”- display ip poolå‘½ä»¤ç”¨æ¥æŸ¥çœ‹å·²é…ç½®çš„IPåœ°å€æ± ä¿¡æ¯ã€‚åŒ…æ‹¬åœ°å€æ± çš„åç§°ã€ç§ŸæœŸã€é”å®šçŠ¶æ€ã€åœ°å€æ± ä¸­IPåœ°å€çš„çŠ¶æ€ç­‰ã€‚ [R2]display ip pool interface GigabitEthernet0&#x2F;0&#x2F;1 Pool-name : GigabitEthernet****0&#x2F;0&#x2F;1 Pool-No : 0 Lease : 1 Days 0 Hours 0 Minutes Domain-name : - DNS-server0 : 10.0.12.2 NBNS-server0 : - Netbios-type : - Position : Interface Status : Unlocked Gateway-0 : 10.0.12.2 Mask : 255.255.255.0 VPN instance : â€“ -â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”- â€‹ Start End Total Used Idle(Expired) Conflict Disable -â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”- â€‹ 10.0.12.1 10.0.12.254 253 1 252(0) 0 0 -â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”- å½“é…ç½®æ¥å£åœ°å€æ± æ—¶ï¼Œåœ°å€æ± çš„åç§°ä¸ºæ¥å£çš„åç§°ã€‚åˆ†é…çš„ç½‘å…³åœ°å€ä¸ºè¯¥æ¥å£çš„IPåœ°å€ï¼Œä¸”æ— æ³•ä¿®æ”¹ã€‚ ä¸­ç»§å®éªŒäº¤æ¢æœº4ä¸Šæœ‰å¤šä¸ªvlanï¼Œäº¤æ¢æœº1æ¨¡æ‹ŸdhcpæœåŠ¡å™¨å®ç°ä¸ºå¤šä¸ªvlanåˆ†é…åœ°å€ï¼Œäº¤æ¢æœº3ä½œä¸ºdhcpç»ˆæè¿æ¥æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ å®éªŒæ­¥éª¤åˆ›å»ºVLAN[S1]vlan 40 [S3]vlan batch 10 20 30 40 [S4]vlan batch 10 20 30 é…ç½®æ¥å£æ”¾é€šç›¸åº”çš„VLAN[S4]interface GigabitEthernet0&#x2F;0&#x2F;3 [S4-GigabitEthernet0&#x2F;0&#x2F;3] port link-type trunk [S4-GigabitEthernet0&#x2F;0&#x2F;3] port trunk allow-pass vlan 10 20 30 [S4-GigabitEthernet0&#x2F;0&#x2F;3] quit [S3]interface GigabitEthernet0&#x2F;0&#x2F;1 [S3-GigabitEthernet0&#x2F;0&#x2F;1] port link-type access [S3-GigabitEthernet0&#x2F;0&#x2F;1] port default vlan 40 [S3-GigabitEthernet0&#x2F;0&#x2F;1] quit [S3]interface GigabitEthernet0&#x2F;0&#x2F;3 [S3-GigabitEthernet0&#x2F;0&#x2F;3] port link-type trunk [S3-GigabitEthernet0&#x2F;0&#x2F;3] port trunk allow-pass vlan 10 20 30 [S3-GigabitEthernet0&#x2F;0&#x2F;3] quit [S1]interface GigabitEthernet0&#x2F;0&#x2F;12 [S1-GigabitEthernet0&#x2F;0&#x2F;12] port link-type access [S1-GigabitEthernet0&#x2F;0&#x2F;12] port default vlan 40 [S1-GigabitEthernet0&#x2F;0&#x2F;12] quit äº¤æ¢æœº4å’Œäº¤æ¢æœº3ä¹‹é—´å› ä¸ºæ”¾é€šå¤šä¸ªvlanï¼Œæ‰€ä»¥ä½¿ç”¨trunkå£ï¼Œäº¤æ¢æœº3å’Œäº¤æ¢æœº1ä¹‹é—´åªæœ‰ä¸€ä¸ªvlan40ï¼Œæ‰€ä»¥é…ç½®accesså£ï¼Œpvid&#x3D;40 VLANIFé…ç½®[S4]interface Vlanif 10 [S4-Vlanif10] quit [S4]interface Vlanif 20 [S4-Vlanif20] quit [S4]interface Vlanif 30 [S4-Vlanif30] quit [S3]interface Vlanif 10 [S3-Vlanif10] ip address 10.0.10.3 24 [S3-Vlanif10] quit [S3]interface Vlanif 20 [S3-Vlanif20] ip address 10.0.20.3 24 [S3-Vlanif20] quit [S3]interface Vlanif 30 [S3-Vlanif30] ip address 10.0.30.3 24 [S3-Vlanif30] quit [S3]interface Vlanif 40 [S3-Vlanif40] ip address 10.0.40.3 24 [S3-Vlanif40] quit [S1]interface Vlanif 40 [S1-Vlanif40] ip address 10.0.40.1 24 [S1-Vlanif40] quit æ£€æŸ¥ä¸€ä¸‹äº¤æ¢æœº3å’Œ1ä¹‹é—´çš„è¿é€šæ€§ ï¼ˆå¼€å¯DHCPæœåŠ¡ï¼Œé…ç½®å…¨å±€åœ°å€æ± ï¼ŒåŒæ—¶ä¸ºS4ä¸Šçš„VLANIF30åˆ†é…é™æ€IPåœ°å€ã€‚ï¼‰ï¼š å¼€å¯DHCPæœåŠ¡[S1]dhcp enable åˆ›å»ºåœ°å€æ± VLAN10ï¼Œç”¨äºç»™S4çš„VLANIF10åˆ†é…åœ°å€[S1]ip pool vlan10 &#x2F;&#x2F;åˆ›å»ºåœ°å€æ± åä¸ºvlan10 [S1-ip-pool-vlan10] gateway-list 10.0.10.3 &#x2F;&#x2F;ç½‘å…³æ˜¯ä¸­ç»§ä¸Šçš„vlanif 10 [S1-ip-pool-vlan10] network 10.0.10.0 mask 255.255.255.0 &#x2F;&#x2F;è®¾ç½®åˆ†é…ipèŒƒå›´æ˜¯10.0.10.1-10.0.10.255 [S1-ip-pool-vlan10] dns-list 10.0.10.3 [S1-ip-pool-vlan10] quit åˆ›å»ºåœ°å€æ± VLAN20ï¼Œç”¨äºç»™S4çš„VLANIF20åˆ†é…åœ°å€[S1]ip pool vlan20 [S1-ip-pool-vlan20] gateway-list 10.0.20.3 [S1-ip-pool-vlan20] network 10.0.20.0 mask 255.255.255.0 [S1-ip-pool-vlan20] dns-list 10.0.20.3 [S1-ip-pool-vlan20] quit åˆ›å»ºåœ°å€æ± VLAN30ï¼Œç”¨äºç»™S4çš„VLANIF30åˆ†é…åœ°å€[S1]ip pool vlan30 [S1-ip-pool-vlan30] gateway-list 10.0.30.3 [S1-ip-pool-vlan30] network 10.0.30.0 mask 255.255.255.0 [S1-ip-pool-vlan30] dns-list 10.0.30.3 [S1-ip-pool-vlan30] quit æŸ¥çœ‹s4çš„vlanif30çš„macä¸ºäº†å®ç°ç»™s4çš„vlanif30å£é™æ€ç»‘å®šä¸€ä¸ªæŒ‡å®šçš„ipåœ°å€ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæŸ¥çœ‹ä¸€ä¸‹mac åœ¨S1ä¸Šä¸ºS4çš„VLANIF30é…ç½®é™æ€åœ°å€åˆ†é… ç»™s4çš„vlanifå£é™æ€åˆ†é…ipï¼š10.0.30.2 åœ¨VLANIF40æ¥å£ä¸‹ä½¿èƒ½DHCP Server[S1]interface Vlanif 40 [S1-Vlanif40] dhcp select global &#x2F;&#x2F;å…¨å±€çš„ä½¿èƒ½ æŸ¥çœ‹IPåœ°å€æ± é…ç½®æƒ…å†µ[S1]display ip pool name vlan30 åœ°å€æ± vlan30å·²ç»å­˜åœ¨ä¸€ä¸ªâ€œUsedâ€åœ°å€ï¼Œè¯¥åœ°å€ä¸ºé™æ€åˆ†é…çš„åœ°å€ã€‚ é…ç½®å‰å¾€ç”¨æˆ·ç½‘æ®µçš„è·¯ç”±[S1]ip route-static 10.0.10.0 24 10.0.40.3 [S1]ip route-static 10.0.20.0 24 10.0.40.3 [S1]ip route-static 10.0.30.0 24 10.0.40.3 ï¼ˆæˆ–è€…é…ç½®ç¼ºçœè·¯ç”±ï¼‰ ä¿è¯è¿é€šæ€§ åœ¨S3ä¸Šå®ŒæˆDHCP Relayç›¸å…³é…ç½® å¼€å¯DHCPæœåŠ¡[S3]dhcp enable åœ¨æ¥å£ä¸Šé…ç½®DHCP Relayï¼ŒæŒ‡å®šDHCP Server[S3]interface Vlanif10 [S3-Vlanif10] dhcp select relay [S3-Vlanif10] dhcp relay server-ip 10.0.40.1 [S3-Vlanif10] quit [S3]interface Vlanif20 [S3-Vlanif20] dhcp select relay [S3-Vlanif20] dhcp relay server-ip 10.0.40.1 [S3-Vlanif20] quit [S3]interface Vlanif30 [S3-Vlanif30] dhcp select relay [S3-Vlanif30] dhcp relay server-ip 10.0.40.1 [S3-Vlanif30] quit æŸ¥çœ‹relayé…ç½® DHCP Clienté…ç½®åœ¨S4ä¸Šé…ç½®VLANIF10ã€20ã€30æ¥å£é€šè¿‡DHCPè·å–IPåœ°å€ å¼€å¯DHCPæœåŠ¡[S4]dhcp enable å¼€å¯æ¥å£é€šè¿‡DHCPè·å–åœ°å€[S4]interface Vlanif10 [S4-Vlanif10] ip address dhcp-alloc [S4-Vlanif10] quit [S4]interface Vlanif20 [S4-Vlanif20] ip address dhcp-alloc [S4-Vlanif20] quit [S4]interface Vlanif30 [S4-Vlanif30] ip address dhcp-alloc [S4-Vlanif30] quit æŸ¥çœ‹å„ä¸ªæ¥å£IPåœ°å€è·å–æƒ…å†µdisplay interface Vlanif 10 Vlanif10 current state : UP Line protocol current state : UP Last line protocol up time : 2020-06-05 17:37:57 UTC-08:00 Description: Route Port,The Maximum Transmit Unit is 1500 Internet Address is allocated by DHCP, 10.0.10.254&#x2F;24 [S4]display interface Vlanif 20 Vlanif20 current state : UP Line protocol current state : UP Last line protocol up time : 2020-06-05 17:41:23 UTC-08:00 Description: Route Port,The Maximum Transmit Unit is 1500 Internet Address is allocated by DHCP, 10.0.20.254&#x2F;24 [S4]display interface Vlanif 30 Vlanif30 current state : UP Line protocol current state : UP Last line protocol up time : 2020-06-05 17:43:22 UTC-08:00 Description: Route Port,The Maximum Transmit Unit is 1500 Internet Address is allocated by DHCP, 10.0.30.2&#x2F;24 æ¥å£å·²ç»é€šè¿‡DHCPè·å–åˆ°IPåœ°å€ï¼Œå¹¶ä¸”VLANIF30çš„åœ°å€ä¸ºé™æ€åˆ†é…çš„åœ°å€ï¼š10.0.30.2ã€‚","categories":[{"name":"ipå®éªŒ","slug":"ipå®éªŒ","permalink":"http://example.com/categories/ip%E5%AE%9E%E9%AA%8C/"}],"tags":[{"name":"DHCP Relay","slug":"DHCP-Relay","permalink":"http://example.com/tags/DHCP-Relay/"},{"name":"DHCP","slug":"DHCP","permalink":"http://example.com/tags/DHCP/"}]},{"title":"vlané—´é€šä¿¡","slug":"vlané—´é€šä¿¡","date":"2023-11-24T07:17:21.000Z","updated":"2023-11-25T07:51:39.450Z","comments":true,"path":"2023/11/24/vlané—´é€šä¿¡/","permalink":"http://example.com/2023/11/24/vlan%E9%97%B4%E9%80%9A%E4%BF%A1/","excerpt":"VLANé—´é€šä¿¡èƒŒæ™¯åˆ’åˆ†VLANåï¼Œä¸åŒVLANçš„ç”¨æˆ·é—´ä¸èƒ½äºŒå±‚äº’è®¿ï¼Œè¿™æ ·èƒ½èµ·åˆ°éš”ç¦»å¹¿æ’­çš„ä½œç”¨ã€‚ä½†å®é™…åº”ç”¨ä¸­ï¼Œä¸åŒVLANçš„ç”¨æˆ·åˆå¸¸æœ‰äº’è®¿çš„éœ€æ±‚ï¼Œæ­¤æ—¶å°±éœ€è¦å®ç°ä¸åŒVLANçš„ç”¨æˆ·äº’è®¿ï¼Œç®€ç§°VLANé—´äº’è®¿ã€‚","text":"VLANé—´é€šä¿¡èƒŒæ™¯åˆ’åˆ†VLANåï¼Œä¸åŒVLANçš„ç”¨æˆ·é—´ä¸èƒ½äºŒå±‚äº’è®¿ï¼Œè¿™æ ·èƒ½èµ·åˆ°éš”ç¦»å¹¿æ’­çš„ä½œç”¨ã€‚ä½†å®é™…åº”ç”¨ä¸­ï¼Œä¸åŒVLANçš„ç”¨æˆ·åˆå¸¸æœ‰äº’è®¿çš„éœ€æ±‚ï¼Œæ­¤æ—¶å°±éœ€è¦å®ç°ä¸åŒVLANçš„ç”¨æˆ·äº’è®¿ï¼Œç®€ç§°VLANé—´äº’è®¿ã€‚ å®éªŒæ‹“æ‰‘ è¯¦è§£ï¼šR2åˆ’å…¥vlan2ï¼ŒR3åˆ’å…¥vlan3ï¼Œä¸äº¤æ¢æœºä¹‹é—´é‡‡ç”¨accesså£ï¼Œç”±äºäº¤æ¢æœºg0&#x2F;0&#x2F;1éœ€è¦é€šè¿‡å¤šä¸ªvlanï¼Œæ‰€ä»¥é…æˆtrunkå£ã€‚R2å’ŒR3ç›¸å½“äºä¸»æœºï¼Œå‘é€å’Œæ¥å—çš„æ•°æ®éƒ½ä¸å¸¦æ ‡ç­¾ï¼Œäº¤æ¢æœºg0&#x2F;0&#x2F;2æ”¶åˆ°R2å‘é€çš„æ•°æ®ï¼Œæ‰“ä¸Šæ ‡ç­¾vlan2ï¼Œç„¶åå‘å‡ºå»ï¼›äº¤æ¢æœºg0&#x2F;0&#x2F;1æ”¶åˆ°æ•°æ®åï¼Œå‘ç°vlançš„æ ‡ç­¾å…è®¸é€šè¿‡ï¼Œåˆ™æ•°æ®å¸¦ç€vlan2çš„æ ‡ç­¾é€šè¿‡ï¼›ç„¶åäº¤æ¢æœºg0&#x2F;0&#x2F;3å£è½¬å‘æ•°æ®æ—¶ï¼Œå‘ç°è‡ªå·±çš„pvidæ˜¯vlan3ï¼Œå’Œvlan2ä¸ä¸€æ ·ï¼Œæ‰€ä»¥ä¸æ¥å—ï¼Œåˆ™vlan2å’Œvlan3ä¸èƒ½é€šä¿¡ã€‚ åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œéœ€è¦ç‰¹å®švlanä¹‹é—´é€šä¿¡ æ–¹æ³•ä¸€ï¼šdot1qæ¥å£ åœ¨r1ä¸Šé…ç½®ä¸¤ä¸ªdot1qæ¥å£ï¼Œg0&#x2F;0&#x2F;1.1å’Œg0&#x2F;0&#x2F;1.2ï¼Œåˆ†åˆ«å¯¹åº”vlan2å’Œvlan3ï¼Œä½œç”¨å°±æ˜¯å¯ä»¥ç»ˆç»“vlanæ ‡ç­¾ï¼ˆå‰¥ç¦»ï¼‰ï¼Œvlan2çš„æ ‡ç­¾åˆ°r1åï¼Œè¢«å‰¥ç¦»æ‰vlan2çš„æ ‡ç­¾ï¼Œç„¶åè½¬å‘æ—¶åˆè¢«g0&#x2F;0&#x2F;1.2æ‰“ä¸Švlan3çš„æ ‡ç­¾ï¼Œäº¤æ¢æœºg0&#x2F;0&#x2F;1é€šè¿‡ï¼Œåˆ°g0&#x2F;0&#x2F;3ï¼Œaccesså£å‘ç°å’Œè‡ªå·±çš„pvidä¸€æ ·ï¼Œç„¶åå‰¥ç¦»æ‰æ ‡ç­¾ï¼Œè½¬å‘æ•°æ®å¸§ç»™r3. æ–¹æ³•äºŒï¼švlanifæ¥å£ï¼šäº¤æ¢æœºä¸Šé…ç½®vlanif2å’Œvlanif3ï¼Œipåœ°å€é…æˆ192.168.2.254å’Œ192.168.3.254 å…¶å®å°±æ˜¯ç›¸å½“äºä¸¤ä¸ªä¸åŒç½‘æ®µçš„ç½‘å…³ï¼Œç„¶åå®ç°ä¸‰å±‚çš„è½¬å‘ Accessæ¥å£äº¤æ¢æœºä¸Šå¸¸ç”¨æ¥è¿æ¥ç”¨æˆ·PCã€æœåŠ¡å™¨ç­‰ç»ˆç«¯è®¾å¤‡çš„æ¥å£ã€‚Accessæ¥å£æ‰€è¿æ¥çš„è¿™äº›è®¾å¤‡çš„ç½‘å¡å¾€å¾€åªæ”¶å‘æ— æ ‡è®°å¸§ã€‚Accessæ¥å£åªèƒ½åŠ å…¥ä¸€ä¸ªVLANã€‚åªèƒ½å…è®¸ä¸€ä¸ªVLANé€šè¿‡ã€‚ è½¬å‘åŸåˆ™ æ¥æ”¶åŸåˆ™ï¼š â‘ æ”¶åˆ°ä¸å¸¦æ ‡ç­¾çš„æ•°æ®å¸§ï¼Œæ‰“ä¸Šæ ‡ç­¾ï¼Œvlan id&#x3D;ç«¯å£çš„PVID â‘¡æ”¶åˆ°å¸¦æ ‡ç­¾çš„æ•°æ®å¸§ï¼Œæ£€æŸ¥æ•°æ®å¸§vlan idæ˜¯å¦å’Œç«¯å£çš„PVIDç›¸åŒï¼Œç›¸åŒç›´æ¥æ¥æ”¶ï¼›ä¸åŒæ‹’ç»æ¥æ”¶ å‘é€åŸåˆ™ï¼š â‘ æ•°æ®å¸§vlan idå’Œç«¯å£PVID ç›¸åŒï¼Œå‰¥ç¦»æ ‡ç­¾å‘é€ï¼› â‘¡æ•°æ®å¸§vlan idå’Œç«¯å£PVID ä¸åŒï¼Œç¦æ­¢å‘é€ã€‚ Trunkæ¥å£Trunkæ¥å£å…è®¸å¤šä¸ªVLANçš„æ•°æ®å¸§é€šè¿‡ï¼Œè¿™äº›æ•°æ®å¸§é€šè¿‡802.1Q Tagå®ç°åŒºåˆ†ã€‚Trunkæ¥å£å¸¸ç”¨äºäº¤æ¢æœºä¹‹é—´çš„äº’è”ï¼Œä¹Ÿç”¨äºè¿æ¥è·¯ç”±å™¨ã€é˜²ç«å¢™ç­‰è®¾å¤‡çš„ å­æ¥å£ è½¬å‘åŸåˆ™ æ¥æ”¶åŸåˆ™ï¼š â‘ æ”¶åˆ°ä¸å¸¦æ ‡ç­¾çš„æ•°æ®å¸§ï¼Œæ‰“ä¸Šæ ‡ç­¾ï¼Œvlan id&#x3D;ç«¯å£çš„PVIDï¼Œç„¶åæŸ¥çœ‹è¯¥vlanidæ˜¯å¦åœ¨å…è®¸åˆ—è¡¨ä¸­ï¼Œæ˜¯â€“æ¥æ”¶ï¼Œä¸æ˜¯â€“æ‹’ç» â‘¡æ”¶åˆ°å¸¦æ ‡ç­¾çš„æ•°æ®å¸§ï¼ŒæŸ¥çœ‹è¯¥vlan idæ˜¯å¦åœ¨å…è®¸åˆ—è¡¨ä¸­ï¼Œæ˜¯â€“æ¥æ”¶ï¼Œä¸æ˜¯â€“æ‹’ç» å‘é€åŸåˆ™ï¼š æŸ¥çœ‹vlan idæ˜¯å¦åœ¨å…è®¸åˆ—è¡¨ä¸­ï¼ŒI:ä¸æ˜¯â€“æ‹’ç»å‘é€ï¼›IIï¼šæ˜¯ï¼ŒæŸ¥çœ‹æ¥å£çš„PVIDå’Œvlan idæ˜¯å¦ç›¸åŒï¼Œç›¸åŒâ€“å‰¥æ ‡ç­¾å‘é€ï¼›ä¸åŒâ€“ç›´æ¥å‘é€ã€‚ Hybridæ¥å£Hybridæ¥å£ä¸Trunkæ¥å£ç±»ä¼¼ï¼Œä¹Ÿå…è®¸å¤šä¸ªVLANçš„æ•°æ®å¸§é€šè¿‡ï¼Œè¿™äº›æ•°æ®å¸§é€šè¿‡802.1Q Tagå®ç°åŒºåˆ†ã€‚ç”¨æˆ·å¯ä»¥çµæ´»æŒ‡å®šHybridæ¥å£åœ¨å‘é€æŸä¸ªï¼ˆæˆ–æŸäº›ï¼‰VLANçš„æ•°æ®å¸§æ—¶æ˜¯å¦æºå¸¦Tag è½¬å‘åŸåˆ™ æ¥æ”¶åŸåˆ™ï¼š â‘ æ”¶åˆ°ä¸å¸¦æ ‡ç­¾çš„æ•°æ®å¸§ï¼Œæ‰“ä¸Šæ ‡ç­¾ï¼Œvlan id&#x3D;ç«¯å£çš„PVIDï¼Œç„¶åæŸ¥çœ‹è¯¥vlanidæ˜¯å¦åœ¨å…è®¸åˆ—è¡¨ä¸­ï¼Œæ˜¯â€“æ¥æ”¶ï¼Œä¸æ˜¯â€“æ‹’ç» â‘¡æ”¶åˆ°å¸¦æ ‡ç­¾çš„æ•°æ®å¸§ï¼ŒæŸ¥çœ‹è¯¥vlan idæ˜¯å¦åœ¨å…è®¸åˆ—è¡¨ä¸­ï¼Œæ˜¯â€“æ¥æ”¶ï¼Œä¸æ˜¯â€“æ‹’ç»å‘é€åŸåˆ™ï¼šæŸ¥çœ‹vlan idæ˜¯å¦åœ¨å…è®¸åˆ—è¡¨ä¸­ï¼ŒI:ä¸æ˜¯â€“æ‹’ç»å‘é€ï¼›IIï¼šæ˜¯ï¼Œæ˜¯å¦å¸¦æ ‡ç­¾å‘é€å–å†³äºæ¥å£çš„é…ç½®ã€‚ PVIDå¯ä»¥æ‰‹å·¥ä¿®æ”¹ï¼Œé»˜è®¤æ˜¯1ï¼Œaccesså£çš„å°±æ˜¯æœ¬èº«çš„vlanå·ï¼Œtrunkå¯ä»¥æœ‰ä¸€ä¸ªä¸»vlanå’Œå¤šä¸ªå‰¯vlanï¼Œæ”¶åˆ°çš„æ•°æ®å’Œä¸»vlanç›¸åŒå°±å‰¥ç¦»è½¬å‘ï¼Œæ”¶åˆ°å’Œä¸»vlanä¸ä¸€æ ·çš„æ ‡ç­¾ï¼ŒæŸ¥è¡¨ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯åœ¨å…è®¸é€šè¿‡çš„åˆ—è¡¨ï¼Œå¦‚æœæœ‰ï¼Œå°±å¸¦ç€åŸæ¥çš„è½¬å‘ï¼Œè¦æ˜¯æ²¡æœ‰ï¼Œå°±ä¸è®©è¿‡å»å•¦ã€‚ å®éªŒé…ç½®è¿‡ç¨‹# R2å’ŒR3çš„IPåœ°å€åŠç½‘å…³é…ç½® system-view Enter system view, return user view with Ctrl+Z. [R2]interface GigabitEthernet 0&#x2F;0&#x2F;1 [R2-GigabitEthernet0&#x2F;0&#x2F;1]ip address 192.168.2.1 24 [R2-GigabitEthernet0&#x2F;0&#x2F;1]quit [R2]ip route-static 0.0.0.0 0 192.168.2.254 é…ç½®é»˜è®¤è·¯ç”±ï¼Œç›¸å½“äºç»™è®¾å¤‡é…ç½®äº†ç½‘å…³ã€‚ system-view Enter system view, return user view with Ctrl+Z. [R3]interface GigabitEthernet 0&#x2F;0&#x2F;1 [R3-GigabitEthernet0&#x2F;0&#x2F;1]ip address 192.168.3.1 24 [R3-GigabitEthernet0&#x2F;0&#x2F;1]quit [R3]ip route-static 0.0.0.0 0 192.168.3.254 # åœ¨S1ä¸Šå¯¹R2å’ŒR3è¿›è¡ŒVLANåˆ’åˆ† [S1]vlan batch 2 3 Info: This operation may take a few seconds. Please wait for a momentâ€¦done. [S1]interface GigabitEthernet 0&#x2F;0&#x2F;2 [S1-GigabitEthernet0&#x2F;0&#x2F;2]port link-type access [S1-GigabitEthernet0&#x2F;0&#x2F;2]port default vlan 2 [S1-GigabitEthernet0&#x2F;0&#x2F;2]quit [S1]interface GigabitEthernet 0&#x2F;0&#x2F;3 [S1-GigabitEthernet0&#x2F;0&#x2F;3]port link-type access [S1-GigabitEthernet0&#x2F;0&#x2F;3]port default vlan 3 æ­¥éª¤ 1 é€šè¿‡Dot1qç»ˆç»“å­æ¥å£å®ç°VLANé—´äº’è®¿ # é…ç½®S1ä¸Šçš„Trunkæ¥å£ [S1]interface GigabitEthernet 0&#x2F;0&#x2F;1 [S1-GigabitEthernet0&#x2F;0&#x2F;1]port trunk allow-pass vlan 2 3 å› ä¸ºVLANé—´äº’è®¿æ•°æ®è¦ç”±R1æ¥ç»ˆç»“VLANï¼Œæ‰€ä»¥S1å’ŒR1ä¹‹é—´çš„é“¾è·¯è¦å…è®¸VLAN2å’ŒVLAN3é€šè¿‡**ã€‚ # åœ¨R1ä¸Šåˆ›å»ºå¹¶é…ç½®Dot1qç»ˆç»“å­æ¥å£ [R1]interface GigabitEthernet 0&#x2F;0&#x2F;1.2 åˆ›å»ºå¹¶è¿›å…¥å­æ¥å£è§†å›¾ã€‚2ä»£è¡¨å­æ¥å£çš„ç¼–å·ï¼Œä¸€èˆ¬å»ºè®®å­æ¥å£ç¼–å·ä¸VLAN IDç›¸åŒï¼Œæ–¹ä¾¿è®°å¿†ã€‚ [R1-GigabitEthernet0&#x2F;0&#x2F;1.2]dot1q termination vid 2 dot1q termination vid vlan-idå‘½ä»¤ç”¨æ¥é…ç½®å­æ¥å£Dot1qç»ˆç»“çš„VLAN IDã€‚ ä»¥æ­¤é…ç½®ä¸ºä¾‹ï¼šå½“GigabitEthernet0&#x2F;0&#x2F;1æ¥å£æ”¶åˆ°å¸¦æœ‰VLAN 2æ ‡ç­¾çš„æ•°æ®ä¹‹åï¼Œä¼šäº¤ç”±2å·å­æ¥å£è¿›è¡ŒVLANç»ˆç»“æ“ä½œå¹¶åšåç»­å¤„ç†ã€‚ä»2å·å­æ¥å£å‘å‡ºçš„æ•°æ®ä¹Ÿä¼šå¸¦ä¸ŠVLAN 2çš„æ ‡ç­¾ã€‚ [R1-GigabitEthernet0&#x2F;0&#x2F;1.2]arp broadcast enable ç»ˆç»“å­æ¥å£ä¸èƒ½è½¬å‘å¹¿æ’­æŠ¥æ–‡ï¼Œåœ¨æ”¶åˆ°å¹¿æ’­æŠ¥æ–‡åå®ƒä»¬ç›´æ¥æŠŠè¯¥æŠ¥æ–‡ä¸¢å¼ƒã€‚ä¸ºäº†å…è®¸ç»ˆç»“å­æ¥å£èƒ½è½¬å‘å¹¿æ’­æŠ¥æ–‡ï¼Œå¯ä»¥é€šè¿‡åœ¨å­æ¥å£ä¸Šæ‰§è¡Œå‘½ä»¤arp broadcast enableä½¿èƒ½ç»ˆç»“å­æ¥å£çš„ARPå¹¿æ’­åŠŸèƒ½ã€‚éƒ¨åˆ†è®¾å¤‡é»˜è®¤ä½¿èƒ½è¯¥åŠŸèƒ½ï¼Œæ­¤å‘½ä»¤çš„é…ç½®æ ¹æ®è®¾å¤‡è€Œå®šã€‚ [R1-GigabitEthernet0&#x2F;0&#x2F;1.2]ip address 192.168.2.254 24 [R1-GigabitEthernet0&#x2F;0&#x2F;1.2]quit [R1]interface GigabitEthernet 0&#x2F;0&#x2F;1.3 [R1-GigabitEthernet0&#x2F;0&#x2F;1.3]dot1q termination vid 3 [R1-GigabitEthernet0&#x2F;0&#x2F;1.3]arp broadcast enable [R1-GigabitEthernet0&#x2F;0&#x2F;1.3]ip address 192.168.3.254 24 [R1-GigabitEthernet0&#x2F;0&#x2F;1.3]quit # æ£€æµ‹VLANé—´äº’è®¿è”é€šæ€§ ping 192.168.3.1 PING 192.168.3.1: 56 data bytes, press CTRL_C to break Reply from 192.168.3.1: bytes&#x3D;56 Sequence&#x3D;1 ttl&#x3D;254 time&#x3D;60 ms Reply from 192.168.3.1: bytes&#x3D;56 Sequence&#x3D;2 ttl&#x3D;254 time&#x3D;40 ms Reply from 192.168.3.1: bytes&#x3D;56 Sequence&#x3D;3 ttl&#x3D;254 time&#x3D;110 ms Reply from 192.168.3.1: bytes&#x3D;56 Sequence&#x3D;4 ttl&#x3D;254 time&#x3D;70 ms Reply from 192.168.3.1: bytes&#x3D;56 Sequence&#x3D;5 ttl&#x3D;254 time&#x3D;100 ms â€” 192.168.3.1 ping statistics â€” 5 packet(s) transmitted 5 packet(s) received 0.00% packet loss round-trip min&#x2F;avg&#x2F;max &#x3D; 40&#x2F;76&#x2F;110 ms tracert 192.168.3.1 traceroute to 192.168.3.1(192.168.3.1), max hops: 30 ,packet length: 40,press CTRL_C to break 1 192.168.2.254 30 ms 50 ms 50 ms 2 192.168.3.1 70 ms 60 ms 60 ms æ­¤æ—¶VLAN2å’ŒVLAN3ä¹‹é—´å·²ç»å¯ä»¥æ­£å¸¸çš„äº’è®¿ã€‚ æ­¥éª¤ 2 é€šè¿‡VLANIFæ¥å£å®ç°VLANé—´äº’è®¿ # æ¸…é™¤ä¸Šä¸€æ­¥é…ç½® [S1]interface GigabitEthernet 0&#x2F;0&#x2F;1 [S1-GigabitEthernet0&#x2F;0&#x2F;1]undo port trunk allow-pass vlan 2 3 [S1-GigabitEthernet0&#x2F;0&#x2F;1]undo port link-type [R1]undo interface GigabitEthernet 0&#x2F;0&#x2F;1.2 [R1]undo interface GigabitEthernet 0&#x2F;0&#x2F;1.3 # åœ¨S1ä¸Šåˆ›å»ºç›¸åº”çš„VLANIFæ¥å£ [S1]interface Vlanif 2 interface vlanif vlan-idå‘½ä»¤ç”¨æ¥åˆ›å»ºVLANIFæ¥å£å¹¶è¿›å…¥VLANIFæ¥å£è§†å›¾ã€‚åªæœ‰å…ˆé€šè¿‡å‘½ä»¤åˆ›å»ºVLANåï¼Œæ‰èƒ½æ‰§è¡Œinterface vlanifå‘½ä»¤åˆ›å»ºVLANIFæ¥å£ã€‚ [S1-Vlanif2]ip address 192.168.2.254 24 [S1-Vlanif2]quit [S1]interface Vlanif 3 [S1-Vlanif3]ip address 192.168.3.254 24 [S1-Vlanif3]quit # æ£€æµ‹VLANé—´äº’è®¿è”é€šæ€§ ping 192.168.3.1 PING 192.168.3.1: 56 data bytes, press CTRL_C to break Reply from 192.168.3.1: bytes&#x3D;56 Sequence&#x3D;1 ttl&#x3D;254 time&#x3D;100 ms Reply from 192.168.3.1: bytes&#x3D;56 Sequence&#x3D;2 ttl&#x3D;254 time&#x3D;50 ms Reply from 192.168.3.1: bytes&#x3D;56 Sequence&#x3D;3 ttl&#x3D;254 time&#x3D;50 ms Reply from 192.168.3.1: bytes&#x3D;56 Sequence&#x3D;4 ttl&#x3D;254 time&#x3D;60 ms Reply from 192.168.3.1: bytes&#x3D;56 Sequence&#x3D;5 ttl&#x3D;254 time&#x3D;70 ms â€” 192.168.3.1 ping statistics â€” 5 packet(s) transmitted 5 packet(s) received 0.00% packet loss round-trip min&#x2F;avg&#x2F;max &#x3D; 50&#x2F;66&#x2F;100 ms tracert 192.168.3.1 traceroute to 192.168.3.1(192.168.3.1), max hops: 30 ,packet length: 40,press CTRL_C to break 1 192.168.2.254 40 ms 30 ms 20 ms 2 192.168.3.1 40 ms 30 ms 40 ms æ­¤æ—¶VLAN2å’ŒVLAN3ä¹‹é—´å·²ç»å¯ä»¥æ­£å¸¸çš„äº’è®¿ã€‚","categories":[{"name":"ipå®éªŒ","slug":"ipå®éªŒ","permalink":"http://example.com/categories/ip%E5%AE%9E%E9%AA%8C/"}],"tags":[{"name":"vlané—´é€šä¿¡","slug":"vlané—´é€šä¿¡","permalink":"http://example.com/tags/vlan%E9%97%B4%E9%80%9A%E4%BF%A1/"},{"name":"dot1q","slug":"dot1q","permalink":"http://example.com/tags/dot1q/"},{"name":"vlanif","slug":"vlanif","permalink":"http://example.com/tags/vlanif/"}]}],"categories":[{"name":"åŸºç¡€çŸ¥è¯†","slug":"åŸºç¡€çŸ¥è¯†","permalink":"http://example.com/categories/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"},{"name":"ieå®éªŒ","slug":"ieå®éªŒ","permalink":"http://example.com/categories/ie%E5%AE%9E%E9%AA%8C/"},{"name":"ç»¼åˆå®éªŒ","slug":"ç»¼åˆå®éªŒ","permalink":"http://example.com/categories/%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/"},{"name":"ipå®éªŒ","slug":"ipå®éªŒ","permalink":"http://example.com/categories/ip%E5%AE%9E%E9%AA%8C/"}],"tags":[{"name":"æ•°é€šåŸºç¡€","slug":"æ•°é€šåŸºç¡€","permalink":"http://example.com/tags/%E6%95%B0%E9%80%9A%E5%9F%BA%E7%A1%80/"},{"name":"VRPç³»ç»Ÿ","slug":"VRPç³»ç»Ÿ","permalink":"http://example.com/tags/VRP%E7%B3%BB%E7%BB%9F/"},{"name":"ARP","slug":"ARP","permalink":"http://example.com/tags/ARP/"},{"name":"VRF","slug":"VRF","permalink":"http://example.com/tags/VRF/"},{"name":"STP","slug":"STP","permalink":"http://example.com/tags/STP/"},{"name":"RSTP","slug":"RSTP","permalink":"http://example.com/tags/RSTP/"},{"name":"MSTP","slug":"MSTP","permalink":"http://example.com/tags/MSTP/"},{"name":"vlan pool","slug":"vlan-pool","permalink":"http://example.com/tags/vlan-pool/"},{"name":"option 43","slug":"option-43","permalink":"http://example.com/tags/option-43/"},{"name":"æ¼«æ¸¸","slug":"æ¼«æ¸¸","permalink":"http://example.com/tags/%E6%BC%AB%E6%B8%B8/"},{"name":"VRRP","slug":"VRRP","permalink":"http://example.com/tags/VRRP/"},{"name":"SSH","slug":"SSH","permalink":"http://example.com/tags/SSH/"},{"name":"BGP","slug":"BGP","permalink":"http://example.com/tags/BGP/"},{"name":"IGMP","slug":"IGMP","permalink":"http://example.com/tags/IGMP/"},{"name":"PIM","slug":"PIM","permalink":"http://example.com/tags/PIM/"},{"name":"stpæ‹“æ‰‘å˜æ›´","slug":"stpæ‹“æ‰‘å˜æ›´","permalink":"http://example.com/tags/stp%E6%8B%93%E6%89%91%E5%8F%98%E6%9B%B4/"},{"name":"PPP","slug":"PPP","permalink":"http://example.com/tags/PPP/"},{"name":"PPPoE","slug":"PPPoE","permalink":"http://example.com/tags/PPPoE/"},{"name":"IS-IS","slug":"IS-IS","permalink":"http://example.com/tags/IS-IS/"},{"name":"ospf","slug":"ospf","permalink":"http://example.com/tags/ospf/"},{"name":"äº¤æ¢æœºå·¥ä½œåŸç†","slug":"äº¤æ¢æœºå·¥ä½œåŸç†","permalink":"http://example.com/tags/%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/"},{"name":"å­ç½‘åˆ’åˆ†","slug":"å­ç½‘åˆ’åˆ†","permalink":"http://example.com/tags/%E5%AD%90%E7%BD%91%E5%88%92%E5%88%86/"},{"name":"apä¸Šçº¿","slug":"apä¸Šçº¿","permalink":"http://example.com/tags/ap%E4%B8%8A%E7%BA%BF/"},{"name":"wlan","slug":"wlan","permalink":"http://example.com/tags/wlan/"},{"name":"USG5500","slug":"USG5500","permalink":"http://example.com/tags/USG5500/"},{"name":"é˜²ç«å¢™nat","slug":"é˜²ç«å¢™nat","permalink":"http://example.com/tags/%E9%98%B2%E7%81%AB%E5%A2%99nat/"},{"name":"rstp","slug":"rstp","permalink":"http://example.com/tags/rstp/"},{"name":"mstp","slug":"mstp","permalink":"http://example.com/tags/mstp/"},{"name":"é“¾è·¯èšåˆ","slug":"é“¾è·¯èšåˆ","permalink":"http://example.com/tags/%E9%93%BE%E8%B7%AF%E8%81%9A%E5%90%88/"},{"name":"lacp","slug":"lacp","permalink":"http://example.com/tags/lacp/"},{"name":"eth-trunk","slug":"eth-trunk","permalink":"http://example.com/tags/eth-trunk/"},{"name":"mpls","slug":"mpls","permalink":"http://example.com/tags/mpls/"},{"name":"hybrid","slug":"hybrid","permalink":"http://example.com/tags/hybrid/"},{"name":"tag","slug":"tag","permalink":"http://example.com/tags/tag/"},{"name":"telnet","slug":"telnet","permalink":"http://example.com/tags/telnet/"},{"name":"aaa","slug":"aaa","permalink":"http://example.com/tags/aaa/"},{"name":"FTP","slug":"FTP","permalink":"http://example.com/tags/FTP/"},{"name":"BFD","slug":"BFD","permalink":"http://example.com/tags/BFD/"},{"name":"BGPè·¯ç”±ä¼˜é€‰","slug":"BGPè·¯ç”±ä¼˜é€‰","permalink":"http://example.com/tags/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/"},{"name":"BGPè·¯ç”±åå°„å™¨","slug":"BGPè·¯ç”±åå°„å™¨","permalink":"http://example.com/tags/BGP%E8%B7%AF%E7%94%B1%E5%8F%8D%E5%B0%84%E5%99%A8/"},{"name":"è·¯ç”±ç­–ç•¥","slug":"è·¯ç”±ç­–ç•¥","permalink":"http://example.com/tags/%E8%B7%AF%E7%94%B1%E7%AD%96%E7%95%A5/"},{"name":"nat","slug":"nat","permalink":"http://example.com/tags/nat/"},{"name":"DHCP Relay","slug":"DHCP-Relay","permalink":"http://example.com/tags/DHCP-Relay/"},{"name":"DHCP","slug":"DHCP","permalink":"http://example.com/tags/DHCP/"},{"name":"vlané—´é€šä¿¡","slug":"vlané—´é€šä¿¡","permalink":"http://example.com/tags/vlan%E9%97%B4%E9%80%9A%E4%BF%A1/"},{"name":"dot1q","slug":"dot1q","permalink":"http://example.com/tags/dot1q/"},{"name":"vlanif","slug":"vlanif","permalink":"http://example.com/tags/vlanif/"}]}