{"meta":{"title":"æ²ƒå¾·å‘","subtitle":"ç›¸äº’å¹æ§ï¼Œå…±åŒè¿›æ­¥ğŸ˜ğŸ˜ğŸ˜","description":null,"author":"Yang","url":"http://example.com","root":"/"},"pages":[{"title":"categories","date":"2023-11-23T11:58:42.000Z","updated":"2023-11-23T11:59:22.023Z","comments":true,"path":"categories/index.html","permalink":"http://example.com/categories/index.html","excerpt":"","text":""},{"title":"tags","date":"2023-11-23T12:01:15.000Z","updated":"2023-11-23T12:04:24.284Z","comments":true,"path":"tags/index.html","permalink":"http://example.com/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"BGPå®éªŒ","slug":"BGPå®éªŒ","date":"2023-11-28T02:58:58.000Z","updated":"2023-11-28T07:45:03.915Z","comments":true,"path":"2023/11/28/BGPå®éªŒ/","permalink":"http://example.com/2023/11/28/BGP%E5%AE%9E%E9%AA%8C/","excerpt":"BGPåŸºç¡€å®éªŒè®¾å¤‡è¿æ¥æ–¹å¼ã€IPåœ°å€è§„åˆ’ã€BGP ASå·å¦‚å›¾æ‰€ç¤ºï¼Œæ‰€æœ‰è®¾å¤‡å‡åˆ›å»ºLoopback0æ¥å£ï¼ŒIPåœ°å€ä¸º10.0.x.x&#x2F;32ï¼Œå…¶ä¸­xä¸ºè®¾å¤‡ç¼–å·ï¼Œæ‰€æœ‰è®¾å¤‡éƒ½ä½¿ç”¨Loopback0æ¥å£IPåœ°å€ä½œä¸ºBGP Router IDã€‚R1ã€R5ä¸Šå­˜åœ¨Loopback1æ¨¡æ‹Ÿç”¨æˆ·ç½‘æ®µã€‚ R2ã€R3ã€R4ä¹‹é—´è¿è¡ŒOSPFï¼Œåœ¨R2ã€R3ã€R4çš„äº’è”æ¥å£ã€Loopback0æ¥å£ä¸Šæ¿€æ´»OSPFã€‚!","text":"BGPåŸºç¡€å®éªŒè®¾å¤‡è¿æ¥æ–¹å¼ã€IPåœ°å€è§„åˆ’ã€BGP ASå·å¦‚å›¾æ‰€ç¤ºï¼Œæ‰€æœ‰è®¾å¤‡å‡åˆ›å»ºLoopback0æ¥å£ï¼ŒIPåœ°å€ä¸º10.0.x.x&#x2F;32ï¼Œå…¶ä¸­xä¸ºè®¾å¤‡ç¼–å·ï¼Œæ‰€æœ‰è®¾å¤‡éƒ½ä½¿ç”¨Loopback0æ¥å£IPåœ°å€ä½œä¸ºBGP Router IDã€‚R1ã€R5ä¸Šå­˜åœ¨Loopback1æ¨¡æ‹Ÿç”¨æˆ·ç½‘æ®µã€‚ R2ã€R3ã€R4ä¹‹é—´è¿è¡ŒOSPFï¼Œåœ¨R2ã€R3ã€R4çš„äº’è”æ¥å£ã€Loopback0æ¥å£ä¸Šæ¿€æ´»OSPFã€‚! å®éªŒèƒŒæ™¯ä½ æ˜¯å…¬å¸çš„ç½‘ç»œç®¡ç†å‘˜ã€‚å…¬å¸çš„ç½‘ç»œé‡‡ç”¨äº†BGPåè®®ä½œä¸ºè·¯ç”±åè®®ã€‚å…¬å¸çš„ç½‘ç»œç”±å¤šä¸ªè‡ªæ²»ç³»ç»Ÿç»„æˆï¼Œä¸åŒçš„åˆ†æ”¯æœºæ„ä½¿ç”¨äº†ä¸åŒçš„ASå·ï¼Œç°åœ¨ä½ éœ€è¦å®Œæˆå…¬å¸ç½‘ç»œçš„æ­å»ºå·¥ä½œã€‚åœ¨å…¬å¸æ€»éƒ¨ä½¿ç”¨äº†OSPFä½œä¸ºIGPï¼Œå…¬å¸å†…éƒ¨ä¸åŒåˆ†æ”¯æœºæ„ä½¿ç”¨çš„æ˜¯ç§æœ‰çš„BGP ASå·ã€‚ 1.é…ç½®ipå¦‚æ‹“æ‰‘å›¾é…ç½®å„ä¸ªæ¥å£ipï¼Œå’Œloopback 0 ï¼š10.0.x.x r1 loopback 1 ï¼š10.1.1.1 24 r5 loopback 1 ï¼š10.1.5.5 24 r2 r3 r4é…ç½®ospfï¼šç•¥ 2.é…ç½®IBGPå¯¹ç­‰ä½“åœ¨R2ã€R3ã€R4ä¹‹é—´åŸºäºLoopback0æ¥å£å»ºç«‹å…¨äº’è”çš„IBGPå¯¹ç­‰ä½“å…³ç³»ã€‚ #R2ä¸Šé…ç½®BGP [R2]bgp 64512 [R2-bgp] router-id 10.0.2.2 [R2-bgp] peer 10.0.3.3 as-number 64512 [R2-bgp] peer 10.0.3.3 connect-interface LoopBack0 [R2-bgp] peer 10.0.4.4 as-number 64512 [R2-bgp] peer 10.0.4.4 connect-interface LoopBack0 #R3ä¸Šé…ç½®BGP [R3]bgp 64512 [R3-bgp] router-id 10.0.3.3 [R3-bgp] peer 10.0.2.2 as-number 64512 [R3-bgp] peer 10.0.2.2 connect-interface LoopBack0 [R3-bgp] peer 10.0.4.4 as-number 64512 [R3-bgp] peer 10.0.4.4 connect-interface LoopBack0 #R4ä¸Šé…ç½®BGP [R4]bgp 64512 [R4-bgp] peer 10.0.2.2 as-number 64512 [R4-bgp] peer 10.0.2.2 connect-interface LoopBack0 [R4-bgp] peer 10.0.3.3 as-number 64512 [R4-bgp] peer 10.0.3.3 connect-interface LoopBack0 #åˆ†åˆ«åœ¨R2ã€R3ã€R4ä¸Šæ£€æŸ¥BGPå¯¹ç­‰ä½“çŠ¶æ€ 3.é…ç½®EBGPå¯¹ç­‰ä½“ï¼ˆä¸€èˆ¬æƒ…å†µä½¿ç”¨ç›´è¿æ¥å£å»ºç«‹EBGpï¼‰ åœ¨R1ä¸R2ã€R4ä¸R5ä¹‹é—´åŸºäºLoopback0æ¥å£å»ºç«‹EBGPå¯¹ç­‰ä½“å…³ç³»ï¼Œä¸ºä¿è¯èƒ½å¤Ÿæ­£å¸¸å»ºç«‹ï¼Œåœ¨R1ã€R2ä¸Šé…ç½®é™æ€è·¯ç”±ä½¿Loopback0ä¹‹é—´è·¯ç”±å¯è¾¾ï¼ˆR4ã€R5åŒæ ·æ“ä½œï¼‰ã€‚ #åœ¨R1ã€R2ä¸Šé…ç½®é™æ€è·¯ç”± [R1]ip route-static 10.0.2.2 32 10.0.12.2 [R2]ip route-static 10.0.1.1 32 10.0.12.1 #åœ¨R4ã€R5ä¸Šé…ç½®é™æ€è·¯ç”± [R4]ip route-static 10.0.5.5 32 10.0.45.5 [R5]ip route-static 10.0.4.4 32 10.0.45.4 è¿™é‡Œé…ç½®é™æ€è·¯ç”±ï¼Œå› ä¸ºè¦å»ºç«‹TCPä¼šè¯çš„å‰æï¼Œéœ€è¦åœ¨æ•°æ®å±‚é¢ä¸¤è·¯ç”±å™¨ç›¸é€šï¼Œæ‰€ä»¥éœ€è¦éœ€è¦æ‰‹å·¥é…ç½®é™æ€è·¯ç”±ï¼Œå®ç°loopback 0 ä¹‹é—´äº’é€š #é…ç½®R1ã€R2ä¹‹é—´çš„EBGPå¯¹ç­‰ä½“ [R1]bgp 64513 [R1-bgp] router-id 10.0.1.1 [R1-bgp] peer 10.0.2.2 as-number 64512 [R1-bgp] peer 10.0.2.2 ebgp-max-hop 2 [R1-bgp] peer 10.0.2.2 connect-interface LoopBack0 [R2]bgp 64512 [R2-bgp] peer 10.0.1.1 as-number 64513 [R2-bgp] peer 10.0.1.1 ebgp-max-hop 2 [R2-bgp] peer 10.0.1.1 connect-interface LoopBack0 é»˜è®¤æƒ…å†µä¸‹ï¼ŒEBGPè¿æ¥å…è®¸çš„æœ€å¤§è·³æ•°ä¸º1ï¼Œè¿™å¯¼è‡´EBGPå¯¹ç­‰ä½“ä¹‹é—´åªèƒ½ä½¿ç”¨ç›´è¿é“¾è·¯å»ºç«‹EBGPå¯¹ç­‰ä½“å…³ç³»ï¼Œä¸ºä½¿ç”¨ç¯å›å£ä½œä¸ºæ›´æ–°æºéœ€è¦æ‰‹åŠ¨ä¿®æ”¹EBGPè¿æ¥å…è®¸çš„æœ€å¤§è·³æ•°ã€‚ #é…ç½®R4ã€R5ä¹‹é—´çš„EBGPå¯¹ç­‰ä½“ [R4]bgp 64512 [R4-bgp] peer 10.0.5.5 as-number 64514 [R4-bgp] peer 10.0.5.5 ebgp-max-hop 2 [R4-bgp] peer 10.0.5.5 connect-interface LoopBack0 [R5]bgp 64514 [R5-bgp] router-id 10.0.5.5 [R5-bgp] peer 10.0.4.4 as-number 64512 [R5-bgp] peer 10.0.4.4 ebgp-max-hop 2 [R5-bgp] peer 10.0.4.4 connect-interface LoopBack0 #åœ¨R1ã€R5ä¸Šæ£€æŸ¥EBGPå¯¹ç­‰ä½“çŠ¶æ€ 4.åœ¨BGPä¸­å‘å¸ƒè·¯ç”±åœ¨R1ã€R5ä¸Šå°†Loopback1æ¥å£è·¯ç”±å‘å¸ƒåˆ°BGP #åœ¨R1ã€R5ä¸Šé€šè¿‡networkå‘½ä»¤å‘å¸ƒè·¯ç”± [R1]bgp 64513 [R1-bgp] network 10.1.1.1 24 [R5]bgp 64514 [R5-bgp] network 10.1.5.5 24 åœ¨R3ä¸ŠæŸ¥çœ‹BGPè·¯ç”±è¡¨ å¯ä»¥çœ‹åˆ°æ­¤æ—¶R3ä¸Šå·²ç»å­¦ä¹ åˆ°R1ã€R5ä¸Šå‘å¸ƒçš„BGPè·¯ç”±ï¼Œä½†æ˜¯éƒ½æ˜¯éæœ‰æ•ˆè·¯ç”±ï¼Œè¿™æ˜¯å› ä¸ºå®ƒä»¬çš„ä¸‹ä¸€è·³åœ¨R3ä¸Šéƒ½ä¸å¯è¾¾ï¼Œä¸ºæ­¤å¯ä»¥åœ¨R2ã€R4ä¸Šé€šè¿‡next-hop-localå‘½ä»¤ä¿®æ”¹ä¸‹ä¸€è·³åœ°å€ä¸ºR2ã€R4çš„æ›´æ–°æºåœ°å€ã€‚ åŸå› ï¼šebgpå¯¹ç­‰ä½“åœ¨å‘é€æ•°æ®æ—¶ï¼Œä¸‹ä¸€è·³åœ°å€ä¸ºè‡ªèº«æ›´æ–°æºåœ°å€ï¼Œibgpæ”¶åˆ°ebgpå‘é€çš„æ•°æ®ï¼Œä¸‹ä¸€è·³ä¸å˜ #åœ¨R2ã€R4ä¸Šå°†è·¯ç”±çš„ä¸‹ä¸€è·³åœ°å€ä¿®æ”¹ä¸ºè‡ªèº« [R2]bgp 64512 [R2-bgp] peer 10.0.3.3 next-hop-local [R2-bgp] peer 10.0.4.4 next-hop-local [R4]bgp 64512 [R4-bgp] peer 10.0.2.2 next-hop-local [R4-bgp] peer 10.0.3.3 next-hop-local peer next-hop-localå‘½ä»¤ä¸€èˆ¬åœ¨ASBRä¸Šé…ç½®ã€‚å½“è®¾å¤‡é€šè¿‡EBGPé‚»å±…å­¦åˆ°è·¯ç”±å†è½¬å‘ç»™å…¶ä»–IBGPé‚»å±…æ—¶ï¼Œé»˜è®¤ä¸ä¿®æ”¹ä¸‹ä¸€è·³ï¼Œä½†å…¶EBGPé‚»å±…å‘æ¥çš„è·¯ç”±çš„ä¸‹ä¸€è·³éƒ½æ˜¯å…¶EBGPé‚»å±…çš„Peeråœ°å€ï¼Œæœ¬ç«¯å¯¹ç­‰ä½“æ‰€å±ASåŸŸå†…çš„IBGPé‚»å±…æ”¶åˆ°è¿™æ ·çš„è·¯ç”±åï¼Œç”±äºä¸‹ä¸€è·³ä¸å¯è¾¾å¯¼è‡´è·¯ç”±æ— æ³•æ´»è·ƒã€‚å› æ­¤ï¼Œéœ€è¦åœ¨ASBRä¸Šå¯¹IBGPé‚»å±…é…ç½®peer next-hop-localå‘½ä»¤ï¼Œä½¿å¾—å‘ç»™IBGPé‚»å±…çš„è·¯ç”±çš„ä¸‹ä¸€è·³æ˜¯å…¶è‡ªèº«çš„åœ°å€ï¼ŒIBGPé‚»å±…æ”¶åˆ°è¿™æ ·çš„è·¯ç”±åï¼ˆç”±äºåŸŸå†…éƒ½é…ç½®äº†IGPï¼‰å‘ç°ä¸‹ä¸€è·³å¯è¾¾ï¼Œè·¯ç”±å³ä¸ºæ´»è·ƒè·¯ç”±ã€‚ æ­¤å‘½ä»¤ä¸ºè¦†ç›–å¼å‘½ä»¤ã€‚ æ‰§è¡Œpeer next-hop-localå‘½ä»¤åï¼Œè®¾å¤‡å‘IBGPå¯¹ç­‰ä½“&#x2F;å¯¹ç­‰ä½“ç»„é€šå‘Šè·¯ç”±æ—¶ï¼ŒæŠŠä¸‹ä¸€è·³å±æ€§è®¾ä¸ºè‡ªèº«çš„IPåœ°å€ã€‚ peer next-hop-localå‘½ä»¤ä»…åº”ç”¨äºIBGPå¯¹ç­‰ä½“é—´ã€‚ å†æ¬¡r3ä¸ŠæŸ¥çœ‹bgpè·¯ç”±è¡¨ æ­¤æ—¶ä¸¤æ¡BGPè·¯ç”±éƒ½å˜æˆäº†æœ‰æ•ˆã€æœ€ä¼˜çš„çŠ¶æ€ã€‚ #åœ¨R1ã€R5ä¸ŠæŸ¥çœ‹BGPè·¯ç”±è¡¨ R1ã€R5ä¹‹é—´ç›¸äº’å­¦ä¹ åˆ°äº†å¯¹ç«¯Loopback1æ¥å£è·¯ç”±ã€‚ BGPè·¯ç”±æ±‡æ€»å®éªŒ BGP ASå·ã€äº’è”åœ°å€å¦‚å›¾æ‰€ç¤ºï¼Œæ‰€æœ‰è®¾å¤‡å‡åˆ›å»ºLoopback0æ¥å£ï¼ŒIPåœ°å€ä¸º10.0.x.x&#x2F;32ï¼Œå…¶ä¸­xä¸ºè®¾å¤‡ç¼–å·ã€‚ R1ã€R2ã€R3ä½¿ç”¨Loopback0åœ°å€ä½œä¸ºBGP Router IDï¼ŒåŸºäºç›´è¿æ¥å£å»ºç«‹EBGPå¯¹ç­‰ä½“å…³ç³»ã€‚ R1ã€R3ä¸Šå­˜åœ¨Loopback1ã€Loopback2æ¥å£ï¼Œç”¨äºæ¨¡æ‹Ÿç”¨æˆ·ç½‘æ®µã€‚ 1.é…ç½®ipç•¥ 2.é…ç½®EBGPdå¯¹ç­‰ä½“#é…ç½®R1 [R1]bgp 64511 [R1-bgp] router-id 10.0.1.1 [R1-bgp] peer 10.0.12.2 as-number 64512 #é…ç½®R2 #é…ç½®R3 [R3]bgp 64513 [R3-bgp] router-id 10.0.3.3 [R3-bgp] peer 10.0.23.2 as-number 64512 3.BGPè·¯ç”±è‡ªåŠ¨æ±‡æ€»åœ¨R1ä¸Šå¼€å¯BGPè·¯ç”±è‡ªåŠ¨æ±‡æ€»ï¼Œå°†Loopback1ã€Loopback2æ¥å£è·¯ç”±å‘å¸ƒåˆ°BGPä¸­ï¼Œå¹¶è¿›è¡Œè‡ªåŠ¨æ±‡æ€»ã€‚ #åˆ›å»ºIPå‰ç¼€åˆ—è¡¨1ï¼ŒåŒ¹é…Loopback1ã€Loopback2æ¥å£è·¯ç”± [R1]ip ip-prefix 1 permit 172.16.0.0 16 greater-equal 24 less-equal 24 #åˆ›å»ºRoute-Policy hcipï¼Œå¹¶åˆ›å»ºèŠ‚ç‚¹10ï¼Œåœ¨å…¶ä¸­è°ƒç”¨IPå‰ç¼€åˆ—è¡¨1 [R1]route-policy hcip permit node 10 [R1-route-policy] if-match ip-prefix 1 [R1-route-policy] quit [R1]bgp 64511 [R1-bgp] import-route direct route-policy hcip [R1-bgp] summary automatic Info: Automatic summarization is valid only for the routes imported through the import-route command. è‡ªåŠ¨æ±‡æ€»åªå¯¹é€šè¿‡import-routeå‘½ä»¤å¼•å…¥çš„è·¯ç”±ç”Ÿæ•ˆã€‚ #åœ¨R1ä¸ŠæŸ¥çœ‹BGPè·¯ç”±è¡¨ display bgp routing-table Loopback1ã€Loopback2æ¥å£è·¯ç”±å·²ç»å‘å¸ƒåˆ°BGPï¼Œç”±äºR1æ¿€æ´»äº†BGPè·¯ç”±è‡ªåŠ¨æ±‡æ€»ï¼Œå› æ­¤R1ä¼šå°†è¿™äº›è·¯ç”±æ±‡æ€»æˆ172.16.0.0&#x2F;16ï¼ŒåŒæ—¶æŠ‘åˆ¶æ‰€æœ‰çš„æ˜ç»†è·¯ç”±ï¼Œé€šè¿‡æ˜ç»†è·¯ç”±å‰çš„â€œsâ€æ ‡è®°å¯ä»¥çœ‹å‡ºï¼Œè¯¥æ ‡è®°çš„å«ä¹‰ä¸ºâ€œsuppressedâ€ï¼Œè¡¨ç¤ºè¢«æŠ‘åˆ¶ï¼Œæœ€ç»ˆR1åªå¯¹å¤–é€šå‘Šæ±‡æ€»è·¯ç”±172.16.0.0&#x2F;16ã€‚ #åœ¨R2ä¸ŠæŸ¥çœ‹BGPè·¯ç”±è¡¨ display bgp routing-table R2ä¸Šåªèƒ½çœ‹åˆ°ä¸€æ¡ä¸»ç±»è·¯ç”±172.16.0.0&#x2F;16ã€‚ #åœ¨R2ä¸ŠæŸ¥çœ‹BGPè·¯ç”±172.16.0.0çš„æ˜ç»†ä¿¡æ¯ display bgp routing-table 172.16.0.0 è¯¥è·¯ç”±çš„è·¯å¾„å±æ€§ä¸­å­˜åœ¨Aggregatorå±æ€§ï¼Œå…¶ä¸­æºå¸¦äº†æ±‡æ€»è·¯ç”±ç”Ÿæˆè®¾å¤‡æ‰€å±çš„ASå·ä»¥åŠå…¶Router ID 4.BGPè·¯ç”±æ‰‹åŠ¨æ±‡æ€»åœ¨R3ä¸Šå°†Loopback1ã€Loopback2æ¥å£è·¯ç”±å‘å¸ƒåˆ°BGPï¼Œåœ¨R2ä¸Šé€šè¿‡aggregateå‘½ä»¤æ‰§è¡Œæ‰‹åŠ¨æ±‡æ€»ï¼Œå¹¶æŠ‘åˆ¶æ˜ç»†è·¯ç”±çš„å¯¹å¤–å‘å¸ƒã€‚ #åˆ›å»ºIPå‰ç¼€åˆ—è¡¨1ï¼ŒåŒ¹é…Loopback1ã€Loopback2æ¥å£è·¯ç”± [R3]ip ip-prefix 1 permit 172.17.0.0 16 greater-equal 24 less-equal 24 #åˆ›å»ºRoute-Policy hcipï¼Œå¹¶åˆ›å»ºèŠ‚ç‚¹10ï¼Œåœ¨å…¶ä¸­è°ƒç”¨IPå‰ç¼€åˆ—è¡¨1 [R3]route-policy hcip permit node 10 [R3-route-policy] if-match ip-prefix 1 [R3-route-policy] quit #å°†Loopback1ã€Loopback2æ¥å£è·¯ç”±å‘å¸ƒåˆ°BGP [R3]bgp 64513 [R3-bgp] import-route direct route-policy hcip #æŸ¥çœ‹R2çš„BGPè·¯ç”±è¡¨ display bgp routing-table â€‹ åœ¨R2çš„BGPè·¯ç”±è¡¨ä¸­å·²ç»å­˜åœ¨R3é€šå‘Šçš„BGPè·¯ç”±172.17.1.0&#x2F;24ã€172.17.2.0&#x2F;24ã€‚ #R2ä¸Šæ‰§è¡Œæ‰‹åŠ¨è·¯ç”±æ±‡æ€»ï¼Œå°†172.17.1.0&#x2F;24ã€172.17.2.0&#x2F;24æ±‡æ€»æˆ172.17.0.0&#x2F;22ï¼Œå¹¶æŠ‘åˆ¶æ˜ç»†è·¯ç”±çš„å¯¹å¤–é€šå‘Š [R2]bgp 64512 [R2-bgp] aggregate 172.17.0.0 22 detail-suppressed #æŸ¥çœ‹R2çš„BGPè·¯ç”±è¡¨ display bgp routing-table â€‹ æ­¤æ—¶åœ¨R2çš„BGPè·¯ç”±è¡¨ä¸­å¯ä»¥çœ‹åˆ°æ±‡æ€»åçš„è·¯ç”±ã€‚ #åœ¨R2ä¸ŠæŸ¥çœ‹BGPè·¯ç”±172.16.0.0&#x2F;22çš„æ˜ç»†ä¿¡æ¯ display bgp routing-table 172.17.0.0 22 ä»è¾“å‡ºä¿¡æ¯å¯ä»¥çœ‹åˆ°AS_Pathå€¼ä¸ºNilï¼Œä»£è¡¨äº†AS_Pathå±æ€§å€¼ä¸ºç©ºï¼Œè¿™æ„å‘³ç€ä¸¢å¤±äº†æ˜ç»†çš„AS_Pathå±æ€§å€¼ï¼ŒBGPä¾èµ–AS_Pathå®ç°é˜²ç¯ï¼Œå› æ­¤AS_Pathå±æ€§çš„ä¸¢å¤±å¯èƒ½å¸¦æ¥è·¯ç”±ç¯è·¯ã€‚ä»è¯¥æ¡è·¯ç”±å¯¹å¤–é€šå‘Šçš„å¯¹ç­‰ä½“ä¸­å¯ä»¥çœ‹åˆ°10.0.23.3ï¼ˆR3)ã€‚ #æŸ¥çœ‹R3çš„BGPè·¯ç”±è¡¨ åœ¨R3çš„BGPè·¯ç”±è¡¨ä¸­å¯ä»¥çœ‹åˆ°æ±‡æ€»è·¯ç”±172.17.0.0&#x2F;22ã€‚ #ä¸ºé˜²æ­¢è·¯ç”±ç¯è·¯ï¼Œåœ¨R2ä¸Šæ‰§è¡Œæ‰‹åŠ¨æ±‡æ€»æ—¶å¢åŠ as-setå…³é”®å­— [R2]bgp 64512 [R2-bgp] aggregate 172.17.0.0 255.255.252.0 detail-suppressed as-set #å†æ¬¡åœ¨R2ä¸ŠæŸ¥çœ‹BGPè·¯ç”±172.17.0.0&#x2F;22çš„æ˜ç»†ä¿¡æ¯ å¯ä»¥çœ‹åˆ°æ­¤æ—¶AS_Pathå±æ€§å€¼ä¸º64513ï¼Œæ­¤æ—¶è¯¥æ¡è·¯ç”±ä¾æ—§å‘10.0.23.3ï¼ˆR3ï¼‰é€šå‘Šã€‚ R3æ”¶åˆ°å…³äº172.17.0.0&#x2F;22çš„é€šå‘Šä¹‹åï¼Œåœ¨AS_Pathä¸­å°†çœ‹åˆ°è‡ªèº«çš„ASå·ï¼ˆ64153ï¼‰ï¼Œå°†ä¼šå¿½ç•¥è¯¥è·¯ç”±é€šå‘Šã€‚æ­¤æ—¶R3çš„BGPè·¯ç”±è¡¨ä¸­æ— æ³•çœ‹åˆ°æ±‡æ€»è·¯ç”±172.17.0.0&#x2F;22ï¼Œå› æ­¤é€šè¿‡åœ¨æ‰‹åŠ¨è·¯ç”±æ±‡æ€»çš„é…ç½®ä¸­ä½¿ç”¨as-setå…³é”®å­—é¡ºåˆ©åœ°è§„é¿äº†è·¯ç”±ç¯è·¯çš„äº§ç”Ÿã€‚ BGPè·¯ç”±åå°„å™¨","categories":[{"name":"ipå®éªŒ","slug":"ipå®éªŒ","permalink":"http://example.com/categories/ip%E5%AE%9E%E9%AA%8C/"}],"tags":[{"name":"BGP","slug":"BGP","permalink":"http://example.com/tags/BGP/"}]},{"title":"è·¯ç”±ç­–ç•¥","slug":"è·¯ç”±ç­–ç•¥","date":"2023-11-26T12:36:59.000Z","updated":"2023-11-26T13:26:00.594Z","comments":true,"path":"2023/11/26/è·¯ç”±ç­–ç•¥/","permalink":"http://example.com/2023/11/26/%E8%B7%AF%E7%94%B1%E7%AD%96%E7%95%A5/","excerpt":"è®¾å¤‡äº’è”æ–¹å¼ã€äº’è”åœ°å€å¦‚å›¾æ‰€ç¤ºï¼Œæ‰€æœ‰è®¾å¤‡å‡åˆ›å»ºLoopback0ï¼Œå…¶IPåœ°å€ä¸º10.0.x.x&#x2F;32ï¼Œå…¶ä¸­xä¸ºè®¾å¤‡ç¼–å·ï¼ŒR1ã€R2ã€R3åœ¨äº’è”æ¥å£ã€Loopback0æ¥å£ä¸Šæ¿€æ´»OSPFã€‚ R3ã€R4å±äºIS-IS Area 49.0001ï¼Œä¸¤è€…éƒ½æ˜¯Level-1è·¯ç”±å™¨ï¼ŒR3ã€R4çš„ç³»ç»ŸIDé‡‡ç”¨0000.0000.000xæ ¼å¼ï¼Œå…¶ä¸­xä¸ºè®¾å¤‡ç¼–å·ã€‚","text":"è®¾å¤‡äº’è”æ–¹å¼ã€äº’è”åœ°å€å¦‚å›¾æ‰€ç¤ºï¼Œæ‰€æœ‰è®¾å¤‡å‡åˆ›å»ºLoopback0ï¼Œå…¶IPåœ°å€ä¸º10.0.x.x&#x2F;32ï¼Œå…¶ä¸­xä¸ºè®¾å¤‡ç¼–å·ï¼ŒR1ã€R2ã€R3åœ¨äº’è”æ¥å£ã€Loopback0æ¥å£ä¸Šæ¿€æ´»OSPFã€‚ R3ã€R4å±äºIS-IS Area 49.0001ï¼Œä¸¤è€…éƒ½æ˜¯Level-1è·¯ç”±å™¨ï¼ŒR3ã€R4çš„ç³»ç»ŸIDé‡‡ç”¨0000.0000.000xæ ¼å¼ï¼Œå…¶ä¸­xä¸ºè®¾å¤‡ç¼–å·ã€‚ R1ä¸Šå­˜åœ¨ä¸‰ä¸ªä¸šåŠ¡ç½‘æ®µAã€Bã€Cï¼ˆä½¿ç”¨Loopback1ã€2ã€3æ¥å£è·¯ç”±æ¨¡æ‹Ÿï¼‰ï¼Œåœ¨R1ä¸Šå°†ç›´è¿è·¯ç”±å¼•å…¥åˆ°OSPFï¼Œä½†æ˜¯OSPFåŸŸå†…çš„è·¯ç”±å™¨ä¸Šä¸éœ€è¦Cä¸šåŠ¡çš„è·¯ç”±ï¼Œä¸ºæ­¤åœ¨R1ä¸Šå¼•å…¥ç›´è¿è·¯ç”±æ—¶é€šè¿‡Route-Policyè¿‡æ»¤å¼•å…¥çš„è·¯ç”±ã€‚ R2ä¸Šä¸éœ€è¦Aä¸šåŠ¡ç½‘æ®µçš„è·¯ç”±ï¼Œä½†æ˜¯R3ä¸Šéœ€è¦Aã€Bä¸šåŠ¡ç½‘æ®µçš„è·¯ç”±ï¼Œä¸ºæ­¤åœ¨R2ä¸Šé…ç½®Filter-Policyå¯¹OSPFæ¥æ”¶çš„è·¯ç”±è¿›è¡Œè¿‡æ»¤ã€‚ IS-ISåŸŸå†…çš„è·¯ç”±å™¨éœ€è¦è®¿é—®Aä¸šåŠ¡ï¼Œå› æ­¤éœ€è¦åœ¨R3ä¸Šæ‰§è¡Œè·¯ç”±é‡åˆ†å‘ï¼Œå°†OSPFè·¯ç”±å¼•å…¥åˆ°IS-ISï¼Œä½†æ˜¯IS-ISåŸŸå†…çš„è·¯ç”±å™¨ä¸éœ€è¦è®¿é—®Bä¸šåŠ¡ï¼Œä¸ºæ­¤åœ¨R1ä¸Šå¼•å…¥ç›´è¿è·¯ç”±æ—¶ä¸ºAã€Bä¸šåŠ¡ç½‘æ®µè·¯ç”±æ‰“ä¸Šä¸åŒçš„è·¯ç”±æ ‡è®°ï¼ŒR3ä¸Šæ‰§è¡Œé‡åˆ†å‘æ—¶æ ¹æ®è·¯ç”±æ ‡è®°è¿‡æ»¤Bä¸šåŠ¡ç½‘æ®µè·¯ç”±ã€‚ ä»»åŠ¡æ€è·¯ è®¾å¤‡åŸºç¡€IPåœ°å€é…ç½®ã€‚ é…ç½®R1ã€R2ã€R3ä¹‹é—´çš„OSPFï¼Œåœ¨äº’è”æ¥å£ã€Loopback0æ¥å£ä¸Šæ¿€æ´»OSPFã€‚åœ¨R3ã€R4ä¹‹é—´é…ç½®IS-ISã€‚ åœ¨R1ä¸Šå°†ç›´è¿è·¯ç”±å¼•å…¥åˆ°OSPFä¸­ï¼ŒåŒæ—¶é…ç½®è·¯ç”±ç­–ç•¥ä¸å¼•å…¥Cä¸šåŠ¡ç½‘æ®µçš„è·¯ç”±ï¼Œå°†Aã€Bä¸šåŠ¡ç½‘æ®µè·¯ç”±åˆ†åˆ«æ‰“ä¸Šè·¯ç”±æ ‡è®°10ã€20ã€‚ åœ¨R2ä¸Šé…ç½®Filter-Policyå¯¹æ¥æ”¶çš„OSPFè·¯ç”±è¿›è¡Œè¿‡æ»¤ï¼Œåªæ¥æ”¶Bä¸šåŠ¡ç½‘æ®µçš„è·¯ç”±ã€‚ åœ¨R3ä¸Šå°†OSPFè·¯ç”±å¼•å…¥åˆ°IS-ISä¸­ï¼Œé€šè¿‡Route-PolicyåŒ¹é…è·¯ç”±æ ‡è®°ï¼Œåªå¼•å…¥Aä¸šåŠ¡ç½‘æ®µçš„OSPFå¤–éƒ¨è·¯ç”±ã€‚ 1.é…ç½®ip#é…ç½®R1çš„GE0&#x2F;0&#x2F;2ã€Loopback0æ¥å£IPåœ°å€ [R1]interface GigabitEthernet0&#x2F;0&#x2F;2 [R1-GigabitEthernet0&#x2F;0&#x2F;2] ip address 10.0.12.1 255.255.255.0 [R1-GigabitEthernet0&#x2F;0&#x2F;2] quit [R1]interface LoopBack0 [R1-LoopBack0] ip address 10.0.1.1 255.255.255.255 [R1-LoopBack0] quit #åœ¨R1ä¸Šåˆ›å»ºå¤šä¸ªç¯å›å£ï¼Œç”¨äºæ¨¡æ‹Ÿä¸šåŠ¡ç½‘æ®µAã€Bã€C [R1]interface LoopBack1 [R1-LoopBack1] ip address 172.16.1.1 255.255.255.0 [R1-LoopBack1] quit [R1]interface LoopBack2 [R1-LoopBack2] ip address 172.16.2.1 255.255.255.0 [R1-LoopBack2] quit [R1]interface LoopBack3 [R1-LoopBack3] ip address 172.16.3.1 255.255.255.0 [R1-LoopBack3] quit #é…ç½®R2çš„GE0&#x2F;0&#x2F;2ã€GE0&#x2F;0&#x2F;3ã€Loopback0æ¥å£IPåœ°å€ [R2]interface LoopBack0 [R2-LoopBack0] ip address 10.0.2.2 255.255.255.255 [R2-LoopBack0] quit [R2]interface GigabitEthernet0&#x2F;0&#x2F;2 [R2-GigabitEthernet0&#x2F;0&#x2F;2] ip address 10.0.23.2 255.255.255.0 [R2-GigabitEthernet0&#x2F;0&#x2F;2] quit [R2]interface GigabitEthernet0&#x2F;0&#x2F;3 [R2-GigabitEthernet0&#x2F;0&#x2F;3] ip address 10.0.12.2 255.255.255.0 [R2-GigabitEthernet0&#x2F;0&#x2F;3] quit #é…ç½®R3çš„GE0&#x2F;0&#x2F;2ã€GE0&#x2F;0&#x2F;3ã€Loopback0æ¥å£IPåœ°å€ [R3]interface LoopBack0 [R3-LoopBack0] ip address 10.0.3.3 255.255.255.255 [R3-LoopBack0] quit [R3]interface GigabitEthernet0&#x2F;0&#x2F;2 [R3-GigabitEthernet0&#x2F;0&#x2F;2] ip address 10.0.34.3 255.255.255.0 [R3-GigabitEthernet0&#x2F;0&#x2F;2] quit [R3]interface GigabitEthernet0&#x2F;0&#x2F;3 [R3-GigabitEthernet0&#x2F;0&#x2F;3] ip address 10.0.23.3 255.255.255.0 [R3-GigabitEthernet0&#x2F;0&#x2F;3] quit #é…ç½®R4çš„GE0&#x2F;0&#x2F;3ã€Loopback0æ¥å£IPåœ°å€ [R4]interface GigabitEthernet0&#x2F;0&#x2F;3 [R4-GigabitEthernet0&#x2F;0&#x2F;3] ip address 10.0.34.4 255.255.255.0 [R4-GigabitEthernet0&#x2F;0&#x2F;3] quit [R4]interface LoopBack0 [R4-LoopBack0] ip address 10.0.4.4 255.255.255.255 [R4-LoopBack0] quit #åœ¨R2ã€R4ä¸Šæ£€æŸ¥IPåœ°å€è¿é€šæ€§ 2.é…ç½®ospfå’Œisis#é…ç½®R1 [R1]ospf 1 router-id 10.0.1.1 [R1-ospf-1] area 0 [R1-ospf-1-area-0.0.0.0] network 10.0.1.1 0.0.0.0 [R1-ospf-1-area-0.0.0.0] network 10.0.12.1 0.0.0.0 [R1-ospf-1-area-0.0.0.0] quit [R1-ospf-1] quit #é…ç½®R2 [R2]ospf 1 router-id 10.0.2.2 [R2-ospf-1] area 0.0.0.0 [R2-ospf-1-area-0.0.0.0] network 10.0.2.2 0.0.0.0 [R2-ospf-1-area-0.0.0.0] network 10.0.12.2 0.0.0.0 [R2-ospf-1-area-0.0.0.0] network 10.0.23.2 0.0.0.0 [R2-ospf-1-area-0.0.0.0] quit [R2-ospf-1] quit #é…ç½®R3 [R3]ospf 1 router-id 10.0.3.3 [R3-ospf-1] area 0.0.0.0 [R3-ospf-1-area-0.0.0.0] network 10.0.3.3 0.0.0.0 [R3-ospf-1-area-0.0.0.0] network 10.0.23.3 0.0.0.0 [R3-ospf-1-area-0.0.0.0] quit [R3-ospf-1] quit #åœ¨R2ä¸Šæ£€æŸ¥OSPFé‚»å±…çš„æ¦‚è¦ä¿¡æ¯ R3ã€R4ä¸Šé…ç½®IS-ISï¼ŒåŒºåŸŸä¸º49.0001ï¼Œç³»ç»ŸIDé‡‡ç”¨0000.0000.000xæ ¼å¼ï¼ˆxä¸ºè®¾å¤‡ç¼–å·ï¼‰ï¼Œä¸¤å°è®¾å¤‡éƒ½ä¸ºLevel-1è·¯ç”±å™¨ï¼Œåœ¨äº’è”æ¥å£ã€R4çš„Loopback0æ¥å£ä¸Šæ¿€æ´»IS-ISã€‚ #é…ç½®R3 [R3]isis 1 [R3-isis-1] is-level level-1 [R3-isis-1] network-entity 49.0001.0000.0000.0003.00 [R3-isis-1] quit [R3]interface GigabitEthernet0&#x2F;0&#x2F;2 [R3-GigabitEthernet0&#x2F;0&#x2F;2] isis enable 1 [R3-GigabitEthernet0&#x2F;0&#x2F;2] quit #é…ç½®R4 [R4]isis 1 [R4-isis-1] is-level level-1 [R4-isis-1] network-entity 49.0001.0000.0000.0004.00 [R4-isis-1] quit [R4]interface GigabitEthernet0&#x2F;0&#x2F;3 [R4-GigabitEthernet0&#x2F;0&#x2F;3] isis enable 1 [R4-GigabitEthernet0&#x2F;0&#x2F;3] quit [R4]interface LoopBack 0 [R4-LoopBack0] isis enable 1 [R4-LoopBack0] quit #åœ¨R3ä¸Šæ£€æŸ¥IS-ISé‚»å±…çŠ¶æ€ 3.åœ¨R1ä¸Šå¼•å…¥ç›´è¿è·¯ç”±åœ¨R1ä¸Šå°†ç›´è¿è·¯ç”±å¼•å…¥åˆ°OSPFä¸­ï¼ŒåŒæ—¶é…ç½®è·¯ç”±ç­–ç•¥è¿‡æ»¤Cä¸šåŠ¡ç½‘æ®µï¼Œå°†Aã€Bä¸šåŠ¡ç½‘æ®µè·¯ç”±åˆ†åˆ«æ‰“ä¸Šè·¯ç”±æ ‡è®°10ã€20ã€‚ #åˆ›å»ºIPå‰ç¼€åˆ—è¡¨1ï¼ŒåŒ¹é…Loopback1æ¥å£è·¯ç”±ï¼ˆAä¸šåŠ¡ç½‘æ®µï¼‰ [R1]ip ip-prefix 1 index 10 permit 172.16.1.0 24 greater-equal 24 less-equal 24 #åˆ›å»ºIPå‰ç¼€åˆ—è¡¨2ï¼ŒåŒ¹é…Loopback2æ¥å£è·¯ç”±ï¼ˆBä¸šåŠ¡ç½‘æ®µï¼‰ [R1]ip ip-prefix 2 index 10 permit 172.16.2.0 24 greater-equal 24 less-equal 24 #åˆ›å»ºRoute-Policy hcipï¼Œå¹¶åˆ›å»ºèŠ‚ç‚¹10ã€20ï¼Œåˆ†åˆ«è°ƒç”¨IPå‰ç¼€åˆ—è¡¨1ã€2ï¼Œæ‰“ä¸Šè·¯ç”±æ ‡è®° [R1]route-policy hcip permit node 10 [R1-route-policy] if-match ip-prefix 1 [R1-route-policy] apply tag 10 [R1-route-policy] quit [R1]route-policy hcip permit node 20 [R1-route-policy] if-match ip-prefix 2 [R1-route-policy] apply tag 20 [R1-route-policy] quit #åœ¨R1çš„OSPFä¸­å¼•å…¥ç›´è¿è·¯ç”±ï¼Œè°ƒç”¨Route-Policy hcip [R1]ospf 1 [R1-ospf-1] import-route direct route-policy hcip r1ä¸ŠæŸ¥çœ‹ospf lsdbï¼ŒLoopback1ã€2æ¥å£è·¯ç”±å·²ç»è¢«æˆåŠŸå¼•å…¥OSPFä¸­ã€‚ #åœ¨R1ä¸ŠæŸ¥çœ‹OSPF LSDBä¸­AS-external LSA 172.16.1.0çš„ç›¸å…³ä¿¡æ¯ [R1]display ospf lsdb ase 172.16.1.0 â€‹ OSPF Process 1 with Router ID 10.0.1.1 â€‹ Link State Database Type : External Ls id : 172.16.1.0 Adv rtr : 10.0.1.1 Ls age : 165 Len : 36 Options : E seq# : 80000001 chksum : 0xa954 Net mask : 255.255.255.0 TOS 0 Metric: 1 E type : 2 Forwarding Address : 0.0.0.0 Tag : 10 Priority : Low å¤–éƒ¨è·¯ç”±172.16.1.0&#x2F;24å·²ç»è¢«æ‰“ä¸ŠTag 10ã€‚ #åœ¨R1ä¸ŠæŸ¥çœ‹OSPF LSDBä¸­AS-external LSA 172.16.2.0çš„ç›¸å…³ä¿¡æ¯ [R1]display ospf lsdb ase 172.16.2.0 â€‹ OSPF Process 1 with Router ID 10.0.1.1 â€‹ Link State Database Type : External Ls id : 172.16.2.0 Adv rtr : 10.0.1.1 Ls age : 355 Len : 36 Options : E seq# : 80000001 chksum : 0x539f Net mask : 255.255.255.0 TOS 0 Metric: 1 E type : 2 Forwarding Address : 0.0.0.0 Tag : 20 Priority : Low å¤–éƒ¨è·¯ç”±172.16.2.0&#x2F;24å·²ç»è¢«æ‰“ä¸ŠTag 20ã€‚ 4.åœ¨R2ä¸Šé…ç½®è¿‡æ»¤ç­–ç•¥åœ¨R2ä¸Šé…ç½®Filter-Policyå¯¹æ¥æ”¶çš„OSPFè·¯ç”±è¿›è¡Œè¿‡æ»¤ï¼Œåªæ¥æ”¶Bä¸šåŠ¡ç½‘æ®µçš„è·¯ç”±ã€‚ #æŸ¥çœ‹é…ç½®Filter-Policyå‰çš„OSPFè·¯ç”±è¡¨ display ospf routing #æŸ¥çœ‹é…ç½®Filter-Policyå‰çš„IPè·¯ç”±è¡¨ä¸­çš„OSPFè·¯ç”± display ip routing-table protocol ospf åœ¨OSPFè·¯ç”±è¡¨ä»¥åŠIPè·¯ç”±è¡¨ä¸­éƒ½å¯ä»¥çœ‹åˆ°OSPFå¤–éƒ¨è·¯ç”±172.16.1.0&#x2F;24ã€172.16.2.0&#x2F;24ã€‚ #é…ç½®åŸºç¡€ACL [R2]acl number 2000 [R2-acl-basic-2000] rule 5 deny source 172.16.1.0 0.0.0.255 [R2-acl-basic-2000] rule 10 permit #åœ¨OSPFä¸­éƒ¨ç½²å…¥æ–¹å‘çš„Filter-Policyï¼Œè°ƒç”¨ACL 2000 [R2]ospf 1 [R2-ospf-1] filter-policy 2000 import #æŸ¥çœ‹é…ç½®Filter-Policyåçš„OSPFè·¯ç”±è¡¨ dis ospf routing å‘ç°ä¸¤æ¡å¤–éƒ¨è·¯ç”±éƒ½è¿˜å­˜åœ¨ #æŸ¥çœ‹é…ç½®Filter-Policyåçš„IPè·¯ç”±è¡¨ä¸­çš„OSPFè·¯ç”± display ip routing-table protocol ospf åœ¨IPè·¯ç”±è¡¨ä¸­è·¯ç”±172.16.2.0&#x2F;24å·²ç»ä¸å­˜åœ¨ï¼Œä½†æ˜¯åœ¨OSPFè·¯ç”±è¡¨ä¸­ä¾æ—§å­˜åœ¨ã€‚è¿™éªŒè¯äº†å¯¹äºOSPFï¼ŒFilter-Policyåªæ˜¯é™åˆ¶è·¯ç”±åŠ å…¥IPè·¯ç”±è¡¨ï¼Œä¸å½±å“æœ¬åœ°çš„LSDBä»¥åŠLSAçš„ä¼ é€’ã€‚ #åœ¨R3ä¸ŠæŸ¥çœ‹IPè·¯ç”±è¡¨ä¸­çš„OSPFè·¯ç”± display ip routing-table protocol ospf R3çš„IPè·¯ç”±è¡¨ä¸­OSPFå¤–éƒ¨è·¯ç”±172.16.1.0&#x2F;24ã€172.16.2.0&#x2F;24ä¾æ—§å­˜åœ¨ã€‚ 5.åœ¨R3ä¸Šå°†OSPFè·¯ç”±å¼•å…¥åˆ°IS-ISåœ¨R3ä¸Šå°†OSPFè·¯ç”±å¼•å…¥åˆ°IS-ISä¸­ï¼Œé€šè¿‡Route-PolicyåŒ¹é…è·¯ç”±æ ‡è®°ï¼Œåªå¼•å…¥Aä¸šåŠ¡ç½‘æ®µçš„OSPFå¤–éƒ¨è·¯ç”±ã€‚ #åˆ›å»ºRoute-Policy hcip [R3]route-policy hcip permit node 10 [R3-route-policy] if-match tag 10 [R3-route-policy] quit #åœ¨IS-ISä¸­å¼•å…¥OSPFè·¯ç”±ï¼Œè°ƒç”¨Route-Policy hcipåªå¼•å…¥Aä¸šåŠ¡ç½‘æ®µçš„OSPFå¤–éƒ¨è·¯ç”± [R3]isis 1 [R3-isis-1] import-route ospf 1 level-1 route-policy hcip ï¼ˆæ³¨æ„æŒ‡å®šlevelï¼‰ #æŸ¥çœ‹R3çš„IS-ISè·¯ç”±è¡¨ display isis route Level-1çš„è·¯ç”±é‡åˆ†å‘è¡¨ä¸­åªæœ‰172.16.1.0&#x2F;24ã€‚","categories":[{"name":"ipå®éªŒ","slug":"ipå®éªŒ","permalink":"http://example.com/categories/ip%E5%AE%9E%E9%AA%8C/"}],"tags":[{"name":"è·¯ç”±ç­–ç•¥","slug":"è·¯ç”±ç­–ç•¥","permalink":"http://example.com/tags/%E8%B7%AF%E7%94%B1%E7%AD%96%E7%95%A5/"}]},{"title":"natå®éªŒ","slug":"natå®éªŒ","date":"2023-11-25T12:41:12.000Z","updated":"2023-11-25T13:54:42.229Z","comments":true,"path":"2023/11/25/natå®éªŒ/","permalink":"http://example.com/2023/11/25/nat%E5%AE%9E%E9%AA%8C/","excerpt":"é™æ€naté™æ€NATå®ç°äº†ç§æœ‰åœ°å€å’Œå…¬æœ‰åœ°å€çš„ä¸€å¯¹ä¸€æ˜ å°„ã€‚å¦‚æœå¸Œæœ›ä¸€å°ä¸»æœºä¼˜å…ˆä½¿ç”¨æŸä¸ªå…³è”åœ°å€ï¼Œæˆ–è€…æƒ³è¦å¤–éƒ¨ç½‘ç»œä½¿ç”¨ä¸€ä¸ªæŒ‡å®šçš„å…¬ç½‘åœ°å€è®¿é—®å†…éƒ¨æœåŠ¡å™¨æ—¶ï¼Œå¯ä»¥ä½¿ç”¨é™æ€NATã€‚ä½†æ˜¯åœ¨å¤§å‹ç½‘ç»œä¸­ï¼Œè¿™ç§ä¸€å¯¹ä¸€çš„IPåœ°å€æ˜ å°„æ— æ³•ç¼“è§£å…¬ç”¨åœ°å€çŸ­ç¼ºçš„é—®é¢˜ã€‚","text":"é™æ€naté™æ€NATå®ç°äº†ç§æœ‰åœ°å€å’Œå…¬æœ‰åœ°å€çš„ä¸€å¯¹ä¸€æ˜ å°„ã€‚å¦‚æœå¸Œæœ›ä¸€å°ä¸»æœºä¼˜å…ˆä½¿ç”¨æŸä¸ªå…³è”åœ°å€ï¼Œæˆ–è€…æƒ³è¦å¤–éƒ¨ç½‘ç»œä½¿ç”¨ä¸€ä¸ªæŒ‡å®šçš„å…¬ç½‘åœ°å€è®¿é—®å†…éƒ¨æœåŠ¡å™¨æ—¶ï¼Œå¯ä»¥ä½¿ç”¨é™æ€NATã€‚ä½†æ˜¯åœ¨å¤§å‹ç½‘ç»œä¸­ï¼Œè¿™ç§ä¸€å¯¹ä¸€çš„IPåœ°å€æ˜ å°„æ— æ³•ç¼“è§£å…¬ç”¨åœ°å€çŸ­ç¼ºçš„é—®é¢˜ã€‚ é™æ€NATå®ç°äº†ç§æœ‰åœ°å€å’Œå…±æœ‰åœ°å€ä¸€å¯¹ä¸€çš„æ˜ å°„ï¼ˆä¸€ä¸ªç§æœ‰åœ°å€å¯¹åº”ä¸€ä¸ªå…±æœ‰åœ°å€ï¼‰ï¼Œå¹¶æ²¡æœ‰åšåˆ°ç¼“è§£åœ°å€çŸ­ç¼ºçš„é—®é¢˜ï¼Œåªæ˜¯åšåˆ°äº†åœ°å€è½¬æ¢ã€‚ ä¸€ä¸ªå…¬ç½‘åœ°å€åªä¼šåˆ†é…ç»™å”¯ä¸€ä¸”å›ºå®šçš„å†…ç½‘åœ°å€ å¦‚å›¾é…ç½®ipåœ°å€å’Œç½‘å…³ r1ä¸Šé…ç½®é™æ€natï¼ˆæ³¨æ„æ˜¯åœ¨å…¬ç½‘çš„æ¥å£ä¸Šï¼Œå‡ºæ¥å£ï¼‰ æ³¨æ„é…ç½®ä¸€æ¡é™æ€è·¯ç”±ï¼Œä¸ç„¶æ²¡æœ‰è·¯ç”±çš„ä¸‹ä¸€è·³ä¼šè¢«ä¸¢å¼ƒ åœ¨r1ä¸ŠæŸ¥çœ‹natæ˜ å°„å…³ç³»ï¼šdis nat static éªŒè¯ä¸€ä¸‹ï¼š å‘ç°å»å¾€2.2.2.2çš„æºåœ°å€å˜ä¸º2.2.2.3ï¼Œè¯´æ˜natå®Œæˆè½¬æ¢ã€‚ é™æ€natä¸¤ç§é…ç½®æ–¹å¼ï¼š 1.æ¥å£ä¸‹ï¼ˆä¸Šè¿°å®éªŒé‡‡ç”¨è¿™ç§æ–¹å¼ï¼‰ï¼šè¿›å…¥åˆ°è¿æ¥å¤–ç½‘è·¯ç”±å™¨çš„å‡ºæ¥å£ä¸‹ï¼Œç„¶ååœ¨æ¥å£è§†å›¾ä¸‹é…ç½®natæ˜ å°„å…³ç³» 2.å…¨å±€ï¼šåœ¨å…¨å±€è§†å›¾ä¸‹ï¼Œé…ç½®å¥½natæ˜ å°„å…³ç³»ï¼Œå†è¿›å…¥åˆ°å‡ºæ¥å£ï¼Œæ‰§è¡Œï¼šnat static enable åŠ¨æ€natåŠ¨æ€NATé€šè¿‡ä½¿ç”¨åœ°å€æ± æ¥å®ç°ã€‚ å¦‚ä¸Šå›¾ï¼Œå½“å†…éƒ¨ä¸»æœºAå’Œä¸»æœºBéœ€è¦ä¸å…¬ç½‘ä¸­çš„ç›®çš„ä¸»æœºé€šä¿¡æ—¶ï¼Œç½‘å…³RTAä¼šä»é…ç½®çš„å…¬ç½‘åœ°å€æ± ä¸­é€‰æ‹©ä¸€ä¸ªæœªä½¿ç”¨çš„å…¬ç½‘åœ°å€ä¸ä¹‹åšæ˜ å°„ã€‚æ¯å°ä¸»æœºéƒ½ä¼šåˆ†é…åˆ°åœ°å€æ± ä¸­çš„ä¸€ä¸ªå”¯ä¸€åœ°å€ã€‚å½“ä¸éœ€è¦æ­¤è¿æ¥æ—¶ï¼Œå¯¹åº”çš„åœ°å€æ˜ å°„å°†ä¼šè¢«åˆ é™¤ï¼Œå…¬ç½‘åœ°å€ä¹Ÿä¼šè¢«æ¢å¤åˆ°åœ°å€æ± ä¸­å¾…ç”¨ã€‚å½“ç½‘å…³æ”¶åˆ°å›å¤æŠ¥æ–‡åï¼Œä¼šæ ¹æ®ä¹‹å‰çš„æ˜ å°„å†æ¬¡è¿›è¡Œè½¬æ¢ä¹‹åè½¬å‘ç»™å¯¹åº”ä¸»æœºã€‚ æ³¨æ„ï¼š åŠ¨æ€NATå®é™…ä¸Šå®ç°çš„è¿˜æ˜¯ç§æœ‰åœ°å€å’Œå…¬æœ‰åœ°å€ä¸€å¯¹ä¸€çš„å…³ç³»ï¼Œä½†æ˜¯å…±æœ‰åœ°å€ä¸å†ç»‘å®šç»™ç‰¹å®šçš„å†…ç½‘åœ°å€ã€‚å®ç°äº†ä¸€å®šç¨‹åº¦çš„ç¼“è§£åœ°å€çŸ­ç¼ºé—®é¢˜ã€‚åŠ¨æ€NATåœ°å€æ± ä¸­çš„åœ°å€ç”¨å°½ä»¥åï¼Œåªèƒ½ç­‰å¾…è¢«å ç”¨çš„å…¬ç”¨IPè¢«é‡Šæ”¾åï¼Œå…¶ä»–ä¸»æœºæ‰èƒ½ä½¿ç”¨å®ƒæ¥è®¿é—®å…¬ç½‘ã€‚ åŠ¨æ€NATè½¬æ¢æµç¨‹ï¼š1ï¼‰è·¯ç”±å™¨ä¸Šé…ç½®ä¸€ä¸ªå†…éƒ¨åœ°å€æ± ï¼ˆå…¬å¸å†…éƒ¨æ‰€æœ‰ä¸»æœºç”¨åˆ°çš„ç§æœ‰IPï¼‰åŠ¨æ€æ˜ å°„ä¸€ä¸ªå¤–éƒ¨åœ°å€æ± ï¼ˆæ‰€è´­ä¹°çš„å…¬æœ‰IPï¼‰ã€‚2ï¼‰å½“æœ‰ä¸€ä¸ªå†…ç½‘ä¸»æœºè®¿é—®å¤–ç½‘æ—¶ï¼Œè·¯ç”±å™¨é¦–å…ˆæŸ¥çœ‹NATåœ°å€è½¬æ¢è¡¨ï¼›3ï¼‰è‹¥æ— ï¼Œåˆ™å†æŸ¥çœ‹æ˜¯å¦é…ç½®äº†åŠ¨æ€NATæ˜ å°„ï¼Œè‹¥é…ç½®ï¼Œåˆ™å°†IPåŒ…å¤´ä¸­çš„æºIPä¸å†…éƒ¨åœ°å€æ± è¿›è¡ŒåŒ¹é…ï¼Œè‹¥æœ‰åŒ¹é…é¡¹ï¼Œåˆ™å°†è¯¥å†…ç½‘IPä»å†…éƒ¨åœ°å€æ± ä¸­å–å‡ºï¼ŒåŒæ—¶å–å‡ºå¤–éƒ¨åœ°å€æ± ä¸­çš„ä¸€ä¸ªIPåœ°å€ï¼ŒåŠ¨æ€å½¢æˆNATåœ°å€è½¬æ¢è¡¨ã€‚æ³¨æ„ï¼Œå¤–éƒ¨åœ°å€æ± çš„å…¬ç½‘IPåœ°å€å–å‡ºåï¼Œå¤–éƒ¨åœ°å€æ± ä¸­å°†æ²¡æœ‰è¯¥å…¬ç½‘IPäº†ã€‚4ï¼‰é»˜è®¤å½“è¯¥ä¸»æœº24å°æ—¶æ²¡æœ‰è”ç³»å¤–ç½‘æ—¶ï¼Œè¯¥åŠ¨æ€NATæ¡ç›®ä¼šè‡ªåŠ¨æ¶ˆå¤±ï¼Œæ‰€è¢«å–å‡ºçš„å…¬ç§æœ‰åœ°å€é‡æ–°å›åˆ°åœ°å€æ± ä¸­ã€‚ ipå¦‚å›¾ï¼Œpcçš„ç½‘å…³192.168.1.254 r1ä¸Šé…ç½®é»˜è®¤è·¯ç”±ï¼Œip route-static 0.0.0.0 0 172.16.1.2 r1ä¸Šé…ç½®åŠ¨æ€åœ°å€æ± ï¼š åœ°å€æ± éªŒè¯ï¼š é…ç½®aclç­–ç•¥ï¼š åœ¨r1çš„å¤–ç½‘å‡ºæ¥å£ä¸Šè°ƒç”¨ï¼š éªŒè¯ï¼š å…¶ä¸­æºIPä¸º3ã€4ã€5ä¸å®šï¼Œè¯´æ˜æ˜¯åœ¨åŠ¨æ€åˆ†é…å¤–ç½‘åœ°å€ã€‚åŠ¨æ€NATé…ç½®å®Œæˆã€‚ åœ¨åŠ¨æ€NATå®éªŒä¸­ï¼Œæœ€ååˆ©ç”¨PC1æµ‹è¯•è¿é€šæ€§æ—¶ï¼Œé—´æ­‡æ€§ä¼šä¸¢åŒ… å¯èƒ½çš„åŸå› ï¼špingçš„æ—¶å€™é»˜è®¤æŒ‰åœ°å€æ± ä¸­å¯ç”¨åœ°å€é¡ºåºä»1~254è¿›è¡Œåœ°å€è½¬æ¢ï¼Œæ”¾å¤§natåœ°å€æ± å¯è§£å†³ã€‚ NAPT å¦‚ä¸Šå›¾ï¼ŒRTAæ”¶åˆ°ä¸€ä¸ªç§ç½‘ä¸»æœºå‘é€çš„æŠ¥æ–‡ï¼ŒæºIPåœ°å€æ˜¯192.168.1.1ï¼Œæºç«¯å£å·æ˜¯1025ï¼Œç›®çš„IPåœ°å€æ˜¯100.1.1.1ï¼Œç›®çš„ç«¯å£æ˜¯80ã€‚RTAä¼šä»é…ç½®çš„å…¬ç½‘åœ°å€æ± ä¸­é€‰æ‹©ä¸€ä¸ªç©ºé—²çš„å…¬ç½‘IPåœ°å€å’Œç«¯å£å·ï¼Œå¹¶å»ºç«‹ç›¸åº”çš„NAPTè¡¨é¡¹ã€‚è¿™äº›NAPTè¡¨é¡¹æŒ‡å®šäº†æŠ¥æ–‡çš„ç§ç½‘IPåœ°å€å’Œç«¯å£å·ä¸å…¬ç½‘IPåœ°å€å’Œç«¯å£å·çš„æ˜ å°„å…³ç³»ã€‚ä¹‹åï¼ŒRTAå°†æŠ¥æ–‡çš„æºIPåœ°å€å’Œç«¯å£å·è½¬æ¢æˆå…¬ç½‘åœ°å€200.10.10.1å’Œç«¯å£å·2843ï¼Œå¹¶è½¬å‘æŠ¥æ–‡åˆ°å…¬ç½‘ã€‚å½“ç½‘å…³RTAæ”¶åˆ°å›å¤æŠ¥æ–‡åï¼Œä¼šæ ¹æ®ä¹‹å‰çš„æ˜ å°„è¡¨å†æ¬¡è¿›è¡Œè½¬æ¢ä¹‹åè½¬å‘ç»™ä¸»æœºAã€‚ä¸»æœºBåŒç†ã€‚ æ³¨æ„ï¼š NAPTæŠ€æœ¯å…è®¸å¤šä¸ªå†…éƒ¨åœ°å€æ˜ å°„åˆ°åŒä¸€ä¸ªå…¬æœ‰åœ°å€çš„ä¸åŒç«¯å£ã€‚NAPTå®ç°äº†ç§æœ‰åœ°å€å¯¹å…±æœ‰åœ°å€å¤šå¯¹ä¸€ ç›¸å½“äºä¸€ç§ç‰¹æ®Šçš„åŠ¨æ€nat 1ã€ç«¯å£NATå’ŒåŠ¨æ€NATçš„é…ç½®è¿‡ç¨‹åŸºæœ¬ä¸€è‡´ï¼Œåªæ˜¯åœ¨åº”ç”¨åˆ°æ¥å£æ—¶ï¼Œé…ç½®å‘½ä»¤å°‘no-pat2ã€ç«¯å£NATä¸€ä¸ªåœ°å€å¯ä»¥ç»™å¤šä¸ªæºåœ°å€è½¬æ¢ï¼Œä¸æ˜¯å•å¯¹å•çš„è½¬æ¢ï¼Œæ‰€ä»¥èŠ‚çœäº†natåœ°å€ï¼3ã€ç«¯å£NATå®é™…åº”ç”¨è¾ƒå¤šï¼Œé™æ€NATå’ŒåŠ¨æ€NATå› ä¸ºåœ°å€ä¸èƒ½èŠ‚çº¦ï¼Œæ‰€ä»¥å®é™…åº”ç”¨å°‘ Easy IP Easy IPæœ¬è´¨ä¸Šæ˜¯NAPTï¼ˆæ‰€ä»¥åŸç†ä¸NAPTå¤§è‡´ç›¸ä¼¼ï¼‰ç”±äºç½‘å…³è®¾å¤‡å‡ºæ¥å£IPåœ°å€ä¸ºå…¬ç½‘åœ°å€ï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨è¯¥å‡ºæ¥å£åœ°å€æ¥ä½œä¸ºåœ°å€è½¬æ¢çš„å…¬æœ‰åœ°å€ã€‚Easy IPé€‚ç”¨äºå°è§„æ¨¡å±€åŸŸç½‘ä¸­çš„ä¸»æœºè®¿é—®Internetçš„åœºæ™¯ã€‚å°è§„æ¨¡å±€åŸŸç½‘é€šå¸¸éƒ¨ç½²åœ¨å°å‹çš„ç½‘å§æˆ–è€…åŠå…¬å®¤ä¸­ï¼Œè¿™äº›åœ°æ–¹å†…éƒ¨ä¸»æœºä¸å¤šï¼Œå‡ºæ¥å£å¯ä»¥é€šè¿‡æ‹¨å·æ–¹å¼è·å–ä¸€ä¸ªä¸´æ—¶å…¬ç½‘IPåœ°å€ã€‚Easy IPå¯ä»¥å®ç°å†…éƒ¨ä¸»æœºä½¿ç”¨è¿™ä¸ªä¸´æ—¶å…¬ç½‘IPåœ°å€è®¿é—®Internetã€‚ Easy IPé€‚ç”¨äºå°è§„æ¨¡å±€åŸŸç½‘ä¸­çš„ä¸»æœºè®¿é—®Internetçš„åœºæ™¯ã€‚å°è§„æ¨¡å±€åŸŸç½‘é€šå¸¸éƒ¨ç½²åœ¨å°å‹çš„ç½‘å§æˆ–è€…åŠå…¬å®¤ä¸­ï¼Œè¿™äº›åœ°æ–¹å†…éƒ¨ä¸»æœºä¸å¤šï¼Œå‡ºæ¥å£å¯ä»¥é€šè¿‡æ‹¨å·æ–¹å¼è·å–ä¸€ä¸ªä¸´æ—¶å…¬ç½‘IPåœ°å€ã€‚Easy IPå¯ä»¥å®ç°å†…éƒ¨ä¸»æœºä½¿ç”¨è¿™ä¸ªä¸´æ—¶å…¬ç½‘IPåœ°å€è®¿é—®Internetã€‚ Easy IPçš„é…ç½®ï¼š1.åˆ›å»ºACLï¼šacl 2000 2.å…è®¸1.0çš„æ•°æ®è¿›è¡Œè½¬æ¢ï¼šrule 5 permit source 192.168.1.0 0 .0.0.255 3.è¿›å…¥å…¬ç½‘å‡ºæ¥å£ 4.åº”ç”¨aclï¼šnat outbound 2000 ï¼ˆç›¸è¾ƒäºnaptå°‘äº†åœ°å€æ± ï¼‰ éªŒè¯ï¼š æºåœ°å€ä¸ºå‡ºæ¥å£åœ°å€172.16.1.1ï¼Œåªæ˜¯ç«¯å£ä¸åŒ","categories":[{"name":"ipå®éªŒ","slug":"ipå®éªŒ","permalink":"http://example.com/categories/ip%E5%AE%9E%E9%AA%8C/"}],"tags":[{"name":"nat","slug":"nat","permalink":"http://example.com/tags/nat/"}]},{"title":"DHCPåŸºç¡€é…ç½®","slug":"DHCPåŸºç¡€é…ç½®","date":"2023-11-25T06:34:51.000Z","updated":"2023-11-25T07:52:19.845Z","comments":true,"path":"2023/11/25/DHCPåŸºç¡€é…ç½®/","permalink":"http://example.com/2023/11/25/DHCP%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE/","excerpt":"DHCPæ˜¯ä¸€ç§ç»ˆç«¯è‡ªåŠ¨é…ç½®åè®®ï¼Œå®¢æˆ·ç«¯é€šè¿‡DHCPåè®®å¯è·å–ä¸€ä¸ªåˆæ³•çš„åŠ¨æ€IPåœ°å€ã€‚","text":"DHCPæ˜¯ä¸€ç§ç»ˆç«¯è‡ªåŠ¨é…ç½®åè®®ï¼Œå®¢æˆ·ç«¯é€šè¿‡DHCPåè®®å¯è·å–ä¸€ä¸ªåˆæ³•çš„åŠ¨æ€IPåœ°å€ã€‚ æ¦‚è¿°éšç€ç½‘ç»œè§„æ¨¡çš„æ‰©å¤§å’Œç½‘ç»œå¤æ‚åº¦çš„æé«˜ï¼Œç½‘ç»œé…ç½®è¶Šæ¥è¶Šå¤æ‚ï¼Œç»å¸¸å‡ºç°è®¡ç®—æœºä½ç½®å˜åŒ–ï¼ˆå¦‚ä¾¿æºæœºæˆ–æ— çº¿ç½‘ç»œï¼‰å’Œè®¡ç®—æœºæ•°é‡è¶…è¿‡å¯åˆ†é…çš„IPåœ°å€çš„æƒ…å†µã€‚åŠ¨æ€ä¸»æœºé…ç½®åè®®DHCPï¼ˆDynamic Host Configuration Protocolï¼‰å°±æ˜¯ä¸ºæ»¡è¶³è¿™äº›éœ€æ±‚è€Œå‘å±•èµ·æ¥çš„ã€‚DHCPåè®®ä»¥æœåŠ¡å™¨&#x2F;å®¢æˆ·ç«¯ï¼ˆServer&#x2F;Clientï¼‰æ¨¡å¼å·¥ä½œï¼ŒDHCPå®¢æˆ·ç«¯å‘DHCPæœåŠ¡å™¨åŠ¨æ€åœ°è¯·æ±‚é…ç½®ä¿¡æ¯ï¼ŒDHCPæœåŠ¡å™¨å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ä¸ºå®¢æˆ·ç«¯åŠ¨æ€å‘é€é…ç½®ä¿¡æ¯ã€‚ DHCPæœåŠ¡å™¨DHCP Serverå³DHCPæœåŠ¡å™¨ï¼Œè´Ÿè´£å®¢æˆ·ç«¯IPåœ°å€çš„åˆ†é…ã€‚å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€é…ç½®ç”³è¯·æŠ¥æ–‡ï¼ˆåŒ…æ‹¬IPåœ°å€ã€å­ç½‘æ©ç ã€ç¼ºçœç½‘å…³ç­‰å‚æ•°ï¼‰ï¼ŒæœåŠ¡å™¨æ ¹æ®ç­–ç•¥è¿”å›æºå¸¦ç›¸åº”é…ç½®ä¿¡æ¯çš„æŠ¥æ–‡ï¼Œè¯·æ±‚æŠ¥æ–‡å’Œå›åº”æŠ¥æ–‡éƒ½é‡‡ç”¨UDPè¿›è¡Œå°è£…ã€‚ DHCPä¸­ç»§DHCP Relayå³DHCPä¸­ç»§ï¼Œå®ƒæ˜¯ä¸ºè§£å†³æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¸åœ¨åŒä¸€ä¸ªç½‘æ®µè€Œæå‡ºæ¥çš„ï¼Œå®ƒæä¾›äº†å¯¹DHCPå¹¿æ’­æŠ¥æ–‡çš„é€æ˜ä¼ è¾“åŠŸèƒ½ï¼Œèƒ½å¤ŸæŠŠDHCPå®¢æˆ·ç«¯çš„å¹¿æ’­æŠ¥æ–‡é€æ˜åœ°ä¼ é€åˆ°å…¶å®ƒç½‘æ®µçš„DHCPæœåŠ¡å™¨ä¸Šï¼ŒåŒæ ·èƒ½å¤ŸæŠŠDHCPæœåŠ¡å™¨ç«¯çš„å¹¿æ’­æŠ¥æ–‡é€æ˜åœ°ä¼ é€åˆ°å…¶å®ƒç½‘æ®µçš„DHCPå®¢æˆ·ç«¯ã€‚ DHCPåŸºç¡€é…ç½®äº¤æ¢æœº4ä¸Šæœ‰å¤šä¸ªvlanï¼Œäº¤æ¢æœº1æ¨¡æ‹ŸdhcpæœåŠ¡å™¨å®ç°ä¸ºå¤šä¸ªvlanåˆ†é…åœ°å€ï¼Œäº¤æ¢æœº3ä½œä¸ºdhcpç»ˆæè¿æ¥æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ å®éªŒæ­¥éª¤åˆ›å»ºVLAN[S1]vlan 40 [S3]vlan batch 10 20 30 40 [S4]vlan batch 10 20 30 é…ç½®æ¥å£æ”¾é€šç›¸åº”çš„VLAN[S4]interface GigabitEthernet0&#x2F;0&#x2F;3 [S4-GigabitEthernet0&#x2F;0&#x2F;3] port link-type trunk [S4-GigabitEthernet0&#x2F;0&#x2F;3] port trunk allow-pass vlan 10 20 30 [S4-GigabitEthernet0&#x2F;0&#x2F;3] quit [S3]interface GigabitEthernet0&#x2F;0&#x2F;1 [S3-GigabitEthernet0&#x2F;0&#x2F;1] port link-type access [S3-GigabitEthernet0&#x2F;0&#x2F;1] port default vlan 40 [S3-GigabitEthernet0&#x2F;0&#x2F;1] quit [S3]interface GigabitEthernet0&#x2F;0&#x2F;3 [S3-GigabitEthernet0&#x2F;0&#x2F;3] port link-type trunk [S3-GigabitEthernet0&#x2F;0&#x2F;3] port trunk allow-pass vlan 10 20 30 [S3-GigabitEthernet0&#x2F;0&#x2F;3] quit [S1]interface GigabitEthernet0&#x2F;0&#x2F;12 [S1-GigabitEthernet0&#x2F;0&#x2F;12] port link-type access [S1-GigabitEthernet0&#x2F;0&#x2F;12] port default vlan 40 [S1-GigabitEthernet0&#x2F;0&#x2F;12] quit äº¤æ¢æœº4å’Œäº¤æ¢æœº3ä¹‹é—´å› ä¸ºæ”¾é€šå¤šä¸ªvlanï¼Œæ‰€ä»¥ä½¿ç”¨trunkå£ï¼Œäº¤æ¢æœº3å’Œäº¤æ¢æœº1ä¹‹é—´åªæœ‰ä¸€ä¸ªvlan40ï¼Œæ‰€ä»¥é…ç½®accesså£ï¼Œpvid&#x3D;40 VLANIFé…ç½®[S4]interface Vlanif 10 [S4-Vlanif10] quit [S4]interface Vlanif 20 [S4-Vlanif20] quit [S4]interface Vlanif 30 [S4-Vlanif30] quit [S3]interface Vlanif 10 [S3-Vlanif10] ip address 10.0.10.3 24 [S3-Vlanif10] quit [S3]interface Vlanif 20 [S3-Vlanif20] ip address 10.0.20.3 24 [S3-Vlanif20] quit [S3]interface Vlanif 30 [S3-Vlanif30] ip address 10.0.30.3 24 [S3-Vlanif30] quit [S3]interface Vlanif 40 [S3-Vlanif40] ip address 10.0.40.3 24 [S3-Vlanif40] quit [S1]interface Vlanif 40 [S1-Vlanif40] ip address 10.0.40.1 24 [S1-Vlanif40] quit æ£€æŸ¥ä¸€ä¸‹äº¤æ¢æœº3å’Œ1ä¹‹é—´çš„è¿é€šæ€§ ï¼ˆå¼€å¯DHCPæœåŠ¡ï¼Œé…ç½®å…¨å±€åœ°å€æ± ï¼ŒåŒæ—¶ä¸ºS4ä¸Šçš„VLANIF30åˆ†é…é™æ€IPåœ°å€ã€‚ï¼‰ï¼š å¼€å¯DHCPæœåŠ¡[S1]dhcp enable åˆ›å»ºåœ°å€æ± VLAN10ï¼Œç”¨äºç»™S4çš„VLANIF10åˆ†é…åœ°å€[S1]ip pool vlan10 &#x2F;&#x2F;åˆ›å»ºåœ°å€æ± åä¸ºvlan10 [S1-ip-pool-vlan10] gateway-list 10.0.10.3 &#x2F;&#x2F;ç½‘å…³æ˜¯ä¸­ç»§ä¸Šçš„vlanif 10 [S1-ip-pool-vlan10] network 10.0.10.0 mask 255.255.255.0 &#x2F;&#x2F;è®¾ç½®åˆ†é…ipèŒƒå›´æ˜¯10.0.10.1-10.0.10.255 [S1-ip-pool-vlan10] dns-list 10.0.10.3 [S1-ip-pool-vlan10] quit åˆ›å»ºåœ°å€æ± VLAN20ï¼Œç”¨äºç»™S4çš„VLANIF20åˆ†é…åœ°å€[S1]ip pool vlan20 [S1-ip-pool-vlan20] gateway-list 10.0.20.3 [S1-ip-pool-vlan20] network 10.0.20.0 mask 255.255.255.0 [S1-ip-pool-vlan20] dns-list 10.0.20.3 [S1-ip-pool-vlan20] quit åˆ›å»ºåœ°å€æ± VLAN30ï¼Œç”¨äºç»™S4çš„VLANIF30åˆ†é…åœ°å€[S1]ip pool vlan30 [S1-ip-pool-vlan30] gateway-list 10.0.30.3 [S1-ip-pool-vlan30] network 10.0.30.0 mask 255.255.255.0 [S1-ip-pool-vlan30] dns-list 10.0.30.3 [S1-ip-pool-vlan30] quit æŸ¥çœ‹s4çš„vlanif30çš„macä¸ºäº†å®ç°ç»™s4çš„vlanif30å£é™æ€ç»‘å®šä¸€ä¸ªæŒ‡å®šçš„ipåœ°å€ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæŸ¥çœ‹ä¸€ä¸‹mac åœ¨S1ä¸Šä¸ºS4çš„VLANIF30é…ç½®é™æ€åœ°å€åˆ†é… ç»™s4çš„vlanifå£é™æ€åˆ†é…ipï¼š10.0.30.2 åœ¨VLANIF40æ¥å£ä¸‹ä½¿èƒ½DHCP Server[S1]interface Vlanif 40 [S1-Vlanif40] dhcp select global &#x2F;&#x2F;å…¨å±€çš„ä½¿èƒ½ æŸ¥çœ‹IPåœ°å€æ± é…ç½®æƒ…å†µ[S1]display ip pool name vlan30 åœ°å€æ± vlan30å·²ç»å­˜åœ¨ä¸€ä¸ªâ€œUsedâ€åœ°å€ï¼Œè¯¥åœ°å€ä¸ºé™æ€åˆ†é…çš„åœ°å€ã€‚ é…ç½®å‰å¾€ç”¨æˆ·ç½‘æ®µçš„è·¯ç”±[S1]ip route-static 10.0.10.0 24 10.0.40.3 [S1]ip route-static 10.0.20.0 24 10.0.40.3 [S1]ip route-static 10.0.30.0 24 10.0.40.3 ï¼ˆæˆ–è€…é…ç½®ç¼ºçœè·¯ç”±ï¼‰ ä¿è¯è¿é€šæ€§ åœ¨S3ä¸Šå®ŒæˆDHCP Relayç›¸å…³é…ç½® å¼€å¯DHCPæœåŠ¡[S3]dhcp enable åœ¨æ¥å£ä¸Šé…ç½®DHCP Relayï¼ŒæŒ‡å®šDHCP Server[S3]interface Vlanif10 [S3-Vlanif10] dhcp select relay [S3-Vlanif10] dhcp relay server-ip 10.0.40.1 [S3-Vlanif10] quit [S3]interface Vlanif20 [S3-Vlanif20] dhcp select relay [S3-Vlanif20] dhcp relay server-ip 10.0.40.1 [S3-Vlanif20] quit [S3]interface Vlanif30 [S3-Vlanif30] dhcp select relay [S3-Vlanif30] dhcp relay server-ip 10.0.40.1 [S3-Vlanif30] quit æŸ¥çœ‹relayé…ç½® DHCP Clienté…ç½®åœ¨S4ä¸Šé…ç½®VLANIF10ã€20ã€30æ¥å£é€šè¿‡DHCPè·å–IPåœ°å€ å¼€å¯DHCPæœåŠ¡[S4]dhcp enable å¼€å¯æ¥å£é€šè¿‡DHCPè·å–åœ°å€[S4]interface Vlanif10 [S4-Vlanif10] ip address dhcp-alloc [S4-Vlanif10] quit [S4]interface Vlanif20 [S4-Vlanif20] ip address dhcp-alloc [S4-Vlanif20] quit [S4]interface Vlanif30 [S4-Vlanif30] ip address dhcp-alloc [S4-Vlanif30] quit æŸ¥çœ‹å„ä¸ªæ¥å£IPåœ°å€è·å–æƒ…å†µdisplay interface Vlanif 10 Vlanif10 current state : UP Line protocol current state : UP Last line protocol up time : 2020-06-05 17:37:57 UTC-08:00 Description: Route Port,The Maximum Transmit Unit is 1500 Internet Address is allocated by DHCP, 10.0.10.254&#x2F;24 [S4]display interface Vlanif 20 Vlanif20 current state : UP Line protocol current state : UP Last line protocol up time : 2020-06-05 17:41:23 UTC-08:00 Description: Route Port,The Maximum Transmit Unit is 1500 Internet Address is allocated by DHCP, 10.0.20.254&#x2F;24 [S4]display interface Vlanif 30 Vlanif30 current state : UP Line protocol current state : UP Last line protocol up time : 2020-06-05 17:43:22 UTC-08:00 Description: Route Port,The Maximum Transmit Unit is 1500 Internet Address is allocated by DHCP, 10.0.30.2&#x2F;24 æ¥å£å·²ç»é€šè¿‡DHCPè·å–åˆ°IPåœ°å€ï¼Œå¹¶ä¸”VLANIF30çš„åœ°å€ä¸ºé™æ€åˆ†é…çš„åœ°å€ï¼š10.0.30.2ã€‚","categories":[{"name":"ipå®éªŒ","slug":"ipå®éªŒ","permalink":"http://example.com/categories/ip%E5%AE%9E%E9%AA%8C/"}],"tags":[{"name":"DHCP Relay","slug":"DHCP-Relay","permalink":"http://example.com/tags/DHCP-Relay/"},{"name":"DHCP","slug":"DHCP","permalink":"http://example.com/tags/DHCP/"}]},{"title":"vlané—´é€šä¿¡","slug":"vlané—´é€šä¿¡","date":"2023-11-24T07:17:21.000Z","updated":"2023-11-25T07:51:39.450Z","comments":true,"path":"2023/11/24/vlané—´é€šä¿¡/","permalink":"http://example.com/2023/11/24/vlan%E9%97%B4%E9%80%9A%E4%BF%A1/","excerpt":"VLANé—´é€šä¿¡èƒŒæ™¯åˆ’åˆ†VLANåï¼Œä¸åŒVLANçš„ç”¨æˆ·é—´ä¸èƒ½äºŒå±‚äº’è®¿ï¼Œè¿™æ ·èƒ½èµ·åˆ°éš”ç¦»å¹¿æ’­çš„ä½œç”¨ã€‚ä½†å®é™…åº”ç”¨ä¸­ï¼Œä¸åŒVLANçš„ç”¨æˆ·åˆå¸¸æœ‰äº’è®¿çš„éœ€æ±‚ï¼Œæ­¤æ—¶å°±éœ€è¦å®ç°ä¸åŒVLANçš„ç”¨æˆ·äº’è®¿ï¼Œç®€ç§°VLANé—´äº’è®¿ã€‚","text":"VLANé—´é€šä¿¡èƒŒæ™¯åˆ’åˆ†VLANåï¼Œä¸åŒVLANçš„ç”¨æˆ·é—´ä¸èƒ½äºŒå±‚äº’è®¿ï¼Œè¿™æ ·èƒ½èµ·åˆ°éš”ç¦»å¹¿æ’­çš„ä½œç”¨ã€‚ä½†å®é™…åº”ç”¨ä¸­ï¼Œä¸åŒVLANçš„ç”¨æˆ·åˆå¸¸æœ‰äº’è®¿çš„éœ€æ±‚ï¼Œæ­¤æ—¶å°±éœ€è¦å®ç°ä¸åŒVLANçš„ç”¨æˆ·äº’è®¿ï¼Œç®€ç§°VLANé—´äº’è®¿ã€‚ å®éªŒæ‹“æ‰‘ è¯¦è§£ï¼šR2åˆ’å…¥vlan2ï¼ŒR3åˆ’å…¥vlan3ï¼Œä¸äº¤æ¢æœºä¹‹é—´é‡‡ç”¨accesså£ï¼Œç”±äºäº¤æ¢æœºg0&#x2F;0&#x2F;1éœ€è¦é€šè¿‡å¤šä¸ªvlanï¼Œæ‰€ä»¥é…æˆtrunkå£ã€‚R2å’ŒR3ç›¸å½“äºä¸»æœºï¼Œå‘é€å’Œæ¥å—çš„æ•°æ®éƒ½ä¸å¸¦æ ‡ç­¾ï¼Œäº¤æ¢æœºg0&#x2F;0&#x2F;2æ”¶åˆ°R2å‘é€çš„æ•°æ®ï¼Œæ‰“ä¸Šæ ‡ç­¾vlan2ï¼Œç„¶åå‘å‡ºå»ï¼›äº¤æ¢æœºg0&#x2F;0&#x2F;1æ”¶åˆ°æ•°æ®åï¼Œå‘ç°vlançš„æ ‡ç­¾å…è®¸é€šè¿‡ï¼Œåˆ™æ•°æ®å¸¦ç€vlan2çš„æ ‡ç­¾é€šè¿‡ï¼›ç„¶åäº¤æ¢æœºg0&#x2F;0&#x2F;3å£è½¬å‘æ•°æ®æ—¶ï¼Œå‘ç°è‡ªå·±çš„pvidæ˜¯vlan3ï¼Œå’Œvlan2ä¸ä¸€æ ·ï¼Œæ‰€ä»¥ä¸æ¥å—ï¼Œåˆ™vlan2å’Œvlan3ä¸èƒ½é€šä¿¡ã€‚ åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œéœ€è¦ç‰¹å®švlanä¹‹é—´é€šä¿¡ æ–¹æ³•ä¸€ï¼šdot1qæ¥å£ åœ¨r1ä¸Šé…ç½®ä¸¤ä¸ªdot1qæ¥å£ï¼Œg0&#x2F;0&#x2F;1.1å’Œg0&#x2F;0&#x2F;1.2ï¼Œåˆ†åˆ«å¯¹åº”vlan2å’Œvlan3ï¼Œä½œç”¨å°±æ˜¯å¯ä»¥ç»ˆç»“vlanæ ‡ç­¾ï¼ˆå‰¥ç¦»ï¼‰ï¼Œvlan2çš„æ ‡ç­¾åˆ°r1åï¼Œè¢«å‰¥ç¦»æ‰vlan2çš„æ ‡ç­¾ï¼Œç„¶åè½¬å‘æ—¶åˆè¢«g0&#x2F;0&#x2F;1.2æ‰“ä¸Švlan3çš„æ ‡ç­¾ï¼Œäº¤æ¢æœºg0&#x2F;0&#x2F;1é€šè¿‡ï¼Œåˆ°g0&#x2F;0&#x2F;3ï¼Œaccesså£å‘ç°å’Œè‡ªå·±çš„pvidä¸€æ ·ï¼Œç„¶åå‰¥ç¦»æ‰æ ‡ç­¾ï¼Œè½¬å‘æ•°æ®å¸§ç»™r3. æ–¹æ³•äºŒï¼švlanifæ¥å£ï¼šäº¤æ¢æœºä¸Šé…ç½®vlanif2å’Œvlanif3ï¼Œipåœ°å€é…æˆ192.168.2.254å’Œ192.168.3.254 å…¶å®å°±æ˜¯ç›¸å½“äºä¸¤ä¸ªä¸åŒç½‘æ®µçš„ç½‘å…³ï¼Œç„¶åå®ç°ä¸‰å±‚çš„è½¬å‘ Accessæ¥å£äº¤æ¢æœºä¸Šå¸¸ç”¨æ¥è¿æ¥ç”¨æˆ·PCã€æœåŠ¡å™¨ç­‰ç»ˆç«¯è®¾å¤‡çš„æ¥å£ã€‚Accessæ¥å£æ‰€è¿æ¥çš„è¿™äº›è®¾å¤‡çš„ç½‘å¡å¾€å¾€åªæ”¶å‘æ— æ ‡è®°å¸§ã€‚Accessæ¥å£åªèƒ½åŠ å…¥ä¸€ä¸ªVLANã€‚åªèƒ½å…è®¸ä¸€ä¸ªVLANé€šè¿‡ã€‚ è½¬å‘åŸåˆ™ æ¥æ”¶åŸåˆ™ï¼š â‘ æ”¶åˆ°ä¸å¸¦æ ‡ç­¾çš„æ•°æ®å¸§ï¼Œæ‰“ä¸Šæ ‡ç­¾ï¼Œvlan id&#x3D;ç«¯å£çš„PVID â‘¡æ”¶åˆ°å¸¦æ ‡ç­¾çš„æ•°æ®å¸§ï¼Œæ£€æŸ¥æ•°æ®å¸§vlan idæ˜¯å¦å’Œç«¯å£çš„PVIDç›¸åŒï¼Œç›¸åŒç›´æ¥æ¥æ”¶ï¼›ä¸åŒæ‹’ç»æ¥æ”¶ å‘é€åŸåˆ™ï¼š â‘ æ•°æ®å¸§vlan idå’Œç«¯å£PVID ç›¸åŒï¼Œå‰¥ç¦»æ ‡ç­¾å‘é€ï¼› â‘¡æ•°æ®å¸§vlan idå’Œç«¯å£PVID ä¸åŒï¼Œç¦æ­¢å‘é€ã€‚ Trunkæ¥å£Trunkæ¥å£å…è®¸å¤šä¸ªVLANçš„æ•°æ®å¸§é€šè¿‡ï¼Œè¿™äº›æ•°æ®å¸§é€šè¿‡802.1Q Tagå®ç°åŒºåˆ†ã€‚Trunkæ¥å£å¸¸ç”¨äºäº¤æ¢æœºä¹‹é—´çš„äº’è”ï¼Œä¹Ÿç”¨äºè¿æ¥è·¯ç”±å™¨ã€é˜²ç«å¢™ç­‰è®¾å¤‡çš„ å­æ¥å£ è½¬å‘åŸåˆ™ æ¥æ”¶åŸåˆ™ï¼š â‘ æ”¶åˆ°ä¸å¸¦æ ‡ç­¾çš„æ•°æ®å¸§ï¼Œæ‰“ä¸Šæ ‡ç­¾ï¼Œvlan id&#x3D;ç«¯å£çš„PVIDï¼Œç„¶åæŸ¥çœ‹è¯¥vlanidæ˜¯å¦åœ¨å…è®¸åˆ—è¡¨ä¸­ï¼Œæ˜¯â€“æ¥æ”¶ï¼Œä¸æ˜¯â€“æ‹’ç» â‘¡æ”¶åˆ°å¸¦æ ‡ç­¾çš„æ•°æ®å¸§ï¼ŒæŸ¥çœ‹è¯¥vlan idæ˜¯å¦åœ¨å…è®¸åˆ—è¡¨ä¸­ï¼Œæ˜¯â€“æ¥æ”¶ï¼Œä¸æ˜¯â€“æ‹’ç» å‘é€åŸåˆ™ï¼š æŸ¥çœ‹vlan idæ˜¯å¦åœ¨å…è®¸åˆ—è¡¨ä¸­ï¼ŒI:ä¸æ˜¯â€“æ‹’ç»å‘é€ï¼›IIï¼šæ˜¯ï¼ŒæŸ¥çœ‹æ¥å£çš„PVIDå’Œvlan idæ˜¯å¦ç›¸åŒï¼Œç›¸åŒâ€“å‰¥æ ‡ç­¾å‘é€ï¼›ä¸åŒâ€“ç›´æ¥å‘é€ã€‚ Hybridæ¥å£Hybridæ¥å£ä¸Trunkæ¥å£ç±»ä¼¼ï¼Œä¹Ÿå…è®¸å¤šä¸ªVLANçš„æ•°æ®å¸§é€šè¿‡ï¼Œè¿™äº›æ•°æ®å¸§é€šè¿‡802.1Q Tagå®ç°åŒºåˆ†ã€‚ç”¨æˆ·å¯ä»¥çµæ´»æŒ‡å®šHybridæ¥å£åœ¨å‘é€æŸä¸ªï¼ˆæˆ–æŸäº›ï¼‰VLANçš„æ•°æ®å¸§æ—¶æ˜¯å¦æºå¸¦Tag è½¬å‘åŸåˆ™ æ¥æ”¶åŸåˆ™ï¼š â‘ æ”¶åˆ°ä¸å¸¦æ ‡ç­¾çš„æ•°æ®å¸§ï¼Œæ‰“ä¸Šæ ‡ç­¾ï¼Œvlan id&#x3D;ç«¯å£çš„PVIDï¼Œç„¶åæŸ¥çœ‹è¯¥vlanidæ˜¯å¦åœ¨å…è®¸åˆ—è¡¨ä¸­ï¼Œæ˜¯â€“æ¥æ”¶ï¼Œä¸æ˜¯â€“æ‹’ç» â‘¡æ”¶åˆ°å¸¦æ ‡ç­¾çš„æ•°æ®å¸§ï¼ŒæŸ¥çœ‹è¯¥vlan idæ˜¯å¦åœ¨å…è®¸åˆ—è¡¨ä¸­ï¼Œæ˜¯â€“æ¥æ”¶ï¼Œä¸æ˜¯â€“æ‹’ç»å‘é€åŸåˆ™ï¼šæŸ¥çœ‹vlan idæ˜¯å¦åœ¨å…è®¸åˆ—è¡¨ä¸­ï¼ŒI:ä¸æ˜¯â€“æ‹’ç»å‘é€ï¼›IIï¼šæ˜¯ï¼Œæ˜¯å¦å¸¦æ ‡ç­¾å‘é€å–å†³äºæ¥å£çš„é…ç½®ã€‚ PVIDå¯ä»¥æ‰‹å·¥ä¿®æ”¹ï¼Œé»˜è®¤æ˜¯1ï¼Œaccesså£çš„å°±æ˜¯æœ¬èº«çš„vlanå·ï¼Œtrunkå¯ä»¥æœ‰ä¸€ä¸ªä¸»vlanå’Œå¤šä¸ªå‰¯vlanï¼Œæ”¶åˆ°çš„æ•°æ®å’Œä¸»vlanç›¸åŒå°±å‰¥ç¦»è½¬å‘ï¼Œæ”¶åˆ°å’Œä¸»vlanä¸ä¸€æ ·çš„æ ‡ç­¾ï¼ŒæŸ¥è¡¨ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯åœ¨å…è®¸é€šè¿‡çš„åˆ—è¡¨ï¼Œå¦‚æœæœ‰ï¼Œå°±å¸¦ç€åŸæ¥çš„è½¬å‘ï¼Œè¦æ˜¯æ²¡æœ‰ï¼Œå°±ä¸è®©è¿‡å»å•¦ã€‚ å®éªŒé…ç½®è¿‡ç¨‹# R2å’ŒR3çš„IPåœ°å€åŠç½‘å…³é…ç½® system-view Enter system view, return user view with Ctrl+Z. [R2]interface GigabitEthernet 0&#x2F;0&#x2F;1 [R2-GigabitEthernet0&#x2F;0&#x2F;1]ip address 192.168.2.1 24 [R2-GigabitEthernet0&#x2F;0&#x2F;1]quit [R2]ip route-static 0.0.0.0 0 192.168.2.254 é…ç½®é»˜è®¤è·¯ç”±ï¼Œç›¸å½“äºç»™è®¾å¤‡é…ç½®äº†ç½‘å…³ã€‚ system-view Enter system view, return user view with Ctrl+Z. [R3]interface GigabitEthernet 0&#x2F;0&#x2F;1 [R3-GigabitEthernet0&#x2F;0&#x2F;1]ip address 192.168.3.1 24 [R3-GigabitEthernet0&#x2F;0&#x2F;1]quit [R3]ip route-static 0.0.0.0 0 192.168.3.254 # åœ¨S1ä¸Šå¯¹R2å’ŒR3è¿›è¡ŒVLANåˆ’åˆ† [S1]vlan batch 2 3 Info: This operation may take a few seconds. Please wait for a momentâ€¦done. [S1]interface GigabitEthernet 0&#x2F;0&#x2F;2 [S1-GigabitEthernet0&#x2F;0&#x2F;2]port link-type access [S1-GigabitEthernet0&#x2F;0&#x2F;2]port default vlan 2 [S1-GigabitEthernet0&#x2F;0&#x2F;2]quit [S1]interface GigabitEthernet 0&#x2F;0&#x2F;3 [S1-GigabitEthernet0&#x2F;0&#x2F;3]port link-type access [S1-GigabitEthernet0&#x2F;0&#x2F;3]port default vlan 3 æ­¥éª¤ 1 é€šè¿‡Dot1qç»ˆç»“å­æ¥å£å®ç°VLANé—´äº’è®¿ # é…ç½®S1ä¸Šçš„Trunkæ¥å£ [S1]interface GigabitEthernet 0&#x2F;0&#x2F;1 [S1-GigabitEthernet0&#x2F;0&#x2F;1]port trunk allow-pass vlan 2 3 å› ä¸ºVLANé—´äº’è®¿æ•°æ®è¦ç”±R1æ¥ç»ˆç»“VLANï¼Œæ‰€ä»¥S1å’ŒR1ä¹‹é—´çš„é“¾è·¯è¦å…è®¸VLAN2å’ŒVLAN3é€šè¿‡**ã€‚ # åœ¨R1ä¸Šåˆ›å»ºå¹¶é…ç½®Dot1qç»ˆç»“å­æ¥å£ [R1]interface GigabitEthernet 0&#x2F;0&#x2F;1.2 åˆ›å»ºå¹¶è¿›å…¥å­æ¥å£è§†å›¾ã€‚2ä»£è¡¨å­æ¥å£çš„ç¼–å·ï¼Œä¸€èˆ¬å»ºè®®å­æ¥å£ç¼–å·ä¸VLAN IDç›¸åŒï¼Œæ–¹ä¾¿è®°å¿†ã€‚ [R1-GigabitEthernet0&#x2F;0&#x2F;1.2]dot1q termination vid 2 dot1q termination vid vlan-idå‘½ä»¤ç”¨æ¥é…ç½®å­æ¥å£Dot1qç»ˆç»“çš„VLAN IDã€‚ ä»¥æ­¤é…ç½®ä¸ºä¾‹ï¼šå½“GigabitEthernet0&#x2F;0&#x2F;1æ¥å£æ”¶åˆ°å¸¦æœ‰VLAN 2æ ‡ç­¾çš„æ•°æ®ä¹‹åï¼Œä¼šäº¤ç”±2å·å­æ¥å£è¿›è¡ŒVLANç»ˆç»“æ“ä½œå¹¶åšåç»­å¤„ç†ã€‚ä»2å·å­æ¥å£å‘å‡ºçš„æ•°æ®ä¹Ÿä¼šå¸¦ä¸ŠVLAN 2çš„æ ‡ç­¾ã€‚ [R1-GigabitEthernet0&#x2F;0&#x2F;1.2]arp broadcast enable ç»ˆç»“å­æ¥å£ä¸èƒ½è½¬å‘å¹¿æ’­æŠ¥æ–‡ï¼Œåœ¨æ”¶åˆ°å¹¿æ’­æŠ¥æ–‡åå®ƒä»¬ç›´æ¥æŠŠè¯¥æŠ¥æ–‡ä¸¢å¼ƒã€‚ä¸ºäº†å…è®¸ç»ˆç»“å­æ¥å£èƒ½è½¬å‘å¹¿æ’­æŠ¥æ–‡ï¼Œå¯ä»¥é€šè¿‡åœ¨å­æ¥å£ä¸Šæ‰§è¡Œå‘½ä»¤arp broadcast enableä½¿èƒ½ç»ˆç»“å­æ¥å£çš„ARPå¹¿æ’­åŠŸèƒ½ã€‚éƒ¨åˆ†è®¾å¤‡é»˜è®¤ä½¿èƒ½è¯¥åŠŸèƒ½ï¼Œæ­¤å‘½ä»¤çš„é…ç½®æ ¹æ®è®¾å¤‡è€Œå®šã€‚ [R1-GigabitEthernet0&#x2F;0&#x2F;1.2]ip address 192.168.2.254 24 [R1-GigabitEthernet0&#x2F;0&#x2F;1.2]quit [R1]interface GigabitEthernet 0&#x2F;0&#x2F;1.3 [R1-GigabitEthernet0&#x2F;0&#x2F;1.3]dot1q termination vid 3 [R1-GigabitEthernet0&#x2F;0&#x2F;1.3]arp broadcast enable [R1-GigabitEthernet0&#x2F;0&#x2F;1.3]ip address 192.168.3.254 24 [R1-GigabitEthernet0&#x2F;0&#x2F;1.3]quit # æ£€æµ‹VLANé—´äº’è®¿è”é€šæ€§ ping 192.168.3.1 PING 192.168.3.1: 56 data bytes, press CTRL_C to break Reply from 192.168.3.1: bytes&#x3D;56 Sequence&#x3D;1 ttl&#x3D;254 time&#x3D;60 ms Reply from 192.168.3.1: bytes&#x3D;56 Sequence&#x3D;2 ttl&#x3D;254 time&#x3D;40 ms Reply from 192.168.3.1: bytes&#x3D;56 Sequence&#x3D;3 ttl&#x3D;254 time&#x3D;110 ms Reply from 192.168.3.1: bytes&#x3D;56 Sequence&#x3D;4 ttl&#x3D;254 time&#x3D;70 ms Reply from 192.168.3.1: bytes&#x3D;56 Sequence&#x3D;5 ttl&#x3D;254 time&#x3D;100 ms â€” 192.168.3.1 ping statistics â€” 5 packet(s) transmitted 5 packet(s) received 0.00% packet loss round-trip min&#x2F;avg&#x2F;max &#x3D; 40&#x2F;76&#x2F;110 ms tracert 192.168.3.1 traceroute to 192.168.3.1(192.168.3.1), max hops: 30 ,packet length: 40,press CTRL_C to break 1 192.168.2.254 30 ms 50 ms 50 ms 2 192.168.3.1 70 ms 60 ms 60 ms æ­¤æ—¶VLAN2å’ŒVLAN3ä¹‹é—´å·²ç»å¯ä»¥æ­£å¸¸çš„äº’è®¿ã€‚ æ­¥éª¤ 2 é€šè¿‡VLANIFæ¥å£å®ç°VLANé—´äº’è®¿ # æ¸…é™¤ä¸Šä¸€æ­¥é…ç½® [S1]interface GigabitEthernet 0&#x2F;0&#x2F;1 [S1-GigabitEthernet0&#x2F;0&#x2F;1]undo port trunk allow-pass vlan 2 3 [S1-GigabitEthernet0&#x2F;0&#x2F;1]undo port link-type [R1]undo interface GigabitEthernet 0&#x2F;0&#x2F;1.2 [R1]undo interface GigabitEthernet 0&#x2F;0&#x2F;1.3 # åœ¨S1ä¸Šåˆ›å»ºç›¸åº”çš„VLANIFæ¥å£ [S1]interface Vlanif 2 interface vlanif vlan-idå‘½ä»¤ç”¨æ¥åˆ›å»ºVLANIFæ¥å£å¹¶è¿›å…¥VLANIFæ¥å£è§†å›¾ã€‚åªæœ‰å…ˆé€šè¿‡å‘½ä»¤åˆ›å»ºVLANåï¼Œæ‰èƒ½æ‰§è¡Œinterface vlanifå‘½ä»¤åˆ›å»ºVLANIFæ¥å£ã€‚ [S1-Vlanif2]ip address 192.168.2.254 24 [S1-Vlanif2]quit [S1]interface Vlanif 3 [S1-Vlanif3]ip address 192.168.3.254 24 [S1-Vlanif3]quit # æ£€æµ‹VLANé—´äº’è®¿è”é€šæ€§ ping 192.168.3.1 PING 192.168.3.1: 56 data bytes, press CTRL_C to break Reply from 192.168.3.1: bytes&#x3D;56 Sequence&#x3D;1 ttl&#x3D;254 time&#x3D;100 ms Reply from 192.168.3.1: bytes&#x3D;56 Sequence&#x3D;2 ttl&#x3D;254 time&#x3D;50 ms Reply from 192.168.3.1: bytes&#x3D;56 Sequence&#x3D;3 ttl&#x3D;254 time&#x3D;50 ms Reply from 192.168.3.1: bytes&#x3D;56 Sequence&#x3D;4 ttl&#x3D;254 time&#x3D;60 ms Reply from 192.168.3.1: bytes&#x3D;56 Sequence&#x3D;5 ttl&#x3D;254 time&#x3D;70 ms â€” 192.168.3.1 ping statistics â€” 5 packet(s) transmitted 5 packet(s) received 0.00% packet loss round-trip min&#x2F;avg&#x2F;max &#x3D; 50&#x2F;66&#x2F;100 ms tracert 192.168.3.1 traceroute to 192.168.3.1(192.168.3.1), max hops: 30 ,packet length: 40,press CTRL_C to break 1 192.168.2.254 40 ms 30 ms 20 ms 2 192.168.3.1 40 ms 30 ms 40 ms æ­¤æ—¶VLAN2å’ŒVLAN3ä¹‹é—´å·²ç»å¯ä»¥æ­£å¸¸çš„äº’è®¿ã€‚","categories":[{"name":"ipå®éªŒ","slug":"ipå®éªŒ","permalink":"http://example.com/categories/ip%E5%AE%9E%E9%AA%8C/"}],"tags":[{"name":"vlané—´é€šä¿¡","slug":"vlané—´é€šä¿¡","permalink":"http://example.com/tags/vlan%E9%97%B4%E9%80%9A%E4%BF%A1/"},{"name":"dot1q","slug":"dot1q","permalink":"http://example.com/tags/dot1q/"},{"name":"vlanif","slug":"vlanif","permalink":"http://example.com/tags/vlanif/"}]}],"categories":[{"name":"ipå®éªŒ","slug":"ipå®éªŒ","permalink":"http://example.com/categories/ip%E5%AE%9E%E9%AA%8C/"}],"tags":[{"name":"BGP","slug":"BGP","permalink":"http://example.com/tags/BGP/"},{"name":"è·¯ç”±ç­–ç•¥","slug":"è·¯ç”±ç­–ç•¥","permalink":"http://example.com/tags/%E8%B7%AF%E7%94%B1%E7%AD%96%E7%95%A5/"},{"name":"nat","slug":"nat","permalink":"http://example.com/tags/nat/"},{"name":"DHCP Relay","slug":"DHCP-Relay","permalink":"http://example.com/tags/DHCP-Relay/"},{"name":"DHCP","slug":"DHCP","permalink":"http://example.com/tags/DHCP/"},{"name":"vlané—´é€šä¿¡","slug":"vlané—´é€šä¿¡","permalink":"http://example.com/tags/vlan%E9%97%B4%E9%80%9A%E4%BF%A1/"},{"name":"dot1q","slug":"dot1q","permalink":"http://example.com/tags/dot1q/"},{"name":"vlanif","slug":"vlanif","permalink":"http://example.com/tags/vlanif/"}]}