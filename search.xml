<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>DHCP基础配置</title>
      <link href="/2023/11/25/DHCP%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE/"/>
      <url>/2023/11/25/DHCP%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<p>DHCP是一种终端自动配置协议，客户端通过DHCP协议可获取一个合法的动态IP地址。</p><h3 id="概述">概述</h3><p>随着网络规模的扩大和网络复杂度的提高，网络配置越来越复杂，经常出现计算机位置变化（如便携机或无线网络）和计算机数量超过可分配的IP地址的情况。动态主机配置协议DHCP（Dynamic Host Configuration Protocol）就是为满足这些需求而发展起来的。</p><p>DHCP协议以服务器/客户端（Server/Client）模式工作，DHCP客户端向DHCP服务器动态地请求配置信息，DHCP服务器可以很方便地为客户端动态发送配置信息。</p><h3 id="DHCP服务器">DHCP服务器</h3><p>DHCP Server即DHCP服务器，负责客户端IP地址的分配。客户端向服务器发送配置申请报文（包括IP地址、子网掩码、缺省网关等参数），服务器根据策略返回携带相应配置信息的报文，请求报文和回应报文都采用UDP进行封装。</p><h3 id="DHCP中继">DHCP中继</h3><p>DHCP Relay即DHCP中继，它是为解决服务器和客户端不在同一个网段而提出来的，它提供了对DHCP广播报文的透明传输功能，能够把DHCP客户端的广播报文透明地传送到其它网段的DHCP服务器上，同样能够把DHCP服务器端的广播报文透明地传送到其它网段的DHCP客户端。</p><h1>DHCP基础配置</h1><p><img src="/2023/11/25/DHCP%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE/dhcpzz111.png" alt="dhcpzz111">交换机4上有多个vlan，交换机1模拟dhcp服务器实现为多个vlan分配地址，交换机3作为dhcp终极连接服务器和客户端</p><h2 id="实验步骤">实验步骤</h2><h3 id="创建VLAN">创建VLAN</h3><p>[S1]vlan 40</p><p>[S3]vlan batch 10 20 30 40</p><p>[S4]vlan batch 10 20 30</p><h3 id="配置接口放通相应的VLAN">配置接口放通相应的VLAN</h3><p>[S4]interface GigabitEthernet0/0/3</p><p>[S4-GigabitEthernet0/0/3] port link-type trunk</p><p>[S4-GigabitEthernet0/0/3] port trunk allow-pass vlan 10 20 30</p><p>[S4-GigabitEthernet0/0/3] quit</p><p>[S3]interface GigabitEthernet0/0/1</p><p>[S3-GigabitEthernet0/0/1] port link-type access</p><p>[S3-GigabitEthernet0/0/1] port default vlan 40</p><p>[S3-GigabitEthernet0/0/1] quit</p><p>[S3]interface GigabitEthernet0/0/3</p><p>[S3-GigabitEthernet0/0/3] port link-type trunk</p><p>[S3-GigabitEthernet0/0/3] port trunk allow-pass vlan 10 20 30</p><p>[S3-GigabitEthernet0/0/3] quit</p><p>[S1]interface GigabitEthernet0/0/12</p><p>[S1-GigabitEthernet0/0/12] port link-type access</p><p>[S1-GigabitEthernet0/0/12] port default vlan 40</p><p>[S1-GigabitEthernet0/0/12] quit</p><p>交换机4和交换机3之间因为放通多个vlan，所以使用trunk口，交换机3和交换机1之间只有一个vlan40，所以配置access口，pvid=40</p><h3 id="VLANIF配置">VLANIF配置</h3><p>[S4]interface Vlanif 10</p><p>[S4-Vlanif10] quit</p><p>[S4]interface Vlanif 20</p><p>[S4-Vlanif20] quit</p><p>[S4]interface Vlanif 30</p><p>[S4-Vlanif30] quit</p><p>[S3]interface Vlanif 10</p><p>[S3-Vlanif10] ip address 10.0.10.3 24</p><p>[S3-Vlanif10] quit</p><p>[S3]interface Vlanif 20</p><p>[S3-Vlanif20] ip address 10.0.20.3 24</p><p>[S3-Vlanif20] quit</p><p>[S3]interface Vlanif 30</p><p>[S3-Vlanif30] ip address 10.0.30.3 24</p><p>[S3-Vlanif30] quit</p><p>[S3]interface Vlanif 40</p><p>[S3-Vlanif40] ip address 10.0.40.3 24</p><p>[S3-Vlanif40] quit</p><p>[S1]interface Vlanif 40</p><p>[S1-Vlanif40] ip address 10.0.40.1 24</p><p>[S1-Vlanif40] quit</p><p>检查一下交换机3和1之间的连通性</p><p>（开启DHCP服务，配置全局地址池，同时为S4上的VLANIF30分配静态IP地址。）：</p><h3 id="开启DHCP服务">开启DHCP服务</h3><p>[S1]dhcp enable</p><h3 id="创建地址池VLAN10，用于给S4的VLANIF10分配地址">创建地址池VLAN10，用于给S4的VLANIF10分配地址</h3><p>[S1]ip pool vlan10 //创建地址池名为vlan10</p><p>[S1-ip-pool-vlan10] gateway-list 10.0.10.3  //网关是中继上的vlanif 10</p><p>[S1-ip-pool-vlan10] network 10.0.10.0 mask 255.255.255.0 <a href="//xn--ip10-pg9f84x2x2aez8b5zgprxk5n.0.10.1-10.0.10.255">//设置分配ip范围是10.0.10.1-10.0.10.255</a></p><p>[S1-ip-pool-vlan10] dns-list 10.0.10.3</p><p>[S1-ip-pool-vlan10] quit</p><h3 id="创建地址池VLAN20，用于给S4的VLANIF20分配地址">创建地址池VLAN20，用于给S4的VLANIF20分配地址</h3><p>[S1]ip pool vlan20</p><p>[S1-ip-pool-vlan20] gateway-list 10.0.20.3</p><p>[S1-ip-pool-vlan20] network 10.0.20.0 mask 255.255.255.0</p><p>[S1-ip-pool-vlan20] dns-list 10.0.20.3</p><p>[S1-ip-pool-vlan20] quit</p><h3 id="创建地址池VLAN30，用于给S4的VLANIF30分配地址">创建地址池VLAN30，用于给S4的VLANIF30分配地址</h3><p>[S1]ip pool vlan30</p><p>[S1-ip-pool-vlan30] gateway-list 10.0.30.3</p><p>[S1-ip-pool-vlan30] network 10.0.30.0 mask 255.255.255.0</p><p>[S1-ip-pool-vlan30] dns-list 10.0.30.3</p><p>[S1-ip-pool-vlan30] quit</p><h3 id="查看s4的vlanif30的mac">查看s4的vlanif30的mac</h3><p>为了实现给s4的vlanif30口静态绑定一个指定的ip地址，我们需要先查看一下mac<img src="/2023/11/25/DHCP%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE/macsiis30.png" alt="macsiis30"></p><h3 id="在S1上为S4的VLANIF30配置静态地址分配">在S1上为S4的VLANIF30配置静态地址分配</h3><p><img src="/2023/11/25/DHCP%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE/mac0234.png" alt="mac0234"></p><p>给s4的vlanif口静态分配ip：10.0.30.2</p><h3 id="在VLANIF40接口下使能DHCP-Server">在VLANIF40接口下使能DHCP Server</h3><p>[S1]interface Vlanif 40</p><p>[S1-Vlanif40] dhcp select global //全局的使能</p><h3 id="查看IP地址池配置情况">查看IP地址池配置情况</h3><p>[S1]display ip pool name vlan30</p><p><img src="/2023/11/25/DHCP%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE/3chakan0.png" alt="3chakan0"></p><p>地址池vlan30已经存在一个“Used”地址，该地址为静态分配的地址。</p><h3 id="配置前往用户网段的路由">配置前往用户网段的路由</h3><p>[S1]ip route-static 10.0.10.0 24 10.0.40.3</p><p>[S1]ip route-static 10.0.20.0 24 10.0.40.3</p><p>[S1]ip route-static 10.0.30.0 24 10.0.40.3</p><p>（或者配置缺省路由）</p><p>保证连通性</p><p>在S3上完成DHCP Relay相关配置</p><h3 id="开启DHCP服务-2">开启DHCP服务</h3><p>[S3]dhcp enable</p><h3 id="在接口上配置DHCP-Relay，指定DHCP-Server">在接口上配置DHCP Relay，指定DHCP Server</h3><p>[S3]interface Vlanif10</p><p>[S3-Vlanif10] dhcp select relay</p><p>[S3-Vlanif10] dhcp relay server-ip 10.0.40.1</p><p>[S3-Vlanif10] quit</p><p>[S3]interface Vlanif20</p><p>[S3-Vlanif20] dhcp select relay</p><p>[S3-Vlanif20] dhcp relay server-ip 10.0.40.1</p><p>[S3-Vlanif20] quit</p><p>[S3]interface Vlanif30</p><p>[S3-Vlanif30] dhcp select relay</p><p>[S3-Vlanif30] dhcp relay server-ip 10.0.40.1</p><p>[S3-Vlanif30] quit</p><h3 id="查看relay配置">查看relay配置</h3><p><img src="/2023/11/25/DHCP%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE/relayallss7.png" alt="relayallss7"></p><h3 id="DHCP-Client配置">DHCP Client配置</h3><p>在S4上配置VLANIF10、20、30接口通过DHCP获取IP地址</p><h4 id="开启DHCP服务-3">开启DHCP服务</h4><p>[S4]dhcp enable</p><h4 id="开启接口通过DHCP获取地址">开启接口通过DHCP获取地址</h4><p>[S4]interface Vlanif10</p><p>[S4-Vlanif10] ip address dhcp-alloc</p><p>[S4-Vlanif10] quit</p><p>[S4]interface Vlanif20</p><p>[S4-Vlanif20] ip address dhcp-alloc</p><p>[S4-Vlanif20] quit</p><p>[S4]interface Vlanif30</p><p>[S4-Vlanif30] ip address dhcp-alloc</p><p>[S4-Vlanif30] quit</p><h4 id="查看各个接口IP地址获取情况">查看各个接口IP地址获取情况</h4><p><S4>display interface Vlanif 10</S4></p><p>Vlanif10 current state : UP</p><p>Line protocol current state : UP</p><p>Last line protocol up time : 2020-06-05 17:37:57 UTC-08:00</p><p>Description:</p><p>Route Port,The Maximum Transmit Unit is 1500</p><p>Internet Address is allocated by DHCP, 10.0.10.254/24</p><p>[S4]display interface Vlanif 20</p><p>Vlanif20 current state : UP</p><p>Line protocol current state : UP</p><p>Last line protocol up time : 2020-06-05 17:41:23 UTC-08:00</p><p>Description:</p><p>Route Port,The Maximum Transmit Unit is 1500</p><p>Internet Address is allocated by DHCP, 10.0.20.254/24</p><p>[S4]display interface Vlanif 30</p><p>Vlanif30 current state : UP</p><p>Line protocol current state : UP</p><p>Last line protocol up time : 2020-06-05 17:43:22 UTC-08:00</p><p>Description:</p><p>Route Port,The Maximum Transmit Unit is 1500</p><p>Internet Address is allocated by DHCP, 10.0.30.2/24</p><p>接口已经通过DHCP获取到IP地址，并且VLANIF30的地址为静态分配的地址：10.0.30.2。</p>]]></content>
      
      
      <categories>
          
          <category> ip实验 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DHCP Relay </tag>
            
            <tag> DHCP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vlan间通信</title>
      <link href="/2023/11/24/vlan%E9%97%B4%E9%80%9A%E4%BF%A1/"/>
      <url>/2023/11/24/vlan%E9%97%B4%E9%80%9A%E4%BF%A1/</url>
      
        <content type="html"><![CDATA[<h1>VLAN间通信</h1><h2 id="实验拓扑">实验拓扑</h2><p><img src="/2023/11/24/vlan%E9%97%B4%E9%80%9A%E4%BF%A1/vlantx001.png" alt="vlantx001"></p><p>详解：R2划入vlan2，R3划入vlan3，与交换机之间采用access口，由于交换机g0/0/1需要通过多个vlan，所以配成trunk口。R2和R3相当于主机，发送和接受的数据都不带标签，交换机g0/0/2收到R2发送的数据，打上标签vlan2，然后发出去；交换机g0/0/1收到数据后，发现vlan的标签允许通过，则数据带着vlan2的标签通过；然后交换机g0/0/3口转发数据时，发现自己的pvid是vlan3，和vlan2不一样，所以不接受，则vlan2和vlan3不能通信。</p><p>在某些场景下，需要特定vlan之间通信</p><p>方法一：dot1q接口</p><p>在r1上配置两个dot1q接口，g0/0/1.1和g0/0/1.2，分别对应vlan2和vlan3，作用就是可以终结vlan标签（剥离），vlan2的标签到r1后，被剥离掉vlan2的标签，然后转发时又被g0/0/1.2打上vlan3的标签，交换机g0/0/1通过，到g0/0/3，access口发现和自己的pvid一样，然后剥离掉标签，转发数据帧给r3.</p><p>方法二：vlanif接口：交换机上配置vlanif2和vlanif3，ip地址配成192.168.2.254和192.168.3.254</p><p>其实就是相当于两个不同网段的网关，然后实现三层的转发</p><h2 id="背景">背景</h2><p>划分VLAN后，不同VLAN的用户间不能二层互访，这样能起到隔离广播的作用。但实际应用中，不同VLAN的用户又常有互访的需求，此时就需要实现不同VLAN的用户互访，简称VLAN间互访。</p><p>华为提供了多种技术实现VLAN间互访，常用的两种技术为VLANIF接口和Dot1q终结子接口。</p><h2 id="Access接口">Access接口</h2><p>交换机上常用来连接用户PC、服务器等终端设备的接口。Access接口所连接的这些设备的网卡往往只收发无标记帧。Access接口只能加入一个VLAN。只能允许一个VLAN通过。</p><p><strong>转发原则</strong></p><p>接收原则：</p><p>①收到不带标签的数据帧，打上标签，vlan id=端口的PVID</p><p>②收到带标签的数据帧，检查数据帧vlan id是否和端口的PVID相同，相同直接接收；不同拒绝接收</p><p>发送原则：</p><p>①数据帧vlan id和端口PVID 相同，剥离标签发送；</p><p>②数据帧vlan id和端口PVID 不同，禁止发送。</p><h2 id="Trunk接口">Trunk接口</h2><p>Trunk接口允许多个VLAN的数据帧通过，这些数据帧通过802.1Q Tag实现区分。Trunk接口常用于交换机之间的互联，也用于连接路由器、防火墙等设备的</p><p>子接口</p><p><strong>转发原则</strong></p><p>接收原则：</p><p>①收到不带标签的数据帧，打上标签，vlan id=端口的PVID，然后查看该vlanid是否在允许列表中，是–接收，不是–拒绝</p><p>②收到带标签的数据帧，查看该vlan id是否在允许列表中，是–接收，不是–拒绝</p><p>发送原则：</p><p>查看vlan id是否在允许列表中，I:不是–拒绝发送；II：是，查看接口的PVID和vlan id是否相同，相同–剥标签发送；不同–直接发送。</p><h2 id="Hybrid接口">Hybrid接口</h2><p>Hybrid接口与Trunk接口类似，也允许多个VLAN的数据帧通过，这些数据帧通过802.1Q Tag实现区分。用户可以灵活指定Hybrid接口在发送某个（或某些）VLAN的数据帧时是否携带Tag</p><p><strong>转发原则</strong></p><p>接收原则：</p><p>①收到不带标签的数据帧，打上标签，vlan id=端口的PVID，然后查看该vlanid是否在允许列表中，是–接收，不是–拒绝</p><p>②收到带标签的数据帧，查看该vlan id是否在允许列表中，是–接收，不是–拒绝发送原则：查看vlan id是否在允许列表中，I:不是–拒绝发送；II：是，是否带标签发送取决于接口的配置。</p><h2 id="PVID">PVID</h2><p>可以手工修改，默认是1，access口的就是本身的vlan号，trunk可以有一个主vlan和多个副vlan，收到的数据和主vlan相同就剥离转发，收到和主vlan不一样的标签，查表，看看是不是在允许通过的列表，如果有，就带着原来的转发，要是没有，就不让过去啦。</p><h2 id="实验配置过程">实验配置过程</h2><p># R2和R3的IP地址及网关配置</p><p><R2> system-view</R2></p><p>Enter system view, return user view with Ctrl+Z.</p><p>[R2]interface GigabitEthernet 0/0/1</p><p>[R2-GigabitEthernet0/0/1]ip address 192.168.2.1 24</p><p>[R2-GigabitEthernet0/0/1]quit</p><p>[R2]ip route-static 0.0.0.0 0 192.168.2.254</p><p>配置默认路由，相当于给设备配置了网关。</p><p><R3>system-view</R3></p><p>Enter system view, return user view with Ctrl+Z.</p><p>[R3]interface GigabitEthernet 0/0/1</p><p>[R3-GigabitEthernet0/0/1]ip address 192.168.3.1 24</p><p>[R3-GigabitEthernet0/0/1]quit</p><p>[R3]ip route-static 0.0.0.0 0 192.168.3.254</p><p># 在S1上对R2和R3进行VLAN划分</p><p>[S1]vlan batch 2 3</p><p>Info: This operation may take a few seconds. Please wait for a moment…done.</p><p>[S1]interface GigabitEthernet 0/0/2</p><p>[S1-GigabitEthernet0/0/2]port link-type access</p><p>[S1-GigabitEthernet0/0/2]port default vlan 2</p><p>[S1-GigabitEthernet0/0/2]quit</p><p>[S1]interface GigabitEthernet 0/0/3</p><p>[S1-GigabitEthernet0/0/3]port link-type access</p><p>[S1-GigabitEthernet0/0/3]port default vlan 3</p><p>步骤 1 通过Dot1q终结子接口实现VLAN间互访</p><p># 配置S1上的Trunk接口</p><p>[S1]interface GigabitEthernet 0/0/1</p><p>[S1-GigabitEthernet0/0/1]port trunk allow-pass vlan 2 3</p><p><em>因为VLAN间<strong>互访数据要</strong>由R1来终结VLAN</em>*，<strong>所以S1和R1之间</strong>的链路要允许<strong>VLAN2和VLAN3通过</strong>。*</p><p># 在R1上创建并配置Dot1q终结子接口</p><p>[R1]interface GigabitEthernet 0/0/1.2</p><p>创建并进入子接口视图。2代表子接口的编号，一般建议子接口编号与VLAN ID相同，方便记忆。</p><p>[R1-GigabitEthernet0/0/1.2]dot1q termination vid 2</p><p><strong>dot1q termination vid</strong> <em>vlan-id</em>命令用来配置子接口Dot1q终结的VLAN ID。</p><p>以此配置为例：当GigabitEthernet0/0/1接口收到带有VLAN 2标签的数据之后，会交由2号子接口进行VLAN终结操作并做后续处理。从2号子接口发出的数据也会带上VLAN 2的标签。</p><p>[R1-GigabitEthernet0/0/1.2]arp broadcast enable</p><p>终结子接口不能转发广播报文，在收到广播报文后它们直接把该报文丢弃。为了允许终结子接口能转发广播报文，可以通过在子接口上执行命令<strong>arp broadcast enable</strong>使能终结子接口的ARP广播功能。部分设备默认使能该功能，此命令的配置根据设备而定。</p><p>[R1-GigabitEthernet0/0/1.2]ip address 192.168.2.254 24</p><p>[R1-GigabitEthernet0/0/1.2]quit</p><p>[R1]interface GigabitEthernet 0/0/1.3</p><p>[R1-GigabitEthernet0/0/1.3]dot1q termination vid 3</p><p>[R1-GigabitEthernet0/0/1.3]arp broadcast enable</p><p>[R1-GigabitEthernet0/0/1.3]ip address 192.168.3.254 24</p><p>[R1-GigabitEthernet0/0/1.3]quit</p><p># 检测VLAN间互访联通性</p><p><R2>ping 192.168.3.1</R2></p><p>PING 192.168.3.1: 56  data bytes, press CTRL_C to break</p><p>Reply from 192.168.3.1: bytes=56 Sequence=1 ttl=254 time=60 ms</p><p>Reply from 192.168.3.1: bytes=56 Sequence=2 ttl=254 time=40 ms</p><p>Reply from 192.168.3.1: bytes=56 Sequence=3 ttl=254 time=110 ms</p><p>Reply from 192.168.3.1: bytes=56 Sequence=4 ttl=254 time=70 ms</p><p>Reply from 192.168.3.1: bytes=56 Sequence=5 ttl=254 time=100 ms</p><p>— 192.168.3.1 ping statistics —</p><p>5 packet(s) transmitted</p><p>5 packet(s) received</p><p>0.00% packet loss</p><p>round-trip min/avg/max = 40/76/110 ms</p><p><R2>tracert 192.168.3.1</R2></p><p>traceroute to  192.168.3.1(192.168.3.1), max hops: 30 ,packet length: 40,press CTRL_C to break</p><p>1 192.168.2.254 30 ms  50 ms  50 ms</p><p>2 192.168.3.1 70 ms  60 ms  60 ms</p><p>此时VLAN2和VLAN3之间已经可以正常的互访。</p><p>步骤 2 通过VLANIF接口实现VLAN间互访</p><p># 清除上一步配置</p><p>[S1]interface GigabitEthernet 0/0/1</p><p>[S1-GigabitEthernet0/0/1]undo port trunk allow-pass vlan 2 3</p><p>[S1-GigabitEthernet0/0/1]undo port link-type</p><p>[R1]undo interface GigabitEthernet 0/0/1.2</p><p>[R1]undo interface GigabitEthernet 0/0/1.3</p><p># 在S1上创建相应的VLANIF接口</p><p>[S1]interface Vlanif 2</p><p><strong>interface vlanif</strong> <em>vlan-id</em>命令用来创建VLANIF接口并进入VLANIF接口视图。只有先通过命令创建VLAN后，才能执行interface vlanif命令创建VLANIF接口。</p><p>[S1-Vlanif2]ip address 192.168.2.254 24</p><p>[S1-Vlanif2]quit</p><p>[S1]interface Vlanif 3</p><p>[S1-Vlanif3]ip address 192.168.3.254 24</p><p>[S1-Vlanif3]quit</p><p># 检测VLAN间互访联通性</p><p><R2>ping 192.168.3.1</R2></p><p>PING 192.168.3.1: 56  data bytes, press CTRL_C to break</p><p>Reply from 192.168.3.1: bytes=56 Sequence=1 ttl=254 time=100 ms</p><p>Reply from 192.168.3.1: bytes=56 Sequence=2 ttl=254 time=50 ms</p><p>Reply from 192.168.3.1: bytes=56 Sequence=3 ttl=254 time=50 ms</p><p>Reply from 192.168.3.1: bytes=56 Sequence=4 ttl=254 time=60 ms</p><p>Reply from 192.168.3.1: bytes=56 Sequence=5 ttl=254 time=70 ms</p><p>— 192.168.3.1 ping statistics —</p><p>5 packet(s) transmitted</p><p>5 packet(s) received</p><p>0.00% packet loss</p><p>round-trip min/avg/max = 50/66/100 ms</p><p><R2>tracert 192.168.3.1</R2></p><p>traceroute to  192.168.3.1(192.168.3.1), max hops: 30 ,packet length: 40,press CTRL_C to break</p><p>1 192.168.2.254 40 ms  30 ms  20 ms</p><p>2 192.168.3.1 40 ms  30 ms  40 ms</p><p>此时VLAN2和VLAN3之间已经可以正常的互访。</p>]]></content>
      
      
      <categories>
          
          <category> ip实验 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vlan间通信 </tag>
            
            <tag> dot1q </tag>
            
            <tag> vlanif </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
